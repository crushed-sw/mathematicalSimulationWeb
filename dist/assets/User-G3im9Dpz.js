import{a as V,a0 as B,a1 as N,k as p,o as k,c as I,g as s,f as c,$ as X,u as t,M as J,t as C,y as a,x as $,a2 as Y,a3 as G,a4 as F,W as P,O as L,P as T,_ as O,Y as j,w as S,l as M,F as H,j as W,e as q,Z as ee,b as te,A as ae,E as se}from"./index-n6R6eWql.js";import{s as z}from"./fieldset.esm-eP25ExgE.js";import{s as U,a as ie}from"./tabpanel.esm-JyXj12zM.js";import{s as Z}from"./paginator.esm-0yz6-6Rm.js";const A=m=>(L("data-v-218b431a"),m=m(),T(),m),ne={class:"h-full m-3"},oe={class:"flex justify-content-between"},le={class:"flex"},re={class:"flex flex-column ml-3"},ce=A(()=>a("span",null,"昵称",-1)),ue=A(()=>a("span",null,"邮箱",-1)),de={class:"flex flex-column justify-content-around gap-2"},fe=A(()=>a("div",{class:"flex align-items-center justify-content-center"},[a("span",{class:"font-bold white-space-nowrap"},"更改昵称")],-1)),me={class:"flex align-items-center pt-4"},ge=A(()=>a("label",{for:"username"},"新昵称",-1)),ve=V({__name:"UserInform",setup(m){const i=B(),e=N(),_=p(""),n=p(!1);function g(){}function o(){_.value="",n.value=!0}function l(){n.value=!1}function r(){P.get(`api/change_username?userid=${e.config.userid}&username=${_.value}&email=${e.config.email}&token=${e.config.token}`).then(function(v){if(v.data.success){const x=v.data.data;e.config.username=x.split('"')[1],i.add({severity:"success",summary:"成功",detail:v.data.message,life:2e3});const u={login:e.config.login,email:e.config.email,userid:e.config.userid,username:e.config.username,avatar:e.config.avatar};localStorage.setItem("mathmatic-crushed-login",JSON.stringify(u))}else i.add({severity:"error",summary:"失败",detail:v.data.message,life:2e3}),v.data.code===20041&&(e.clearConfig(),localStorage.removeItem("mathmatic-crushed-login"))}),l()}return(v,x)=>(k(),I("div",ne,[s(t(z),{class:"w-full",legend:"个人信息"},{default:c(()=>[a("div",oe,[a("div",le,[s(t(X),{image:t(e).config.avatar,size:"large",shape:"circle"},null,8,["image"]),a("div",re,[a("div",null,[ce,J("："),a("span",null,C(t(e).config.username),1)]),a("div",null,[ue,J("："),a("span",null,C(t(e).config.email),1)])])]),a("div",de,[s(t($),{label:"更改头像",outlined:"",severity:"secondary",onClick:g}),s(t($),{label:"更改昵称",outlined:"",severity:"secondary",onClick:o})])])]),_:1}),s(t(F),{visible:n.value,"onUpdate:visible":x[1]||(x[1]=u=>n.value=u),modal:"",header:"Edit Profile",style:{width:"25rem"}},{header:c(()=>[fe]),footer:c(()=>[s(t($),{label:"取消",outlined:"",severity:"secondary",onClick:l,autofocus:""}),s(t($),{label:"确定",outlined:"",severity:"secondary",onClick:r})]),default:c(()=>[a("div",me,[s(t(Y),{class:"w-full"},{default:c(()=>[s(t(G),{class:"w-full",id:"username",modelValue:_.value,"onUpdate:modelValue":x[0]||(x[0]=u=>_.value=u)},null,8,["modelValue"]),ge]),_:1})])]),_:1},8,["visible"])]))}}),_e=O(ve,[["__scopeId","data-v-218b431a"]]),pe=m=>(L("data-v-48346a74"),m=m(),T(),m),he=pe(()=>a("div",{class:"flex align-items-center justify-content-center"},[a("span",{class:"font-bold white-space-nowrap"},"是否删除文章")],-1)),ye={class:"flex align-items-center px-2"},$e={class:"font-bold"},xe={class:"flex flex-column"},we={class:"m-0"},be={class:"flex justify-content-between align-items-end"},ke={class:"text-400 text-sm"},Ce=["onClick"],Pe=V({__name:"OwnArticle",setup(m){const i=j(),e=N(),_=p(0),n=p(!1),g=p("");function o(u=!1){(u||e.user.ownPageRequest)&&(P.get(`/api/get_num_own_article?userid=${e.config.userid}&email=${e.config.email}&token=${e.config.token}&page=-1`).then(function(h){h.data.success?_.value=Math.ceil(Number(h.data.data)/10):h.data.code===20041&&(e.clearConfig(),i.push("/forum/forum"))}),P.get(`/api/get_own_article?userid=${e.config.userid}&email=${e.config.email}&token=${e.config.token}&page=${e.user.ownPage}`).then(function(h){if(h.data.success){const y=JSON.parse(h.data.data);e.user.ownPageContent=y.records}else h.data.code===20041&&(e.clearConfig(),i.push("/forum/forum"))}))}function l(u){i.push({path:`/article/${u}`})}function r(u){n.value=!0,g.value=u.toString()}function v(){n.value=!1}function x(){P.get(`/api/delete_article?email=${e.config.email}&token=${e.config.token}&id=${g.value}`).then(function(u){console.log(u),u.data.success?o(!0):u.data.code===20041&&(e.clearConfig(),i.push("/forum/forum"))}),v()}return S(()=>e.user.ownPage,()=>{o(!0)}),S(()=>e.user.index,()=>{e.user.index==0&&o()}),M(()=>{o(!0)}),(u,h)=>(k(),I("div",null,[s(t(F),{visible:n.value,"onUpdate:visible":h[0]||(h[0]=y=>n.value=y),modal:"",header:"Edit Profile",style:{width:"25rem"}},{header:c(()=>[he]),footer:c(()=>[s(t($),{label:"取消",outlined:"",severity:"secondary",onClick:v,autofocus:""}),s(t($),{label:"确定",outlined:"",severity:"secondary",onClick:x})]),_:1},8,["visible"]),(k(!0),I(H,null,W(t(e).user.ownPageContent,y=>(k(),q(t(z),{class:"w-full prevent-select mb-3",legend:y.title,onClick:R=>l(y.id)},{legend:c(()=>[a("div",ye,[a("span",$e,C(y.title),1)])]),default:c(()=>[a("div",xe,[a("p",we,C(y.content),1),a("div",be,[a("p",ke,C(y.time),1),a("i",{class:"pi pi-trash mr-5",onClick:ee(R=>r(y.id),["stop"])},null,8,Ce)])])]),_:2},1032,["legend","onClick"]))),256)),s(t(Z),{first:t(e).user.ownPage,"onUpdate:first":h[1]||(h[1]=y=>t(e).user.ownPage=y),rows:1,totalRecords:_.value,template:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink JumpToPageInput"},null,8,["first","totalRecords"])]))}}),Ie=O(Pe,[["__scopeId","data-v-48346a74"]]),Se={class:"flex align-items-center px-2"},Ve={class:"font-bold"},Ne={class:"flex flex-column"},Re={class:"m-0"},Ae={class:"flex justify-content-between align-items-end"},Ue={class:"text-400 text-sm"},Fe=V({__name:"FavoriteArticle",setup(m){const i=j(),e=N(),_=p(0);p(!1),p("");function n(o=!1){(o||e.user.favoritePageRequest)&&(e.user.favoritePageContent=[],P.get(`/api/get_num_favorite?userid=${e.config.userid}&email=${e.config.email}&token=${e.config.token}&page=-1`).then(function(l){l.data.success?_.value=Math.ceil(Number(l.data.data)/10):l.data.code===20041&&(e.clearConfig(),i.push("/forum/forum"))}),P.get(`/api/get_favorite?userid=${e.config.userid}&email=${e.config.email}&token=${e.config.token}&page=${e.user.favoritePage}`).then(function(l){if(l.data.success){const r=JSON.parse(l.data.data);e.user.favoritePageContent=r}else l.data.code===20041&&(e.clearConfig(),i.push("/forum/forum"))}))}function g(o){i.push({path:`/article/${o}`})}return S(()=>e.user.favoritePage,()=>{n(!0)}),S(()=>e.user.index,()=>{e.user.index==1&&n()}),M(()=>{n(!0)}),(o,l)=>(k(),I("div",null,[(k(!0),I(H,null,W(t(e).user.favoritePageContent,r=>(k(),q(t(z),{class:"w-full prevent-select mb-3",legend:r.title,onClick:v=>g(r.id)},{legend:c(()=>[a("div",Se,[a("span",Ve,C(r.title),1)])]),default:c(()=>[a("div",Ne,[a("p",Re,C(r.content),1),a("div",Ae,[a("p",Ue,C(r.time),1)])])]),_:2},1032,["legend","onClick"]))),256)),s(t(Z),{first:t(e).user.favoritePage,"onUpdate:first":l[0]||(l[0]=r=>t(e).user.favoritePage=r),rows:1,totalRecords:_.value,template:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink JumpToPageInput"},null,8,["first","totalRecords"])]))}}),K=m=>(L("data-v-fd116d1d"),m=m(),T(),m),Le={class:""},Te=K(()=>a("div",{class:"flex align-items-center justify-content-center"},[a("span",{class:"font-bold white-space-nowrap"},"标题(最多50字符)")],-1)),Oe={class:"flex align-items-center pt-4"},je=K(()=>a("label",{for:"title"},"标题",-1)),Me={class:"flex flex-column"},qe={class:"flex mb-3 gap-3"},ze=V({__name:"Content",props:{width:{type:Number,required:!0},height:{type:Number,required:!0}},setup(m){const i=B(),e=p(""),_=p(),n=p(!1),g=p(""),o=N();function l(){const d=new Date;let f=d.getMonth()+1,w=d.getDate();return f<=9&&(f="0"+f),w<=9&&(w="0"+w),d.getFullYear()+"-"+f+"-"+w+" "+d.getHours()+":"+d.getMinutes()+":"+d.getSeconds()}function r(){_.value.click()}async function v(d){const f=d.target.files;if(f.length!=0){const w=await x(f[0]);e.value=w}}function x(d){return new Promise((f,w)=>{const b=new FileReader;b.readAsText(d,"UTF-8"),b.onload=function(D){const E=D.target.result;E?f(E):w(D)}})}function u(){localStorage.setItem("mathmatic-article",e.value),i.add({severity:"success",summary:"成功",detail:"草稿保存成功",life:2e3})}function h(){let d=localStorage.getItem("mathmatic-article");d===null?i.add({severity:"info",summary:"消息",detail:"您还没有草稿",life:2e3}):e.value=d}function y(){n.value=!0,g.value=""}function R(){n.value=!1}function Q(){if(g.value.trim().length===0){i.add({severity:"warn",summary:"警告",detail:"标题不能为空",life:2e3});return}if(g.value.trim().length>50){i.add({severity:"warn",summary:"警告",detail:"标题字数大于50",life:2e3});return}P.post("/api/publish_article",{title:g.value,content:e.value,time:l(),author:o.config.userid,email:o.config.email,token:o.config.token},{headers:{"Content-Type":"application/json"}}).then(function(d){d.data.success?(o.user.ownPageRequest=!0,o.user.index=0,i.add({severity:"info",summary:"信息",detail:d.data.message,life:2e3}),R()):i.add({severity:"error",summary:"错误",detail:d.data.message,life:2e3})}).catch(function(){i.add({severity:"error",summary:"错误",detail:"请求发送失败",life:2e3})})}return(d,f)=>{const w=te("v-md-editor");return k(),I("div",Le,[s(t(F),{visible:n.value,"onUpdate:visible":f[1]||(f[1]=b=>n.value=b),modal:"",header:"Edit Profile",style:{width:"25rem"}},{header:c(()=>[Te]),footer:c(()=>[s(t($),{label:"取消",outlined:"",severity:"secondary",onClick:R,autofocus:""}),s(t($),{label:"确定",outlined:"",severity:"secondary",onClick:Q})]),default:c(()=>[a("div",Oe,[s(t(Y),{class:"w-full"},{default:c(()=>[s(t(G),{class:"w-full",id:"title",modelValue:g.value,"onUpdate:modelValue":f[0]||(f[0]=b=>g.value=b)},null,8,["modelValue"]),je]),_:1})])]),_:1},8,["visible"]),s(t(ie),{scrollable:!0,activeIndex:t(o).user.index,"onUpdate:activeIndex":f[3]||(f[3]=b=>t(o).user.index=b)},{default:c(()=>[s(t(U),{header:"我的文章"},{default:c(()=>[s(Ie)]),_:1}),s(t(U),{header:"收藏"},{default:c(()=>[s(Fe)]),_:1}),s(t(U),{header:"写文章"},{default:c(()=>[a("div",Me,[a("div",qe,[s(t($),{label:"保存草稿",outlined:"",severity:"secondary",onClick:u}),s(t($),{label:"加载草稿",outlined:"",severity:"secondary",onClick:h}),s(t($),{label:"上传文章",outlined:"",severity:"secondary",onClick:r}),s(t($),{label:"发布文章",outlined:"",severity:"secondary",onClick:y})]),s(w,{modelValue:e.value,"onUpdate:modelValue":f[2]||(f[2]=b=>e.value=b),height:`${m.height-150}px`},null,8,["modelValue","height"])])]),_:1})]),_:1},8,["activeIndex"]),a("input",{type:"file",ref_key:"uploadFile",ref:_,name:"file",hidden:"true",onInput:v},null,544)])}}}),De=O(ze,[["__scopeId","data-v-fd116d1d"]]),Ge=V({__name:"User",setup(m){const i=j(),e=N(),_=ae(()=>e.user.index!=2);let n=p(0),g=p(0);function o(r){for(const v of r)g.value=v.contentRect.width,n.value=v.contentRect.height}const l=p();return M(()=>{new ResizeObserver(o).observe(l.value),e.config.login||i.push("/forum/forum")}),S(()=>e.config.login,()=>{e.config.login||i.push("/forum/forum")}),(r,v)=>(k(),I("div",{class:"w-full h-full flex flex-column",ref_key:"contentContainer",ref:l},[_.value?(k(),q(_e,{key:0,class:"h-10rem"})):se("",!0),s(De,{class:"flex-1",width:t(g),height:t(n)},null,8,["width","height"])],512))}});export{Ge as default};
