import{d as $e,r as W,k as te,a as K,o as $,c as R,t as qe,_ as Le,b as j,e as Z,f as ce,g as A,A as fe,F as le,j as ue,w as me,n as be,i as ye,u as ge,m as Xe,z as Ye,l as Ne,y as oe,K as xe}from"./index-n6R6eWql.js";import{S as Be,P as ze,W as Re,O as Oe,D as Ge,A as Fe,B as He,V as je,a as Me,M as Ke,b as Ue,c as Je}from"./OrbitControls-_KwZQ4Pf.js";var c=(i=>(i[i.None=0]="None",i[i.Line=1]="Line",i[i.MultiLine=2]="MultiLine",i[i.Dash=3]="Dash",i[i.MultiDash=4]="MultiDash",i[i.Point=5]="Point",i[i.MultiPoint=6]="MultiPoint",i))(c||{}),pe=(i=>(i[i.None=0]="None",i[i.Font=1]="Font",i[i.Left=2]="Left",i[i.Top=3]="Top",i[i.All=4]="All",i))(pe||{});function Pe(i,e,t,N){return Math.sqrt(Math.pow(t-i,2)+Math.pow(N-e,2))}const se=$e("threeViewStore",()=>{const i=new Map,e=W([]),t=W([]),N=W([]),q=W([]),V=W([]),h=W([]),a=W([]),f=W([]),y=W([]),x=W([]),r=W([]),g=W([]),L=W({ctrl:!1,shift:!1}),k=W({drawing:!1,moving:!1,x:0,y:0,hover:0,hoverState:0,clicked:[]}),d=W({drawing:!1,moving:!1,x:0,y:0,hover:0,hoverState:0,clicked:[]}),M=W({drawing:!1,moving:!1,x:0,y:0,hover:0,hoverState:0,clicked:[]}),E=te(0);let F=1,ee=1,U=1;function X(l,n,s=-1){const v=z(n);if(v){const o=u(l,v);o&&o.roots.forEach(p=>{if(p.index!==s)switch(p.type){case 1:ie(p.index,n);break;case 3:ve(p.index,n);break}})}}function ie(l,n){const s=J(n),v=z(n);if(s&&v){const o=b(l,s);if(o){const p=u(o.leaves[0],v),w=u(o.leaves[1],v);p&&w&&(o.points=[p.x,p.y,w.x,w.y]);const m=o.helps.length,P=(o.points[2]-o.points[0])/(m+1),I=(o.points[3]-o.points[1])/(m+1);for(let D=0;D<m;++D){const B=u(o.helps[D],v);B&&(B.x=o.points[0]+(D+1)*P,B.y=o.points[1]+(D+1)*I)}o.helps.forEach(D=>{X(D,n,l)})}}}function ve(l,n){const s=Q(n),v=z(n);if(s&&v){const o=G(l,s);if(o){const p=u(o.leaves[0],v),w=u(o.leaves[1],v);p&&w&&(o.points=[p.x,p.y,w.x,w.y]);const m=o.helps.length,P=(o.points[2]-o.points[0])/(m+1),I=(o.points[3]-o.points[1])/(m+1);for(let D=0;D<m;++D){const B=u(o.helps[D],v);B&&(B.x=o.points[0]+(D+1)*P,B.y=o.points[1]+(D+1)*I)}o.helps.forEach(D=>{X(D,n,l)})}}}function ae(l){let n;return l==="font"?n=q:l==="left"?n=f:l==="top"&&(n=g),n}function z(l){let n;return l==="font"?n=e:l==="left"?n=V:l==="top"&&(n=y),n}function J(l){let n;return l==="font"?n=t:l==="left"?n=h:l==="top"&&(n=x),n}function Q(l){let n;return l==="font"?n=N:l==="left"?n=a:l==="top"&&(n=r),n}function u(l,n){for(let s=0;s!==n.length;++s)if(n[s].index===l)return n[s]}function b(l,n){for(let s=0;s!==n.length;++s)if(n[s].index===l)return n[s]}function G(l,n){for(let s=0;s!==n.length;++s)if(n[s].index===l)return n[s]}function C(l,n,s,v,o,p){if(s>0){const w=z(p);if(w){const m=u(s,w);m&&m.roots.push({type:o,index:v})}return s}else{const w=z(p),m={index:-1,x:l,y:n,visible:!0,mask:!1,callBack:()=>X(m.index,p),attr:p,roots:[{type:o,index:v}]};p==="font"?(m.index=F++,i.set(`font${m.index}`,5)):p==="left"?(m.index=ee++,i.set(`left${m.index}`,5)):p==="top"&&(m.index=U++,i.set(`top${m.index}`,5));const P=ae(p);return P==null||P.push(m),w==null||w.push(m),m.index}}function T(l,n,s,v){if(v>0)return;const o=z(s),p={index:-1,x:l,y:n,visible:!0,mask:!1,callBack:()=>X(p.index,s),attr:s,roots:[]};s==="font"?(p.index=F++,i.set(`font${p.index}`,5)):s==="left"?(p.index=ee++,i.set(`left${p.index}`,5)):s==="top"&&(p.index=U++,i.set(`top${p.index}`,5));const w=ae(s);w==null||w.push(p),o==null||o.push(p)}function S(l,n,s){const v=J(s),o={index:0,points:l,visible:!0,mask:!1,attr:s,leaves:n,helps:[]};s==="font"?(o.index=F++,i.set(`font${o.index}`,1)):s==="left"?(o.index=ee++,i.set(`left${o.index}`,1)):s==="top"&&(o.index=U++,i.set(`top${o.index}`,1));const p=C(l[0],l[1],n[0],o.index,1,s),w=C(l[2],l[3],n[1],o.index,1,s);o.leaves=[p,w],v==null||v.push(o)}function _(l,n,s){const v=Q(s),o={index:0,points:l,visible:!0,mask:!1,attr:s,leaves:n,helps:[]};s==="font"?(o.index=F++,i.set(`font${o.index}`,3)):s==="left"?(o.index=ee++,i.set(`left${o.index}`,3)):s==="top"&&(o.index=U++,i.set(`top${o.index}`,3));const p=C(l[0],l[1],n[0],o.index,3,s),w=C(l[2],l[3],n[1],o.index,3,s);o.leaves=[p,w],v==null||v.push(o)}function Y(l,n){const s=z(n),v=ae(n);if(s&&v){const o=u(l,s);if(o){const p=o.roots,w=s.findIndex(P=>P.index===l);w!==-1&&s.splice(w,1);const m=v.findIndex(P=>P.index===l);m!==-1&&v.splice(m,1),p.forEach(P=>{we(P.index,P.type,n)})}}}function H(l,n,s){const v=z(s),o=ae(s);if(v&&o){const p=u(l,v);if(p){if(p.roots.length<1){const w=v.findIndex(P=>P.index===l);w!==-1&&v.splice(w,1);const m=o.findIndex(P=>P.index===l);m!==-1&&o.splice(m,1)}else if(p.roots.length===1){if(p.roots[0].index===n){const w=v.findIndex(P=>P.index===l);w!==-1&&v.splice(w,1);const m=o.findIndex(P=>P.index===l);m!==-1&&o.splice(m,1)}}else if(p.roots.length>1){const w=p.roots.findIndex(m=>m.index===n);w!==-1&&p.roots.splice(w,1)}}}}function O(l,n,s,v){const o=l(v);if(o){const p=n(s,o);if(p){const w=p.leaves;let m=[];p.helps&&(m=p.helps);const P=o.findIndex(I=>I.index===s);P!==-1&&o.splice(P,1),w.forEach(I=>{H(I,s,v)}),m.forEach(I=>{H(I,s,v)})}}}function we(l,n,s){switch(n){case 5:Y(l,s);break;case 1:O(J,b,l,s);break;case 3:O(Q,G,l,s);break}}function De(l,n){n==="font"?(k.clicked=[],k.hover=0,k.hoverState=0):n==="left"?(d.clicked=[],d.hover=0,d.hoverState=0):n==="top"&&(M.clicked=[],M.hover=0,M.hoverState=0);const s=i.get(n+l);s!==void 0&&we(l,s,n)}function Ce(l,n,s){const v=i.get(s+l);if(v&&v!==1&&v!==3)return;let o,p,w=0;if(v===1?(o=J(s),w=1,o&&(p=b(l,o))):v===3&&(o=Q(s),w=3,o&&(p=G(l,o))),p&&(p.helps||(p.helps=[]),p.helps.forEach(m=>{H(m,l,s)}),p.helps=[],n!==0)){const m=(p.points[2]-p.points[0])/(n+1),P=(p.points[3]-p.points[1])/(n+1);for(let I=1;I<=n;++I)p.helps.push(C(p.points[0]+I*m,p.points[1]+I*P,-1,p.index,w,s))}}function Ie(l,n,s,v){const o=i.get(v+l),p=i.get(v+n);if(o!==5||p!==5)return;const w=z(v);if(w){const m=u(l,w),P=u(n,w);if(m&&P){const I=Math.atan2(P.y-m.y,P.x-m.x);P.x=m.x+s*Math.cos(I),P.y=m.y+s*Math.sin(I),X(P.index,v)}}}function Ee(l,n,s){const v=i.get(s+l);if(v!==1)return;const o=J(s),p=Q(s),w=z(s);if(o&&p&&w){let m;if(v===1?m=b(l,o):v===3&&(m=G(l,p)),m){const P=u(m.leaves[0],w),I=u(m.leaves[1],w);if(P&&I){const D=Math.atan2(I.y-P.y,I.x-P.x);I.x=P.x+n*Math.cos(D),I.y=P.y+n*Math.sin(D),X(I.index,s)}}}}function Ve(l,n,s,v,o){const p=i.get(o+l),w=i.get(o+n),m=i.get(o+s);if(p!==5||w!==5||m!==5)return;const P=z(o);if(P){const I=u(l,P),D=u(n,P),B=u(s,P);if(I&&D&&B){const he=Math.atan2(I.y-D.y,I.x-D.x),de=v*Math.PI/180,ne=Pe(D.x,D.y,B.x,B.y);B.x=D.x+ne*Math.cos(he-de),B.y=D.y+ne*Math.sin(he-de),X(B.index,o)}}}function Ae(l,n,s,v){const o=i.get(v+l),p=i.get(v+n);if(o===0||o===5||p===0||p===5)return;const w=J(v),m=Q(v),P=z(v);if(w&&m&&P){let I,D;if(o===1?I=b(l,w):o===3&&(I=G(l,m)),p===1?D=b(n,w):p===3&&(D=G(n,m)),I&&D){const B=Math.atan2(I.points[1]-I.points[3],I.points[0]-I.points[2]),he=s*Math.PI/180,de=Pe(D.points[0],D.points[1],D.points[2],D.points[3]),ne=u(D.leaves[1],P);ne&&(ne.x=D.points[0]+de*Math.cos(B-he),ne.y=D.points[1]+de*Math.sin(B-he),X(ne.index,v))}}}function Te(l,n,s,v){s===5?(console.log(l,n,v),Ie(l[0],l[1],n,v)):(console.log(l,n,v),Ee(l[0],n,v))}function We(l,n,s,v){s===5?Ve(l[0],l[1],l[2],n,v):Ae(l[0],l[1],n,v)}return{drawBoardState:E,fontGlobal:k,leftGlobal:d,topGlobal:M,global:L,allShape:i,fontPointList:e,fontLineList:t,fontDashList:N,fontAllPointList:q,leftPointList:V,leftLineList:h,leftDashList:a,leftAllPointList:f,topPointList:y,topLineList:x,topDashList:r,topAllPointList:g,getPointList:z,getLineList:J,getDashList:Q,getPoint:u,getLine:b,getDash:G,addPoint:T,addLine:S,addDash:_,deleteShape:De,changeHelper:Ce,changeAngle:We,changeLength:Te}}),Qe={key:0,class:"absolute w-auto h-auto bottom-0 right-0 state-div p-2"},Ze=K({__name:"ShowState",props:{stateValue:{type:String,required:!0}},setup(i){const e=i;return(t,N)=>($(),R("div",Qe,qe(e.stateValue),1))}}),et=Le(Ze,[["__scopeId","data-v-1f61816f"]]),re=K({__name:"Point",props:{x:{type:Number,required:!0},y:{type:Number,required:!0},visible:{type:Boolean,required:!0},mask:{type:Boolean,default:!1},index:{type:Number,default:0},attr:{type:String,default:""}},setup(i){const e=i,t=se();function N(){let h;e.index>0&&(e.attr==="font"?h=t.fontGlobal:e.attr==="left"?h=t.leftGlobal:e.attr==="top"&&(h=t.topGlobal)),h&&(h.hoverState=c.Point,h.hover=e.index,h.x=e.x,h.y=e.y),h&&h.drawing&&!h.moving&&(h.clicked.splice(0,h.clicked.length),h.clicked.push(e.index))}function q(){let h;e.index>0&&(e.attr==="font"?h=t.fontGlobal:e.attr==="left"?h=t.leftGlobal:e.attr==="top"&&(h=t.topGlobal)),h&&(h.hoverState=c.None,h.hover=0),h&&h.drawing&&!h.moving&&h.clicked.splice(0,h.clicked.length)}function V(){let h;e.index>0&&(e.attr==="font"?h=t.fontGlobal.clicked:e.attr==="left"?h=t.leftGlobal.clicked:e.attr==="top"&&(h=t.topGlobal.clicked)),h&&(t.global.ctrl||h.splice(0,h.length),h.push(e.index))}return(h,a)=>{const f=j("v-circle"),y=j("v-group");return $(),Z(y,{onMouseenter:N,onMouseout:q,onClick:V,index:i.index},{default:ce(()=>[A(f,{x:i.x,y:i.y,visible:i.mask,radius:4,stroke:"rgba(255, 0, 0, 1)",strokeWidth:2},null,8,["x","y","visible","stroke"]),A(f,{x:i.x,y:i.y,visible:i.visible,radius:3,stroke:"rgba(0, 0, 0, 1)",strokeWidth:1,fill:"rgba(255, 0, 0, 1)",hitStrokeWidth:5},null,8,["x","y","visible","stroke","fill"])]),_:1},8,["index"])}}}),_e=K({__name:"Line",props:{points:{type:Array,required:!0},visible:{type:Boolean,required:!0},mask:{type:Boolean,default:!1},index:{type:Number,default:0},attr:{type:String,default:""}},setup(i){const e=i,t=se();function N(a){let f;if(e.index>0&&(e.attr==="font"?f=t.fontGlobal:e.attr==="left"?f=t.leftGlobal:e.attr==="top"&&(f=t.topGlobal)),f){f.hoverState=c.Line,f.hover=e.index;const y=e.points[0],x=e.points[1],r=e.points[2],g=e.points[3],L=a.evt.layerX,k=a.evt.layerY,d=Math.atan2(x-g,y-r),M=Math.PI/4;if(d>=-M&&d<=M||d<-3*M||d>3*M){const E=(g-x)/(r-y)*(L-y)+x;f.x=L,f.y=E}else{const E=(r-y)/(g-x)*(k-x)+y;f.x=E,f.y=k}}f&&f.drawing&&!f.moving&&(f.clicked.splice(0,f.clicked.length),f.clicked.push(e.index))}function q(){let a;e.index>0&&(e.attr==="font"?a=t.fontGlobal:e.attr==="left"?a=t.leftGlobal:e.attr==="top"&&(a=t.topGlobal)),a&&(a.hoverState=c.None,a.hover=0),a&&a.drawing&&!a.moving&&a.clicked.splice(0,a.clicked.length)}function V(a){let f;if(e.index>0&&(e.attr==="font"?f=t.fontGlobal:e.attr==="left"?f=t.leftGlobal:e.attr==="top"&&(f=t.topGlobal)),f){const y=e.points[0],x=e.points[1],r=e.points[2],g=e.points[3],L=a.evt.layerX,k=a.evt.layerY,d=Math.atan2(x-g,y-r),M=Math.PI/4;if(d>=-M&&d<=M||d<-3*M||d>3*M){const E=(g-x)/(r-y)*(L-y)+x;f.x=L,f.y=E}else{const E=(r-y)/(g-x)*(k-x)+y;f.x=E,f.y=k}}}function h(){let a;e.index>0&&(e.attr==="font"?a=t.fontGlobal.clicked:e.attr==="left"?a=t.leftGlobal.clicked:e.attr==="top"&&(a=t.topGlobal.clicked)),a&&(t.global.ctrl||a.splice(0,a.length),a.push(e.index))}return(a,f)=>{const y=j("v-line"),x=j("v-group");return $(),Z(x,{onMouseenter:N,onMousemove:V,onMouseout:q,onClick:h,index:i.index},{default:ce(()=>[A(y,{points:i.points,visible:i.mask,stroke:"rgba(255, 0, 0, 1)",strokeWidth:3},null,8,["points","visible","stroke"]),A(y,{points:i.points,visible:i.visible,stroke:"rgba(0, 0, 0, 1)",strokeWidth:1,hitStrokeWidth:7},null,8,["points","visible","stroke"])]),_:1},8,["index"])}}}),Se=K({__name:"DashLine",props:{points:{type:Array,required:!0},visible:{type:Boolean,required:!0},mask:{type:Boolean,default:!1},index:{type:Number,default:0},attr:{type:String,default:""}},setup(i){const e=i,t=se();function N(a){let f;if(e.index>0&&(e.attr==="font"?f=t.fontGlobal:e.attr==="left"?f=t.leftGlobal:e.attr==="top"&&(f=t.topGlobal)),f){f.hoverState=c.Dash,f.hover=e.index;const y=e.points[0],x=e.points[1],r=e.points[2],g=e.points[3],L=a.evt.layerX,k=a.evt.layerY,d=Math.atan2(x-g,y-r),M=Math.PI/4;if(d>=-M&&d<=M||d<-3*M||d>3*M){const E=(g-x)/(r-y)*(L-y)+x;f.x=L,f.y=E}else{const E=(r-y)/(g-x)*(k-x)+y;f.x=E,f.y=k}}f&&f.drawing&&!f.moving&&(f.clicked.splice(0,f.clicked.length),f.clicked.push(e.index))}function q(){let a;e.index>0&&(e.attr==="font"?a=t.fontGlobal:e.attr==="left"?a=t.leftGlobal:e.attr==="top"&&(a=t.topGlobal)),a&&(a.hoverState=c.None,a.hover=0),a&&a.drawing&&!a.moving&&a.clicked.splice(0,a.clicked.length)}function V(a){let f;if(e.index>0&&(e.attr==="font"?f=t.fontGlobal:e.attr==="left"?f=t.leftGlobal:e.attr==="top"&&(f=t.topGlobal)),f){const y=e.points[0],x=e.points[1],r=e.points[2],g=e.points[3],L=a.evt.layerX,k=a.evt.layerY,d=Math.atan2(x-g,y-r),M=Math.PI/4;if(d>=-M&&d<=M||d<-3*M||d>3*M){const E=(g-x)/(r-y)*(L-y)+x;f.x=L,f.y=E}else{const E=(r-y)/(g-x)*(k-x)+y;f.x=E,f.y=k}}}function h(){let a;e.index>0&&(e.attr==="font"?a=t.fontGlobal.clicked:e.attr==="left"?a=t.leftGlobal.clicked:e.attr==="top"&&(a=t.topGlobal.clicked)),a&&(t.global.ctrl||a.splice(0,a.length),a.push(e.index))}return(a,f)=>{const y=j("v-line"),x=j("v-group");return $(),Z(x,{onMouseenter:N,onMousemove:V,onMouseout:q,onClick:h,index:i.index},{default:ce(()=>[A(y,{points:i.points,visible:i.mask,dash:[10,5],stroke:"rgba(255, 0, 0, 1)",strokeWidth:3},null,8,["points","visible","stroke"]),A(y,{points:i.points,visible:i.visible,dash:[10,5],stroke:"rgba(0, 0, 0, 1)",strokeWidth:1,fill:"rgba(255, 0, 0, 1)",hitStrokeWidth:5},null,8,["points","visible","stroke","fill"])]),_:1},8,["index"])}}}),tt=K({__name:"RoundRectangle",props:{width:{type:Number,required:!0},height:{type:Number,required:!0},attr:{type:String,required:!0}},setup(i){const e=i,t=se(),N=fe(()=>{if(e.attr==="font")return t.topAllPointList;if(e.attr==="top")return t.fontAllPointList;if(e.attr==="left"){const g=[];return t.topAllPointList.forEach(L=>{g.push({x:L.y,y:L.x})}),g}return[]}),q=fe(()=>{if(e.attr==="font")return t.leftAllPointList;if(e.attr==="top"){const g=[];return t.leftAllPointList.forEach(L=>{g.push({x:L.y,y:L.x})}),g}else if(e.attr==="left")return t.fontAllPointList;return[]});function V(g){const L=[];return g.forEach(k=>{L.findIndex(M=>Math.abs(M-k.x)<3)===-1&&L.push(k.x)}),L}function h(g){const L=[];return g.forEach(k=>{L.findIndex(M=>Math.abs(M-k.y)<3)===-1&&L.push(k.y)}),L}const a=fe(()=>{var L;const g=[];return(L=N.value)==null||L.forEach(k=>{var d;(d=q.value)==null||d.forEach(M=>{g.findIndex(F=>Math.abs(k.x-F.x)<3&&Math.abs(M.y-F.y)<3)===-1&&g.push({x:k.x,y:M.y})})}),g});function f(g,L,k){let d;e.attr==="font"?d=t.fontGlobal:e.attr==="left"?d=t.leftGlobal:e.attr==="top"&&(d=t.topGlobal),d&&d.drawing&&(d.hover=-1,d.hoverState=c.Line,k?(d.x=L,d.y=g.evt.layerY):(d.x=g.evt.layerX,d.y=L))}function y(g,L,k){let d;e.attr==="font"?d=t.fontGlobal:e.attr==="left"?d=t.leftGlobal:e.attr==="top"&&(d=t.topGlobal),d&&d.drawing&&(d.hover=-1,d.hoverState=c.Line,k?(d.x=L,d.y=g.evt.layerY):(d.x=g.evt.layerX,d.y=L))}function x(){let g;e.attr==="font"?g=t.fontGlobal:e.attr==="left"?g=t.leftGlobal:e.attr==="top"&&(g=t.topGlobal),g&&(g.hover=0,g.hoverState=c.None)}function r(g,L,k){let d;e.attr==="font"?d=t.fontGlobal:e.attr==="left"?d=t.leftGlobal:e.attr==="top"&&(d=t.topGlobal),d&&(d.hoverState=c.Point,d.hover=-1,d.x=L,d.y=k)}return(g,L)=>{const k=j("v-line"),d=j("v-circle");return $(),R(le,null,[($(!0),R(le,null,ue(V(N.value),M=>($(),Z(k,{points:[M,0,M,i.height],stroke:"rgba(0, 0, 255, 0.2)",strokeWidth:1,hitStrokeWidth:7,onMouseenter:E=>f(E,M,!0),onMousemove:E=>y(E,M,!0),onMouseout:x},null,8,["points","stroke","onMouseenter","onMousemove"]))),256)),($(!0),R(le,null,ue(h(q.value),M=>($(),Z(k,{points:[0,M,i.width,M],stroke:"rgba(0, 0, 255, 0.2)",strokeWidth:1,hitStrokeWidth:7,onMouseenter:E=>f(E,M,!1),onMousemove:E=>y(E,M,!1),onMouseout:x},null,8,["points","stroke","onMouseenter","onMousemove"]))),256)),($(!0),R(le,null,ue(a.value,M=>($(),Z(d,{x:M.x,y:M.y,radius:2,fill:"rgba(0, 0, 255, 0.4)",hitStrokeWidth:7,onMouseenter:E=>r(E,M.x,M.y),onMouseout:x},null,8,["x","y","fill","onMouseenter"]))),256))],64)}}}),it=K({__name:"DrawBoard",props:{width:{type:Number,required:!0},height:{type:Number,required:!0},attr:{type:String,required:!0}},setup(i){const e=i,t=se(),N=te(!1),q=te(),V=te(),h={type:c.None,isAngle:!1,angleValue:0,id:[]},a={type:c.None,isLen:!1,lenValue:0,id:[]},f=W({x:0,y:0,leaves:0,visible:!1,radius:3,stroke:"rgba(0, 0, 0, 1)",strokeWidth:1,fill:"rgba(255, 0, 0, 1)",hitStrokeWidth:5}),y=W({points:[0,0,0,0],leaves:[0,0],visible:!1,stroke:"rgba(0, 0, 0, 1)",strokeWidth:1,fill:"rgba(255, 0, 0, 1)",hitStrokeWidth:5}),x=W({points:[0,0,0,0],leaves:[0,0],dash:[10,5],visible:!1,stroke:"rgba(0, 0, 0, 1)",strokeWidth:1,fill:"rgba(255, 0, 0, 1)",hitStrokeWidth:5}),r=W({state:c.None,value:"none",clickTimes:0}),g=W({x:0,y:0,width:0,height:0,visible:!1,fill:"rgba(0, 0, 0, 0.2)",stroke:"rgba(0, 0, 255, 1)",strokeWidth:1}),L=W({x:0,y:0});function k(){d(c.None,0),f.visible=!1,y.visible=!1,x.visible=!1,a.isLen=!1,h.isAngle=!1}function d(u,b){switch(r.state=u,r.clickTimes=b,u){case c.None:r.value="none";break;case c.Line:r.value="line";break;case c.MultiLine:r.value="multi-line";break;case c.Dash:r.value="dash";break;case c.MultiDash:r.value="multi-dash";break;case c.Point:r.value="point";break;case c.MultiPoint:r.value="multi-point";break}u!==c.None?t[e.attr+"Global"].drawing=!0:t[e.attr+"Global"].drawing=!1}function M(u){u.key==="Control"?t.global.ctrl=!1:u.key==="Shift"&&(t.global.shift=!1)}function E(u){if(u.key==="Control"?t.global.ctrl=!0:u.key==="Shift"?t.global.shift=!0:u.key==="Escape"?k():u.key==="Backspace"?a.isLen?(a.lenValue/=10,a.lenValue=parseInt(String(a.lenValue)),r.value="set length "+a.lenValue):h.isAngle?(h.angleValue/=10,h.angleValue=parseInt(String(h.angleValue)),r.value="set angle "+h.angleValue):t[e.attr+"Global"].clicked.forEach(b=>{t.deleteShape(b,e.attr)}):u.key==="Delete"?t[e.attr+"Global"].clicked.forEach(b=>{t.deleteShape(b,e.attr)}):u.key==="Enter"&&(a.isLen?t.changeLength(a.id,a.lenValue,a.type,e.attr):h.isAngle&&t.changeAngle(h.id,h.angleValue,h.type,e.attr),k()),["0","1","2","3","4","5","6","7","8","9"].includes(u.key)&&(a.isLen?(a.lenValue*=10,a.lenValue+=Number(u.key),r.value="set length "+a.lenValue):h.isAngle?(h.angleValue*=10,h.angleValue+=Number(u.key),r.value="set angle "+h.angleValue):t[e.attr+"Global"].clicked.length===1&&t.changeHelper(t[e.attr+"Global"].clicked[0],Number(u.key),e.attr)),u.key==="a"){if(t[e.attr+"Global"].clicked.length===2){const b=t.allShape.get(e.attr+t[e.attr+"Global"].clicked[0]),G=t.allShape.get(e.attr+t[e.attr+"Global"].clicked[1]);(b===c.Line||b===c.Dash)&&(G===c.Line||G===c.Dash)&&(h.type=c.Line,h.isAngle=!0,h.angleValue=0,h.id=[t[e.attr+"Global"].clicked[0],t[e.attr+"Global"].clicked[1]],r.value="set angle")}else if(t[e.attr+"Global"].clicked.length===3){const b=t.allShape.get(e.attr+t[e.attr+"Global"].clicked[0]),G=t.allShape.get(e.attr+t[e.attr+"Global"].clicked[1]),C=t.allShape.get(e.attr+t[e.attr+"Global"].clicked[2]);b===c.Point&&G===c.Point&&C===c.Point&&(h.type=c.Point,h.isAngle=!0,h.angleValue=0,h.id=[...t[e.attr+"Global"].clicked],r.value="set angle")}}else if(u.key==="l")if(t[e.attr+"Global"].clicked.length===1){const b=t.allShape.get(e.attr+t[e.attr+"Global"].clicked[0]);(b===c.Line||b===c.Dash)&&(a.type=c.Line,a.isLen=!0,a.lenValue=0,a.id=[t[e.attr+"Global"].clicked[0]],r.value="set length")}else if(t[e.attr+"Global"].clicked.length===2){const b=t.allShape.get(e.attr+t[e.attr+"Global"].clicked[0]),G=t.allShape.get(e.attr+t[e.attr+"Global"].clicked[1]);(b===c.Point||G===c.Point)&&(a.type=c.Point,a.isLen=!0,a.lenValue=0,a.id=[...t[e.attr+"Global"].clicked],r.value="set length")}else r.state===c.None?(d(c.Line,2),y.visible=!0):r.state===c.Line?(d(c.MultiLine,2),y.visible=!0):k();else u.key==="d"?r.state===c.None?(d(c.Dash,2),x.visible=!0):r.state===c.Dash?(d(c.MultiDash,2),x.visible=!0):k():u.key==="p"&&(r.state===c.None?(f.visible=!0,d(c.Point,1)):r.state===c.Point?(f.visible=!0,d(c.MultiPoint,1)):k())}function F(u){let b=u.evt.layerX,G=u.evt.layerY;(t[e.attr+"Global"].drawing||t[e.attr+"Global"].moving)&&t[e.attr+"Global"].hover>0&&(b=t[e.attr+"Global"].x,G=t[e.attr+"Global"].y),t[e.attr+"Global"].hover===c.None&&!t.global.ctrl&&(t[e.attr+"Global"].clicked=[]),r.clickTimes--,r.state===c.Point||r.state===c.MultiPoint?r.clickTimes===0&&t.addPoint(f.x,f.y,e.attr,f.leaves):r.state===c.Line||r.state===c.MultiLine?r.clickTimes===0&&t.addLine([...y.points],[...y.leaves],e.attr):(r.state===c.Dash||r.state===c.MultiDash)&&(r.clickTimes===0?t.addDash([...x.points],[...x.leaves],e.attr):r.clickTimes===1&&(x.points=[b,G,b,G],t.allShape.get(e.attr+t[e.attr+"Global"].hover)===c.Point?x.leaves=[t[e.attr+"Global"].hover,0]:y.leaves=[0,0],x.visible=!0)),r.clickTimes===0&&(r.state===c.MultiPoint?r.clickTimes=1:(r.state===c.MultiLine||r.state===c.MultiDash)&&(r.clickTimes=2,y.visible=!1,x.visible=!1)),r.clickTimes===0&&k()}function ee(){if(g.visible){const u=V.value.getNode().getClientRect(),b=[];q.value.getNode().children.forEach(function(G){const C=G.getClientRect();u.x<C.x&&u.y<C.y&&u.x+u.width>C.x+C.width&&u.y+u.height>C.y+C.height&&b.push(G.attrs.index)}),t[e.attr+"Global"].clicked=b,g.visible=!1,g.width=0,g.height=0}t[e.attr+"Global"].moving&&(t[e.attr+"Global"].moving=!1)}function U(u){if(u.button===0)if(t[e.attr+"Global"].hover<=0&&!t[e.attr+"Global"].drawing){const b=u.layerX,G=u.layerY;g.visible=!0,g.x=b,g.y=G}else t[e.attr+"Global"].hover>0&&t[e.attr+"Global"].clicked.length>=1&&!t[e.attr+"Global"].drawing&&(t[e.attr+"Global"].moving=!0,L.x=u.clientX,L.y=u.clientY)}function X(u,b){if(t.global.shift){let G=[-1,-1];if(r.state===c.Line||r.state===c.MultiLine?r.clickTimes===1&&(G=[y.points[0],y.points[1]]):(r.state===c.Dash||r.state===c.MultiDash)&&r.clickTimes===1&&(G=[x.points[0],x.points[1]]),G[0]===-1&&G[1]===-1)return[u,b];const C=G[0],T=G[1],S=Math.atan2(T-b,C-u),_=Math.PI/8;if(S<_&&S>-_||S>Math.PI-_||S<-Math.PI+_)return[u,T];if(S<5*_&&S>3*_||S>-5*_&&S<-3*_)return[C,b];if(S<7*_&&S>5*_||S>-3*_&&S<-_){const Y=u-C,H=b-T,O=Math.sqrt((Math.pow(H,2)+Math.pow(Y,2))/2);return Y>0?[C+O,T-O]:[C-O,T+O]}else if(S<3*_&&S>_||S>-7*_&&S<-5*_){const Y=u-C,H=b-T,O=Math.sqrt((Math.pow(H,2)+Math.pow(Y,2))/2);return Y>0?[C+O,T+O]:[C-O,T-O]}}return[u,b]}function ie(u){let b=u.evt.layerX,G=u.evt.layerY;t[e.attr+"Global"].moving&&Q(u.evt.clientX,u.evt.clientY),g.visible&&(g.width=b-g.x,g.height=G-g.y),t[e.attr+"Global"].drawing&&(t[e.attr+"Global"].hover>0||t[e.attr+"Global"].hover===-1)&&(b=t[e.attr+"Global"].x,G=t[e.attr+"Global"].y);const C=X(b,G);b=C[0],G=C[1],f.x=b,f.y=G,r.state===c.Point||r.state===c.MultiPoint?f.leaves=t[e.attr+"Global"].hover:r.state===c.Line||r.state===c.MultiLine?r.clickTimes===1?(t.allShape.get(e.attr+t[e.attr+"Global"].hover)===c.Point?y.leaves[1]=t[e.attr+"Global"].hover:y.leaves[1]=0,y.points[2]=b,y.points[3]=G):r.clickTimes===2&&(t.allShape.get(e.attr+t[e.attr+"Global"].hover)===c.Point?y.leaves[0]=t[e.attr+"Global"].hover:y.leaves[0]=0,y.points=[b,G,b,G]):(r.state===c.Dash||r.state===c.MultiDash)&&(r.clickTimes===1?(t.allShape.get(e.attr+t[e.attr+"Global"].hover)===c.Point?x.leaves[1]=t[e.attr+"Global"].hover:x.leaves[1]=0,x.points[2]=b,x.points[3]=G):r.clickTimes===2&&(t.allShape.get(e.attr+t[e.attr+"Global"].hover)===c.Point?x.leaves[0]=t[e.attr+"Global"].hover:x.leaves[0]=0,x.points=[b,G,b,G]))}function ve(){N.value=!0,e.attr==="font"?t.drawBoardState=pe.Font:e.attr==="left"?t.drawBoardState=pe.Left:e.attr==="top"&&(t.drawBoardState=pe.Top)}function ae(){N.value=!1,t.drawBoardState=pe.None,t[e.attr+"Global"].clicked=[],t[e.attr+"Global"].hover=0,t[e.attr+"Global"].hoverState=c.None,k()}const z=new Set;me(()=>t[e.attr+"Global"].clicked,()=>{const u=new Set(z);t[e.attr+"Global"].clicked.forEach(b=>{const G=t.allShape.get(`${e.attr}${b}`);if(G)switch(u.has(b)?u.delete(b):z.add(b),G){case c.Point:const C=t.getPointList(e.attr);if(C){const _=t.getPoint(b,C);_&&(_.mask=!0)}break;case c.Line:const T=t.getLineList(e.attr);if(T){const _=t.getLine(b,T);_&&(_.mask=!0)}break;case c.Dash:const S=t.getDashList(e.attr);if(S){const _=t.getDash(b,S);_&&(_.mask=!0)}break}}),u.forEach(b=>{const G=t.allShape.get(`${e.attr}${b}`);if(G)switch(G){case c.Point:const C=t.getPointList(e.attr);if(C){const _=t.getPoint(b,C);_&&(_.mask=!1)}break;case c.Line:const T=t.getLineList(e.attr);if(T){const _=t.getLine(b,T);_&&(_.mask=!1)}break;case c.Dash:const S=t.getDashList(e.attr);if(S){const _=t.getDash(b,S);_&&(_.mask=!1)}break}})},{deep:!0});function J(u){u.preventDefault(),k()}function Q(u,b){const G=u-L.x,C=b-L.y,T=new Set;t[e.attr+"Global"].clicked.forEach(S=>{switch(t.allShape.get(e.attr+S)){case c.Point:T.add(S);break;case c.Line:t[e.attr+"LineList"].forEach(Y=>{Y.index===S&&Y.leaves.forEach(H=>{T.add(H)})});break;case c.Dash:t[e.attr+"DashList"].forEach(Y=>{Y.index===S&&Y.leaves.forEach(H=>{T.add(H)})});break}}),T.forEach(S=>{const _=t.getPointList(e.attr);if(_){const Y=t.getPoint(S,_);Y&&(Y.x+=G,Y.y+=C)}}),T.forEach(S=>{const _=t.getPointList(e.attr);if(_){const Y=t.getPoint(S,_);Y&&Y.callBack()}}),L.x=u,L.y=b}return(u,b)=>{const G=j("v-layer"),C=j("v-rect"),T=j("v-stage");return $(),R("div",{tabindex:"1",onContextmenu:J,onFocus:ve,onBlur:ae,onKeydown:E,onKeyup:M,onMousedown:U,onMouseup:ee,class:Ye(["h-full w-full overflow-hidden border-3 stage-container relative",{"focus-style":N.value,"surface-border":!N.value}])},[A(T,{x:0,y:0,width:i.width,height:i.height,onClick:F,onMousemove:ie},{default:ce(()=>[A(G,null,{default:ce(()=>[A(tt,{width:i.width,height:i.height,attr:i.attr},null,8,["width","height","attr"]),A(re,{x:f.x,y:f.y,visible:f.visible},null,8,["x","y","visible"]),A(_e,{points:y.points,visible:y.visible,stroke:"rgba(0, 0, 0, 1)"},null,8,["points","visible","stroke"]),A(re,{x:y.points[0],y:y.points[1],visible:y.visible},null,8,["x","y","visible"]),A(re,{x:y.points[2],y:y.points[3],visible:y.visible},null,8,["x","y","visible"]),A(Se,{points:x.points,visible:x.visible},null,8,["points","visible"]),A(re,{x:x.points[0],y:x.points[1],visible:x.visible},null,8,["x","y","visible"]),A(re,{x:x.points[2],y:x.points[3],visible:x.visible},null,8,["x","y","visible"])]),_:1}),A(G,{ref_key:"layer",ref:q},{default:ce(()=>[($(!0),R(le,null,ue(ge(t)[e.attr+"LineList"],S=>($(),Z(_e,be(ye({...S})),null,16))),256)),($(!0),R(le,null,ue(ge(t)[e.attr+"DashList"],S=>($(),Z(Se,be(ye({...S})),null,16))),256)),($(!0),R(le,null,ue(ge(t)[e.attr+"PointList"],S=>($(),Z(re,be(ye({...S})),null,16))),256)),A(C,Xe({ref_key:"selected",ref:V},{...g}),null,16)]),_:1},512)]),_:1},8,["width","height"]),A(et,{stateValue:r.value},null,8,["stateValue"])],34)}}}),ke=Le(it,[["__scopeId","data-v-3f6436c4"]]);function nt(i){return new Worker("/assets/threeView-3teICSlA.js",{name:i==null?void 0:i.name})}const ot=K({__name:"ShowThree",props:{width:{type:Number,required:!0},height:{type:Number,required:!0}},setup(i){const e=i,t=se();let N;me([()=>t.fontPointList,()=>t.leftPointList,()=>t.topPointList,()=>t.fontLineList,()=>t.leftLineList,()=>t.topLineList,()=>t.fontDashList,()=>t.leftDashList,()=>t.topDashList],r=>{const g=new nt;g.onmessage=L=>{const k=JSON.parse(L.data),d=q(k[0]);y(d,k[1],k[2]),console.log(k)},g.postMessage(JSON.stringify(r))},{deep:!0});function q(r){const g=e.width/2,L=[];return r.forEach(k=>{L.push({x:k.x-g,y:k.y-g,z:g-k.z})}),L}const V=new Be,h=new ze(75,e.width/e.height,.1,1e3),a=new Re({antialias:!0}),f=new Oe(h,a.domElement);f.listenToKeyEvents(window),f.enableDamping=!0,a.setSize(e.width,e.height),a.setClearColor(16777215,1);function y(r,g,L){N&&V.remove(N);const k=new He,d=[];r.forEach(X=>{d.push(new je(X.x,X.y,X.z))});const M=d.length,E=new Float32Array(M*3),F=new Uint32Array(L.flat());for(let X=0;X<M;X++){const ie=d[X];E[X*3]=ie.x,E[X*3+1]=ie.y,E[X*3+2]=ie.z}k.setAttribute("position",new Me(E,3)),k.setIndex(new Me(F,1)),k.computeVertexNormals();const ee=new Ke({color:11184810,flatShading:!0,side:Ue}),U=new Je(k,ee);V.add(U),N=U}const x=te();return Ne(()=>{x.value.appendChild(a.domElement);const r=new Ge(16777215,3);r.position.set(1,1,1),V.add(r);const g=new Ge(8947848,3);g.position.set(-1,-1,-1),V.add(g);const L=new Fe(5592405);V.add(L),h.position.z=700;function k(){requestAnimationFrame(k),f.update(),a.render(V,h)}k()}),me(()=>e,()=>{h.aspect=e.width/e.height,h.updateProjectionMatrix(),a.setSize(e.width,e.height),a.render(V,h)},{deep:!0}),(r,g)=>($(),R("div",{ref_key:"container",ref:x},null,512))}}),lt={class:"h-full w-full flex justify-content-center align-items-center"},st={class:"flex flex-column"},at={class:"flex"},rt={class:"flex"},ct={class:"m-2 p-0"},ft=K({__name:"Content",props:{width:{type:Number,required:!0},height:{type:Number,required:!0}},setup(i){const e=i;se();const t=fe(()=>({width:N.value+"px",height:N.value+"px"}));fe(()=>({width:N.value+"px",height:N.value+"px"}));const N=fe(()=>Math.min(e.width,e.height)/2-22);return(q,V)=>($(),R("div",lt,[oe("div",st,[oe("div",at,[oe("div",{class:"m-2 p-0",style:xe(t.value)},[A(ke,{width:N.value,height:N.value,attr:"font"},null,8,["width","height"])],4),oe("div",{class:"m-2 p-0",style:xe(t.value)},[A(ke,{width:N.value,height:N.value,attr:"left"},null,8,["width","height"])],4)]),oe("div",rt,[oe("div",{class:"m-2 p-0",style:xe(t.value)},[A(ke,{width:N.value,height:N.value,attr:"top"},null,8,["width","height"])],4),oe("div",ct,[A(ot,{width:N.value,height:N.value},null,8,["width","height"])])])])]))}}),ut=Le(ft,[["__scopeId","data-v-511d98ee"]]),ht=K({__name:"Content",setup(i){let e=te(0),t=te(0);function N(V){for(const h of V)t.value=h.contentRect.width,e.value=h.contentRect.height}const q=te();return Ne(()=>{new ResizeObserver(N).observe(q.value)}),(V,h)=>($(),R("div",{ref_key:"contentContainer",ref:q,class:"h-full w-full relative"},[A(ut,{width:ge(t),height:ge(e)},null,8,["width","height"])],512))}}),dt={class:"h-full w-full flex"},vt=K({__name:"ThreeView",setup(i){return(e,t)=>($(),R("div",dt,[A(ht,{class:"flex-1"})]))}});export{vt as default};
