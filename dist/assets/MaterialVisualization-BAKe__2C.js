import{d as defineStore,r as reactive,a as defineComponent,k as ref,w as watch,o as openBlock,c as createElementBlock,y as createBaseVNode,_ as _export_sfc,G as commonjsGlobal,l as onMounted,O as pushScopeId,P as popScopeId,W as axios,g as createVNode,u as unref}from"./index-n6R6eWql.js";const useMolStore=defineStore("molStore",()=>({config:reactive({convert:!1,picture:!1,smiles:""})})),_hoisted_1$2={class:"h-full w-full"},_hoisted_2$1=["width","height"],_sfc_main$3=defineComponent({__name:"Content",props:{width:{type:Number,required:!0},height:{type:Number,required:!0}},setup(X){let L=useMolStore();const c=ref();return watch(()=>L.config.convert,()=>{let A=c.value.contentWindow.ketcher;A&&A.getSmiles().then(T=>{L.config.smiles=T})}),watch(()=>L.config.picture,()=>{let A=c.value.contentWindow.ketcher;A&&A.getKet().then(T=>{A.generateImage(T).then(D=>{let P=URL.createObjectURL(D),u=document.createElement("a");u.href=P,u.download="2d_image.png",u.click()})})}),(A,T)=>(openBlock(),createElementBlock("div",_hoisted_1$2,[createBaseVNode("iframe",{class:"frame",ref_key:"ketch",ref:c,src:"/standalone/index.html?hiddenControls=open,clear,save,undo,redo,cut,copies,copy,copy-image,copy-mol,copy-ket,paste,settings,about,zoom,zoom-out,zoom-in,zoom-list,fullscreen,help,miew,analyse,check,cip,extended-table,any-atom,template-lib,functional-groups,text,shapes,rgroup,arrows,sgroup,reaction-mapping-tools,reaction-plus,enhanced-stereo",width:X.width,height:X.height-6},null,8,_hoisted_2$1)]))}}),Content=_export_sfc(_sfc_main$3,[["__scopeId","data-v-4d8b7dca"]]);var _3Dmol={exports:{}};/*!
 * 3dmol v2.1.0
 * JavaScript/TypeScript molecular visualization library
 * Author: David Koes and contributors
 */(function(module,exports){(function(L,c){module.exports=c()})(commonjsGlobal,()=>(()=>{var __webpack_modules__={"./node_modules/iobuffer/lib-esm/IOBuffer.js":(X,L,c)=>{c.r(L),c.d(L,{IOBuffer:()=>u});var A=c("./node_modules/iobuffer/lib-esm/text.browser.js");const T=1024*8,D=(()=>{const y=new Uint8Array(4),C=new Uint32Array(y.buffer);return!((C[0]=1)&y[0])})(),P={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class u{constructor(C=T,v={}){let M=!1;typeof C=="number"?C=new ArrayBuffer(C):(M=!0,this.lastWrittenByte=C.byteLength);const _=v.offset?v.offset>>>0:0,p=C.byteLength-_;let x=_;(ArrayBuffer.isView(C)||C instanceof u)&&(C.byteLength!==C.buffer.byteLength&&(x=C.byteOffset+_),C=C.buffer),M?this.lastWrittenByte=p:this.lastWrittenByte=0,this.buffer=C,this.length=p,this.byteLength=p,this.byteOffset=x,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,x,p),this._mark=0,this._marks=[]}available(C=1){return this.offset+C<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(C=1){return this.offset+=C,this}back(C=1){return this.offset-=C,this}seek(C){return this.offset=C,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const C=this._marks.pop();if(C===void 0)throw new Error("Mark stack empty");return this.seek(C),this}rewind(){return this.offset=0,this}ensureAvailable(C=1){if(!this.available(C)){const M=(this.offset+C)*2,_=new Uint8Array(M);_.set(new Uint8Array(this.buffer)),this.buffer=_.buffer,this.length=this.byteLength=M,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(C=1){return this.readArray(C,"uint8")}readArray(C,v){const M=P[v].BYTES_PER_ELEMENT*C,_=this.byteOffset+this.offset,p=this.buffer.slice(_,_+M);if(this.littleEndian===D&&v!=="uint8"&&v!=="int8"){const t=new Uint8Array(this.buffer.slice(_,_+M));t.reverse();const r=new P[v](t.buffer);return this.offset+=M,r.reverse(),r}const x=new P[v](p);return this.offset+=M,x}readInt16(){const C=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,C}readUint16(){const C=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,C}readInt32(){const C=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,C}readUint32(){const C=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,C}readFloat32(){const C=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,C}readFloat64(){const C=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,C}readBigInt64(){const C=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,C}readBigUint64(){const C=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,C}readChar(){return String.fromCharCode(this.readInt8())}readChars(C=1){let v="";for(let M=0;M<C;M++)v+=this.readChar();return v}readUtf8(C=1){return(0,A.decode)(this.readBytes(C))}decodeText(C=1,v="utf-8"){return(0,A.decode)(this.readBytes(C),v)}writeBoolean(C){return this.writeUint8(C?255:0),this}writeInt8(C){return this.ensureAvailable(1),this._data.setInt8(this.offset++,C),this._updateLastWrittenByte(),this}writeUint8(C){return this.ensureAvailable(1),this._data.setUint8(this.offset++,C),this._updateLastWrittenByte(),this}writeByte(C){return this.writeUint8(C)}writeBytes(C){this.ensureAvailable(C.length);for(let v=0;v<C.length;v++)this._data.setUint8(this.offset++,C[v]);return this._updateLastWrittenByte(),this}writeInt16(C){return this.ensureAvailable(2),this._data.setInt16(this.offset,C,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(C){return this.ensureAvailable(2),this._data.setUint16(this.offset,C,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(C){return this.ensureAvailable(4),this._data.setInt32(this.offset,C,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(C){return this.ensureAvailable(4),this._data.setUint32(this.offset,C,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(C){return this.ensureAvailable(4),this._data.setFloat32(this.offset,C,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(C){return this.ensureAvailable(8),this._data.setFloat64(this.offset,C,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(C){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,C,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(C){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,C,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(C){return this.writeUint8(C.charCodeAt(0))}writeChars(C){for(let v=0;v<C.length;v++)this.writeUint8(C.charCodeAt(v));return this}writeUtf8(C){return this.writeBytes((0,A.encode)(C))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}},"./node_modules/iobuffer/lib-esm/text-encoding-polyfill.js":function(){(function(X){if(X.TextEncoder&&X.TextDecoder)return!1;function L(A="utf-8"){if(A!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${A}') is invalid.`)}Object.defineProperty(L.prototype,"encoding",{value:"utf-8"}),L.prototype.encode=function(A,T={stream:!1}){if(T.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let D=0;const P=A.length;let u=0,y=Math.max(32,P+(P>>1)+7),C=new Uint8Array(y>>3<<3);for(;D<P;){let v=A.charCodeAt(D++);if(v>=55296&&v<=56319){if(D<P){const M=A.charCodeAt(D);(M&64512)===56320&&(++D,v=((v&1023)<<10)+(M&1023)+65536)}if(v>=55296&&v<=56319)continue}if(u+4>C.length){y+=8,y*=1+D/A.length*2,y=y>>3<<3;const M=new Uint8Array(y);M.set(C),C=M}if(v&4294967168)if(!(v&4294965248))C[u++]=v>>6&31|192;else if(!(v&4294901760))C[u++]=v>>12&15|224,C[u++]=v>>6&63|128;else if(!(v&4292870144))C[u++]=v>>18&7|240,C[u++]=v>>12&63|128,C[u++]=v>>6&63|128;else continue;else{C[u++]=v;continue}C[u++]=v&63|128}return C.slice(0,u)};function c(A="utf-8",T={fatal:!1}){if(A!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${A}') is invalid.`);if(T.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(c.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(c.prototype,"fatal",{value:!1}),Object.defineProperty(c.prototype,"ignoreBOM",{value:!1}),c.prototype.decode=function(A,T={stream:!1}){if(T.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const D=new Uint8Array(A);let P=0;const u=D.length,y=[];for(;P<u;){const C=D[P++];if(C===0)break;if(!(C&128))y.push(C);else if((C&224)===192){const v=D[P++]&63;y.push((C&31)<<6|v)}else if((C&240)===224){const v=D[P++]&63,M=D[P++]&63;y.push((C&31)<<12|v<<6|M)}else if((C&248)===240){const v=D[P++]&63,M=D[P++]&63,_=D[P++]&63;let p=(C&7)<<18|v<<12|M<<6|_;p>65535&&(p-=65536,y.push(p>>>10&1023|55296),p=56320|p&1023),y.push(p)}}return String.fromCharCode.apply(null,y)},X.TextEncoder=L,X.TextDecoder=c})(typeof window<"u"?window:typeof self<"u"?self:this)},"./node_modules/iobuffer/lib-esm/text.browser.js":(X,L,c)=>{c.r(L),c.d(L,{decode:()=>A,encode:()=>D}),c("./node_modules/iobuffer/lib-esm/text-encoding-polyfill.js");function A(P,u="utf8"){return new TextDecoder(u).decode(P)}const T=new TextEncoder;function D(P){return T.encode(P)}},"./node_modules/netcdfjs/lib-esm/data.js":(X,L,c)=>{c.r(L),c.d(L,{nonRecord:()=>T,record:()=>D});var A=c("./node_modules/netcdfjs/lib-esm/types.js");function T(P,u){const y=(0,A.str2num)(u.type),C=u.size/(0,A.num2bytes)(y),v=new Array(C);for(let M=0;M<C;M++)v[M]=(0,A.readType)(P,y,1);return v}function D(P,u,y){const C=(0,A.str2num)(u.type),v=u.size?u.size/(0,A.num2bytes)(C):1,M=y.length,_=new Array(M),p=y.recordStep;if(p)for(let x=0;x<M;x++){const t=P.offset;_[x]=(0,A.readType)(P,C,v),P.seek(t+p)}else throw new Error("recordDimension.recordStep is undefined");return _}},"./node_modules/netcdfjs/lib-esm/header.js":(X,L,c)=>{c.r(L),c.d(L,{header:()=>v});var A=c("./node_modules/netcdfjs/lib-esm/types.js"),T=c("./node_modules/netcdfjs/lib-esm/utils.js");const D=0,P=10,u=11,y=12,C=0;function v(x,t){const r={version:t},h={length:x.readUint32()},s=M(x);Array.isArray(s)||(h.id=s.recordId,h.name=s.recordName,r.dimensions=s.dimensions),r.globalAttributes=_(x);const o=p(x,h==null?void 0:h.id,t);return Array.isArray(o)||(r.variables=o.variables,h.recordStep=o.recordStep),r.recordDimension=h,r}function M(x){const t={};let r,h;const s=x.readUint32();let o;if(s===D)return(0,T.notNetcdf)(x.readUint32()!==D,"wrong empty tag for list of dimensions"),[];{(0,T.notNetcdf)(s!==P,"wrong tag for list of dimensions");const e=x.readUint32();o=new Array(e);for(let n=0;n<e;n++){const a=(0,T.readName)(x),g=x.readUint32();g===C&&(r=n,h=a),o[n]={name:a,size:g}}}return r!==void 0&&(t.recordId=r),h!==void 0&&(t.recordName=h),t.dimensions=o,t}function _(x){const t=x.readUint32();let r;if(t===D)return(0,T.notNetcdf)(x.readUint32()!==D,"wrong empty tag for list of attributes"),[];{(0,T.notNetcdf)(t!==y,"wrong tag for list of attributes");const h=x.readUint32();r=new Array(h);for(let s=0;s<h;s++){const o=(0,T.readName)(x),e=x.readUint32();(0,T.notNetcdf)(e<1||e>6,`non valid type ${e}`);const n=x.readUint32(),a=(0,A.readType)(x,e,n);(0,T.padding)(x),r[s]={name:o,type:(0,A.num2str)(e),value:a}}}return r}function p(x,t,r){const h=x.readUint32();let s=0,o;if(h===D)return(0,T.notNetcdf)(x.readUint32()!==D,"wrong empty tag for list of variables"),[];{(0,T.notNetcdf)(h!==u,"wrong tag for list of variables");const e=x.readUint32();o=new Array(e);for(let n=0;n<e;n++){const a=(0,T.readName)(x),g=x.readUint32(),f=new Array(g);for(let I=0;I<g;I++)f[I]=x.readUint32();const E=_(x),w=x.readUint32();(0,T.notNetcdf)(w<1&&w>6,`non valid type ${w}`);const R=x.readUint32();let z=x.readUint32();r===2&&((0,T.notNetcdf)(z>0,"offsets larger than 4GB not supported"),z=x.readUint32());let S=!1;typeof t<"u"&&f[0]===t&&(s+=R,S=!0),o[n]={name:a,dimensions:f,attributes:E,type:(0,A.num2str)(w),size:R,offset:z,record:S}}}return{variables:o,recordStep:s}}},"./node_modules/netcdfjs/lib-esm/index.js":(X,L,c)=>{c.r(L),c.d(L,{NetCDFReader:()=>A.NetCDFReader});var A=c("./node_modules/netcdfjs/lib-esm/parser.js")},"./node_modules/netcdfjs/lib-esm/parser.js":(X,L,c)=>{c.r(L),c.d(L,{NetCDFReader:()=>y});var A=c("./node_modules/iobuffer/lib-esm/IOBuffer.js"),T=c("./node_modules/netcdfjs/lib-esm/data.js"),D=c("./node_modules/netcdfjs/lib-esm/header.js"),P=c("./node_modules/netcdfjs/lib-esm/toString.js"),u=c("./node_modules/netcdfjs/lib-esm/utils.js");class y{constructor(v){this.toString=P.toString;const M=new A.IOBuffer(v);M.setBigEndian(),(0,u.notNetcdf)(M.readChars(3)!=="CDF","should start with CDF");const _=M.readByte();(0,u.notNetcdf)(_>2,"unknown version"),this.header=(0,D.header)(M,_),this.buffer=M}get version(){return this.header.version===1?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}getAttribute(v){const M=this.globalAttributes.find(_=>_.name===v);return M?M.value:null}getDataVariableAsString(v){const M=this.getDataVariable(v);return M?M.join(""):null}get variables(){return this.header.variables}getDataVariable(v){let M;if(typeof v=="string"?M=this.header.variables.find(_=>_.name===v):M=v,M===void 0)throw new Error("Not a valid NetCDF v3.x file: variable not found");return this.buffer.seek(M.offset),M.record?(0,T.record)(this.buffer,M,this.header.recordDimension):(0,T.nonRecord)(this.buffer,M)}dataVariableExists(v){return this.header.variables.find(_=>_.name===v)!==void 0}attributeExists(v){return this.globalAttributes.find(_=>_.name===v)!==void 0}}},"./node_modules/netcdfjs/lib-esm/toString.js":(X,L,c)=>{c.r(L),c.d(L,{toString:()=>A});function A(){const T=[];T.push("DIMENSIONS");for(const P of this.dimensions)T.push(`  ${P.name.padEnd(30)} = size: ${P.size}`);T.push(""),T.push("GLOBAL ATTRIBUTES");for(const P of this.globalAttributes)T.push(`  ${P.name.padEnd(30)} = ${P.value}`);const D=JSON.parse(JSON.stringify(this.variables));T.push(""),T.push("VARIABLES:");for(const P of D){P.value=this.getDataVariable(P);let u=JSON.stringify(P.value);u.length>50&&(u=u.substring(0,50)),isNaN(P.value.length)||(u+=` (length: ${P.value.length})`),T.push(`  ${P.name.padEnd(30)} = ${u}`)}return T.join(`
`)}},"./node_modules/netcdfjs/lib-esm/types.js":(X,L,c)=>{c.r(L),c.d(L,{num2bytes:()=>D,num2str:()=>T,readType:()=>y,str2num:()=>P});const A={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function T(v){switch(Number(v)){case A.BYTE:return"byte";case A.CHAR:return"char";case A.SHORT:return"short";case A.INT:return"int";case A.FLOAT:return"float";case A.DOUBLE:return"double";default:return"undefined"}}function D(v){switch(Number(v)){case A.BYTE:return 1;case A.CHAR:return 1;case A.SHORT:return 2;case A.INT:return 4;case A.FLOAT:return 4;case A.DOUBLE:return 8;default:return-1}}function P(v){switch(String(v)){case"byte":return A.BYTE;case"char":return A.CHAR;case"short":return A.SHORT;case"int":return A.INT;case"float":return A.FLOAT;case"double":return A.DOUBLE;default:return-1}}function u(v,M){if(v!==1){const _=new Array(v);for(let p=0;p<v;p++)_[p]=M();return _}else return M()}function y(v,M,_){switch(M){case A.BYTE:return Array.from(v.readBytes(_));case A.CHAR:return C(v.readChars(_));case A.SHORT:return u(_,v.readInt16.bind(v));case A.INT:return u(_,v.readInt32.bind(v));case A.FLOAT:return u(_,v.readFloat32.bind(v));case A.DOUBLE:return u(_,v.readFloat64.bind(v));default:throw new Error(`non valid type ${M}`)}}function C(v){return v.charCodeAt(v.length-1)===0?v.substring(0,v.length-1):v}},"./node_modules/netcdfjs/lib-esm/utils.js":(X,L,c)=>{c.r(L),c.d(L,{notNetcdf:()=>A,padding:()=>T,readName:()=>D});function A(P,u){if(P)throw new TypeError(`Not a valid NetCDF v3.x file: ${u}`)}function T(P){P.offset%4!==0&&P.skip(4-P.offset%4)}function D(P){const u=P.readUint32(),y=P.readChars(u);return T(P),y}},"./src/WebGL/shaders/lib/basic/basic.frag":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`uniform mat4 viewMatrix;
uniform float opacity;
uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
varying vec3 vColor;
//DEFINEFRAGCOLOR
void main() {
    gl_FragColor = vec4( vColor, opacity );
    float depth = gl_FragCoord.z / gl_FragCoord.w;
    float fogFactor = smoothstep( fogNear, fogFar, depth );
    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
}`},"./src/WebGL/shaders/lib/basic/basic.vert":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;

attribute vec3 position;
attribute vec3 color;

varying vec3 vColor;

void main() {

    vColor = color;
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    gl_Position = projectionMatrix * mvPosition;

}`},"./src/WebGL/shaders/lib/instanced/instanced.frag":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`uniform mat4 viewMatrix;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec3 vLightFront;
varying vec3 vColor;
//DEFINEFRAGCOLOR

void main() {

    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );

    #ifndef WIREFRAME
    gl_FragColor.xyz *= vLightFront;
    #endif

    gl_FragColor = gl_FragColor * vec4( vColor, opacity );
    float depth = gl_FragCoord.z / gl_FragCoord.w;

    float fogFactor = smoothstep( fogNear, fogFar, depth );

    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );

}


`},"./src/WebGL/shaders/lib/instanced/instanced.vert":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 offset;
attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;
attribute float radius;

varying vec3 vColor;
varying vec3 vLightFront;

void main() {

    vColor = color;

    vec3 objectNormal = normal;
    vec3 transformedNormal = normalMatrix * objectNormal;
    vec4 mvPosition = modelViewMatrix * vec4( position * radius + offset, 1.0 );

    vLightFront = vec3( 0.0 );

    transformedNormal = normalize( transformedNormal );

    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vec3 dirVector = normalize( lDirection.xyz );
    float dotProduct = dot( transformedNormal, dirVector );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );

    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;

    gl_Position = projectionMatrix * mvPosition;
}

`},"./src/WebGL/shaders/lib/lambert/lambert.frag":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`uniform mat4 viewMatrix;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec3 vLightFront;
varying vec3 vColor;
//DEFINEFRAGCOLOR

void main() {

    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );

    #ifndef WIREFRAME
    gl_FragColor.xyz *= vLightFront;
    #endif

    gl_FragColor = gl_FragColor * vec4( vColor, opacity );
    float depth = gl_FragCoord.z / gl_FragCoord.w;

    float fogFactor = smoothstep( fogNear, fogFar, depth );

    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );

}`},"./src/WebGL/shaders/lib/lambert/lambert.vert":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`
uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec3 vColor;
varying vec3 vLightFront;

void main() {

    vColor = color;

    vec3 objectNormal = normal;
    vec3 transformedNormal = normalMatrix * objectNormal;
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );

    vLightFront = vec3( 0.0 );

    transformedNormal = normalize( transformedNormal );

    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vec3 dirVector = normalize( lDirection.xyz );
    float dotProduct = dot( transformedNormal, dirVector );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );

    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;

    gl_Position = projectionMatrix * mvPosition;
}`},"./src/WebGL/shaders/lib/lambertdouble/lambertdouble.frag":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`

uniform mat4 viewMatrix;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec3 vLightFront;
varying vec3 vLightBack;

varying vec3 vColor;
//DEFINEFRAGCOLOR

void main() {

    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );

    #ifndef WIREFRAME
    if ( gl_FrontFacing )
       gl_FragColor.xyz *= vLightFront;
    else
       gl_FragColor.xyz *= vLightBack;
    #endif

    gl_FragColor = gl_FragColor * vec4( vColor, opacity );
    float depth = gl_FragCoord.z / gl_FragCoord.w;

    float fogFactor = smoothstep( fogNear, fogFar, depth );

    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );

}


`},"./src/WebGL/shaders/lib/lambertdouble/lambertdouble.vert":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec3 vColor;
varying vec3 vLightFront;
varying vec3 vLightBack;

void main() {

    vColor = color;

    vec3 objectNormal = normal;
    vec3 transformedNormal = normalMatrix * objectNormal;
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );

    vLightFront = vec3( 0.0 );
    vLightBack = vec3( 0.0 );

    transformedNormal = normalize( transformedNormal );

    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vec3 dirVector = normalize( lDirection.xyz );
    float dotProduct = dot( transformedNormal, dirVector );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );
    vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );

    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;
    vLightBack += directionalLightColor[ 0 ] * directionalLightWeightingBack;

    gl_Position = projectionMatrix * mvPosition;
}

`},"./src/WebGL/shaders/lib/outline/outline.frag":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`

uniform float opacity;
uniform vec3 outlineColor;
uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
//DEFINEFRAGCOLOR

void main() {
    gl_FragColor = vec4( outlineColor, 1 );
}


`},"./src/WebGL/shaders/lib/outline/outline.vert":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform float outlineWidth;
uniform float outlinePushback;

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

void main() {

    vec4 norm = modelViewMatrix*vec4(normalize(normal),0.0);
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    mvPosition.xy += norm.xy*outlineWidth;
    gl_Position = projectionMatrix * mvPosition;
    mvPosition.z -= outlinePushback; //go backwards in model space
    vec4 pushpos = projectionMatrix*mvPosition; //project to get z in projection space, I'm probably missing some simple math to do the same thing..
    gl_Position.z = gl_Position.w*pushpos.z/pushpos.w;
}

`},"./src/WebGL/shaders/lib/screen/screen.frag":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`uniform sampler2D colormap;
varying highp vec2 vTexCoords;
uniform vec2 dimensions;
//DEFINEFRAGCOLOR
void main (void) {
   gl_FragColor = texture2D(colormap, vTexCoords);
}
        `},"./src/WebGL/shaders/lib/screen/screen.vert":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `},"./src/WebGL/shaders/lib/screenaa/screenaa.frag":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`uniform sampler2D colormap;
varying highp vec2 vTexCoords;
uniform vec2 dimensions;

// Basic FXAA implementation based on the code on geeks3d.com 
#define FXAA_REDUCE_MIN (1.0/ 128.0)
#define FXAA_REDUCE_MUL (1.0 / 8.0)
#define FXAA_SPAN_MAX 8.0

vec4 applyFXAA(vec2 fragCoord, sampler2D tex)
{
    vec4 color;
    vec2 inverseVP = vec2(1.0 / dimensions.x, 1.0 / dimensions.y);
    vec3 rgbNW = texture2D(tex, fragCoord + vec2(-1.0, -1.0) * inverseVP).xyz;
    vec3 rgbNE = texture2D(tex, fragCoord + vec2(1.0, -1.0) * inverseVP).xyz;
    vec3 rgbSW = texture2D(tex, fragCoord + vec2(-1.0, 1.0) * inverseVP).xyz;
    vec3 rgbSE = texture2D(tex, fragCoord + vec2(1.0, 1.0) * inverseVP).xyz;
    vec3 rgbM  = texture2D(tex, fragCoord  * inverseVP).xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                        (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
            max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
            dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
        texture2D(tex, fragCoord + dir * (1.0 / 3.0 - 0.5)).xyz +
        texture2D(tex, fragCoord  + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
        texture2D(tex, fragCoord  + dir * -0.5).xyz +
        texture2D(tex, fragCoord  + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, 1.0);
    else
        color = vec4(rgbB, 1.0);
    return color;
}
//DEFINEFRAGCOLOR
void main (void) {
   gl_FragColor = applyFXAA(vTexCoords, colormap);
}
        `},"./src/WebGL/shaders/lib/screenaa/screenaa.vert":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `},"./src/WebGL/shaders/lib/sphereimposter/sphereimposter.frag":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`
uniform mat4 viewMatrix;
uniform float opacity;
uniform mat4 projectionMatrix;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
uniform float uDepth;
uniform vec3 directionalLightColor[ 1 ];

varying vec3 vColor;
varying vec2 mapping;
varying float rval;
varying vec3 vLight;
varying vec3 center;

//DEFINEFRAGCOLOR

void main() {
    float lensqr = dot(mapping,mapping);
    float rsqr = rval*rval;
    if(lensqr > rsqr)
       discard;
    float z = sqrt(rsqr-lensqr);
    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z);
    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);
    float ndcDepth = clipPos.z / clipPos.w;
    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
    vec3 norm = normalize(vec3(mapping.x,mapping.y,z));
    float dotProduct = dot( norm, vLight );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );
    vec3 vLight = directionalLightColor[ 0 ] * directionalLightWeighting;
    gl_FragColor = vec4(vLight*vColor, opacity*opacity );
    float fogFactor = smoothstep( fogNear, fogFar, gl_FragDepthEXT/gl_FragCoord.w );
    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );


}

`},"./src/WebGL/shaders/lib/sphereimposter/sphereimposter.vert":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec2 mapping;
varying vec3 vColor;
varying float rval;
varying vec3 vLight;
varying vec3 center;

void main() {

    vColor = color;
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    center = mvPosition.xyz;
    vec4 projPosition = projectionMatrix * mvPosition;
    vec4 adjust = projectionMatrix* vec4(normal,0.0); adjust.z = 0.0; adjust.w = 0.0;
    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vLight = normalize( lDirection.xyz );
    mapping = normal.xy;
    rval = abs(normal.x);
    gl_Position = projPosition+adjust;

}
`},"./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.frag":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`

uniform float opacity;
uniform vec3 outlineColor;
uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
uniform mat4 projectionMatrix;
varying vec2 mapping;
varying float rval;
varying vec3 center;

uniform float outlinePushback;

//DEFINEFRAGCOLOR

void main() {
    float lensqr = dot(mapping,mapping);
    float rsqr = rval*rval;
    if(lensqr > rsqr)
       discard;
    float z = sqrt(rsqr-lensqr);
    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z-outlinePushback);
    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);
    float ndcDepth = clipPos.z / clipPos.w;
    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
    gl_FragColor = vec4(outlineColor, 1 );
}


`},"./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.vert":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform float outlineWidth;
uniform float outlinePushback;

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec2 mapping;
varying float rval;
varying vec3 center;

void main() {

    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    center = mvPosition.xyz;
    vec4 projPosition = projectionMatrix * mvPosition;
    vec2 norm = normal.xy + vec2(sign(normal.x)*outlineWidth,sign(normal.y)*outlineWidth);
    vec4 adjust = projectionMatrix* vec4(norm,normal.z,0.0); adjust.z = 0.0; adjust.w = 0.0;
    mapping = norm.xy;
    rval = abs(norm.x);
    gl_Position = projPosition+adjust;
}

`},"./src/WebGL/shaders/lib/sprite/sprite.frag":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`

uniform vec3 color;
uniform sampler2D map;
uniform float opacity;

uniform int fogType;
uniform vec3 fogColor;
uniform float fogDensity;
uniform float fogNear;
uniform float fogFar;
uniform float alphaTest;

varying vec2 vUV;
//DEFINEFRAGCOLOR

void main() {

    vec4 texture = texture2D(map, vUV);

    if (texture.a < alphaTest) discard;

    gl_FragColor = vec4(color * texture.xyz, texture.a * opacity);

    if (fogType > 0) {

        float depth = gl_FragCoord.z / gl_FragCoord.w;
        float fogFactor = 0.0;

        if (fogType == 1) {
            fogFactor = smoothstep(fogNear, fogFar, depth);
        }

        else {
            const float LOG2 = 1.442695;
            float fogFactor = exp2(- fogDensity * fogDensity * depth * depth * LOG2);
            fogFactor = 1.0 - clamp(fogFactor, 0.0, 1.0);
        }

        gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);

    }
}

`},"./src/WebGL/shaders/lib/sprite/sprite.vert":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`

uniform int useScreenCoordinates;
uniform vec3 screenPosition;
uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform float rotation;
uniform vec2 scale;
uniform vec2 alignment;
uniform vec2 uvOffset;
uniform vec2 uvScale;

attribute vec2 position;
attribute vec2 uv;

varying vec2 vUV;

void main() {

    vUV = uvOffset + uv * uvScale;

    vec2 alignedPosition = position + alignment;

    vec2 rotatedPosition;
    rotatedPosition.x = ( cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y ) * scale.x;
    rotatedPosition.y = ( sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y ) * scale.y;

    vec4 finalPosition;

    if(useScreenCoordinates != 0) {
        finalPosition = vec4(screenPosition.xy + rotatedPosition, screenPosition.z, 1.0);
    }

    else {
        finalPosition = projectionMatrix * modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0); finalPosition /= finalPosition.w;
        finalPosition.xy += rotatedPosition; 
    }

    gl_Position = finalPosition;

}

`},"./src/WebGL/shaders/lib/stickimposter/stickimposter.partial.frag":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`    float dotProduct = dot( norm, vLight );
    vec3 light = vec3( max( dotProduct, 0.0 ) );
    gl_FragColor = vec4(light*color, opacity*opacity );
    float fogFactor = smoothstep( fogNear, fogFar, depth );
    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
}`},"./src/WebGL/shaders/lib/stickimposter/stickimposter.vert":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;
attribute float radius;

varying vec3 vColor;
varying vec3 vLight;
varying vec3 cposition;
varying vec3 p1;
varying vec3 p2;
varying float r;

void main() {

    vColor = color; vColor.z = abs(vColor.z); //z indicates which vertex and so would vary
    r = abs(radius);
    vec4 to = modelViewMatrix*vec4(normal, 1.0); //normal is other point of cylinder
    vec4 pt = modelViewMatrix*vec4(position, 1.0);
    vec4 mvPosition = pt;
    p1 = pt.xyz; p2 = to.xyz;
    vec3 norm = to.xyz-pt.xyz;
    float mult = 1.1; //slop to account for perspective of sphere
    if(length(p1) > length(p2)) { //billboard at level of closest point
       mvPosition = to;
    }
    vec3 n = normalize(mvPosition.xyz);
//intersect with the plane defined by the camera looking at the billboard point
    if(color.z >= 0.0) { //p1
       if(projectionMatrix[3][3] == 0.0) { //perspective
         vec3 pnorm = normalize(p1);
         float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);
         mvPosition.xyz = p1+t*pnorm; 
       } else { //orthographic
         mvPosition.xyz = p1;
       }
    } else {
      if(projectionMatrix[3][3] == 0.0) { //perspective
         vec3 pnorm = normalize(p2);
         float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);
         mvPosition.xyz = p2+t*pnorm;
       } else { //orthographic
         mvPosition.xyz = p2;
       } 
       mult *= -1.0;
    }
    vec3 cr = normalize(cross(mvPosition.xyz,norm))*radius;
    vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*radius;
    mvPosition.xyz +=  mult*(cr + doublecr).xyz;
    cposition = mvPosition.xyz;
    gl_Position = projectionMatrix * mvPosition;
    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vLight = normalize( lDirection.xyz )*directionalLightColor[0]; //not really sure this is right, but color is always white so..
}

`},"./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.vert":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];
uniform vec3 outlineColor;
uniform float outlineWidth;
uniform float outlinePushback;


attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;
attribute float radius;

varying vec3 vColor;
varying vec3 vLight;
varying vec3 cposition;
varying vec3 p1;
varying vec3 p2;
varying float r;

void main() {

    vColor = outlineColor;
    float rad = radius+sign(radius)*outlineWidth;
    r = abs(rad);
    vec4 to = modelViewMatrix*vec4(normal, 1.0); //normal is other point of cylinder
    vec4 pt = modelViewMatrix*vec4(position, 1.0);
//pushback
    to.xyz += normalize(to.xyz)*outlinePushback;
    pt.xyz += normalize(pt.xyz)*outlinePushback;

    vec4 mvPosition = pt;
    p1 = pt.xyz; p2 = to.xyz;
    vec3 norm = to.xyz-pt.xyz;
    float mult = 1.1; //slop to account for perspective of sphere
    if(length(p1) > length(p2)) { //billboard at level of closest point
       mvPosition = to;
    }
    vec3 n = normalize(mvPosition.xyz);
//intersect with the plane defined by the camera looking at the billboard point
    if(color.z >= 0.0) { //p1
       vec3 pnorm = normalize(p1);
       float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);
       mvPosition.xyz = p1+t*pnorm;
    } else {
       vec3 pnorm = normalize(p2);
       float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);
       mvPosition.xyz = p2+t*pnorm;
       mult *= -1.0;
    }
    vec3 cr = normalize(cross(mvPosition.xyz,norm))*rad;
    vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*rad;
    mvPosition.xy +=  mult*(cr + doublecr).xy;
    cposition = mvPosition.xyz;
    gl_Position = projectionMatrix * mvPosition;
    vLight = vec3(1.0,1.0,1.0);
}

`},"./src/WebGL/shaders/lib/volumetric/volumetric.frag":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`
uniform highp sampler3D data;
uniform highp sampler2D colormap;
uniform highp sampler2D depthmap;


uniform mat4 textmat;
uniform mat4 projinv;
uniform mat4 projectionMatrix;

uniform float step;
uniform float subsamples;
uniform float maxdepth;
uniform float transfermin;
uniform float transfermax;
in  vec4 mvPosition;
out vec4 color;
void main(void) {

   vec4 pos = mvPosition;
   bool seengood = false;
   float i = 0.0;
   color = vec4(1,1,1,0);
   float increment = 1.0/subsamples;
   float maxsteps = (maxdepth*subsamples/step);
//there's probably a better way to do this..
//calculate farthest possible point in model coordinates
   vec4 maxpos = vec4(pos.x,pos.y,pos.z-maxdepth,1.0);
// convert to projection
   maxpos = projectionMatrix*maxpos;
   vec4 startp = projectionMatrix*pos;
// homogonize
   maxpos /= maxpos.w;
   startp /= startp.w;
//take x,y from start and z from max
   maxpos = vec4(startp.x,startp.y,maxpos.z,1.0);
//convert back to model space
   maxpos = projinv*maxpos;
   maxpos /= maxpos.w;
   float incr = step/subsamples;
//get depth from depthmap
//startp is apparently [-1,1]
   vec2 tpos = startp.xy/2.0+0.5;
   float depth = texture(depthmap, tpos).r;
//compute vector between start and end
   vec4 direction = maxpos-pos;
   for( i = 0.0; i <= maxsteps; i++) {
      vec4 pt = (pos+(i/maxsteps)*direction);
      vec4 ppt = projectionMatrix*pt;
      float ptdepth = ppt.z/ppt.w;
      ptdepth = ((gl_DepthRange.diff * ptdepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
      if(ptdepth > depth) break;
      pt = textmat*pt;
//       pt /= pt.w;
      if(pt.x >= -0.01 && pt.y >= -0.01 && pt.z >= -0.01 && pt.x <= 1.01 && pt.y <= 1.01 && pt.z <= 1.01) {
         seengood = true;
      } else if(seengood) {
         break;
      }
      if( pt.x < -0.01 || pt.x > 1.01 || pt.y < -0.01 || pt.y > 1.01 || pt.z < -0.01 || pt.z > 1.01  ){
          color.a = 0.0;
          continue;
      }
      else {
         float val = texture(data, pt.zyx).r;
         if(isinf(val)) continue; //masked out
         float cval = (val-transfermin)/(transfermax-transfermin); //scale to texture 0-1 range
         vec4 val_color = texture(colormap, vec2(cval,0.5));
         color.rgb = color.rgb*color.a + (1.0-color.a)*val_color.a*val_color.rgb;
         color.a += (1.0 - color.a) * val_color.a; 
         if(color.a > 0.0) color.rgb /= color.a;
//          color = vec4(pt.x, pt.y, pt.z, 1.0);
      }
//       color = vec4(pt.x, pt.y, pt.z, 0.0)
    }
}

        `},"./src/WebGL/shaders/lib/volumetric/volumetric.vert":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;

in vec3 position;
out vec4 mvPosition;
void main() {

    mvPosition = modelViewMatrix * vec4( position, 1.0 );
    gl_Position = projectionMatrix*mvPosition;
}
`},"./src/WebGL/shaders/utils/stickimposterFragmentShader.partial.frag":(X,L,c)=>{c.r(L),c.d(L,{default:()=>A});const A=`uniform float opacity;
uniform mat4 projectionMatrix;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec3 vLight;
varying vec3 vColor;
varying vec3 cposition;
varying vec3 p1;
varying vec3 p2;
varying float r;

//DEFINEFRAGCOLOR

//cylinder-ray intersection testing taken from http://mrl.nyu.edu/~dzorin/cg05/lecture12.pdf
//also useful: http://stackoverflow.com/questions/9595300/cylinder-impostor-in-glsl
//with a bit more care (caps) this could be a general cylinder imposter (see also outline)
void main() {
    vec3 color = abs(vColor);
    vec3 pos = cposition;
    vec3 p = pos; //ray point
    vec3 v = vec3(0.0,0.0,-1.0); //ray normal - orthographic
    if(projectionMatrix[3][3] == 0.0) v = normalize(pos); //ray normal - perspective
    vec3 pa = p1; //cyl start
    vec3 va = normalize(p2-p1); //cyl norm
    vec3 tmp1 = v-(dot(v,va)*va);
    vec3 deltap = p-pa;
    float A = dot(tmp1,tmp1);
    if(A == 0.0) discard;
    vec3 tmp2 = deltap-(dot(deltap,va)*va);
    float B = 2.0*dot(tmp1, tmp2);
    float C = dot(tmp2,tmp2)-r*r;
//quadratic equation!
    float det = (B*B) - (4.0*A*C);
    if(det < 0.0) discard;
    float sqrtDet = sqrt(det);
    float posT = (-B+sqrtDet)/(2.0*A);
    float negT = (-B-sqrtDet)/(2.0*A);
    float intersectionT = min(posT,negT);
    vec3 qi = p+v*intersectionT;
    float dotp1 = dot(va,qi-p1);
    float dotp2 = dot(va,qi-p2);
    vec3 norm;
    if( dotp1 < 0.0 || dotp2 > 0.0) { //(p-c)^2 + 2(p-c)vt +v^2+t^2 - r^2 = 0
       vec3 cp;
       if( dotp1 < 0.0) {  
//        if(vColor.x < 0.0 ) discard; //color sign bit indicates if we should cap or not
        cp = p1;
       } else {
//          if(vColor.y < 0.0 ) discard;
          cp = p2;
       }
       vec3 diff = p-cp;
       A = dot(v,v);
       B = dot(diff,v)*2.0;
       C = dot(diff,diff)-r*r;
       det = (B*B) - (4.0*C);
       if(det < 0.0) discard;
       sqrtDet = sqrt(det);
       posT = (-B+sqrtDet)/(2.0);
       negT = (-B-sqrtDet)/(2.0);
       float t = min(posT,negT);
       qi = p+v*t; 
       norm = normalize(qi-cp); 
    } else {
       norm = normalize(qi-(dotp1*va + p1));
    }
    vec4 clipPos = projectionMatrix * vec4(qi, 1.0);
    float ndcDepth = clipPos.z / clipPos.w;
    float depth = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
    gl_FragDepthEXT = depth;`},"./src/GLDraw.ts":(X,L,c)=>{c.r(L),c.d(L,{CAP:()=>T,GLDraw:()=>D});var A=c("./src/WebGL/math/index.ts"),T;(function(P){P[P.NONE=0]="NONE",P[P.FLAT=1]="FLAT",P[P.ROUND=2]="ROUND"})(T||(T={}));var D;(function(P){function u(t,r,h){var s=Math.hypot(t,r),o,e,n,a,g;s<1e-4?(e=0,n=1):(e=-t/s,n=r/s),r=-e*t+n*r,o=Math.hypot(r,h),o<1e-4?(a=0,g=1):(a=h/o,g=r/o);var f=new Float32Array(9);return f[0]=n,f[1]=e,f[2]=0,f[3]=-e*g,f[4]=n*g,f[5]=a,f[6]=e*a,f[7]=-n*a,f[8]=g,f}class y{constructor(){this.cache={};let r=[],h=4,s=Math.pow(2,h),o=2,e=Math.pow(2,o),n=s/e,a;for(r[0]=new A.Vector3(-1,0,0),r[n]=new A.Vector3(0,0,1),r[n*2]=new A.Vector3(1,0,0),r[n*3]=new A.Vector3(0,0,-1),o=3;o<=h;o++){for(e=Math.pow(2,o-1),n=s/e,a=0;a<e-1;a++)r[n/2+a*n]=r[a*n].clone().add(r[(a+1)*n]).normalize();a=e-1,r[n/2+a*n]=r[a*n].clone().add(r[0]).normalize()}this.basisVectors=r}getVerticesForRadius(r,h,s){if(typeof this.cache<"u"&&this.cache[r]!==void 0&&this.cache[r][h+s]!==void 0)return this.cache[r][h+s];for(var o=this.basisVectors.length,e=[],n=[],a,g=0;g<o;g++)e.push(this.basisVectors[g].clone().multiplyScalar(r)),e.push(this.basisVectors[g].clone().multiplyScalar(r)),a=this.basisVectors[g].clone().normalize(),n.push(a),n.push(a);var f=[],E=10,w=o,R=0,z=Math.PI*2,S=0,I=Math.PI,F,G,B=!1,W=!1;for(G=0;G<=E;G++){B=G===0||G===E,W=G===E/2;var V=[],k=[];for(F=0;F<=w;F++){if(W){var U=F<w?2*F:0;k.push(U+1),V.push(U);continue}var j=F/w,q=G/E;if(!B||F===0)if(F<w){var ie=new A.Vector3;ie.x=-r*Math.cos(R+j*z)*Math.sin(S+q*I),h==1?ie.y=0:ie.y=r*Math.cos(S+q*I),ie.z=r*Math.sin(R+j*z)*Math.sin(S+q*I),Math.abs(ie.x)<1e-5&&(ie.x=0),Math.abs(ie.y)<1e-5&&(ie.y=0),Math.abs(ie.z)<1e-5&&(ie.z=0),h==T.FLAT?(a=new A.Vector3(0,Math.cos(S+q*I),0),a.normalize()):(a=new A.Vector3(ie.x,ie.y,ie.z),a.normalize()),e.push(ie),n.push(a),V.push(e.length-1)}else V.push(e.length-w);else B&&V.push(e.length-1)}W&&f.push(k),f.push(V)}var ge={vertices:e,normals:n,verticesRows:f,w,h:E};return r in this.cache||(this.cache[r]={}),this.cache[r][h+s]=ge,ge}}var C=new y;function v(t,r,h,s,o,e=0,n=0){if(!r||!h)return;let a=function(ye){if(typeof ye=="string"){let je=ye;return je.toLowerCase()=="flat"?T.FLAT:je.toLowerCase()=="round"?T.ROUND:T.NONE}else return ye};e=a(e),n=a(n);var g=n||e;o=o||{r:0,g:0,b:0};var f=u(h.x-r.x,h.y-r.y,h.z-r.z),E=C.getVerticesForRadius(s,n,"to"),w=E.w,R=E.h,z=g?R*w+2:2*w,S=t.updateGeoGroup(z),I=E.vertices,F=E.normals,G=E.verticesRows,B=G[R/2],W=G[R/2+1],V=S.vertices,k,U,j,q,ie,ge,he=S.vertexArray,ve=S.normalArray,le=S.colorArray,se=S.faceArray;for(j=0;j<w;++j){var Me=2*j;q=f[0]*I[Me].x+f[3]*I[Me].y+f[6]*I[Me].z,ie=f[1]*I[Me].x+f[4]*I[Me].y+f[7]*I[Me].z,ge=f[5]*I[Me].y+f[8]*I[Me].z,k=3*(V+Me),U=S.faceidx,he[k]=q+r.x,he[k+1]=ie+r.y,he[k+2]=ge+r.z,he[k+3]=q+h.x,he[k+4]=ie+h.y,he[k+5]=ge+h.z,ve[k]=q,ve[k+3]=q,ve[k+1]=ie,ve[k+4]=ie,ve[k+2]=ge,ve[k+5]=ge,le[k]=o.r,le[k+3]=o.r,le[k+1]=o.g,le[k+4]=o.g,le[k+2]=o.b,le[k+5]=o.b,se[U]=W[j]+V,se[U+1]=W[j+1]+V,se[U+2]=B[j]+V,se[U+3]=B[j]+V,se[U+4]=W[j+1]+V,se[U+5]=B[j+1]+V,S.faceidx+=6}if(g){var be=n?0:R/2,Pe=e?R+1:R/2+1,ce,me,De,Se,Ge,ke,ze,Re,Be,Ie,We,Fe,$e,Ye,$,Z,J,ae,de,Ee,we,H,fe,xe,Te,ne,Le,K,Oe,Ne,O,pe;for(ie=be;ie<Pe;ie++)if(ie!==R/2){var ue=ie<=R/2?h:r,Y=C.getVerticesForRadius(s,n,"to"),re=C.getVerticesForRadius(s,e,"from");for(ue===h?(I=Y.vertices,F=Y.normals,G=Y.verticesRows):ue==r&&(I=re.vertices,F=re.normals,G=re.verticesRows),q=0;q<w;q++)U=S.faceidx,ce=G[ie][q+1],Oe=(ce+V)*3,me=G[ie][q],Ne=(me+V)*3,De=G[ie+1][q],O=(De+V)*3,Se=G[ie+1][q+1],pe=(Se+V)*3,Ge=f[0]*I[ce].x+f[3]*I[ce].y+f[6]*I[ce].z,ke=f[0]*I[me].x+f[3]*I[me].y+f[6]*I[me].z,ze=f[0]*I[De].x+f[3]*I[De].y+f[6]*I[De].z,Re=f[0]*I[Se].x+f[3]*I[Se].y+f[6]*I[Se].z,Be=f[1]*I[ce].x+f[4]*I[ce].y+f[7]*I[ce].z,Ie=f[1]*I[me].x+f[4]*I[me].y+f[7]*I[me].z,We=f[1]*I[De].x+f[4]*I[De].y+f[7]*I[De].z,Fe=f[1]*I[Se].x+f[4]*I[Se].y+f[7]*I[Se].z,$e=f[5]*I[ce].y+f[8]*I[ce].z,Ye=f[5]*I[me].y+f[8]*I[me].z,$=f[5]*I[De].y+f[8]*I[De].z,Z=f[5]*I[Se].y+f[8]*I[Se].z,he[Oe]=Ge+ue.x,he[Ne]=ke+ue.x,he[O]=ze+ue.x,he[pe]=Re+ue.x,he[Oe+1]=Be+ue.y,he[Ne+1]=Ie+ue.y,he[O+1]=We+ue.y,he[pe+1]=Fe+ue.y,he[Oe+2]=$e+ue.z,he[Ne+2]=Ye+ue.z,he[O+2]=$+ue.z,he[pe+2]=Z+ue.z,le[Oe]=o.r,le[Ne]=o.r,le[O]=o.r,le[pe]=o.r,le[Oe+1]=o.g,le[Ne+1]=o.g,le[O+1]=o.g,le[pe+1]=o.g,le[Oe+2]=o.b,le[Ne+2]=o.b,le[O+2]=o.b,le[pe+2]=o.b,J=f[0]*F[ce].x+f[3]*F[ce].y+f[6]*F[ce].z,ae=f[0]*F[me].x+f[3]*F[me].y+f[6]*F[me].z,de=f[0]*F[De].x+f[3]*F[De].y+f[6]*F[De].z,Ee=f[0]*F[Se].x+f[3]*F[Se].y+f[6]*F[Se].z,we=f[1]*F[ce].x+f[4]*F[ce].y+f[7]*F[ce].z,H=f[1]*F[me].x+f[4]*F[me].y+f[7]*F[me].z,fe=f[1]*F[De].x+f[4]*F[De].y+f[7]*F[De].z,xe=f[1]*F[Se].x+f[4]*F[Se].y+f[7]*F[Se].z,Te=f[5]*F[ce].y+f[8]*F[ce].z,ne=f[5]*F[me].y+f[8]*F[me].z,Le=f[5]*F[De].y+f[8]*F[De].z,K=f[5]*F[Se].y+f[8]*F[Se].z,ie===0?(ve[Oe]=J,ve[O]=de,ve[pe]=Ee,ve[Oe+1]=we,ve[O+1]=fe,ve[pe+1]=xe,ve[Oe+2]=Te,ve[O+2]=Le,ve[pe+2]=K,se[U]=ce+V,se[U+1]=De+V,se[U+2]=Se+V,S.faceidx+=3):ie===Pe-1?(ve[Oe]=J,ve[Ne]=ae,ve[O]=de,ve[Oe+1]=we,ve[Ne+1]=H,ve[O+1]=fe,ve[Oe+2]=Te,ve[Ne+2]=ne,ve[O+2]=Le,se[U]=ce+V,se[U+1]=me+V,se[U+2]=De+V,S.faceidx+=3):(ve[Oe]=J,ve[Ne]=ae,ve[pe]=Ee,ve[Oe+1]=we,ve[Ne+1]=H,ve[pe+1]=xe,ve[Oe+2]=Te,ve[Ne+2]=ne,ve[pe+2]=K,ve[Ne]=ae,ve[O]=de,ve[pe]=Ee,ve[Ne+1]=H,ve[O+1]=fe,ve[pe+1]=xe,ve[Ne+2]=ne,ve[O+2]=Le,ve[pe+2]=K,se[U]=ce+V,se[U+1]=me+V,se[U+2]=Se+V,se[U+3]=me+V,se[U+4]=De+V,se[U+5]=Se+V,S.faceidx+=6)}}S.vertices+=z}P.drawCylinder=v;function M(t,r,h,s,o){if(!r||!h)return;o=o||{r:0,g:0,b:0};let e=new A.Vector3(h.x-r.x,h.y-r.y,h.z-r.z);var n=u(e.x,e.y,e.z);e=e.normalize();var a=C.basisVectors.length,g=C.basisVectors,f=a+2,E=t.updateGeoGroup(f),w=E.vertices,R,z,S,I,F,G,B=E.vertexArray,W=E.normalArray,V=E.colorArray,k=E.faceArray;for(R=w*3,B[R]=r.x,B[R+1]=r.y,B[R+2]=r.z,W[R]=-e.x,W[R+1]=-e.y,W[R+2]=-e.z,V[R]=o.r,V[R+1]=o.g,V[R+2]=o.b,B[R+3]=h.x,B[R+4]=h.y,B[R+5]=h.z,W[R+3]=e.x,W[R+4]=e.y,W[R+5]=e.z,V[R+3]=o.r,V[R+4]=o.g,V[R+5]=o.b,R+=6,S=0;S<a;++S){var U=g[S].clone();U.multiplyScalar(s),I=n[0]*U.x+n[3]*U.y+n[6]*U.z,F=n[1]*U.x+n[4]*U.y+n[7]*U.z,G=n[5]*U.y+n[8]*U.z,B[R]=I+r.x,B[R+1]=F+r.y,B[R+2]=G+r.z,W[R]=I,W[R+1]=F,W[R+2]=G,V[R]=o.r,V[R+1]=o.g,V[R+2]=o.b,R+=3}for(E.vertices+=a+2,z=E.faceidx,S=0;S<a;S++){var j=w+2+S,q=w+2+(S+1)%a;k[z]=j,k[z+1]=q,k[z+2]=w,z+=3,k[z]=j,k[z+1]=q,k[z+2]=w+1,z+=3}E.faceidx+=6*a}P.drawCone=M;class _{constructor(){this.cache=new Map}getVerticesForRadius(r,h){h=h||2,this.cache.has(h)||this.cache.set(h,new Map);let s=this.cache.get(h);if(s.has(r))return s.get(r);var o={vertices:[],verticesRows:[],normals:[]},e=16*h,n=10*h;r<1&&(e=10*h,n=8*h);var a=0,g=Math.PI*2,f=0,E=Math.PI,w,R;for(R=0;R<=n;R++){let S=[];for(w=0;w<=e;w++){let I=w/e,F=R/n,G=-r*Math.cos(a+I*g)*Math.sin(f+F*E),B=r*Math.cos(f+F*E),W=r*Math.sin(a+I*g)*Math.sin(f+F*E);var z=new A.Vector3(G,B,W);z.normalize(),o.vertices.push({x:G,y:B,z:W}),o.normals.push(z),S.push(o.vertices.length-1)}o.verticesRows.push(S)}return s.set(r,o),o}}var p=new _;function x(t,r,h,s,o){var e=p.getVerticesForRadius(h,o),n=e.vertices,a=e.normals,g=t.updateGeoGroup(n.length),f=g.vertices,E=g.vertexArray,w=g.colorArray,R=g.faceArray,z=g.lineArray,S=g.normalArray;for(let G=0,B=n.length;G<B;++G){let W=3*(f+G),V=n[G];E[W]=V.x+r.x,E[W+1]=V.y+r.y,E[W+2]=V.z+r.z,w[W]=s.r,w[W+1]=s.g,w[W+2]=s.b}g.vertices+=n.length;let I=e.verticesRows,F=I.length-1;for(let G=0;G<F;G++){let B=I[G].length-1;for(let W=0;W<B;W++){let V=g.faceidx,k=g.lineidx,U=I[G][W+1]+f,j=U*3,q=I[G][W]+f,ie=q*3,ge=I[G+1][W]+f,he=ge*3,ve=I[G+1][W+1]+f,le=ve*3,se=a[U-f],Me=a[q-f],be=a[ge-f],Pe=a[ve-f];Math.abs(n[U-f].y)===h?(S[j]=se.x,S[he]=be.x,S[le]=Pe.x,S[j+1]=se.y,S[he+1]=be.y,S[le+1]=Pe.y,S[j+2]=se.z,S[he+2]=be.z,S[le+2]=Pe.z,R[V]=U,R[V+1]=ge,R[V+2]=ve,z[k]=U,z[k+1]=ge,z[k+2]=U,z[k+3]=ve,z[k+4]=ge,z[k+5]=ve,g.faceidx+=3,g.lineidx+=6):Math.abs(n[ge-f].y)===h?(S[j]=se.x,S[ie]=Me.x,S[he]=be.x,S[j+1]=se.y,S[ie+1]=Me.y,S[he+1]=be.y,S[j+2]=se.z,S[ie+2]=Me.z,S[he+2]=be.z,R[V]=U,R[V+1]=q,R[V+2]=ge,z[k]=U,z[k+1]=q,z[k+2]=U,z[k+3]=ge,z[k+4]=q,z[k+5]=ge,g.faceidx+=3,g.lineidx+=6):(S[j]=se.x,S[ie]=Me.x,S[le]=Pe.x,S[j+1]=se.y,S[ie+1]=Me.y,S[le+1]=Pe.y,S[j+2]=se.z,S[ie+2]=Me.z,S[le+2]=Pe.z,S[ie]=Me.x,S[he]=be.x,S[le]=Pe.x,S[ie+1]=Me.y,S[he+1]=be.y,S[le+1]=Pe.y,S[ie+2]=Me.z,S[he+2]=be.z,S[le+2]=Pe.z,R[V]=U,R[V+1]=q,R[V+2]=ve,R[V+3]=q,R[V+4]=ge,R[V+5]=ve,z[k]=U,z[k+1]=q,z[k+2]=U,z[k+3]=ve,z[k+4]=q,z[k+5]=ge,z[k+6]=ge,z[k+7]=ve,g.faceidx+=6,g.lineidx+=8)}}}P.drawSphere=x})(D||(D={}))},"./src/GLModel.ts":(X,L,c)=>{c.r(L),c.d(L,{GLModel:()=>r});var A=c("./src/WebGL/index.ts"),T=c("./src/WebGL/shapes/index.ts"),D=c("./src/WebGL/math/index.ts"),P=c("./src/colors.ts"),u=c("./src/GLDraw.ts"),y=c("./src/glcartoon.ts"),C=c("./src/utilities.ts"),v=c("./src/Gradient.ts"),M=c("./src/parsers/index.ts"),_=c("./node_modules/netcdfjs/lib-esm/index.js"),p=c("./node_modules/pako/dist/pako.esm.mjs"),x=c("./src/parsers/utils/assignBonds.ts");function t(h){let s;return typeof h=="string"?s=new TextEncoder().encode(h):s=new Uint8Array(h),(0,p.inflate)(s,{to:"string"})}class r{static sameObj(s,o){return s&&o?JSON.stringify(s)==JSON.stringify(o):s==o}constructor(s,o){this.atoms=[],this.frames=[],this.box=null,this.atomdfs=null,this.id=0,this.hidden=!1,this.molObj=null,this.renderedMolObj=null,this.lastColors=null,this.modelData={},this.modelDatas=null,this.idMatrix=new D.Matrix4,this.dontDuplicateAtoms=!0,this.defaultColor=P.elementColors.defaultColor,this.defaultStickRadius=.25,this.options=o||{},this.ElementColors=this.options.defaultcolors?this.options.defaultcolors:P.elementColors.defaultColors,this.defaultSphereRadius=this.options.defaultSphereRadius?this.options.defaultSphereRadius:1.5,this.defaultCartoonQuality=this.options.cartoonQuality?this.options.cartoonQuality:10,this.id=s}getRadiusFromStyle(s,o){var e=this.defaultSphereRadius;if(typeof o.radius<"u")e=o.radius;else if(r.vdwRadii[s.elem])e=r.vdwRadii[s.elem];else if(s.elem.length>1){let n=s.elem;n=n[0].toUpperCase()+n[1].toLowerCase(),r.vdwRadii[n]&&(e=r.vdwRadii[n])}return typeof o.scale<"u"&&(e*=o.scale),e}drawAtomCross(s,o){if(s.style.cross){var e=s.style.cross;if(!e.hidden){var n=e.linewidth||r.defaultlineWidth;o[n]||(o[n]=new A.Geometry);var a=o[n].updateGeoGroup(6),g=this.getRadiusFromStyle(s,e),f=[[g,0,0],[-g,0,0],[0,g,0],[0,-g,0],[0,0,g],[0,0,-g]],E=s.clickable||s.hoverable;E&&s.intersectionShape===void 0&&(s.intersectionShape={sphere:[],cylinder:[],line:[]});for(var w=(0,C.getColorFromStyle)(s,e),R=a.vertexArray,z=a.colorArray,S=0;S<6;S++){var I=a.vertices*3;if(a.vertices++,R[I]=s.x+f[S][0],R[I+1]=s.y+f[S][1],R[I+2]=s.z+f[S][2],z[I]=w.r,z[I+1]=w.g,z[I+2]=w.b,E){var F=new D.Vector3(f[S][0],f[S][1],f[S][2]);F.multiplyScalar(.1),F.set(F.x+s.x,F.y+s.y,F.z+s.z),s.intersectionShape.line.push(F)}}}}}getGoodCross(s,o,e,n){for(var a=null,g=-1,f=0,E=s.bonds.length;f<E;f++)if(s.bonds[f]!=o.index){let R=s.bonds[f],z=this.atoms[R],I=new D.Vector3(z.x,z.y,z.z).clone();I.sub(e);let F=I.clone();F.cross(n);var w=F.lengthSq();if(w>g&&(g=w,a=F,g>.1))return a}return a}getSideBondV(s,o,e){var n,a,g,f,E,w=new D.Vector3(s.x,s.y,s.z),R=new D.Vector3(o.x,o.y,o.z),z=R.clone(),S=null;if(z.sub(w),s.bonds.length===1)o.bonds.length===1?(S=z.clone(),Math.abs(S.x)>1e-4?S.y+=1:S.x+=1):(n=(e+1)%o.bonds.length,a=o.bonds[n],g=this.atoms[a],g.index==s.index&&(n=(n+1)%o.bonds.length,a=o.bonds[n],g=this.atoms[a]),f=new D.Vector3(g.x,g.y,g.z),E=f.clone(),E.sub(w),S=E.clone(),S.cross(z));else if(S=this.getGoodCross(s,o,w,z),S.lengthSq()<.01){var I=this.getGoodCross(o,s,w,z);I!=null&&(S=I)}return S.lengthSq()<.01&&(S=z.clone(),Math.abs(S.x)>1e-4?S.y+=1:S.x+=1),S.cross(z),S.normalize(),S}addLine(s,o,e,n,a,g){s[e]=n.x,s[e+1]=n.y,s[e+2]=n.z,o[e]=g.r,o[e+1]=g.g,o[e+2]=g.b,s[e+3]=a.x,s[e+4]=a.y,s[e+5]=a.z,o[e+3]=g.r,o[e+4]=g.g,o[e+5]=g.b}drawBondLines(s,o,e){if(s.style.line){var n=s.style.line;if(!n.hidden){var a,g,f,E,w=n.linewidth||r.defaultlineWidth;e[w]||(e[w]=new A.Geometry);for(var R=e[w].updateGeoGroup(6*s.bonds.length),z=R.vertexArray,S=R.colorArray,I=0;I<s.bonds.length;I++){var F=s.bonds[I],G=o[F];if(G.style.line&&!(s.index>=G.index)){var B=new D.Vector3(s.x,s.y,s.z),W=new D.Vector3(G.x,G.y,G.z),V=B.clone().add(W).multiplyScalar(.5),k=!1,U=s.clickable||s.hoverable,j=G.clickable||G.hoverable;(U||j)&&(U&&(s.intersectionShape===void 0&&(s.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),s.intersectionShape.line.push(B),s.intersectionShape.line.push(V)),j&&(G.intersectionShape===void 0&&(G.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),G.intersectionShape.line.push(V),G.intersectionShape.line.push(W)));var q=(0,C.getColorFromStyle)(s,s.style.line),ie=(0,C.getColorFromStyle)(G,G.style.line);if(s.bondStyles&&s.bondStyles[I]){var ge=s.bondStyles[I];if(!ge.iswire)continue;ge.singleBond&&(k=!0),typeof ge.color1<"u"&&(q=P.CC.color(ge.color1)),typeof ge.color2<"u"&&(ie=P.CC.color(ge.color2))}var he=R.vertices*3,ve,le;if(s.bondOrder[I]>1&&s.bondOrder[I]<4&&!k){var se=this.getSideBondV(s,G,I),Me=W.clone();Me.sub(B),s.bondOrder[I]==2?(se.multiplyScalar(.1),a=B.clone(),a.add(se),g=B.clone(),g.sub(se),f=a.clone(),f.add(Me),E=g.clone(),E.add(Me),q==ie?(R.vertices+=4,this.addLine(z,S,he,a,f,q),this.addLine(z,S,he+6,g,E,q)):(R.vertices+=8,Me.multiplyScalar(.5),ve=a.clone(),ve.add(Me),le=g.clone(),le.add(Me),this.addLine(z,S,he,a,ve,q),this.addLine(z,S,he+6,ve,f,ie),this.addLine(z,S,he+12,g,le,q),this.addLine(z,S,he+18,le,E,ie))):s.bondOrder[I]==3&&(se.multiplyScalar(.1),a=B.clone(),a.add(se),g=B.clone(),g.sub(se),f=a.clone(),f.add(Me),E=g.clone(),E.add(Me),q==ie?(R.vertices+=6,this.addLine(z,S,he,B,W,q),this.addLine(z,S,he+6,a,f,q),this.addLine(z,S,he+12,g,E,q)):(R.vertices+=12,Me.multiplyScalar(.5),ve=a.clone(),ve.add(Me),le=g.clone(),le.add(Me),this.addLine(z,S,he,B,V,q),this.addLine(z,S,he+6,V,W,ie),this.addLine(z,S,he+12,a,ve,q),this.addLine(z,S,he+18,ve,f,ie),this.addLine(z,S,he+24,g,le,q),this.addLine(z,S,he+30,le,E,ie)))}else q==ie?(R.vertices+=2,this.addLine(z,S,he,B,W,q)):(R.vertices+=4,this.addLine(z,S,he,B,V,q),this.addLine(z,S,he+6,V,W,ie))}}}}}drawAtomSphere(s,o){if(s.style.sphere){var e=s.style.sphere;if(!e.hidden){var n=(0,C.getColorFromStyle)(s,e),a=this.getRadiusFromStyle(s,e);if((s.clickable===!0||s.hoverable)&&s.intersectionShape!==void 0){var g=new D.Vector3(s.x,s.y,s.z);s.intersectionShape.sphere.push(new T.Sphere(g,a))}u.GLDraw.drawSphere(o,s,a,n)}}}drawAtomClickSphere(s){if(s.style.clicksphere){var o=s.style.clicksphere;if(!o.hidden){var e=this.getRadiusFromStyle(s,o);if((s.clickable===!0||s.hoverable)&&s.intersectionShape!==void 0){var n=new D.Vector3(s.x,s.y,s.z);s.intersectionShape.sphere.push(new T.Sphere(n,e))}}}}drawAtomInstanced(s,o){if(s.style.sphere){var e=s.style.sphere;if(!e.hidden){var n=this.getRadiusFromStyle(s,e),a=(0,C.getColorFromStyle)(s,e),g=o.updateGeoGroup(1),f=g.vertices,E=f*3,w=g.vertexArray,R=g.colorArray,z=g.radiusArray;if(w[E]=s.x,w[E+1]=s.y,w[E+2]=s.z,R[E]=a.r,R[E+1]=a.g,R[E+2]=a.b,z[f]=n,(s.clickable===!0||s.hoverable)&&s.intersectionShape!==void 0){var S=new D.Vector3(s.x,s.y,s.z);s.intersectionShape.sphere.push(new T.Sphere(S,n))}g.vertices+=1}}}drawSphereImposter(s,o,e,n){var a=s.updateGeoGroup(4),g,f=a.vertices,E=f*3,w=a.vertexArray,R=a.colorArray;for(g=0;g<4;g++)w[E+3*g]=o.x,w[E+3*g+1]=o.y,w[E+3*g+2]=o.z;var z=a.normalArray;for(g=0;g<4;g++)R[E+3*g]=n.r,R[E+3*g+1]=n.g,R[E+3*g+2]=n.b;z[E+0]=-e,z[E+1]=e,z[E+2]=0,z[E+3]=-e,z[E+4]=-e,z[E+5]=0,z[E+6]=e,z[E+7]=-e,z[E+8]=0,z[E+9]=e,z[E+10]=e,z[E+11]=0,a.vertices+=4;var S=a.faceArray,I=a.faceidx;S[I+0]=f,S[I+1]=f+1,S[I+2]=f+2,S[I+3]=f+2,S[I+4]=f+3,S[I+5]=f,a.faceidx+=6}drawAtomImposter(s,o){if(s.style.sphere){var e=s.style.sphere;if(!e.hidden){var n=this.getRadiusFromStyle(s,e),a=(0,C.getColorFromStyle)(s,e);if((s.clickable===!0||s.hoverable)&&s.intersectionShape!==void 0){var g=new D.Vector3(s.x,s.y,s.z);s.intersectionShape.sphere.push(new T.Sphere(g,n))}this.drawSphereImposter(o,s,n,a)}}}calculateDashes(s,o,e,n,a){var g=Math.sqrt(Math.pow(s.x-o.x,2)+Math.pow(s.y-o.y,2)+Math.pow(s.z-o.z,2));e=Math.max(e,0),a=Math.max(a,0)+2*e,n=Math.max(n,.001),n+a>g&&(n=g,a=0);var f=Math.floor((g-n)/(n+a))+1,E=f*n;a=(g-E)/f;for(var w,R=new D.Vector3(s.x,s.y,s.z),z=new D.Vector3((o.x-s.x)/(g/a),(o.y-s.y)/(g/a),(o.z-s.z)/(g/a)),S=new D.Vector3((o.x-s.x)/(g/n),(o.y-s.y)/(g/n),(o.z-s.z)/(g/n)),I=[],F=0;F<f;F++)w=new D.Vector3(R.x+S.x,R.y+S.y,R.z+S.z),I.push({from:R,to:w}),R=new D.Vector3(w.x+z.x,w.y+z.y,w.z+z.z);return I}static drawStickImposter(s,o,e,n,a,g=0,f=0){for(var E=s.updateGeoGroup(4),w=E.vertices,R=w*3,z=E.vertexArray,S=E.colorArray,I=E.radiusArray,F=E.normalArray,G=a.r,B=a.g,W=a.b,V=function(ie){var ge=-ie;return ge==0&&(ge=-1e-4),ge},k=R,U=0;U<4;U++)z[k]=o.x,F[k]=e.x,S[k]=G,k++,z[k]=o.y,F[k]=e.y,S[k]=B,k++,z[k]=o.z,F[k]=e.z,U<2?S[k]=W:S[k]=V(W),k++;E.vertices+=4,I[w]=-n,I[w+1]=n,I[w+2]=-n,I[w+3]=n;var j=E.faceArray,q=E.faceidx;j[q+0]=w,j[q+1]=w+1,j[q+2]=w+2,j[q+3]=w+2,j[q+4]=w+3,j[q+5]=w,E.faceidx+=6}drawBondSticks(s,o,e){var n,a;if(s.style.stick){var g=s.style.stick;if(!g.hidden){var f=g.radius||this.defaultStickRadius,E=g.doubleBondScaling||.4,w=g.tripleBondScaling||.25,R=((n=g.dashedBondConfig)===null||n===void 0?void 0:n.dashLength)||.1,z=((a=g.dashedBondConfig)===null||a===void 0?void 0:a.gapLength)||.25,S=f,I=g.singleBonds||!1,F=g.dashedBonds||!1,G=0,B=0,W,V,k,U,j,q,ie,ge,he,ve,le,se=(0,C.getColorFromStyle)(s,g),Me,be,Pe;!s.capDrawn&&s.bonds.length<4&&(G=2);var ce=Te=>{var ne=e.imposter?r.drawStickImposter:u.GLDraw.drawCylinder;return!F&&Te>=1?ne:(Le,K,Oe,Ne,O,pe=0,ue=0,Y=.1,re=.25)=>{var ye=this.calculateDashes(K,Oe,Ne,Y,re);ye.forEach(je=>{ne(Le,je.from,je.to,Ne,O,pe,ue)})}};for(k=0;k<s.bonds.length;k++){var me=ce(s.bondOrder[k]),De=s.bonds[k],Se=o[De];if(Me=be=Pe=null,s.index<Se.index){var Ge=Se.style;if(!Ge.stick||Ge.stick.hidden)continue;var ke=(0,C.getColorFromStyle)(Se,Ge.stick);if(S=f,U=I,s.bondStyles&&s.bondStyles[k]){if(j=s.bondStyles[k],j.iswire)continue;j.radius&&(S=j.radius),j.singleBond&&(U=!0),typeof j.color1<"u"&&(se=P.CC.color(j.color1)),typeof j.color2<"u"&&(ke=P.CC.color(j.color2))}var ze=new D.Vector3(s.x,s.y,s.z),Re=new D.Vector3(Se.x,Se.y,Se.z);if(s.bondOrder[k]<=1||U||s.bondOrder[k]>3){if(s.bondOrder[k]<1&&(S*=s.bondOrder[k]),!Se.capDrawn&&Se.bonds.length<4&&(B=2),se!=ke?(Me=new D.Vector3().addVectors(ze,Re).multiplyScalar(.5),me(e,ze,Me,S,se,G,0,R,z),me(e,Me,Re,S,ke,0,B,R,z)):me(e,ze,Re,S,se,G,B,R,z),W=s.clickable||s.hoverable,V=Se.clickable||Se.hoverable,W||V){if(Me||(Me=new D.Vector3().addVectors(ze,Re).multiplyScalar(.5)),W){var Be=new T.Cylinder(ze,Me,S),Ie=new T.Sphere(ze,S);s.intersectionShape.cylinder.push(Be),s.intersectionShape.sphere.push(Ie)}if(V){var We=new T.Cylinder(Re,Me,S),Fe=new T.Sphere(Re,S);Se.intersectionShape.cylinder.push(We),Se.intersectionShape.sphere.push(Fe)}}}else if(s.bondOrder[k]>1){var $e=0,Ye=0;S!=f&&($e=2,Ye=2);var $=Re.clone(),Z=null;$.sub(ze);var J,ae,de,Ee,we;Z=this.getSideBondV(s,Se,k),s.bondOrder[k]==2?(J=S*E,Z.multiplyScalar(J*1.5),ae=ze.clone(),ae.add(Z),de=ze.clone(),de.sub(Z),Ee=ae.clone(),Ee.add($),we=de.clone(),we.add($),se!=ke?(Me=new D.Vector3().addVectors(ae,Ee).multiplyScalar(.5),be=new D.Vector3().addVectors(de,we).multiplyScalar(.5),me(e,ae,Me,J,se,$e,0),me(e,Me,Ee,J,ke,0,Ye),me(e,de,be,J,se,$e,0),me(e,be,we,J,ke,0,Ye)):(me(e,ae,Ee,J,se,$e,Ye),me(e,de,we,J,se,$e,Ye)),W=s.clickable||s.hoverable,V=Se.clickable||Se.hoverable,(W||V)&&(Me||(Me=new D.Vector3().addVectors(ae,Ee).multiplyScalar(.5)),be||(be=new D.Vector3().addVectors(de,we).multiplyScalar(.5)),W&&(q=new T.Cylinder(ae,Me,J),ie=new T.Cylinder(de,be,J),s.intersectionShape.cylinder.push(q),s.intersectionShape.cylinder.push(ie)),V&&(he=new T.Cylinder(Ee,Me,J),ve=new T.Cylinder(we,be,J),Se.intersectionShape.cylinder.push(he),Se.intersectionShape.cylinder.push(ve)))):s.bondOrder[k]==3&&(J=S*w,Z.cross($),Z.normalize(),Z.multiplyScalar(J*3),ae=ze.clone(),ae.add(Z),de=ze.clone(),de.sub(Z),Ee=ae.clone(),Ee.add($),we=de.clone(),we.add($),se!=ke?(Me=new D.Vector3().addVectors(ae,Ee).multiplyScalar(.5),be=new D.Vector3().addVectors(de,we).multiplyScalar(.5),Pe=new D.Vector3().addVectors(ze,Re).multiplyScalar(.5),me(e,ae,Me,J,se,$e,0),me(e,Me,Ee,J,ke,0,Ye),me(e,ze,Pe,J,se,G,0),me(e,Pe,Re,J,ke,0,B),me(e,de,be,J,se,$e,0),me(e,be,we,J,ke,0,Ye)):(me(e,ae,Ee,J,se,$e,Ye),me(e,ze,Re,J,se,G,B),me(e,de,we,J,se,$e,Ye)),W=s.clickable||s.hoverable,V=Se.clickable||Se.hoverable,(W||V)&&(Me||(Me=new D.Vector3().addVectors(ae,Ee).multiplyScalar(.5)),be||(be=new D.Vector3().addVectors(de,we).multiplyScalar(.5)),Pe||(Pe=new D.Vector3().addVectors(ze,Re).multiplyScalar(.5)),W&&(q=new T.Cylinder(ae.clone(),Me.clone(),J),ie=new T.Cylinder(de.clone(),be.clone(),J),ge=new T.Cylinder(ze.clone(),Pe.clone(),J),s.intersectionShape.cylinder.push(q),s.intersectionShape.cylinder.push(ie),s.intersectionShape.cylinder.push(ge)),V&&(he=new T.Cylinder(Ee.clone(),Me.clone(),J),ve=new T.Cylinder(we.clone(),be.clone(),J),le=new T.Cylinder(Re.clone(),Pe.clone(),J),Se.intersectionShape.cylinder.push(he),Se.intersectionShape.cylinder.push(ve),Se.intersectionShape.cylinder.push(le))))}}}var H=!1,fe=0,xe=!1;for(k=0;k<s.bonds.length;k++)U=I,s.bondStyles&&s.bondStyles[k]&&(j=s.bondStyles[k],j.singleBond&&(U=!0),j.radius&&j.radius!=f&&(xe=!0)),(U||s.bondOrder[k]==1)&&fe++;xe?fe>0&&(H=!0):fe==0&&(s.bonds.length>0||g.showNonBonded)&&(H=!0),H&&(S=f,e.imposter?this.drawSphereImposter(e.sphereGeometry,s,S,se):u.GLDraw.drawSphere(e,s,S,se))}}}createMolObj(s,o){o=o||{};var e=new A.Object3D,n=[],a={},g={},f=this.drawAtomSphere,E=null,w=null;o.supportsImposters?(f=this.drawAtomImposter,E=new A.Geometry(!0),E.imposter=!0,w=new A.Geometry(!0,!0),w.imposter=!0,w.sphereGeometry=new A.Geometry(!0),w.sphereGeometry.imposter=!0,w.drawnCaps={}):o.supportsAIA?(f=this.drawAtomInstanced,E=new A.Geometry(!1,!0,!0),E.instanced=!0,w=new A.Geometry(!0)):(E=new A.Geometry(!0),w=new A.Geometry(!0));var R,z,S,I,F={},G=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(R=0,S=s.length;R<S;R++){var B=s[R];if(B&&B.style){(B.clickable||B.hoverable)&&B.intersectionShape===void 0&&(B.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),I={line:void 0,cross:void 0,stick:void 0,sphere:void 0};for(z in I)B.style[z]?B.style[z].opacity?I[z]=parseFloat(B.style[z].opacity):I[z]=1:I[z]=void 0,F[z]?I[z]!=null&&F[z]!=I[z]&&(console.log("Warning: "+z+" opacity is ambiguous"),F[z]=1):F[z]=I[z];f.call(this,B,E),this.drawAtomClickSphere(B),this.drawAtomCross(B,g),this.drawBondLines(B,s,a),this.drawBondSticks(B,s,w),typeof B.style.cartoon<"u"&&!B.style.cartoon.hidden&&(B.style.cartoon.color==="spectrum"&&typeof B.resi=="number"&&!B.hetflag&&(B.resi<G[0]&&(G[0]=B.resi),B.resi>G[1]&&(G[1]=B.resi)),n.push(B))}}if(n.length>0&&(0,y.drawCartoon)(e,n,G,this.defaultCartoonQuality),E&&E.vertices>0){E.initTypedArrays();var W=null,V=null;E.imposter?W=new A.SphereImposterMaterial({ambient:0,vertexColors:!0,reflectivity:0}):E.instanced?(V=new A.Geometry(!0),u.GLDraw.drawSphere(V,{x:0,y:0,z:0},1,new P.Color(.5,.5,.5)),V.initTypedArrays(),W=new A.InstancedMaterial({sphereMaterial:new A.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0}),sphere:V})):W=new A.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0}),F.sphere<1&&F.sphere>=0&&(W.transparent=!0,W.opacity=F.sphere),V=new A.Mesh(E,W),e.add(V)}if(w.vertices>0){var k=null,U=null,j=w.sphereGeometry;(!j||typeof j.vertices>"u"||j.vertices==0)&&(j=null),w.initTypedArrays(),j&&j.initTypedArrays();var q={ambient:0,vertexColors:!0,reflectivity:0};w.imposter?(k=new A.StickImposterMaterial(q),U=new A.SphereImposterMaterial(q)):(k=new A.MeshLambertMaterial(q),U=new A.MeshLambertMaterial(q),k.wireframe&&(w.setUpWireframe(),j&&j.setUpWireframe())),F.stick<1&&F.stick>=0&&(k.transparent=!0,k.opacity=F.stick,U.transparent=!0,U.opacity=F.stick);var ie=new A.Mesh(w,k);if(e.add(ie),j){var ge=new A.Mesh(j,U);e.add(ge)}}var he;for(R in a)if(a.hasOwnProperty(R)){he=R;var ve=new A.LineBasicMaterial({linewidth:he,vertexColors:!0});F.line<1&&F.line>=0&&(ve.transparent=!0,ve.opacity=F.line),a[R].initTypedArrays();var le=new A.Line(a[R],ve,A.LineStyle.LinePieces);e.add(le)}for(R in g)if(g.hasOwnProperty(R)){he=R;var se=new A.LineBasicMaterial({linewidth:he,vertexColors:!0});F.cross<1&&F.cross>=0&&(se.transparent=!0,se.opacity=F.cross),g[R].initTypedArrays();var Me=new A.Line(g[R],se,A.LineStyle.LinePieces);e.add(Me)}if(this.dontDuplicateAtoms&&this.modelData.symmetries&&this.modelData.symmetries.length>0){var be=new A.Object3D,Pe;for(Pe=0;Pe<this.modelData.symmetries.length;Pe++){var ce=new A.Object3D;ce=e.clone(),ce.matrix.copy(this.modelData.symmetries[Pe]),ce.matrixAutoUpdate=!1,be.add(ce)}return be}return e}getInternalState(){return{atoms:this.atoms,frames:this.frames}}setInternalState(s){this.atoms=s.atoms,this.frames=s.frames,this.molObj=null}getCrystData(){if(this.modelData.cryst){if(!this.modelData.cryst.matrix){const s=this.modelData.cryst;this.modelData.cryst.matrix=(0,D.conversionMatrix3)(s.a,s.b,s.c,s.alpha,s.beta,s.gamma)}return this.modelData.cryst}else return null}setCrystData(s,o,e,n,a,g){s=s||1,o=o||1,e=e||1,n=n||90,a=a||90,g=g||90;const f=(0,D.conversionMatrix3)(s,o,e,n,a,g);this.modelData.cryst={a:s,b:o,c:e,alpha:n,beta:a,gamma:g,matrix:f}}setCrystMatrix(s){s=s||new D.Matrix3(1,0,0,0,1,0,0,0,1),this.modelData.cryst={matrix:s}}getSymmetries(){return typeof this.modelData.symmetries>"u"&&(this.modelData.symmetries=[this.idMatrix]),this.modelData.symmetries}setSymmetries(s){typeof s>"u"?this.modelData.symmetries=[this.idMatrix]:this.modelData.symmetries=s}getID(){return this.id}getNumFrames(){return this.frames.numFrames!=null?this.frames.numFrames:this.frames.length}adjustCoord(s,o,e,n){var a=o-s;return a<-e?o+n:a>e?o-n:o}adjustCoordinatesToBox(){if(this.box&&this.atomdfs)for(var s=this.box[0],o=this.box[1],e=this.box[2],n=s*.9,a=o*.9,g=e*.9,f=0;f<this.atomdfs.length;f++)for(var E=this.atomdfs[f],w=1;w<E.length;w++){var R=this.atoms[E[w][0]],z=this.atoms[E[w][1]];R.x=this.adjustCoord(z.x,R.x,n,s),R.y=this.adjustCoord(z.y,R.y,a,o),R.z=this.adjustCoord(z.z,R.z,g,e)}}setFrame(s,o){var e=this.getNumFrames();let n=this;return new Promise(function(a,g){if(e==0&&a(),(s<0||s>=e)&&(s=e-1),n.frames.url!=null){var f=n.frames.url;(0,C.getbin)(f+"/traj/frame/"+s+"/"+n.frames.path,void 0,"POST",void 0).then(function(E){for(var w=new Float32Array(E,44),R=0,z=0;z<n.atoms.length;z++)n.atoms[z].x=w[R++],n.atoms[z].y=w[R++],n.atoms[z].z=w[R++];n.box&&n.atomdfs&&n.adjustCoordinatesToBox(),a()}).catch(g)}else n.atoms=n.frames[s],a();n.molObj=null,n.modelDatas&&s<n.modelDatas.length&&(n.modelData=n.modelDatas[s],n.unitCellObjects&&o&&(o.removeUnitCell(n),o.addUnitCell(n)))})}addFrame(s){this.frames.push(s)}vibrate(s=10,o=1,e=!1,n,a){var g=0,f=s;e&&(g=-s,f=s),this.frames!==void 0&&this.frames.origIndex!==void 0?this.setFrame(this.frames.origIndex):this.setFrame(0),g<f&&(this.frames=[]),e&&(this.frames.origIndex=s);for(var E=g;E<f;E++){var w=[],R=this.frames.length;if(E==0&&!a){this.frames.push(this.atoms);continue}for(var z=0;z<this.atoms.length;z++){var S=(0,C.getAtomProperty)(this.atoms[z],"dx"),I=(0,C.getAtomProperty)(this.atoms[z],"dy"),F=(0,C.getAtomProperty)(this.atoms[z],"dz"),G=new D.Vector3(S,I,F),B=new D.Vector3(this.atoms[z].x,this.atoms[z].y,this.atoms[z].z),W=E*o/s;G.multiplyScalar(W),B.add(G);var V={};for(var k in this.atoms[z])V[k]=this.atoms[z][k];if(V.x=B.x,V.y=B.y,V.z=B.z,w.push(V),n&&a){var U=(0,C.extend)({},a),j=new D.Vector3(S,I,F);if(j.multiplyScalar(o),j.add(B),U.start=B,U.end=j,U.frame=R,!U.color){var q=V.style.sphere;q||(q=V.style.stick),q||(q=V.style.line),U.color=(0,C.getColorFromStyle)(V,q)}n.addArrow(U)}}this.frames.push(w)}}setAtomDefaults(s){for(let o=0;o<s.length;o++){let e=s[o];e&&(e.style=e.style||(0,C.deepCopy)(r.defaultAtomStyle),e.color=e.color||this.ElementColors[e.elem]||this.defaultColor,e.model=this.id,(e.clickable||e.hoverable)&&(e.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}))}}addMolData(s,o,e={}){var n=r.parseMolData(s,o,e);this.dontDuplicateAtoms=!e.duplicateAssemblyAtoms;var a=n.modelData;if(a&&(Array.isArray(a)?(this.modelData=a[0],e.frames&&(this.modelDatas=a)):this.modelData=a),n.box?this.box=n.box:this.box=null,this.frames.length==0){for(let f=0;f<n.length;f++)n[f].length!=0&&this.frames.push(n[f]);this.frames[0]&&(this.atoms=this.frames[0])}else if(e.frames)for(let f=0;f<n.length;f++)this.frames.push(n[f]);else for(var g=0;g<n.length;g++)this.addAtoms(n[g]);for(let f=0;f<this.frames.length;f++)this.setAtomDefaults(this.frames[f]);e.vibrate&&e.vibrate.frames&&e.vibrate.amplitude&&this.vibrate(e.vibrate.frames,e.vibrate.amplitude),e.style&&this.setStyle({},e.style)}setDontDuplicateAtoms(s){this.dontDuplicateAtoms=s}setModelData(s){this.modelData=s}propertyMatches(s,o){if(s==o)return!0;if(typeof o=="string"&&typeof s=="number"){var e=o.match(/(-?\d+)\s*-\s*(-?\d+)/);if(e){var n=parseInt(e[1]),a=parseInt(e[2]);if(e&&s>=n&&s<=a)return!0}}return!1}static deepCopyAndCache(s,o){if(typeof s!="object"||s==null||s.__cache_created)return s;const e={};for(const n in s){const a=s[n];if(Array.isArray(a)){e[n]=[];for(let g=0;g<a.length;g++)e[n].push(r.deepCopyAndCache(a[g],o))}else typeof a=="object"&&n!="properties"&&n!="model"?e[n]=r.deepCopyAndCache(a,o):e[n]=a;if(n=="and"||n=="or"){const g=[];for(const f of e[n]){const E=new Set;for(const w of o.selectedAtoms(f))E.add(w.index);g.push(E)}if(n=="and"){const f=function(w,R){const z=new Set;for(const S of R)w.has(S)&&z.add(S);return z};let E=new Set(g[0]);for(const w of g.splice(1))E=f(E,w);e[n].__cached_results=E}else if(n=="or"){const f=new Set;for(const E of g)for(const w of E)f.add(w);e[n].__cached_results=f}}}return e.__cache_created=!0,e}atomIsSelected(s,o){if(typeof o>"u")return!0;var e=!!o.invert,n=!0;for(var a in o)if(a=="and"||a=="or"||a=="not"){if(a=="not"){if(this.atomIsSelected(s,o[a])){n=!1;break}}else if(o[a].__cached_results===void 0&&(o=r.deepCopyAndCache(o,this)),n=o[a].__cached_results.has(s.index),!n)break}else if(a==="predicate"){if(!o.predicate(s)){n=!1;break}}else if(a=="properties"&&s[a]){for(var g in o.properties)if(!g.startsWith("__cache")){if(typeof s.properties[g]>"u"){n=!1;break}if(s.properties[g]!=o.properties[g]){n=!1;break}}}else if(o.hasOwnProperty(a)&&!r.ignoredKeys.has(a)&&!a.startsWith("__cache")){if(typeof s[a]>"u"){n=!1;break}var f=!1;if(a==="bonds"){var E=o[a];if(E!=s.bonds.length){n=!1;break}}else if(Array.isArray(o[a])){var w=o[a],R=s[a];for(let z=0;z<w.length;z++)if(this.propertyMatches(R,w[z])){f=!0;break}if(!f){n=!1;break}}else{let z=o[a];if(!this.propertyMatches(s[a],z)){n=!1;break}}}return e?!n:n}static squaredDistance(s,o){var e=o.x-s.x,n=o.y-s.y,a=o.z-s.z;return e*e+n*n+a*a}expandAtomList(s,o){if(o<=0)return s;for(var e=(0,C.getExtent)(s,void 0),n=[[],[],[]],a=0;a<3;a++)n[0][a]=e[0][a]-o,n[1][a]=e[1][a]+o,n[2][a]=e[2][a];var g=[];for(let R=0;R<this.atoms.length;R++){var f=this.atoms[R].x,E=this.atoms[R].y,w=this.atoms[R].z;f>=n[0][0]&&f<=n[1][0]&&E>=n[0][1]&&E<=n[1][1]&&w>=n[0][2]&&w<=n[1][2]&&(f>=e[0][0]&&f<=e[1][0]&&E>=e[0][1]&&E<=e[1][1]&&w>=e[0][2]&&w<=e[1][2]||g.push(this.atoms[R]))}return g}static getFloat(s){return typeof s=="number"?s:parseFloat(s)}selectedAtoms(s,o){var e=[];s=r.deepCopyAndCache(s||{},this),o||(o=this.atoms);for(var n=o.length,a=0;a<n;a++){var g=o[a];g&&this.atomIsSelected(g,s)&&e.push(g)}if(s.hasOwnProperty("expand")){const V=r.getFloat(s.expand);let k=this.expandAtomList(e,V),U=e.length;const j=V*V;for(let q=0;q<k.length;q++)for(let ie=0;ie<U;ie++){var f=r.squaredDistance(k[q],e[ie]);f<j&&f>0&&e.push(k[q])}}if(s.hasOwnProperty("within")&&s.within.hasOwnProperty("sel")&&s.within.hasOwnProperty("distance")){var E=this.selectedAtoms(s.within.sel,this.atoms),w={};const V=r.getFloat(s.within.distance),k=V*V;for(let U=0;U<E.length;U++)for(let j=0;j<e.length;j++){let q=r.squaredDistance(E[U],e[j]);q<k&&q>0&&(w[j]=1)}var R=[];if(s.within.invert)for(let U=0;U<e.length;U++)w[U]||R.push(e[U]);else for(let U in w)R.push(e[U]);e=R}if(s.hasOwnProperty("byres")){var z={},S=[],I=[];for(let V=0;V<e.length;V++){let k=e[V];var F=k.chain,G=k.resi;if(z[F]===void 0&&(z[F]={}),k.hasOwnProperty("resi")&&z[F][G]===void 0){for(z[F][G]=!0,I.push(k);I.length>0;)if(k=I.pop(),F=k.chain,G=k.resi,S[k.index]===void 0){S[k.index]=!0;for(var B=0;B<k.bonds.length;B++){var W=this.atoms[k.bonds[B]];S[W.index]===void 0&&W.hasOwnProperty("resi")&&W.chain==F&&W.resi==G&&(I.push(W),e.push(W))}}}}}return e}addAtoms(s){this.molObj=null;var o=this.atoms.length,e=[],n;for(n=0;n<s.length;n++)typeof s[n].index>"u"&&(s[n].index=n),typeof s[n].serial>"u"&&(s[n].serial=n),e[s[n].index]=o+n;for(n=0;n<s.length;n++){var a=s[n],g=e[a.index],f=(0,C.extend)({},a);f.index=g,f.bonds=[],f.bondOrder=[],f.model=this.id,f.style=f.style||(0,C.deepCopy)(r.defaultAtomStyle),typeof f.color>"u"&&(f.color=this.ElementColors[f.elem]||this.defaultColor);for(var E=a.bonds?a.bonds.length:0,w=0;w<E;w++){var R=e[a.bonds[w]];typeof R<"u"&&(f.bonds.push(R),f.bondOrder.push(a.bondOrder?a.bondOrder[w]:1))}this.atoms.push(f)}}assignBonds(){(0,x.assignBonds)(this.atoms,{assignBonds:!0})}removeAtoms(s){this.molObj=null;var o=[],e;for(e=0;e<s.length;e++)o[s[e].index]=!0;var n=[];for(e=0;e<this.atoms.length;e++){var a=this.atoms[e];o[a.index]||n.push(a)}this.atoms=[],this.addAtoms(n)}setStyle(s,o,e){typeof o>"u"&&typeof e>"u"&&(o=s,s={}),s=s,typeof o=="string"&&(o=(0,C.specStringToObject)(o));var n=!1,a=this,g=function(E){var w=a.selectedAtoms(s,E);for(let R=0;R<E.length;R++)E[R]&&(E[R].capDrawn=!1);for(let R=0;R<w.length;R++){n=!0,(w[R].clickable||w[R].hoverable)&&(w[R].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),e||(w[R].style={});for(let z in o)o.hasOwnProperty(z)&&(w[R].style[z]=w[R].style[z]||{},Object.assign(w[R].style[z],o[z]))}};if(s.frame!==void 0&&s.frame<this.frames.length){let E=s.frame;E<0&&(E=this.frames.length+E),g(this.frames[E])}else{g(this.atoms);for(var f=0;f<this.frames.length;f++)this.frames[f]!==this.atoms&&g(this.frames[f])}n&&(this.molObj=null)}setClickable(s,o,e){if(o=!!o,e=(0,C.makeFunction)(e),e===null){console.log("Callback is not a function");return}var n=this.selectedAtoms(s,this.atoms),a=n.length;for(let g=0;g<a;g++)n[g].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},n[g].clickable=o,e&&(n[g].callback=e);a>0&&(this.molObj=null)}setHoverable(s,o,e,n){if(o=!!o,e=(0,C.makeFunction)(e),n=(0,C.makeFunction)(n),e===null){console.log("Hover_callback is not a function");return}if(n===null){console.log("Unhover_callback is not a function");return}var a=this.selectedAtoms(s,this.atoms),g=a.length;for(let f=0;f<g;f++)a[f].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},a[f].hoverable=o,e&&(a[f].hover_callback=e),n&&(a[f].unhover_callback=n);g>0&&(this.molObj=null)}enableContextMenu(s,o){o=!!o;var e,n=this.selectedAtoms(s,this.atoms),a=n.length;for(e=0;e<a;e++)n[e].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},n[e].contextMenuEnabled=o;a>0&&(this.molObj=null)}setColorByElement(s,o){if(!(this.molObj!==null&&r.sameObj(o,this.lastColors))){this.lastColors=o;var e=this.selectedAtoms(s,e);e.length>0&&(this.molObj=null);for(var n=0;n<e.length;n++){var a=e[n];typeof o[a.elem]<"u"&&(a.color=o[a.elem])}}}setColorByProperty(s,o,e,n){var a,g,f=this.selectedAtoms(s,f);for(this.lastColors=null,f.length>0&&(this.molObj=null),typeof e=="string"&&typeof v.Gradient.builtinGradients[e]<"u"&&(e=new v.Gradient.builtinGradients[e]),e=e,n||(n=e.range()),n||(n=(0,C.getPropertyRange)(f,o)),a=0;a<f.length;a++){g=f[a];var E=(0,C.getAtomProperty)(g,o);E!=null&&(g.color=e.valueToHex(parseFloat(g.properties[o]),n))}}setColorByFunction(s,o){var e=this.selectedAtoms(s,e);if(typeof o=="function"){this.lastColors=null,e.length>0&&(this.molObj=null);for(let n=0;n<e.length;n++){let a=e[n];a.color=o(a)}}}toCDObject(s=!1){var o={a:[],b:[]};s&&(o.s=[]);for(let n=0;n<this.atoms.length;n++){let a={},g=this.atoms[n];if(a.x=g.x,a.y=g.y,a.z=g.z,g.elem!="C"&&(a.l=g.elem),s){for(var e=0;e<o.s.length&&JSON.stringify(g.style)!==JSON.stringify(o.s[e]);)e++;e===o.s.length&&o.s.push(g.style),e!==0&&(a.s=e)}o.a.push(a);for(let f=0;f<g.bonds.length;f++){let E=n,w=g.bonds[f];if(E>=w)continue;let R={b:E,e:w},z=g.bondOrder[f];z!=1&&(R.o=z),o.b.push(R)}}return o}globj(s,o){(this.molObj===null||o.regen)&&(this.molObj=this.createMolObj(this.atoms,o),this.renderedMolObj&&(s.remove(this.renderedMolObj),this.renderedMolObj=null),this.renderedMolObj=this.molObj.clone(),this.hidden&&(this.renderedMolObj.setVisible(!1),this.molObj.setVisible(!1)),s.add(this.renderedMolObj))}exportVRML(){var s=this.createMolObj(this.atoms,{supportsImposters:!1,supportsAIA:!1});return s.vrml()}removegl(s){this.renderedMolObj&&(this.renderedMolObj.geometry!==void 0&&this.renderedMolObj.geometry.dispose(),this.renderedMolObj.material!==void 0&&this.renderedMolObj.material.dispose(),s.remove(this.renderedMolObj),this.renderedMolObj=null),this.molObj=null}hide(){this.hidden=!0,this.renderedMolObj&&this.renderedMolObj.setVisible(!1),this.molObj&&this.molObj.setVisible(!1)}show(){this.hidden=!1,this.renderedMolObj&&this.renderedMolObj.setVisible(!0),this.molObj&&this.molObj.setVisible(!0)}addPropertyLabels(s,o,e,n){for(var a=this.selectedAtoms(o,a),g=(0,C.deepCopy)(n),f=0;f<a.length;f++){var E=a[f],w=null;typeof E[s]<"u"?w=String(E[s]):typeof E.properties[s]<"u"&&(w=String(E.properties[s])),w!=null&&(g.position=E,e.addLabel(w,g))}}addResLabels(s,o,e,n=!1){var a=[],g=function(E,w){for(var R=E.selectedAtoms(s,R),z={},S=0;S<R.length;S++){var I=R[S],F=I.chain,G=I.resn,B=I.resi,W=G+""+B;z[F]||(z[F]={}),z[F][W]||(z[F][W]=[]),z[F][W].push(I)}var V=(0,C.deepCopy)(e);for(let U in z)if(z.hasOwnProperty(U)){var k=z[U];for(let j in k)if(k.hasOwnProperty(j)){let q=k[j],ie=new D.Vector3(0,0,0);for(let he=0;he<q.length;he++){let ve=q[he];ie.x+=ve.x,ie.y+=ve.y,ie.z+=ve.z}ie.divideScalar(q.length),V.position=ie,V.frame=w;let ge=o.addLabel(j,V,void 0,!0);a.push(ge)}}};if(n){var f=this.getNumFrames();let E=this.atoms;for(let w=0;w<f;w++)this.frames[w]&&(this.atoms=this.frames[w],g(this,w));this.atoms=E}else g(this);return a}setupDFS(){this.atomdfs=[];var s=this,o=new Int8Array(this.atoms.length);o.fill(0);for(var e=function(f,E,w){w.push([f,E]);var R=s.atoms[f];o[f]=1;for(var z=0;z<R.bonds.length;z++){var S=R.bonds[z];s.atoms[S]&&!o[S]&&e(S,f,w)}},n=0;n<this.atoms.length;n++){var a=this.atoms[n];if(a&&!o[n]){var g=[];e(n,-1,g),this.atomdfs.push(g)}}}setCoordinatesFromURL(s,o){this.frames=[];var e=this;return this.box&&this.setupDFS(),s.startsWith("http")||(s="http://"+s),(0,C.get)(s+"/traj/numframes/"+o,function(n){if(!isNaN(parseInt(n)))return e.frames.push(e.atoms),e.frames.numFrames=n,e.frames.url=s,e.frames.path=o,e.setFrame(0)})}setCoordinates(s,o){if(o=o||"",!s)return[];if(/\.gz$/.test(o)){o=o.replace(/\.gz$/,"");try{s=t(s)}catch(z){console.log(z)}}var e={mdcrd:"",inpcrd:"",pdb:"",netcdf:"",array:""};if(e.hasOwnProperty(o)){this.frames=[];for(var n=this.atoms.length,a=r.parseCrd(s,o),g=0;g<a.length;){for(var f=[],E=0;E<n;E++){var w={};for(var R in this.atoms[E])w[R]=this.atoms[E][R];f[E]=w,f[E].x=a[g++],f[E].y=a[g++],f[E].z=a[g++]}this.frames.push(f)}return this.atoms=this.frames[0],this.frames}return[]}addAtomSpecs(s){}static parseCrd(s,o){var e=[],n=0;if(o=="pdb")for(var a=s.indexOf(`
ATOM`);a!=-1;){for(;s.slice(a,a+5)==`
ATOM`||s.slice(a,a+7)==`
HETATM`;)e[n++]=parseFloat(s.slice(a+31,a+39)),e[n++]=parseFloat(s.slice(a+39,a+47)),e[n++]=parseFloat(s.slice(a+47,a+55)),a=s.indexOf(`
`,a+54),s.slice(a,a+4)==`
TER`&&(a=s.indexOf(`
`,a+5));a=s.indexOf(`
ATOM`,a)}else if(o=="netcdf"){var g=new _.NetCDFReader(s);e=[].concat.apply([],g.getDataVariable("coordinates"))}else{if(o=="array"||Array.isArray(s))return s.flat(2);{let f=s.indexOf(`
`);o=="inpcrd"&&(f=s.indexOf(`
`,f+1)),s=s.slice(f+1),e=s.match(/\S+/g).map(parseFloat)}}return e}static parseMolData(s,o="",e){if(!s)return[];if(/\.gz$/.test(o)){o=o.replace(/\.gz$/,"");try{s=t(s)}catch(g){console.log(g)}}typeof M.Parsers[o]>"u"&&(o=o.split(".").pop(),typeof M.Parsers[o]>"u"&&(console.log("Unknown format: "+o),s instanceof Uint8Array?o="mmtf":s.match(/^@<TRIPOS>MOLECULE/gm)?o="mol2":s.match(/^data_/gm)&&s.match(/^loop_/gm)?o="cif":s.match(/^HETATM/gm)||s.match(/^ATOM/gm)?o="pdb":s.match(/ITEM: TIMESTEP/gm)?o="lammpstrj":s.match(/^.*\n.*\n.\s*(\d+)\s+(\d+)/gm)?o="sdf":s.match(/^%VERSION\s+VERSION_STAMP/gm)?o="prmtop":o="xyz",console.log("Best guess: "+o)));var n=M.Parsers[o],a=n(s,e);return a}}r.defaultAtomStyle={line:{}},r.defaultlineWidth=1,r.vdwRadii={H:1.2,He:1.4,Li:1.82,Be:1.53,B:1.92,C:1.7,N:1.55,O:1.52,F:1.47,Ne:1.54,Na:2.27,Mg:1.73,Al:1.84,Si:2.1,P:1.8,S:1.8,Cl:1.75,Ar:1.88,K:2.75,Ca:2.31,Ni:1.63,Cu:1.4,Zn:1.39,Ga:1.87,Ge:2.11,As:1.85,Se:1.9,Br:1.85,Kr:2.02,Rb:3.03,Sr:2.49,Pd:1.63,Ag:1.72,Cd:1.58,In:1.93,Sn:2.17,Sb:2.06,Te:2.06,I:1.98,Xe:2.16,Cs:3.43,Ba:2.68,Pt:1.75,Au:1.66,Hg:1.55,Tl:1.96,Pb:2.02,Bi:2.07,Po:1.97,At:2.02,Rn:2.2,Fr:3.48,Ra:2.83,U:1.86},r.ignoredKeys=new Set(["props","invert","model","frame","byres","expand","within","and","or","not"])},"./src/GLShape.ts":(X,L,c)=>{c.r(L),c.d(L,{GLShape:()=>_,splitMesh:()=>p});var A=c("./src/WebGL/index.ts"),T=c("./src/WebGL/shapes/index.ts"),D=c("./src/WebGL/math/index.ts"),P=c("./src/colors.ts"),u=c("./src/ProteinSurface4.ts"),y=c("./src/VolumeData.ts"),C=c("./src/GLDraw.ts"),v=c("./src/glcartoon.ts"),M=c("./src/utilities.ts");class _{static finalizeGeo(t){var r=t.updateGeoGroup(0);r.vertices>0&&r.truncateArrayBuffers(!0,!0)}static updateColor(t,r){r=r||P.CC.color(r),t.colorsNeedUpdate=!0;var h,s,o;r.constructor!==Array&&(h=r.r,s=r.g,o=r.b);for(let e in t.geometryGroups){let n=t.geometryGroups[e],a=n.colorArray;for(let g=0,f=n.vertices;g<f;++g){if(r.constructor===Array){let E=r[g];h=E.r,s=E.g,o=E.b}a[g*3]=h,a[g*3+1]=s,a[g*3+2]=o}}}static drawArrow(t,r,h){var s=h.start,o=h.end,e=h.radius,n=h.radiusRatio,a=h.mid,g=h.midpos;if(!(s&&o))return;var f=r.updateGeoGroup(51),E=new D.Vector3(o.x,o.y,o.z).sub(s);if(g){let ne=E.length();g>0?a=g/ne:a=(ne+g)/ne}E.multiplyScalar(a);var w=new D.Vector3(s.x,s.y,s.z).add(E),R=E.clone().negate();let z=new D.Vector3(s.x,s.y,s.z);t.intersectionShape.cylinder.push(new T.Cylinder(z,w.clone(),e)),t.intersectionShape.sphere.push(new T.Sphere(z,e));var S=[];S[0]=E.clone(),Math.abs(S[0].x)>1e-4?S[0].y+=1:S[0].x+=1,S[0].cross(E),S[0].normalize(),S[4]=S[0].clone(),S[4].crossVectors(S[0],E),S[4].normalize(),S[8]=S[0].clone().negate(),S[12]=S[4].clone().negate(),S[2]=S[0].clone().add(S[4]).normalize(),S[6]=S[4].clone().add(S[8]).normalize(),S[10]=S[8].clone().add(S[12]).normalize(),S[14]=S[12].clone().add(S[0]).normalize(),S[1]=S[0].clone().add(S[2]).normalize(),S[3]=S[2].clone().add(S[4]).normalize(),S[5]=S[4].clone().add(S[6]).normalize(),S[7]=S[6].clone().add(S[8]).normalize(),S[9]=S[8].clone().add(S[10]).normalize(),S[11]=S[10].clone().add(S[12]).normalize(),S[13]=S[12].clone().add(S[14]).normalize(),S[15]=S[14].clone().add(S[0]).normalize();var I=f.vertices,F=f.vertexArray,G=f.faceArray,B=f.normalArray,W=f.lineArray,V,k,U;for(k=0,U=S.length;k<U;++k){V=3*(I+3*k);var j=S[k].clone().multiplyScalar(e).add(s),q=S[k].clone().multiplyScalar(e).add(w),ie=S[k].clone().multiplyScalar(e*n).add(w);if(F[V]=j.x,F[V+1]=j.y,F[V+2]=j.z,F[V+3]=q.x,F[V+4]=q.y,F[V+5]=q.z,F[V+6]=ie.x,F[V+7]=ie.y,F[V+8]=ie.z,k>0){var ge=F[V-3],he=F[V-2],ve=F[V-1],le=new D.Vector3(ge,he,ve),se=new D.Vector3(o.x,o.y,o.z),Me=w.clone(),be=new D.Vector3(ie.x,ie.y,ie.z);t.intersectionShape.triangle.push(new T.Triangle(be,se,le)),t.intersectionShape.triangle.push(new T.Triangle(le.clone(),Me,be.clone()))}}f.vertices+=48,V=f.vertices*3,F[V]=s.x,F[V+1]=s.y,F[V+2]=s.z,F[V+3]=w.x,F[V+4]=w.y,F[V+5]=w.z,F[V+6]=o.x,F[V+7]=o.y,F[V+8]=o.z,f.vertices+=3;var Pe,ce,me,De,Se,Ge,ke,ze,Re,Be,Ie,We,Fe,$e,Ye,$,Z,J,ae,de=f.vertices-3,Ee=f.vertices-2,we=f.vertices-1,H=de*3,fe=Ee*3,xe=we*3;for(k=0,U=S.length-1;k<U;++k){var Te=I+3*k;V=Te*3,ce=f.faceidx,me=f.lineidx,De=Te,Be=De*3,Se=Te+1,Ie=Se*3,Ge=Te+2,We=Ge*3,ke=Te+4,Fe=ke*3,ze=Te+5,$e=ze*3,Re=Te+3,Ye=Re*3,$=Z=S[k],J=ae=S[k+1],B[Be]=$.x,B[Ie]=Z.x,B[Ye]=ae.x,B[Be+1]=$.y,B[Ie+1]=Z.y,B[Ye+1]=ae.y,B[Be+2]=$.z,B[Ie+2]=Z.z,B[Ye+2]=ae.z,B[Ie]=Z.x,B[Fe]=J.x,B[Ye]=ae.x,B[Ie+1]=Z.y,B[Fe+1]=J.y,B[Ye+1]=ae.y,B[Ie+2]=Z.z,B[Fe+2]=J.z,B[Ye+2]=ae.z,B[We]=Z.x,B[$e]=J.x,B[We+1]=Z.y,B[$e+1]=J.y,B[We+2]=Z.z,B[$e+2]=J.z,G[ce]=De,G[ce+1]=Se,G[ce+2]=Re,G[ce+3]=Se,G[ce+4]=ke,G[ce+5]=Re,G[ce+6]=De,G[ce+7]=Re,G[ce+8]=de,G[ce+9]=Ge,G[ce+10]=Ee,G[ce+11]=ze,G[ce+12]=Ge,G[ce+13]=we,G[ce+14]=ze,W[me]=De,W[me+1]=Se,W[me+2]=De,W[me+3]=Re,W[me+4]=ke,W[me+5]=Re,W[me+6]=De,W[me+7]=Re,W[me+8]=Ge,W[me+9]=Se,W[me+10]=Ge,W[me+11]=ze,W[me+12]=ke,W[me+13]=ze,W[me+14]=Ge,W[me+15]=we,W[me+16]=Ge,W[me+17]=ze,W[me+18]=we,W[me+19]=ze,f.faceidx+=15,f.lineidx+=20}Pe=[I+45,I+46,I+1,I,I+47,I+2],ce=f.faceidx,me=f.lineidx,De=Pe[0],Be=De*3,Se=Pe[1],Ie=Se*3,Ge=Pe[4],We=Ge*3,ke=Pe[2],Fe=ke*3,ze=Pe[5],$e=ze*3,Re=Pe[3],Ye=Re*3,$=Z=S[15],J=ae=S[0],B[Be]=$.x,B[Ie]=Z.x,B[Ye]=ae.x,B[Be+1]=$.y,B[Ie+1]=Z.y,B[Ye+1]=ae.y,B[Be+2]=$.z,B[Ie+2]=Z.z,B[Ye+2]=ae.z,B[Ie]=Z.x,B[Fe]=J.x,B[Ye]=ae.x,B[Ie+1]=Z.y,B[Fe+1]=J.y,B[Ye+1]=ae.y,B[Ie+2]=Z.z,B[Fe+2]=J.z,B[Ye+2]=ae.z,B[We]=Z.x,B[$e]=J.x,B[We+1]=Z.y,B[$e+1]=J.y,B[We+2]=Z.z,B[$e+2]=J.z,E.normalize(),R.normalize(),B[H]=R.x,B[fe]=B[xe]=E.x,B[H+1]=R.y,B[fe+1]=B[xe+1]=E.y,B[H+2]=R.z,B[fe+2]=B[xe+2]=E.z,G[ce]=De,G[ce+1]=Se,G[ce+2]=Re,G[ce+3]=Se,G[ce+4]=ke,G[ce+5]=Re,G[ce+6]=De,G[ce+7]=Re,G[ce+8]=de,G[ce+9]=Ge,G[ce+10]=Ee,G[ce+11]=ze,G[ce+12]=Ge,G[ce+13]=we,G[ce+14]=ze,W[me]=De,W[me+1]=Se,W[me+2]=De,W[me+3]=Re,W[me+4]=ke,W[me+5]=Re,W[me+6]=De,W[me+7]=Re,W[me+8]=Ge,W[me+9]=Se,W[me+10]=Ge,W[me+11]=ze,W[me+12]=ke,W[me+13]=ze,W[me+14]=Ge,W[me+15]=we,W[me+16]=Ge,W[me+17]=ze,W[me+18]=we,W[me+19]=ze,f.faceidx+=15,f.lineidx+=20}static updateBoundingFromPoints(t,r,h,s){t.center.set(0,0,0);let o=1/0,e=1/0,n=1/0,a=-1/0,g=-1/0,f=-1/0;t.box&&(o=t.box.min.x,a=t.box.max.x,e=t.box.min.y,g=t.box.max.y,n=t.box.min.z,f=t.box.max.z);for(let z=0,S=s;z<S;z++){var E=h[z*3],w=h[z*3+1],R=h[z*3+2];E<o&&(o=E),w<e&&(e=w),R<n&&(n=R),E>a&&(a=E),w>g&&(g=w),R>f&&(f=R)}t.center.set((a+o)/2,(g+e)/2,(f+n)/2),t.radius=t.center.distanceTo({x:a,y:g,z:f}),t.box={min:{x:o,y:e,z:n},max:{x:a,y:g,z:f}}}static addCustomGeo(t,r,h,s,o){var e=r.addGeoGroup(),n=h.vertexArr,a=h.normalArr,g=h.faceArr;e.vertices=n.length,e.faceidx=g.length;var f,E,w,R,z,S,I,F,G,B=e.vertexArray,W=e.colorArray;for(s.constructor!==Array&&(F=s.r,G=s.g,R=s.b),S=0,I=e.vertices;S<I;++S)f=S*3,E=n[S],B[f]=E.x,B[f+1]=E.y,B[f+2]=E.z,s.constructor===Array&&(z=s[S],F=z.r,G=z.g,R=z.b),W[f]=F,W[f+1]=G,W[f+2]=R;if(o)for(S=0,I=e.faceidx/3;S<I;++S){f=S*3,w=g[f],R=g[f+1],z=g[f+2];var V=new D.Vector3,k=new D.Vector3,U=new D.Vector3;t.intersectionShape.triangle.push(new T.Triangle(V.copy(n[w]),k.copy(n[R]),U.copy(n[z])))}if(o){var j=new D.Vector3(0,0,0),q=0;for(let he=0;he<r.geometryGroups.length;he++)j.add(r.geometryGroups[he].getCentroid()),q++;j.divideScalar(q),_.updateBoundingFromPoints(t.boundingSphere,{centroid:j},B,e.vertices)}if(e.faceArray=new Uint16Array(g),e.truncateArrayBuffers(!0,!0),a.length<e.vertices)e.setNormals();else{var ie=e.normalArray=new Float32Array(e.vertices*3),ge;for(S=0,I=e.vertices;S<I;++S)f=S*3,ge=a[S],ie[f]=ge.x,ie[f+1]=ge.y,ie[f+2]=ge.z}e.setLineIndices(),e.lineidx=e.lineArray.length}static updateFromStyle(t,r){typeof r.color<"u"?(t.color=r.color||new P.Color,r.color instanceof P.Color||(t.color=P.CC.color(r.color))):t.color=P.CC.color(0),t.wireframe=!!r.wireframe,t.opacity=r.alpha?(0,D.clamp)(r.alpha,0,1):1,typeof r.opacity<"u"&&(t.opacity=(0,D.clamp)(r.opacity,0,1)),t.side=r.side!==void 0?r.side:A.DoubleSide,t.linewidth=typeof r.linewidth>"u"?1:r.linewidth,t.clickable=!!r.clickable,t.callback=(0,M.makeFunction)(r.callback),t.hoverable=!!r.hoverable,t.hover_callback=(0,M.makeFunction)(r.hover_callback),t.unhover_callback=(0,M.makeFunction)(r.unhover_callback),t.hidden=r.hidden,t.frame=r.frame}constructor(t){this.color=16777215,this.hidden=!1,this.wireframe=!1,this.opacity=1,this.linewidth=1,this.clickable=!1,this.hoverable=!1,this.side=A.DoubleSide,this.stylespec=t||{},this.boundingSphere=new T.Sphere,this.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},_.updateFromStyle(this,this.stylespec),this.components=[],this.shapeObj=null,this.renderedShapeObj=null,this.geo=new A.Geometry(!0),this.linegeo=new A.Geometry(!0)}updateStyle(t){for(var r in t)this.stylespec[r]=t[r];if(_.updateFromStyle(this,this.stylespec),t.voldata&&t.volscheme){(0,M.adjustVolumeStyle)(t);const h=t.volscheme,s=t.voldata,o=P.CC,e=h.range()||[-1,1];this.geo.setColors(function(n,a,g){let f=s.getVal(n,a,g);return o.color(h.valueToHex(f,e))}),delete this.color}}addCustom(t){t.vertexArr=t.vertexArr||[],t.faceArr=t.faceArr||[],t.normalArr=t.normalArr||[],_.drawCustom(this,this.geo,t)}addSphere(t){t.center||(t.center=new D.Vector3(0,0,0)),t.radius=t.radius?(0,D.clamp)(t.radius,0,1/0):1.5,t.color=P.CC.color(t.color),this.intersectionShape.sphere.push(new T.Sphere(t.center,t.radius)),C.GLDraw.drawSphere(this.geo,t.center,t.radius,t.color,t.quality),this.components.push({centroid:new D.Vector3(t.center.x,t.center.y,t.center.z)});var r=this.geo.updateGeoGroup(0);_.updateBoundingFromPoints(this.boundingSphere,this.components,r.vertexArray,r.vertices)}addBox(t){var r=t.dimensions||{w:1,h:1,d:1},h;typeof r.w=="number"?h={x:r.w,y:0,z:0}:h=r.w;var s;typeof r.h=="number"?s={x:0,y:r.h,z:0}:s=r.h;var o;typeof r.d=="number"?o={x:0,y:0,z:r.d}:o=r.d;var e=t.corner;e==null&&(t.center!==void 0?e={x:t.center.x-.5*(h.x+s.x+o.x),y:t.center.y-.5*(h.y+s.y+o.y),z:t.center.z-.5*(h.z+s.z+o.z)}:e={x:0,y:0,z:0});var n=[{x:e.x,y:e.y,z:e.z},{x:e.x+h.x,y:e.y+h.y,z:e.z+h.z},{x:e.x+s.x,y:e.y+s.y,z:e.z+s.z},{x:e.x+h.x+s.x,y:e.y+h.y+s.y,z:e.z+h.z+s.z},{x:e.x+o.x,y:e.y+o.y,z:e.z+o.z},{x:e.x+h.x+o.x,y:e.y+h.y+o.y,z:e.z+h.z+o.z},{x:e.x+s.x+o.x,y:e.y+s.y+o.y,z:e.z+s.z+o.z},{x:e.x+h.x+s.x+o.x,y:e.y+h.y+s.y+o.y,z:e.z+h.z+s.z+o.z}],a=[],g=[];a.splice(a.length,0,n[0],n[1],n[2],n[3]),g.splice(g.length,0,0,2,1,1,2,3);var f=4;a.splice(a.length,0,n[2],n[3],n[6],n[7]),g.splice(g.length,0,f+0,f+2,f+1,f+1,f+2,f+3),f+=4,a.splice(a.length,0,n[4],n[5],n[0],n[1]),g.splice(g.length,0,f+0,f+2,f+1,f+1,f+2,f+3),f+=4,a.splice(a.length,0,n[6],n[7],n[4],n[5]),g.splice(g.length,0,f+0,f+2,f+1,f+1,f+2,f+3),f+=4,a.splice(a.length,0,n[3],n[1],n[7],n[5]),g.splice(g.length,0,f+0,f+2,f+1,f+1,f+2,f+3),f+=4,a.splice(a.length,0,n[2],n[6],n[0],n[4]),g.splice(g.length,0,f+0,f+2,f+1,f+1,f+2,f+3),f+=4;var E=(0,M.extend)({},t);E.vertexArr=a,E.faceArr=g,E.normalArr=[],_.drawCustom(this,this.geo,E);var w=new D.Vector3;this.components.push({centroid:w.addVectors(n[0],n[7]).multiplyScalar(.5)});var R=this.geo.updateGeoGroup(0);_.updateBoundingFromPoints(this.boundingSphere,this.components,R.vertexArray,R.vertices)}addCylinder(t){var r,h;t.start?r=new D.Vector3(t.start.x||0,t.start.y||0,t.start.z||0):r=new D.Vector3(0,0,0),t.end?(h=new D.Vector3(t.end.x,t.end.y||0,t.end.z||0),typeof h.x>"u"&&(h.x=3)):h=new D.Vector3(0,0,0);var s=t.radius||.1,o=P.CC.color(t.color);this.intersectionShape.cylinder.push(new T.Cylinder(r,h,s)),C.GLDraw.drawCylinder(this.geo,r,h,s,o,t.fromCap,t.toCap);var e=new D.Vector3;this.components.push({centroid:e.addVectors(r,h).multiplyScalar(.5)});var n=this.geo.updateGeoGroup(0);_.updateBoundingFromPoints(this.boundingSphere,this.components,n.vertexArray,n.vertices)}addDashedCylinder(t){t.dashLength=t.dashLength||.25,t.gapLength=t.gapLength||.25;var r;t.start?r=new D.Vector3(t.start.x||0,t.start.y||0,t.start.z||0):r=new D.Vector3(0,0,0);var h;t.end?(h=new D.Vector3(t.end.x,t.end.y||0,t.end.z||0),typeof h.x>"u"&&(h.x=3)):h=new D.Vector3(3,0,0);for(var s=t.radius||.1,o=P.CC.color(t.color),e=Math.sqrt(Math.pow(r.x-h.x,2)+Math.pow(r.y-h.y,2)+Math.pow(r.z-h.z,2)),n=e/(t.gapLength+t.dashLength),a=new D.Vector3(t.start.x||0,t.start.y||0,t.start.z||0),g=new D.Vector3(t.end.x,t.end.y||0,t.end.z||0),f=new D.Vector3((h.x-r.x)/(e/t.gapLength),(h.y-r.y)/(e/t.gapLength),(h.z-r.z)/(e/t.gapLength)),E=new D.Vector3((h.x-r.x)/(e/t.dashLength),(h.y-r.y)/(e/t.dashLength),(h.z-r.z)/(e/t.dashLength)),w=0;w<n;w++)g=new D.Vector3(a.x+E.x,a.y+E.y,a.z+E.z),this.intersectionShape.cylinder.push(new T.Cylinder(a,g,s)),C.GLDraw.drawCylinder(this.geo,a,g,s,o,t.fromCap,t.toCap),a=new D.Vector3(g.x+f.x,g.y+f.y,g.z+f.z);var R=new D.Vector3;this.components.push({centroid:R.addVectors(r,h).multiplyScalar(.5)});var z=this.geo.updateGeoGroup(0);_.updateBoundingFromPoints(this.boundingSphere,this.components,z.vertexArray,z.vertices)}addCurve(t){t.points=t.points||[],t.smooth=t.smooth||10,typeof t.fromCap>"u"&&(t.fromCap=2),typeof t.toCap>"u"&&(t.toCap=2);var r=(0,v.subdivide_spline)(t.points,t.smooth);if(r.length<3){console.log("Too few points in addCurve");return}var h=t.radius||.1,s=P.CC.color(t.color),o=0,e=r.length-1,n=r[0].distanceTo(r[1]),a=Math.ceil(2*h/n);if(t.toArrow){e-=a;let w={start:r[e],end:r[r.length-1],radius:h,color:s,mid:1e-4};this.addArrow(w)}if(t.fromArrow){o+=a;let w={start:r[o],end:r[0],radius:h,color:s,mid:1e-4};this.addArrow(w)}for(var g=Math.ceil(r.length/2),f={radius:h,color:s,fromCap:2,toCap:2},E=o;E<e;E++)f.start=r[E],f.end=r[E+1],f.fromCap=2,f.toCap=2,E<g?(f.fromCap=2,f.toCap=0):E>g?(f.fromCap=0,f.toCap=2):(f.fromCap=2,f.toCap=2),this.addCylinder(f)}addLine(t){var r,h;t.start?r=new D.Vector3(t.start.x||0,t.start.y||0,t.start.z||0):r=new D.Vector3(0,0,0),t.end?(h=new D.Vector3(t.end.x,t.end.y||0,t.end.z||0),typeof h.x>"u"&&(h.x=3)):h=new D.Vector3(3,0,0);var s=this.geo.updateGeoGroup(2),o=s.vertices,e=o*3,n=s.vertexArray;n[e]=r.x,n[e+1]=r.y,n[e+2]=r.z,n[e+3]=h.x,n[e+4]=h.y,n[e+5]=h.z,s.vertices+=2;var a=s.lineArray,g=s.lineidx;a[g]=o,a[g+1]=o+1,s.lineidx+=2;var f=new D.Vector3;this.components.push({centroid:f.addVectors(r,h).multiplyScalar(.5)}),s=this.geo.updateGeoGroup(0),_.updateBoundingFromPoints(this.boundingSphere,this.components,s.vertexArray,s.vertices)}addArrow(t){if(t.start?t.start=new D.Vector3(t.start.x||0,t.start.y||0,t.start.z||0):t.start=new D.Vector3(0,0,0),t.dir instanceof D.Vector3&&typeof t.length=="number"){var r=t.dir.clone().multiplyScalar(t.length).add(t.start);t.end=r}else t.end?(t.end=new D.Vector3(t.end.x,t.end.y||0,t.end.z||0),typeof t.end.x>"u"&&(t.end.x=3)):t.end=new D.Vector3(3,0,0);t.radius=t.radius||.1,t.radiusRatio=t.radiusRatio||1.618034,t.mid=0<t.mid&&t.mid<1?t.mid:.618034,_.drawArrow(this,this.geo,t);var h=new D.Vector3;this.components.push({centroid:h.addVectors(t.start,t.end).multiplyScalar(.5)});var s=this.geo.updateGeoGroup(0);_.updateBoundingFromPoints(this.boundingSphere,this.components,s.vertexArray,s.vertices)}static distance_from(t,r){return Math.sqrt(Math.pow(t.x-r.x,2)+Math.pow(t.y-r.y,2)+Math.pow(t.z-r.z,2))}static inSelectedRegion(t,r,h){for(var s=0;s<r.length;s++)if(_.distance_from(r[s],t)<=h)return!0;return!1}addIsosurface(t,r,h){var s=r.isoval!==void 0&&typeof r.isoval=="number"?r.isoval:0,o=!!r.voxel,e=r.smoothness===void 0?1:r.smoothness,n=t.size.x,a=t.size.y,g=t.size.z,f=new Int16Array(n*a*g),E=t.data,w,R;for(w=0,R=f.length;w<R;++w)f[w]=-1;var z=new Uint8Array(n*a*g);for(w=0,R=E.length;w<R;++w){var S=s>=0?E[w]-s:s-E[w];S>0&&(z[w]|=_.ISDONE)}var I=[],F=[];u.MarchingCube.march(z,I,F,{fulltable:!0,voxel:o,unitCube:t.unit,origin:t.origin,matrix:t.matrix,nX:n,nY:a,nZ:g}),!o&&e>0&&u.MarchingCube.laplacianSmooth(e,I,F);var G=[],B=[],W=[];if(r.selectedRegion&&r.coords===void 0&&(r.coords=r.selectedRegion),r.coords!==void 0){var V=r.coords[0].x,k=r.coords[0].y,U=r.coords[0].z,j=r.coords[0].x,q=r.coords[0].y,ie=r.coords[0].z;for(let ce=0;ce<r.coords.length;ce++)r.coords[ce].x>V?V=r.coords[ce].x:r.coords[ce].x<j&&(j=r.coords[ce].x),r.coords[ce].y>k?k=r.coords[ce].y:r.coords[ce].y<q&&(q=r.coords[ce].y),r.coords[ce].z>U?U=r.coords[ce].z:r.coords[ce].z<ie&&(ie=r.coords[ce].z);var ge=2;r.radius!==void 0&&(ge=r.radius),r.selectedOffset!==void 0&&(ge=r.selectedOffset),r.seldist!==void 0&&(ge=r.seldist),j-=ge,V+=ge,q-=ge,k+=ge,ie-=ge,U+=ge;for(let ce=0;ce<I.length;ce++)I[ce].x>j&&I[ce].x<V&&I[ce].y>q&&I[ce].y<k&&I[ce].z>ie&&I[ce].z<U&&_.inSelectedRegion(I[ce],r.coords,ge)?(G.push(B.length),B.push(I[ce])):G.push(-1);for(let ce=0;ce+2<F.length;ce+=3)G[F[ce]]!==-1&&G[F[ce+1]]!==-1&&G[F[ce+2]]!==-1&&(W.push(F[ce]-(F[ce]-G[F[ce]])),W.push(F[ce+1]-(F[ce+1]-G[F[ce+1]])),W.push(F[ce+2]-(F[ce+2]-G[F[ce+2]])));I=B,F=W}_.drawCustom(this,this.geo,{vertexArr:I,faceArr:F,normalArr:[],clickable:r.clickable,hoverable:r.hoverable}),this.updateStyle(r);var he=new D.Vector3(t.origin.x,t.origin.y,t.origin.z),ve=new D.Vector3(t.size.x*t.unit.x,t.size.y*t.unit.y,t.size.z*t.unit.z),le=new D.Vector3(0,0,0),se=he.clone(),Me=he.clone().add(ve);for(let ce=0;ce<I.length;ce++)le.add(I[ce]),se.max(I[ce]),Me.min(I[ce]);le.divideScalar(I.length);var be=le.distanceTo(Me),Pe=le.distanceTo(se);this.boundingSphere.center=le,this.boundingSphere.radius=Math.max(be,Pe),typeof h=="function"&&h()}addVolumetricData(t,r,h){t=new y.VolumeData(t,r),this.addIsosurface(t,h)}finalize(){return _.finalizeGeo(this.geo),this.geo.initTypedArrays(),this.geo}globj(t){if(this.renderedShapeObj&&(t.remove(this.renderedShapeObj),this.renderedShapeObj=null),!this.hidden){_.finalizeGeo(this.geo),this.geo.initTypedArrays(),this.wireframe&&this.geo.setUpWireframe(),typeof this.color<"u"&&_.updateColor(this.geo,this.color),this.shapeObj=new A.Object3D;var r=null;this.side==A.DoubleSide?r=new A.MeshDoubleLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1,opacity:this.opacity,wireframeLinewidth:this.linewidth,vertexColors:A.Coloring.VertexColors}):r=new A.MeshLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1,opacity:this.opacity,wireframeLinewidth:this.linewidth,vertexColors:A.Coloring.VertexColors});var h=new A.Mesh(this.geo,r);this.shapeObj.add(h);var s=new A.LineBasicMaterial({linewidth:this.linewidth,color:this.color}),o=new A.Line(this.linegeo,s,A.LineStyle.LinePieces);this.shapeObj.add(o),this.renderedShapeObj=this.shapeObj.clone(),t.add(this.renderedShapeObj)}}removegl(t){this.renderedShapeObj&&(this.renderedShapeObj.geometry!==void 0&&this.renderedShapeObj.geometry.dispose(),this.renderedShapeObj.material!==void 0&&this.renderedShapeObj.material.dispose(),t.remove(this.renderedShapeObj),this.renderedShapeObj=null),this.shapeObj=null}get position(){return this.boundingSphere.center}get x(){return this.boundingSphere.center.x}get y(){return this.boundingSphere.center.y}get z(){return this.boundingSphere.center.z}}_.ISDONE=2,_.drawCustom=function(x,t,r){var h=r,s=h.vertexArr,o=h.faceArr;(s.length===0||o.length===0)&&console.warn("Error adding custom shape component: No vertices and/or face indices supplied!");var e=r.color;typeof e>"u"&&(e=x.color),e=P.CC.color(e);for(var n=p(h),a=0,g=n.length;a<g;a++)_.addCustomGeo(x,t,n[a],n[a].colorArr?n[a].colorArr:e,r.clickable)};function p(x){var t=64e3;if(x.vertexArr.length<t)return[x];var r=[{vertexArr:[],normalArr:[],faceArr:[]}];x.colorArr&&(r.colorArr=[]);var h=[],s=[],o=0,e=x.faceArr;for(let a=0,g=e.length;a<g;a+=3){let f=r[o];for(let E=0;E<3;E++){var n=e[a+E];h[n]!==o&&(h[n]=o,s[n]=f.vertexArr.length,f.vertexArr.push(x.vertexArr[n]),x.normalArr&&x.normalArr[n]&&f.normalArr.push(x.normalArr[n]),x.colorArr&&x.colorArr[n]&&f.colorArr.push(x.colorArr[n])),f.faceArr.push(s[n])}f.vertexArr.length>=t&&(r.push({vertexArr:[],normalArr:[],faceArr:[]}),x.colorArr&&(r.colorArr=[]),o++)}return r}},"./src/GLViewer.ts":(X,L,c)=>{c.r(L),c.d(L,{GLViewer:()=>t,createStereoViewer:()=>s,createViewer:()=>r,createViewerGrid:()=>h});var A=c("./src/WebGL/index.ts"),T=c("./src/WebGL/math/index.ts"),D=c("./src/colors.ts"),P=c("./src/utilities.ts"),u=c("./src/Gradient.ts"),y=c("./src/GLModel.ts"),C=c("./src/Label.ts"),v=c("./src/GLShape.ts"),M=c("./src/VolumeData.ts"),_=c("./src/ProteinSurface4.ts"),p=c("./src/VolumetricRender.ts"),x=c("./node_modules/upng-js/UPNG.js");class t{getRect(){let e=this.container,n=e.getBoundingClientRect();if(n.width==0&&n.height==0&&e.style.display==="none"){let a=e.style.position,g=e.style.visibility;e.style.display="block",e.style.visibility="hidden",e.style.position="absolute",n=e.getBoundingClientRect(),e.style.display="none",e.style.visibility=g,e.style.position=a}return n}getWidth(){return this.getRect().width}getHeight(){return this.getRect().height}setupRenderer(){this.renderer=new A.Renderer({antialias:this.config.antialias,preserveDrawingBuffer:!0,premultipliedAlpha:!1,id:this.config.id,row:this.config.row,col:this.config.col,rows:this.config.rows,cols:this.config.cols,canvas:this.config.canvas,containerWidth:this.WIDTH||1,containerHeight:this.HEIGHT||1}),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.renderer.domElement.style.padding="0",this.renderer.domElement.style.position="absolute",this.renderer.domElement.style.top="0px",this.renderer.domElement.style.left="0px",this.renderer.domElement.style.zIndex="0"}initializeScene(){this.scene=new A.Scene,this.scene.fog=new A.Fog(this.bgColor,100,200),this.modelGroup=new A.Object3D,this.rotationGroup=new A.Object3D,this.rotationGroup.useQuaternion=!0,this.rotationGroup.quaternion=new T.Quaternion(0,0,0,1),this.rotationGroup.add(this.modelGroup),this.scene.add(this.rotationGroup);var e=new A.Light(16777215);e.position=new T.Vector3(.2,.2,1).normalize(),e.intensity=1,this.scene.add(e)}initContainer(e){this.container=e,this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight(),this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.renderer.setSize(this.WIDTH,this.HEIGHT),this.container.append(this.renderer.domElement),this.glDOM=this.renderer.domElement,this.nomouse||(this.glDOM.addEventListener("mousedown",this._handleMouseDown.bind(this),{passive:!1}),this.glDOM.addEventListener("touchstart",this._handleMouseDown.bind(this),{passive:!1}),this.glDOM.addEventListener("wheel",this._handleMouseScroll.bind(this),{passive:!1}),this.glDOM.addEventListener("mousemove",this._handleMouseMove.bind(this),{passive:!1}),this.glDOM.addEventListener("touchmove",this._handleMouseMove.bind(this),{passive:!1}),this.glDOM.addEventListener("contextmenu",this._handleContextMenu.bind(this),{passive:!1}))}decAnim(){this.animated--,this.animated<0&&(this.animated=0)}incAnim(){this.animated++}nextSurfID(){var e=0;for(let a in this.surfaces)if(this.surfaces.hasOwnProperty(a)){var n=parseInt(a);isNaN(n)||n>e&&(e=n)}return e+1}setSlabAndFog(){let e=this.camera.position.z-this.rotationGroup.position.z;e<1&&(e=1),this.camera.near=e+this.slabNear,this.camera.near<1&&(this.camera.near=1),this.camera.far=e+this.slabFar,this.camera.near+1>this.camera.far&&(this.camera.far=this.camera.near+1),this.camera.fov=this.fov,this.camera.right=e*Math.tan(Math.PI/180*this.fov),this.camera.left=-this.camera.right,this.camera.top=this.camera.right/this.ASPECT,this.camera.bottom=-this.camera.top,this.camera.updateProjectionMatrix(),this.scene.fog.near=this.camera.near+this.fogStart*(this.camera.far-this.camera.near),this.scene.fog.far=this.camera.far,this.config.disableFog&&(this.scene.fog.near=this.scene.fog.far)}show(e){if(this.renderer.setViewport(),!!this.scene&&(this.setSlabAndFog(),this.renderer.render(this.scene,this.camera),this.viewChangeCallback&&this.viewChangeCallback(this._viewer.getView()),!e&&this.linkedViewers.length>0))for(var n=this._viewer.getView(),a=0;a<this.linkedViewers.length;a++){var g=this.linkedViewers[a];g.setView(n,!0)}}updateClickables(){this.clickables.splice(0,this.clickables.length),this.hoverables.splice(0,this.hoverables.length),this.contextMenuEnabledAtoms.splice(0,this.contextMenuEnabledAtoms.length);for(let e=0,n=this.models.length;e<n;e++){let a=this.models[e];if(a){let g=a.selectedAtoms({clickable:!0}),f=a.selectedAtoms({hoverable:!0}),E=a.selectedAtoms({contextMenuEnabled:!0});for(let w=0;w<f.length;w++)this.hoverables.push(f[w]);for(let w=0;w<g.length;w++)this.clickables.push(g[w]);for(let w=0;w<E.length;w++)this.contextMenuEnabledAtoms.push(E[w])}}for(let e=0,n=this.shapes.length;e<n;e++){let a=this.shapes[e];a&&a.clickable&&this.clickables.push(a),a&&a.hoverable&&this.hoverables.push(a)}}handleClickSelection(e,n,a){let g=this.targetedObjects(e,n,this.clickables);if(g.length){var f=g[0].clickable;f.callback!==void 0&&(typeof f.callback!="function"&&(f.callback=(0,P.makeFunction)(f.callback)),typeof f.callback=="function"&&f.callback(f,this._viewer,a,this.container,g))}}canvasOffset(){let e=this.glDOM,n=e.getBoundingClientRect(),a=e.ownerDocument,g=a.documentElement,f=a.defaultView;return{top:n.top+f.pageYOffset-g.clientTop,left:n.left+f.pageXOffset-g.clientLeft}}setHover(e,n,a){this.current_hover!=e&&(this.current_hover&&(typeof this.current_hover.unhover_callback!="function"&&(this.current_hover.unhover_callback=(0,P.makeFunction)(this.current_hover.unhover_callback)),this.current_hover.unhover_callback(this.current_hover,this._viewer,n,this.container,a)),this.current_hover=e,e&&e.hover_callback!==void 0&&(typeof e.hover_callback!="function"&&(e.hover_callback=(0,P.makeFunction)(e.hover_callback)),typeof e.hover_callback=="function"&&e.hover_callback(e,this._viewer,n,this.container,a)))}handleHoverSelection(e,n,a){if(this.hoverables.length==0)return;let g=this.targetedObjects(e,n,this.hoverables);if(g.length){var f=g[0].clickable;this.setHover(f,a,g),this.current_hover=f}else this.setHover(null)}handleHoverContinue(e,n){let a=this.targetedObjects(e,n,this.hoverables);(a.length==0||a[0]===void 0)&&this.setHover(null),a[0]!==void 0&&a[0].clickable!==this.current_hover&&this.setHover(null)}closeEnoughForClick(e,{allowTolerance:n=e.targetTouches,tolerance:a=5}={}){const g=this.getX(e),f=this.getY(e);if(n){const E=Math.abs(g-this.mouseStartX),w=Math.abs(f-this.mouseStartY);return E<=a&&w<=a}else return g===this.mouseStartX&&f===this.mouseStartY}calcTouchDistance(e){var n=e.targetTouches[0].pageX-e.targetTouches[1].pageX,a=e.targetTouches[0].pageY-e.targetTouches[1].pageY;return Math.hypot(n,a)}getX(e){var n=e.pageX;return n==null&&(n=e.pageX),e.targetTouches&&e.targetTouches[0]?n=e.targetTouches[0].pageX:e.changedTouches&&e.changedTouches[0]&&(n=e.changedTouches[0].pageX),n}getY(e){var n=e.pageY;return n==null&&(n=e.pageY),e.targetTouches&&e.targetTouches[0]?n=e.targetTouches[0].pageY:e.changedTouches&&e.changedTouches[0]&&(n=e.changedTouches[0].pageY),n}isInViewer(e,n){if(this.viewers!=null){var a=this.WIDTH/this.cols,g=this.HEIGHT/this.rows,f=this.canvasOffset(),E=e-f.left,w=n-f.top,R=this.rows-Math.floor(w/g)-1,z=Math.floor(E/a);if(R!=this.row||z!=this.col)return!1}return!0}adjustZoomToLimits(e){if(this.config.lowerZoomLimit&&this.config.lowerZoomLimit>0){let n=this.CAMERA_Z-this.config.lowerZoomLimit;e>n&&(e=n)}if(this.config.upperZoomLimit&&this.config.upperZoomLimit>0){let n=this.CAMERA_Z-this.config.upperZoomLimit;e<n&&(e=n)}return e>this.CAMERA_Z-1&&(e=this.CAMERA_Z-1),e}static slerp(e,n,a){if(a==1)return n.clone();if(a==0)return e.clone();let g=e.x*n.x+e.y*n.y+e.z*n.z+e.w*n.w;if(g>.9995){let I=new T.Quaternion(e.x+a*(n.x-e.x),e.y+a*(n.y-e.y),e.z+a*(n.z-e.z),e.w+a*(n.w-e.w));return I.normalize(),I}g<0&&(n=n.clone().multiplyScalar(-1),g=-g),g>1?g=1:g<-1&&(g=-1);var f=Math.acos(g),E=f*a,w=n.clone();w.sub(e.clone().multiplyScalar(g)),w.normalize();var R=Math.cos(E),z=Math.sin(E),S=new T.Quaternion(e.x*R+w.x*z,e.y*R+w.y*z,e.z*R+w.z*z,e.w*R+w.w*z);return S.normalize(),S}constructor(e,n={}){this.nomouse=!1,this.glDOM=null,this.models=[],this.surfaces={},this.shapes=[],this.labels=[],this.clickables=[],this.hoverables=[],this.contextMenuEnabledAtoms=[],this.current_hover=null,this.hoverDuration=500,this.viewer_frame=0,this.viewChangeCallback=null,this.stateChangeCallback=null,this.NEAR=1,this.FAR=800,this.CAMERA_Z=150,this.fov=20,this.linkedViewers=[],this.renderer=null,this.control_all=!1,this.scene=null,this.rotationGroup=null,this.modelGroup=null,this.fogStart=.4,this.slabNear=-50,this.slabFar=50,this.cq=new T.Quaternion(0,0,0,1),this.dq=new T.Quaternion(0,0,0,1),this.animated=0,this.animationTimers=new Set,this.isDragging=!1,this.mouseStartX=0,this.mouseStartY=0,this.touchDistanceStart=0,this.touchHold=!1,this.currentModelPos=0,this.cz=0,this.cslabNear=0,this.cslabFar=0,this.userContextMenuHandler=null,this.config=n,this.callback=this.config.callback,this.defaultcolors=this.config.defaultcolors,this.defaultcolors||(this.defaultcolors=D.elementColors.defaultColors),this.nomouse=this.config.nomouse,this.bgColor=0,this.config.backgroundColor=this.config.backgroundColor||"#ffffff",typeof this.config.backgroundColor<"u"&&(this.bgColor=D.CC.color(this.config.backgroundColor).getHex()),this.config.backgroundAlpha=this.config.backgroundAlpha==null?1:this.config.backgroundAlpha,this.camerax=0,typeof this.config.camerax<"u"&&(this.camerax=parseFloat(this.config.camerax)),this._viewer=this,this.container=e,this.config.hoverDuration!=null&&(this.hoverDuration=this.config.hoverDuration),this.config.antialias===void 0&&(this.config.antialias=!0),this.config.cartoonQuality===void 0&&(this.config.cartoonQuality=10),this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight(),this.setupRenderer(),this.row=this.config.row==null?0:this.config.row,this.col=this.config.col==null?0:this.config.col,this.cols=this.config.cols,this.rows=this.config.rows,this.viewers=this.config.viewers,this.control_all=this.config.control_all,this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.camera=new A.Camera(this.fov,this.ASPECT,this.NEAR,this.FAR,this.config.orthographic),this.camera.position=new T.Vector3(this.camerax,0,this.CAMERA_Z),this.lookingAt=new T.Vector3,this.camera.lookAt(this.lookingAt),this.raycaster=new A.Raycaster(new T.Vector3(0,0,0),new T.Vector3(0,0,0)),this.projector=new A.Projector,this.initializeScene(),this.renderer.setClearColorHex(this.bgColor,this.config.backgroundAlpha),this.scene.fog.color=D.CC.color(this.bgColor),document.body.addEventListener("mouseup",this._handleMouseUp.bind(this)),document.body.addEventListener("touchend",this._handleMouseUp.bind(this)),this.initContainer(this.container),this.config.style&&this.setViewStyle(this.config),window.addEventListener("resize",this.resize.bind(this)),typeof window.ResizeObserver<"u"&&(this.divwatcher=new window.ResizeObserver(this.resize.bind(this)),this.divwatcher.observe(this.container));try{typeof this.callback=="function"&&this.callback(this)}catch(a){console.log("error with glviewer callback: "+a)}}targetedObjects(e,n,a){var g={x:e,y:n,z:-1};return Array.isArray(a)||(a=this.selectedAtoms(a)),a.length==0?[]:(this.raycaster.setFromCamera(g,this.camera),this.raycaster.intersectObjects(this.modelGroup,a))}modelToScreen(e){let n=!1;Array.isArray(e)||(e=[e],n=!0);let a=this.renderer.getXRatio(),g=this.renderer.getYRatio(),f=this.col,E=this.row,w=f*(this.WIDTH/a),R=(g-E-1)*(this.HEIGHT/g),z=[],S=this.canvasOffset();return e.forEach(I=>{let F=new T.Vector3(I.x,I.y,I.z);F.applyMatrix4(this.modelGroup.matrixWorld),this.projector.projectVector(F,this.camera);let G=this.WIDTH/a*(F.x+1)/2+S.left+w,B=-(this.HEIGHT/g)*(F.y-1)/2+S.top+R;z.push({x:G,y:B})}),n&&(z=z[0]),z}screenOffsetToModel(e,n,a){var g=e/this.WIDTH,f=n/this.HEIGHT,E=a===void 0?this.rotationGroup.position.z:a,w=this.rotationGroup.quaternion,R=new T.Vector3(0,0,E);return this.projector.projectVector(R,this.camera),R.x+=g*2,R.y-=f*2,this.projector.unprojectVector(R,this.camera),R.z=0,R.applyQuaternion(w),R}screenToModelDistance(e,n){let a=this.canvasOffset(),g=new T.Vector3(n.x,n.y,n.z);g.applyMatrix4(this.modelGroup.matrixWorld);let f=g.clone();this.projector.projectVector(g,this.camera);let E=new T.Vector3((e.x-a.left)*2/this.WIDTH-1,(e.y-a.top)*2/-this.HEIGHT+1,g.z);return this.projector.unprojectVector(E,this.camera),E.distanceTo(f)}setViewChangeCallback(e){(typeof e=="function"||e==null)&&(this.viewChangeCallback=e)}setStateChangeCallback(e){(typeof e=="function"||e==null)&&(this.stateChangeCallback=e)}getConfig(){return this.config}setConfig(e){this.config=e}getInternalState(){var e={models:[],surfaces:[],shapes:[],labels:[]};for(let n=0;n<this.models.length;n++)this.models[n]&&(e.models[n]=this.models[n].getInternalState());return e}setInternalState(e){this.clear();var n=e.models;for(let a=0;a<n.length;a++)n[a]&&(this.models[a]=new y.GLModel(a),this.models[a].setInternalState(n[a]));this.render()}setZoomLimits(e,n){typeof e<"u"&&(this.config.lowerZoomLimit=e),n&&(this.config.upperZoomLimit=n),this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z),this.show()}setCameraParameters(e){e.fov!==void 0&&(this.fov=e.fov,this.camera.fov=this.fov),e.z!==void 0&&(this.CAMERA_Z=e.z,this.camera.z=this.CAMERA_Z),e.orthographic!==void 0&&(this.camera.ortho=e.orthographic)}_handleMouseDown(e){if(e.preventDefault(),!this.scene)return;var n=this.getX(e),a=this.getY(e);if(n===void 0)return;this.isDragging=!0,this.mouseButton=e.which,this.mouseStartX=n,this.mouseStartY=a,this.touchHold=!0,this.touchDistanceStart=0,e.targetTouches&&e.targetTouches.length==2&&(this.touchDistanceStart=this.calcTouchDistance(e)),this.cq=this.rotationGroup.quaternion.clone(),this.cz=this.rotationGroup.position.z,this.currentModelPos=this.modelGroup.position.clone(),this.cslabNear=this.slabNear,this.cslabFar=this.slabFar;let g=this;setTimeout(function(){e.targetTouches&&g.touchHold==!0&&(g.glDOM=g.renderer.domElement,g.glDOM.dispatchEvent(new Event("contextmenu")))},1e3)}_handleMouseUp(e){if(this.touchHold=!1,this.isDragging&&this.scene){var n=this.getX(e),a=this.getY(e);if(this.closeEnoughForClick(e)&&this.isInViewer(n,a)){let g=this.mouseXY(n,a);this.handleClickSelection(g.x,g.y,e)}}this.isDragging=!1}_handleMouseScroll(e){if(e.preventDefault(),!!this.scene){var n=this.getX(e),a=this.getY(e);if(n!==void 0&&!(!this.control_all&&!this.isInViewer(n,a))){var g=(this.CAMERA_Z-this.rotationGroup.position.z)*.85,f=1;if(e.ctrlKey&&(f=-1),e.detail)this.rotationGroup.position.z+=f*g*e.detail/10;else if(e.wheelDelta){let E=e.wheelDelta*600/(e.wheelDelta+600);this.rotationGroup.position.z-=f*g*E/400}this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z),this.show()}}}pngURI(){return this.getCanvas().toDataURL("image/png")}apngURI(e){let n=this;return e=e||1,new Promise(function(a){let g=0,f=n.viewChangeCallback,E=[],w=[],R=Date.now();n.viewChangeCallback=function(){w.push(Date.now()-R),R=Date.now(),E.push(new Promise(z=>{n.getCanvas().toBlob(function(S){S.arrayBuffer().then(z)},"image/png")})),g+=1,g==e&&(n.viewChangeCallback=f,Promise.all(E).then(z=>{let S=[];for(let V=0;V<z.length;V++){let k=(0,x.decode)(z[V]);S.push((0,x.toRGBA8)(k)[0])}let I=n.getCanvas().width,F=n.getCanvas().height,G=(0,x.encode)(S,I,F,0,w),B=new Blob([G],{type:"image/png"}),W=new FileReader;W.onload=function(V){a(V.target.result)},W.readAsDataURL(B)}))}})}getCanvas(){return this.glDOM}getRenderer(){return this.renderer}setHoverDuration(e){this.hoverDuration=e}mouseXY(e,n){let a=this.canvasOffset(),g=this.renderer.getXRatio(),f=this.renderer.getYRatio(),E=this.col,w=this.row,R=E*(this.WIDTH/g),z=(f-w-1)*(this.HEIGHT/f),S=(e-a.left-R)/(this.WIDTH/g)*2-1,I=-((n-a.top-z)/(this.HEIGHT/f))*2+1;return{x:S,y:I}}_handleMouseMove(e){clearTimeout(this.hoverTimeout),e.preventDefault();let n=this.getX(e),a=this.getY(e);if(n===void 0)return;let g=this.renderer.getXRatio(),f=this.renderer.getYRatio(),E=this.mouseXY(n,a),w=this;this.current_hover!==null&&this.handleHoverContinue(E.x,E.y);var R=0;if(!(!this.control_all&&!this.isInViewer(n,a))&&this.scene&&(this.hoverables.length>0&&(this.hoverTimeout=setTimeout(function(){w.handleHoverSelection(E.x,E.y,e)},this.hoverDuration)),!!this.isDragging)){var z=(n-this.mouseStartX)/this.WIDTH,S=(a-this.mouseStartY)/this.HEIGHT;if(this.touchDistanceStart!=0&&e.targetTouches&&e.targetTouches.length==2){var I=this.calcTouchDistance(e);R=2,S=(I-this.touchDistanceStart)*2/(this.WIDTH+this.HEIGHT)}else e.targetTouches&&e.targetTouches.length==3&&(R=1);z*=g,S*=f;var F=Math.hypot(z,S),G;if(R==3||this.mouseButton==3&&e.ctrlKey)this.slabNear=this.cslabNear+z*100,this.slabFar=this.cslabFar-S*100;else if(R==2||this.mouseButton==3||e.shiftKey)G=(this.CAMERA_Z-this.rotationGroup.position.z)*.85,G<80&&(G=80),this.rotationGroup.position.z=this.cz+S*G,this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z);else if(R==1||this.mouseButton==2||e.ctrlKey){var B=this.screenOffsetToModel(g*(n-this.mouseStartX),f*(a-this.mouseStartY));this.modelGroup.position.addVectors(this.currentModelPos,B)}else if((R===0||this.mouseButton==1)&&F!==0){var W=Math.sin(F*Math.PI)/F;this.dq.x=Math.cos(F*Math.PI),this.dq.y=0,this.dq.z=W*z,this.dq.w=-W*S,this.rotationGroup.quaternion.set(1,0,0,0),this.rotationGroup.quaternion.multiply(this.dq),this.rotationGroup.quaternion.multiply(this.cq)}this.show()}}_handleContextMenu(e){e.preventDefault();var n=this.getX(e),a=this.getY(e);if(!(n!=this.mouseStartX||a!=this.mouseStartY)){var E=this.mouseStartX,w=this.mouseStartY,f=this.canvasOffset();let R=this.mouseXY(E,w),z=R.x,S=R.y,I=this.targetedObjects(z,S,this.contextMenuEnabledAtoms);var g=null;I.length&&(g=I[0].clickable);var f=this.canvasOffset(),E=this.mouseStartX-f.left,w=this.mouseStartY-f.top;this.userContextMenuHandler&&this.userContextMenuHandler(g,E,w,I)}}setContainer(e){let n=(0,P.getElement)(e)||this.container;return this.initContainer(n),this}setBackgroundColor(e,n){(typeof n>"u"||n<0||n>1)&&(n=1);var a=D.CC.color(e);return this.scene.fog.color=a,this.bgColor=a.getHex(),this.renderer.setClearColorHex(a.getHex(),n),this.show(),this}setProjection(e){this.camera.ortho=e==="orthographic",this.setSlabAndFog()}setViewStyle(e){if(e.style==="outline"){var n={};e.color&&(n.color=D.CC.color(e.color)),e.width&&(n.width=e.width),this.renderer.enableOutline(n)}else this.renderer.disableOutline();return this}updateSize(){this.renderer.setSize(this.WIDTH,this.HEIGHT),this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.renderer.setSize(this.WIDTH,this.HEIGHT),this.camera.aspect=this.ASPECT,this.camera.updateProjectionMatrix()}setWidth(e){return this.WIDTH=e||this.WIDTH,this.updateSize(),this}setHeight(e){return this.HEIGHT=e||this.HEIGHT,this.updateSize(),this}resize(){this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight();let e=!1;if(this.renderer.isLost()&&this.WIDTH>0&&this.HEIGHT>0){let n=!1,a=this.container.querySelector("canvas");a&&a!=this.renderer.getCanvas()?this.config.canvas=a:(a.remove(),this.config&&this.config.canvas!=null&&(delete this.config.canvas,n=!0)),this.setupRenderer(),this.initContainer(this.container),e=!0,n&&(this.config.canvas=this.renderer.getCanvas())}if(this.WIDTH==0||this.HEIGHT==0?this.animated&&this._viewer.pauseAnimate():this.animated&&this._viewer.resumeAnimate(),this.updateSize(),e){let n=this.renderer.supportedExtensions();if(n.regen=!0,this.viewers)for(let a=0,g=this.viewers.length;a<g;a++)for(let f=0,E=this.viewers[a].length;f<E;f++)this.viewers[a][f].render(null,n);this._viewer.render(null,n)}else this.show();return this}getModel(e){return e===void 0?this.models.length==0?null:this.models[this.models.length-1]:e instanceof y.GLModel?e:e in this.models?this.models[e]:this.models.length==0?null:this.models[this.models.length-1]}spin(e,n=1){if(clearInterval(this.spinInterval),typeof e>"u"&&(e="y"),typeof e=="boolean")if(e)e="y";else return;Array.isArray(e)&&(e={x:e[0],y:e[1],z:e[2]});var a=this;this.spinInterval=setInterval(function(){!a.getCanvas().isConnected&&a.renderer.isLost()&&clearInterval(a.spinInterval),a.rotate(1*n,e)},25)}animateMotion(e,n,a,g,f,E){var w=20,R=Math.ceil(e/w);R<1&&(R=1),this.incAnim();var z={mpos:this.modelGroup.position.clone(),rz:this.rotationGroup.position.z,rot:this.rotationGroup.quaternion.clone(),cam:this.lookingAt.clone()};if(n){let F=new Array(R);for(let V=0;V<R;V++){let k=(V+1)/R,U={mpos:z.mpos,rz:z.rz,rot:z.rot};U.mpos=a.clone().sub(z.mpos).multiplyScalar(k).add(z.mpos),U.rz=z.rz+k*(g-z.rz),U.rot=t.slerp(z.rot,f,k),U.cam=E.clone().sub(z.cam).multiplyScalar(k).add(z.cam),F[V]=U}let G=0,B=this,W=function(){var V=F[G];G+=1,B.modelGroup.position=V.mpos,B.rotationGroup.position.z=V.rz,B.rotationGroup.quaternion=V.rot,B.camera.lookAt(V.cam),G<F.length?setTimeout(W,w):B.decAnim(),B.show()};setTimeout(W,w)}else{var S={};let F=1/R;if(a&&(S.mpos=a.clone().sub(z.mpos).multiplyScalar(F)),typeof g<"u"&&g!=null&&(S.rz=F*(g-z.rz)),f){var I=t.slerp(z.rot,f,F);S.rot=z.rot.clone().inverse().multiply(I)}E&&(S.cam=E.clone().sub(z.cam).multiplyScalar(F));let G=0,B=this,W=function(){G+=1,S.mpos&&B.modelGroup.position.add(S.mpos),S.rz&&(B.rotationGroup.position.z+=S.rz),S.rot&&B.rotationGroup.quaternion.multiply(S.rot),S.cam&&(B.lookingAt.add(S.cam),B.camera.lookAt(B.lookingAt)),G<R?setTimeout(W,w):B.decAnim(),B.show()};setTimeout(W,w)}}rotate(e,n="y",a=0,g=!1){if(n=="x"?n={x:1,y:0,z:0}:n=="y"?n={x:0,y:1,z:0}:n=="z"&&(n={x:0,y:0,z:1}),n=="vx"?n={vx:1,vy:0,vz:0}:n=="vy"?n={vx:0,vy:1,vz:0}:n=="vz"&&(n={vx:0,vy:0,vz:1}),typeof n.vx<"u"){var f=new T.Vector3(n.vx,n.vy,n.vz);f.applyQuaternion(this.rotationGroup.quaternion),n={x:f.x,y:f.y,z:f.z}}var E=function(S){var I=Math.sin(S/2),F=Math.cos(S/2),G=0,B=0,W=0;return G=n.x*I,B=n.y*I,W=n.z*I,new T.Quaternion(G,B,W,F).normalize()},w=Math.PI*e/180,R=E(w);if(a){var z=new T.Quaternion().copy(this.rotationGroup.quaternion).multiply(R);this.animateMotion(a,g,this.modelGroup.position,this.rotationGroup.position.z,z,this.lookingAt)}else this.rotationGroup.quaternion.multiply(R),this.show();return this}surfacesFinished(){for(var e in this.surfaces)if(!this.surfaces[e][0].done)return!1;return!0}getView(){if(!this.modelGroup)return[0,0,0,0,0,0,0,1];var e=this.modelGroup.position,n=this.rotationGroup.quaternion;return[e.x,e.y,e.z,this.rotationGroup.position.z,n.x,n.y,n.z,n.w]}setView(e,n){return e===void 0||!(e instanceof Array||e.length!==8)?this:!this.modelGroup||!this.rotationGroup?this:(this.modelGroup.position.x=e[0],this.modelGroup.position.y=e[1],this.modelGroup.position.z=e[2],this.rotationGroup.position.z=e[3],this.rotationGroup.quaternion.x=e[4],this.rotationGroup.quaternion.y=e[5],this.rotationGroup.quaternion.z=e[6],this.rotationGroup.quaternion.w=e[7],typeof e[8]<"u"&&(this.rotationGroup.position.x=e[8],this.rotationGroup.position.y=e[9]),this.show(n),this)}render(e,n){this.renderer.setViewport(),this.updateClickables();var a=this.getView();this.stateChangeCallback&&this.stateChangeCallback(this.getInternalState());var g,f;for(n||(n=this.renderer.supportedExtensions()),g=0;g<this.models.length;g++)this.models[g]&&this.models[g].globj(this.modelGroup,n);for(g=0;g<this.shapes.length;g++)this.shapes[g]&&(typeof this.shapes[g].frame>"u"||this.viewer_frame<0||this.shapes[g].frame<0||this.shapes[g].frame==this.viewer_frame?this.shapes[g].globj(this.modelGroup,n):this.shapes[g].removegl(this.modelGroup));for(g=0;g<this.labels.length;g++)n.regen&&(this.labels[g].dispose(),this.modelGroup.remove(this.labels[g].sprite),this.labels[g].setContext(),this.modelGroup.add(this.labels[g].sprite)),this.labels[g]&&typeof this.labels[g].frame<"u"&&this.labels[g].frame>=0&&(this.modelGroup.remove(this.labels[g].sprite),(this.viewer_frame<0||this.labels[g].frame==this.viewer_frame)&&this.modelGroup.add(this.labels[g].sprite));for(g in this.surfaces)if(this.surfaces.hasOwnProperty(g)){var E=this.surfaces[g];for(f=0;f<E.length;f++)if(E.hasOwnProperty(f)){var w=E[f].geo;if(!E[f].finished||n.regen){w.verticesNeedUpdate=!0,w.elementsNeedUpdate=!0,w.normalsNeedUpdate=!0,w.colorsNeedUpdate=!0,w.buffersNeedUpdate=!0,w.boundingSphere=null,E[f].mat.needsUpdate=!0,E[f].done&&(E[f].finished=!0),E[f].lastGL&&this.modelGroup.remove(E[f].lastGL);var R=null;if(E[f].mat instanceof A.LineBasicMaterial?R=new A.Line(w,E[f].mat):R=new A.Mesh(w,E[f].mat),E[f].mat.transparent&&E[f].mat.opacity==0?R.visible=!1:R.visible=!0,E[f].symmetries.length>1||E[f].symmetries.length==1&&!E[f].symmetries[f].isIdentity()){var z,S=new A.Object3D;for(z=0;z<E[f].symmetries.length;z++){var I=R.clone();I.matrix=E[f].symmetries[z],I.matrixAutoUpdate=!1,S.add(I)}E[f].lastGL=S,this.modelGroup.add(S)}else E[f].lastGL=R,this.modelGroup.add(R)}}}return this.setView(a),typeof e=="function"&&e(this),this}getModelList(e){let n=[];if(typeof e>"u"||typeof e.model>"u")for(let g=0;g<this.models.length;g++)this.models[g]&&n.push(this.models[g]);else{let g=e.model;Array.isArray(g)||(g=[g]);for(let f=0;f<g.length;f++)if(typeof g[f]=="number"){var a=g[f];a<0&&(a+=this.models.length),n.push(this.models[a])}else n.push(g[f])}return n}getAtomsFromSel(e){var n=[];typeof e>"u"&&(e={});var a=this.getModelList(e);for(let g=0;g<a.length;g++)n=n.concat(a[g].selectedAtoms(e));return n}atomIsSelected(e,n){typeof n>"u"&&(n={});for(var a=this.getModelList(n),g=0;g<a.length;g++)if(a[g].atomIsSelected(e,n))return!0;return!1}selectedAtoms(e){return this.getAtomsFromSel(e)}getUniqueValues(e,n){typeof n>"u"&&(n={});var a=this.getAtomsFromSel(n),g={};for(var f in a)if(a[f].hasOwnProperty(e)){var E=a[f][e];g[E]=!0}return Object.keys(g)}pdbData(e){for(var n=this.getAtomsFromSel(e),a="",g=0,f=n.length;g<f;++g)a+=n[g].pdbline+`
`;return a}zoom(e=2,n=0,a=!1){var g=(this.CAMERA_Z-this.rotationGroup.position.z)/e,f=this.CAMERA_Z-g;return n>0?this.animateMotion(n,a,this.modelGroup.position,this.adjustZoomToLimits(f),this.rotationGroup.quaternion,this.lookingAt):(this.rotationGroup.position.z=this.adjustZoomToLimits(f),this.show()),this}translate(e,n,a=0,g=!1){var f=e/this.WIDTH,E=n/this.HEIGHT,w=new T.Vector3(0,0,-this.CAMERA_Z);this.projector.projectVector(w,this.camera),w.x-=f,w.y-=E,this.projector.unprojectVector(w,this.camera),w.z=0;var R=this.lookingAt.clone().add(w);return a>0?this.animateMotion(a,g,this.modelGroup.position,this.rotationGroup.position.z,this.rotationGroup.quaternion,R):(this.lookingAt=R,this.camera.lookAt(this.lookingAt),this.show()),this}translateScene(e,n,a=0,g=!1){var f=this.screenOffsetToModel(e,n),E=this.modelGroup.position.clone().add(f);return a>0?this.animateMotion(a,g,this.modelGroup.position,this.rotationGroup.position.z,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=E,this.show()),this}fitSlab(e){e=e||{};var n=this.getAtomsFromSel(e),a=(0,P.getExtent)(n),g=a[1][0]-a[0][0],f=a[1][1]-a[0][1],E=a[1][2]-a[0][2],w=Math.hypot(g,f,E);return w<5&&(w=5),this.slabNear=-w/1.9,this.slabFar=w/2,this}center(e={},n=0,a=!1){var g,f,E=this.getAtomsFromSel(e),w=(0,P.getExtent)(E);(0,P.isEmptyObject)(e)?(this.shapes.forEach(k=>{if(k&&k.boundingSphere&&k.boundingSphere.center){var U=k.boundingSphere.center,j=k.boundingSphere.radius;j>0?(E.push(new T.Vector3(U.x+j,U.y,U.z)),E.push(new T.Vector3(U.x-j,U.y,U.z)),E.push(new T.Vector3(U.x,U.y+j,U.z)),E.push(new T.Vector3(U.x,U.y-j,U.z)),E.push(new T.Vector3(U.x,U.y,U.z+j)),E.push(new T.Vector3(U.x,U.y,U.z-j))):E.push(U)}}),w=(0,P.getExtent)(E),g=E,f=w):(g=this.getAtomsFromSel({}),f=(0,P.getExtent)(g));var R=new T.Vector3(w[2][0],w[2][1],w[2][2]),z=f[1][0]-f[0][0],S=f[1][1]-f[0][1],I=f[1][2]-f[0][2],F=Math.hypot(z,S,I);F<5&&(F=5),this.slabNear=-F/1.9,this.slabFar=F/2,z=w[1][0]-w[0][0],S=w[1][1]-w[0][1],I=w[1][2]-w[0][2],F=Math.hypot(z,S,I),F<5&&(F=5);for(var G=25,B=0;B<E.length;B++)if(E[B]){var W=R.distanceToSquared(E[B]);W>G&&(G=W)}F=Math.sqrt(G)*2;var V=R.clone().multiplyScalar(-1);return n>0?this.animateMotion(n,a,V,this.rotationGroup.position.z,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=V,this.show()),this}zoomTo(e={},n=0,a=!1){let g=this.getAtomsFromSel(e),f=(0,P.getExtent)(g),E=f;if((0,P.isEmptyObject)(e)){let U=g&&g.length;if(this.shapes.forEach(j=>{if(j&&j.boundingSphere){if(j.boundingSphere.box){let ge=j.boundingSphere.box;g.push(new T.Vector3(ge.min.x,ge.min.y,ge.min.z)),g.push(new T.Vector3(ge.max.x,ge.max.y,ge.max.z))}else if(j.boundingSphere.center){var q=j.boundingSphere.center,ie=j.boundingSphere.radius;ie>0?(g.push(new T.Vector3(q.x+ie,q.y,q.z)),g.push(new T.Vector3(q.x-ie,q.y,q.z)),g.push(new T.Vector3(q.x,q.y+ie,q.z)),g.push(new T.Vector3(q.x,q.y-ie,q.z)),g.push(new T.Vector3(q.x,q.y,q.z+ie)),g.push(new T.Vector3(q.x,q.y,q.z-ie))):g.push(q)}}}),E=(0,P.getExtent)(g),!U)for(let j=0;j<3;j++)f[2][j]=(E[0][j]+E[1][j])/2}else{let U=this.getAtomsFromSel({});E=(0,P.getExtent)(U)}var w=new T.Vector3(f[2][0],f[2][1],f[2][2]),R=E[1][0]-E[0][0],z=E[1][1]-E[0][1],S=E[1][2]-E[0][2],I=Math.hypot(R,z,S);I<5&&(I=5),this.slabNear=-I/1.9,this.slabFar=I/2,Object.keys(e).length===0&&(this.slabNear=Math.min(-I*2,-50),this.slabFar=Math.max(I*2,50));var F=this.config.minimumZoomToDistance||5;R=f[1][0]-f[0][0],z=f[1][1]-f[0][1],S=f[1][2]-f[0][2],I=Math.hypot(R,z,S),I<F&&(I=F);for(var G=F*F,B=0;B<g.length;B++)if(g[B]){var W=w.distanceToSquared(g[B]);W>G&&(G=W)}I=Math.sqrt(G)*2;var V=w.clone().multiplyScalar(-1),k=-(I*.5/Math.tan(Math.PI/180*this.camera.fov/2)-this.CAMERA_Z);return k=this.adjustZoomToLimits(k),n>0?this.animateMotion(n,a,V,k,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=V,this.rotationGroup.position.z=k,this.show()),this}setSlab(e,n){this.slabNear=e,this.slabFar=n}getSlab(){return{near:this.slabNear,far:this.slabFar}}addLabel(e,n={},a,g=!1){if(a){var f=(0,P.getExtent)(this.getAtomsFromSel(a));n.position={x:f[2][0],y:f[2][1],z:f[2][2]}}var E=new C.Label(e,n);return E.setContext(),this.modelGroup.add(E.sprite),this.labels.push(E),g||this.show(),E}addResLabels(e,n,a=!1){let g=this.labels.length;return this.applyToModels("addResLabels",e,this,n,a),this.show(),this.labels.slice(g)}addPropertyLabels(e,n,a){return this.applyToModels("addPropertyLabels",e,n,this,a),this.show(),this}removeLabel(e){for(var n=0;n<this.labels.length;n++)if(this.labels[n]==e){this.labels.splice(n,1),e.dispose(),this.modelGroup.remove(e.sprite);break}return this.show(),this}removeAllLabels(){for(var e=0;e<this.labels.length;e++)this.labels[e]&&this.labels[e].sprite&&this.modelGroup.remove(this.labels[e].sprite);return this.labels.splice(0,this.labels.length),this.show(),this}setLabelStyle(e,n){return this.modelGroup.remove(e.sprite),e.dispose(),e.stylespec=n,e.setContext(),this.modelGroup.add(e.sprite),this.show(),e}setLabelText(e,n){return this.modelGroup.remove(e.sprite),e.dispose(),e.text=n,e.setContext(),this.modelGroup.add(e.sprite),this.show(),e}addShape(e){e=e||{};var n=new v.GLShape(e);return n.shapePosition=this.shapes.length,this.shapes.push(n),n}removeShape(e){if(!e)return this;for(e.removegl(this.modelGroup),delete this.shapes[e.shapePosition];this.shapes.length>0&&typeof this.shapes[this.shapes.length-1]>"u";)this.shapes.pop();return this}removeAllShapes(){for(var e=0;e<this.shapes.length;e++){var n=this.shapes[e];n&&n.removegl(this.modelGroup)}return this.shapes.splice(0,this.shapes.length),this}getSelectionCenter(e){if(e.hasOwnProperty("x")&&e.hasOwnProperty("y")&&e.hasOwnProperty("z"))return e;var n=this.getAtomsFromSel(e);if(n.length==0)return{x:0,y:0,z:0};var a=(0,P.getExtent)(n);return{x:a[0][0]+(a[1][0]-a[0][0])/2,y:a[0][1]+(a[1][1]-a[0][1])/2,z:a[0][2]+(a[1][2]-a[0][2])/2}}addSphere(e){e=e||{},e.center=this.getSelectionCenter(e.center);var n=new v.GLShape(e);return n.shapePosition=this.shapes.length,n.addSphere(e),this.shapes.push(n),n.finalize(),n}addBox(e={}){e.corner!=null&&(e.corner=this.getSelectionCenter(e.corner)),e.center!=null&&(e.center=this.getSelectionCenter(e.center));var n=new v.GLShape(e);return n.shapePosition=this.shapes.length,n.addBox(e),this.shapes.push(n),n.finalize(),n}addArrow(e={}){e.start=this.getSelectionCenter(e.start),e.end=this.getSelectionCenter(e.end);var n=new v.GLShape(e);return n.shapePosition=this.shapes.length,n.addArrow(e),this.shapes.push(n),n.finalize(),n}addCylinder(e={}){e.start=this.getSelectionCenter(e.start),e.end=this.getSelectionCenter(e.end);var n=new v.GLShape(e);return n.shapePosition=this.shapes.length,e.dashed?n.addDashedCylinder(e):n.addCylinder(e),this.shapes.push(n),n.finalize(),n}addCurve(e={}){var n=new v.GLShape(e);return n.shapePosition=this.shapes.length,n.addCurve(e),this.shapes.push(n),n.finalize(),n}addLine(e={}){e.start=this.getSelectionCenter(e.start),e.end=this.getSelectionCenter(e.end),e.wireframe=!0;var n=new v.GLShape(e);return n.shapePosition=this.shapes.length,e.dashed?n=this.addLineDashed(e,n):n.addLine(e),this.shapes.push(n),n.finalize(),n}addUnitCell(e,n){e=this.getModel(e),n=n||{alabel:"a",blabel:"b",clabel:"c"},n.box=n.box||{},n.astyle=n.astyle||{color:"red",radius:.1,midpos:-1},n.bstyle=n.bstyle||{color:"green",radius:.1,midpos:-1},n.cstyle=n.cstyle||{color:"blue",radius:.1,midpos:-1},n.alabelstyle=n.alabelstyle||{fontColor:"red",showBackground:!1,alignment:"center",inFront:!1},n.blabelstyle=n.blabelstyle||{fontColor:"green",showBackground:!1,alignment:"center",inFront:!1},n.clabelstyle=n.clabelstyle||{fontColor:"blue",showBackground:!1,alignment:"center",inFront:!1},e.unitCellObjects&&this.removeUnitCell(e),e.unitCellObjects={shapes:[],labels:[]};var a=e.getCrystData(),g=null;if(a){if(a.matrix)g=a.matrix;else{var f=a.a,E=a.b,w=a.c,R=a.alpha,z=a.beta,S=a.gamma;R=R*Math.PI/180,z=z*Math.PI/180,S=S*Math.PI/180;var I,F,G;I=Math.cos(z),F=(Math.cos(R)-Math.cos(z)*Math.cos(S))/Math.sin(S),G=Math.sqrt(Math.max(0,1-I*I-F*F)),g=new T.Matrix3(f,E*Math.cos(S),w*I,0,E*Math.sin(S),w*F,0,0,w*G)}var B=[new T.Vector3(0,0,0),new T.Vector3(1,0,0),new T.Vector3(0,1,0),new T.Vector3(0,0,1),new T.Vector3(1,1,0),new T.Vector3(0,1,1),new T.Vector3(1,0,1),new T.Vector3(1,1,1)];if(a.matrix4)for(let V=0;V<B.length;V++)a.size&&B[V].multiplyVectors(B[V],a.size),B[V]=B[V].applyMatrix4(a.matrix4);else for(let V=0;V<B.length;V++)B[V]=B[V].applyMatrix3(g);if(n.box&&!n.box.hidden){n.box.wireframe=!0;var W=new v.GLShape(n.box);W.shapePosition=this.shapes.length,W.addLine({start:B[0],end:B[1]}),W.addLine({start:B[0],end:B[2]}),W.addLine({start:B[1],end:B[4]}),W.addLine({start:B[2],end:B[4]}),W.addLine({start:B[0],end:B[3]}),W.addLine({start:B[3],end:B[5]}),W.addLine({start:B[2],end:B[5]}),W.addLine({start:B[1],end:B[6]}),W.addLine({start:B[4],end:B[7]}),W.addLine({start:B[6],end:B[7]}),W.addLine({start:B[3],end:B[6]}),W.addLine({start:B[5],end:B[7]}),this.shapes.push(W),e.unitCellObjects.shapes.push(W),W.finalize()}if(!n.astyle.hidden){n.astyle.start=B[0],n.astyle.end=B[1];let V=this.addArrow(n.astyle);e.unitCellObjects.shapes.push(V)}if(!n.bstyle.hidden){n.bstyle.start=B[0],n.bstyle.end=B[2];let V=this.addArrow(n.bstyle);e.unitCellObjects.shapes.push(V)}if(!n.cstyle.hidden){n.cstyle.start=B[0],n.cstyle.end=B[3];let V=this.addArrow(n.cstyle);e.unitCellObjects.shapes.push(V)}if(n.alabel){n.alabelstyle.position=B[1];let V=this.addLabel(n.alabel,n.alabelstyle);e.unitCellObjects.labels.push(V)}if(n.blabel){n.blabelstyle.position=B[2];let V=this.addLabel(n.blabel,n.blabelstyle);e.unitCellObjects.labels.push(V)}if(n.clabel){n.clabelstyle.position=B[3];let V=this.addLabel(n.clabel,n.clabelstyle);e.unitCellObjects.labels.push(V)}}}removeUnitCell(e){if(e=this.getModel(e),e.unitCellObjects){let n=this;e.unitCellObjects.shapes.forEach(function(a){n.removeShape(a)}),e.unitCellObjects.labels.forEach(function(a){n.removeLabel(a)})}delete e.unitCellObjects}replicateUnitCell(e=3,n=e,a=n,g,f,E){g=this.getModel(g);let w=g.getCrystData();if(w){const R=g.selectedAtoms({}),z=w.matrix;let S=function(F){return F%2==0?-F/2:Math.ceil(F/2)};e<=1&&n<=1&&a<=1&&(E=!0,e=n=a=3);let I=function(F,G,B){return!1};if(E){const F=new T.Matrix3().getInverse3(z);I=function(G,B,W){let V=new T.Vector3(G,B,W).applyMatrix3(F);return!(V.x>-1e-4&&V.x<1.0001&&V.y>-1e-4&&V.y<1.0001&&V.z>-1e-4&&V.z<1.0001)}}for(let F=0;F<e;F++)for(let G=0;G<n;G++)for(let B=0;B<a;B++){if(F==0&&G==0&&B==0)continue;let W=new T.Vector3(S(F),S(G),S(B));W.applyMatrix3(z);let V=[];for(let k=0;k<R.length;k++){let U=R[k].x+W.x,j=R[k].y+W.y,q=R[k].z+W.z;if(I(U,j,q))continue;let ie={};for(let ge in R[k])ie[ge]=R[k][ge];ie.x=U,ie.y=j,ie.z=q,V.push(ie)}g.addAtoms(V)}f&&g.assignBonds()}}addLineDashed(e,n){e.dashLength=e.dashLength||.5,e.gapLength=e.gapLength||.5;var a;e.start?a=new T.Vector3(e.start.x||0,e.start.y||0,e.start.z||0):a=new T.Vector3(0,0,0);var g;e.end?g=new T.Vector3(e.end.x,e.end.y||0,e.end.z||0):g=new T.Vector3(0,0,0);var f=new T.Vector3,E=new T.Vector3,w=new T.Vector3,R,z,S,I=a.clone(),F=0;for(f.subVectors(g,a),R=f.length(),f.normalize(),E=f.clone(),w=f.clone(),E.multiplyScalar(e.dashLength),w.multiplyScalar(e.gapLength),z=E.length(),S=w.length();F<R;){if(F+z>R){e.start=a,e.end=g,n.addLine(e);break}I.addVectors(a,E),e.start=a,e.end=I,n.addLine(e),a=I.clone(),F+=z,I.addVectors(a,w),a=I.clone(),F+=S}return n.finalize(),n}addCustom(e){e=e||{};var n=new v.GLShape(e);return n.shapePosition=this.shapes.length,n.addCustom(e),this.shapes.push(n),n.finalize(),n}addVolumetricData(e,n,a={}){var g=new M.VolumeData(e,n);return a.hasOwnProperty("transferfn")?this.addVolumetricRender(g,a):this.addIsosurface(g,a)}addIsosurface(e,n={},a){var g=new v.GLShape(n);return g.shapePosition=this.shapes.length,g.addIsosurface(e,n,a),this.shapes.push(g),g}addVolumetricRender(e,n){n=n||{};var a=new p.GLVolumetricRender(e,n);return a.shapePosition=this.shapes.length,this.shapes.push(a),a}hasVolumetricRender(){return this.renderer.supportsVolumetric()}enableFog(e){e?this.scene.fog=new A.Fog(this.bgColor,100,200):(this.config.disableFog=!0,this.show())}setFrame(e){this.viewer_frame=e;let n=this;return new Promise(function(a){var g=n.models.map(function(f){return f.setFrame(e,n)});Promise.all(g).then(function(){a()})})}getFrame(){return this.viewer_frame}getNumFrames(){var e=0;for(let n=0;n<this.models.length;n++)this.models[n].getNumFrames()>e&&(e=this.models[n].getNumFrames());for(let n=0;n<this.shapes.length;n++)this.shapes[n].frame&&this.shapes[n].frame>=e&&(e=this.shapes[n].frame+1);for(let n=0;n<this.labels.length;n++)this.labels[n].frame&&this.labels[n].frame>=e&&(e=this.labels[n].frame+1);return e}animate(e){this.incAnim();var n=100,a="forward",g=0;e=e||{},e.interval&&(n=e.interval),e.loop&&(a=e.loop),e.reps&&(g=e.reps);var f=this.getNumFrames(),E=this,w=0;e.startFrame&&(w=e.startFrame%f);var R=1;e.step&&(R=e.step,g/=R);var z=0,S=f*g,I=new Date,F,G,B=function(W){I=new Date,W=="forward"?E.setFrame(w).then(function(){w=(w+R)%f,F()}):W=="backward"?E.setFrame(f-1-w).then(function(){w=(w+R)%f,F()}):E.setFrame(w).then(function(){w+=R,R*=w%(f-1)==0?-1:1,F()})};return F=function(){if(E.render(),!E.getCanvas().isConnected)E.stopAnimate();else if(++z==S||!E.isAnimated())G.cancel(),E.animationTimers.delete(G),E.decAnim();else{var W=n-(new Date().getTime()-I.getTime());W=W>0?W:0,E.animationTimers.delete(G),G=new P.PausableTimer(B,W,a),E.animationTimers.add(G)}},G=new P.PausableTimer(B,0,a),this.animationTimers.add(G),this}stopAnimate(){return this.animated=0,this.animationTimers.forEach(function(e){e.cancel()}),this.animationTimers=new Set,this}pauseAnimate(){return this.animationTimers.forEach(function(e){e.pause()}),this}resumeAnimate(){return this.animationTimers.forEach(function(e){e.resume()}),this}isAnimated(){return this.animated>0}getModelOpt(e){return e&&!e.defaultcolors?(e.defaultcolors=this.defaultcolors,e.cartoonQuality=e.cartoonQuality||this.config.cartoonQuality):typeof e>"u"&&(e={defaultcolors:this.defaultcolors,cartoonQuality:this.config.cartoonQuality}),e}addModel(e,n="",a){a=this.getModelOpt(a);var g=new y.GLModel(this.models.length,a);return g.addMolData(e,n,a),this.models.push(g),g}addModels(e,n,a){a=this.getModelOpt(a),a.multimodel=!0,a.frames=!0;for(var g=y.GLModel.parseMolData(e,n,a),f=0;f<g.length;f++){var E=new y.GLModel(this.models.length,a);E.setAtomDefaults(g[f]),E.addFrame(g[f]),E.setFrame(0),g.modelData&&E.setModelData(g.modelData[f]),E.setDontDuplicateAtoms(!a.duplicateAssemblyAtoms),this.models.push(E)}return this.models}addModelsAsFrames(e,n,a){a=this.getModelOpt(a),a.multimodel=!0,a.frames=!0;var g=new y.GLModel(this.models.length,a);return g.addMolData(e,n,a),this.models.push(g),g}addAsOneMolecule(e,n,a){a=this.getModelOpt(a),a.multimodel=!0,a.onemol=!0;var g=new y.GLModel(this.models.length,a);return g.addMolData(e,n,a),this.models.push(g),g}removeModel(e){if(e=this.getModel(e),!!e){for(e.removegl(this.modelGroup),delete this.models[e.getID()];this.models.length>0&&typeof this.models[this.models.length-1]>"u";)this.models.pop();return this}}removeAllModels(){for(var e=0;e<this.models.length;e++){var n=this.models[e];n&&n.removegl(this.modelGroup)}return this.models.splice(0,this.models.length),this}exportJSON(e,n){var a={};return n===void 0?a.m=this.models.map(function(g){return g.toCDObject(e)}):a.m=[this.models[n].toCDObject()],JSON.stringify(a)}exportVRML(){var e=this.modelGroup;this.applyToModels("removegl",this.modelGroup),this.modelGroup=new A.Object3D,this.render(null,{supportsImposters:!1,supportsAIA:!1,regen:!0});var n=`#VRML V2.0 utf8
`+this.modelGroup.vrml()+`
`;return this.applyToModels("removegl",this.modelGroup),this.modelGroup=e,n}createModelFrom(e,n=!1){for(var a=new y.GLModel(this.models.length,this.defaultcolors),g=0;g<this.models.length;g++)if(this.models[g]){var f=this.models[g].selectedAtoms(e);a.addAtoms(f),n&&this.models[g].removeAtoms(f)}return this.models.push(a),a}applyToModels(e,n,a,g,f,E,w){for(var R=this.getModelList(n),z=0;z<R.length;z++)R[z][e](n,a,g,f,E,w)}setStyle(e,n){return typeof n>"u"&&(n=e,e={}),this.applyToModels("setStyle",e,n,!1),this}addStyle(e,n){return typeof n>"u"&&(n=e,e={}),this.applyToModels("setStyle",e,n,!0),this}setClickable(e,n,a){return this.applyToModels("setClickable",e,n,a),this}setHoverable(e,n,a,g){return this.applyToModels("setHoverable",e,n,a,g),this}enableContextMenu(e,n){return this.applyToModels("enableContextMenu",e,n),this}vibrate(e,n,a,g){return this.applyToModels("vibrate",e,n,a,this,g),this}setColorByProperty(e,n,a,g){return this.applyToModels("setColorByProperty",e,n,a,g),this}setColorByElement(e,n){return this.applyToModels("setColorByElement",e,n),this}static getAtomsWithin(e,n){var a=[];for(let f=0;f<e.length;f++){var g=e[f];typeof g>"u"||g.x<n[0][0]||g.x>n[1][0]||g.y<n[0][1]||g.y>n[1][1]||g.z<n[0][2]||g.z>n[1][2]||a.push(g)}return a}static volume(e){var n=e[1][0]-e[0][0],a=e[1][1]-e[0][1],g=e[1][2]-e[0][2];return n*a*g}carveUpExtent(e,n,a){let g=[],f={};for(let I=0,F=n.length;I<F;I++)f[n[I].index]=I;let E=function(I){let F=[];for(let G=0,B=I.length;G<B;G++)I[G].index in f&&F.push(f[I[G].index]);return F},w=function(I){let F=[];return F[0]=[I[0][0],I[0][1],I[0][2]],F[1]=[I[1][0],I[1][1],I[1][2]],F},R=function(I){if(t.volume(I)<t.maxVolume)return[I];var F=I[1][0]-I[0][0],G=I[1][1]-I[0][1],B=I[1][2]-I[0][2],W;F>G&&F>B?W=0:G>F&&G>B?W=1:W=2;var V=w(I),k=w(I),U=(I[1][W]-I[0][W])/2+I[0][W];V[1][W]=U,k[0][W]=U;var j=R(V),q=R(k);return j.concat(q)},z=R(e),S=6;for(let I=0,F=z.length;I<F;I++){let G=w(z[I]);G[0][0]-=S,G[0][1]-=S,G[0][2]-=S,G[1][0]+=S,G[1][1]+=S,G[1][2]+=S;let B=t.getAtomsWithin(n,G),W=t.getAtomsWithin(a,z[I]);g.push({extent:z[I],atoms:E(B),toshow:E(W)})}return g}static generateSurfaceMesh(e,n,a){var g=new A.Geometry(!0),f=g.updateGeoGroup(0),E=[];for(let be=0,Pe=e.length;be<Pe;be++){var w=e[be];w&&(typeof w.surfaceColor<"u"?E[be]=w.surfaceColor:w.color&&(E[be]=D.CC.color(w.color)))}var R=f.vertexArray,z=n.vertices;for(let be=0,Pe=z.length;be<Pe;be++){let ce=f.vertices*3;R[ce]=z[be].x,R[ce+1]=z[be].y,R[ce+2]=z[be].z,f.vertices++}var S=f.colorArray;if(a.voldata&&a.volscheme){var I=a.volscheme,F=a.voldata,G=I.range()||[-1,1];for(let be=0,Pe=z.length;be<Pe;be++){let ce=F.getVal(z[be].x,z[be].y,z[be].z),me=D.CC.color(I.valueToHex(ce,G)),De=be*3;S[De]=me.r,S[De+1]=me.g,S[De+2]=me.b}}else if(E.length>0)for(let be=0,Pe=z.length;be<Pe;be++){let ce=z[be].atomid,me=be*3;S[me]=E[ce].r,S[me+1]=E[ce].g,S[me+2]=E[ce].b}var B=n.faces;f.faceidx=B.length,g.initTypedArrays();var W=f.vertexArray,V=f.normalArray,k,U,j,q;for(let be=0,Pe=B.length;be<Pe;be+=3){var ie=B[be],ge=B[be+1],he=B[be+2],ve=ie*3,le=ge*3,se=he*3;k=new T.Vector3(W[ve],W[ve+1],W[ve+2]),U=new T.Vector3(W[le],W[le+1],W[le+2]),j=new T.Vector3(W[se],W[se+1],W[se+2]),j.subVectors(j,U),k.subVectors(k,U),j.cross(k),q=j,q.normalize(),V[ve]+=q.x,V[le]+=q.x,V[se]+=q.x,V[ve+1]+=q.y,V[le+1]+=q.y,V[se+1]+=q.y,V[ve+2]+=q.z,V[le+2]+=q.z,V[se+2]+=q.z}f.faceArray=new Uint16Array(B);var Me=new A.Mesh(g,a);return Me}static generateMeshSyncHelper(e,n,a,g,f,E){var w=new _.ProteinSurface;return w.initparm(n,e!==1,E),w.fillvoxels(f,a),w.buildboundary(),(e==_.SurfaceType.SES||e==_.SurfaceType.MS)&&(w.fastdistancemap(),w.boundingatom(!1),w.fillvoxelswaals(f,a)),w.marchingcube(e),w.getFacesAndVertices(g)}static getMatWithStyle(e){var n=new A.MeshLambertMaterial;n.vertexColors=A.Coloring.VertexColors;for(var a in e)a==="color"||a==="map"||e.hasOwnProperty(a)&&(n[a]=e[a]);return e.opacity!==void 0&&(e.opacity===1?n.transparent=!1:n.transparent=!0),n}addMesh(e){var n={geo:e.geometry,mat:e.material,done:!0,finished:!1},a=this.nextSurfID();return this.surfaces[a]=n,a}static shallowCopy(e){var n=[];let a=e.length;for(let g=0;g<a;g++)n[g]=(0,P.extend)({},e[g]);return n}addSurface(e,n={},a={},g,f,E){let w=this.nextSurfID(),R=null,z=this,S=_.SurfaceType.VDW;typeof e=="string"?t.surfaceTypeMap[e.toUpperCase()]!==void 0?S=t.surfaceTypeMap[e]:console.log("Surface type : "+e+" is not recognized"):typeof e=="number"&&(S=e);var I=null,F=null,G=t.shallowCopy(this.getAtomsFromSel(a));g?I=t.shallowCopy(this.getAtomsFromSel(g)):I=G,(0,P.adjustVolumeStyle)(n);var B=!1,W;for(W=0;W<this.models.length;W++)if(this.models[W]){var V=this.models[W].getSymmetries();if(V.length>1||V.length==1&&!V[0].isIdentity()){B=!0;break}}var k=function(ve,le,se){f?F=t.shallowCopy(z.getAtomsFromSel(f)):F=se;var Me,be=(0,P.getExtent)(se,!0);if(n.map&&n.map.prop){var Pe=n.map.prop;let We=(0,u.getGradient)(n.map.scheme||n.map.gradient||new u.Gradient.RWB),Fe=We.range();Fe||(Fe=(0,P.getPropertyRange)(se,Pe)),n.colorscheme={prop:Pe,gradient:We}}for(let We=0,Fe=le.length;We<Fe;We++)Me=le[We],Me.surfaceColor=(0,P.getColorFromStyle)(Me,n);var ce=t.volume(be),me=z.carveUpExtent(be,le,se);if(F&&F.length&&F.length>0){var De=(0,P.getExtent)(F,!0),Se=function(We,Fe){var $e=function(Z,J){var ae=Z.extent,de=ae[1][0]-ae[0][0],Ee=ae[1][1]-ae[0][1],we=ae[1][2]-ae[0][2],H=de-J[2][0];H*=H;var fe=Ee-J[2][1];fe*=fe;var xe=we-J[2][2];return xe*=xe,H+fe+xe},Ye=$e(We,De),$=$e(Fe,De);return Ye-$};me.sort(Se)}var Ge=[];for(let We=0,Fe=le.length;We<Fe;We++)Me=le[We],Ge[We]={x:Me.x,y:Me.y,z:Me.z,serial:We,elem:Me.elem};var ke=!!_.syncSurface;if(ke){var ze=function(Fe){return new Promise(function($e){for(var Ye=t.generateMeshSyncHelper(S,me[Fe].extent,me[Fe].atoms,me[Fe].toshow,Ge,ce),$=(0,v.splitMesh)({vertexArr:Ye.vertices,faceArr:Ye.faces}),Z=0,J=$.length;Z<J;Z++){Ye={vertices:$[Z].vertexArr,faces:$[Z].faceArr};var ae=t.generateSurfaceMesh(le,Ye,R);(0,P.mergeGeos)(ve.geo,ae)}z.render(),$e()})},Re=[];for(let We=0;We<me.length;We++)Re.push(ze(We));return Promise.all(Re).then(function(){return ve.done=!0,Promise.resolve(w)})}else{var Be=[];S<0&&(S=0);for(let We=0,Fe=t.numWorkers;We<Fe;We++){var Ie=new Worker($3Dmol.SurfaceWorker);Be.push(Ie),Ie.postMessage({type:-1,atoms:Ge,volume:ce})}return new Promise(function(We,Fe){var $e=0,Ye=function(){!Be||!Be.length||Be.forEach(function(ae){ae&&ae.terminate&&ae.terminate()})},$=function(ae){for(var de=(0,v.splitMesh)({vertexArr:ae.data.vertices,faceArr:ae.data.faces}),Ee=0,we=de.length;Ee<we;Ee++){var H={vertices:de[Ee].vertexArr,faces:de[Ee].faceArr},fe=t.generateSurfaceMesh(le,H,R);(0,P.mergeGeos)(ve.geo,fe)}z.render(),$e++,$e==me.length&&(ve.done=!0,Ye(),We(w))},Z=function(ae){Ye(),console.log(ae.message+" ("+ae.filename+":"+ae.lineno+")"),Fe(ae)};for(let ae=0;ae<me.length;ae++){var J=Be[ae%Be.length];J.onmessage=$,J.onerror=Z,J.postMessage({type:S,expandedExtent:me[ae].extent,extendedAtoms:me[ae].atoms,atomsToShow:me[ae].toshow})}})}};n=n||{},R=t.getMatWithStyle(n);var U=[];U.style=n,U.atomsel=a,U.allsel=g,U.focus=f;var j=null;if(B){var q={},ie={};for(W=0;W<this.models.length;W++)q[W]=[],ie[W]=[];for(W=0;W<I.length;W++)q[I[W].model].push(I[W]);for(W=0;W<G.length;W++)ie[G[W].model].push(G[W]);var ge=[];for(W=0;W<this.models.length;W++)ie[W].length>0&&(U.push({geo:new A.Geometry(!0),mat:R,done:!1,finished:!1,symmetries:this.models[W].getSymmetries()}),ge.push(k(U[U.length-1],q[W],ie[W])));j=Promise.all(ge)}else U.push({geo:new A.Geometry(!0),mat:R,done:!1,finished:!1,symmetries:[new T.Matrix4]}),j=k(U[U.length-1],I,G);return this.surfaces[w]=U,j.surfid=w,E&&typeof E=="function"?(j.then(function(he){E(he)}),w):j}setSurfaceMaterialStyle(e,n){if((0,P.adjustVolumeStyle)(n),this.surfaces[e]){var a=this.surfaces[e];a.style=n;for(var g=0;g<a.length;g++){var f=a[g].mat=t.getMatWithStyle(n);if(a[g].mat.side=A.FrontSide,n.color){a[g].mat.color=n.color,a[g].geo.colorsNeedUpdate=!0;const E=D.CC.color(n.color);a[g].geo.setColors(function(){return E})}else if(f.voldata&&f.volscheme){const E=f.volscheme,w=f.voldata,R=D.CC,z=E.range()||[-1,1];a[g].geo.setColors(function(S,I,F){let G=w.getVal(S,I,F);return R.color(E.valueToHex(G,z))})}a[g].finished=!1}}return this}getSurface(e){return this.surfaces[e]}removeSurface(e){for(var n=this.surfaces[e],a=0;a<n.length;a++)n[a]&&n[a].lastGL&&(n[a].geo!==void 0&&n[a].geo.dispose(),n[a].mat!==void 0&&n[a].mat.dispose(),this.modelGroup.remove(n[a].lastGL));return delete this.surfaces[e],this.show(),this}removeAllSurfaces(){for(var e in this.surfaces)if(this.surfaces.hasOwnProperty(e)){for(var n=this.surfaces[e],a=0;a<n.length;a++)n[a]&&n[a].lastGL&&(n[a].geo!==void 0&&n[a].geo.dispose(),n[a].mat!==void 0&&n[a].mat.dispose(),this.modelGroup.remove(n[a].lastGL));delete this.surfaces[e]}return this.show(),this}jmolMoveTo(){var e=this.modelGroup.position,n="center { "+-e.x+" "+-e.y+" "+-e.z+" }; ",a=this.rotationGroup.quaternion;return n+="moveto .5 quaternion { "+a.x+" "+a.y+" "+a.z+" "+a.w+" };",n}clear(){return this.removeAllSurfaces(),this.removeAllModels(),this.removeAllLabels(),this.removeAllShapes(),this.show(),this}mapAtomProperties(e,n){n=n||{};var a=this.getAtomsFromSel(n);if(typeof e=="function")for(let E=0,w=a.length;E<w;E++){let R=a[E];e(R)}else for(let E=0,w=a.length;E<w;E++){var g=a[E];for(let R=0,z=e.length;R<z;R++){let S=e[R];if(S.props)for(var f in S.props)S.props.hasOwnProperty(f)&&this.atomIsSelected(g,S)&&(g.properties||(g.properties={}),g.properties[f]=S.props[f])}}return this}linkViewer(e){return this.linkedViewers.push(e),this}getPerceivedDistance(){return this.CAMERA_Z-this.rotationGroup.position.z}setPerceivedDistance(e){this.rotationGroup.position.z=this.CAMERA_Z-e}setAutoEyeSeparation(e,n){var a=this.getPerceivedDistance();return n||(n=5),e||this.camera.position.x>0?this.camera.position.x=a*Math.tan(Math.PI/180*n):this.camera.position.x=-a*Math.tan(Math.PI/180*n),this.camera.lookAt(new T.Vector3(0,0,this.rotationGroup.position.z)),this.camera.position.x}setDefaultCartoonQuality(e){this.config.cartoonQuality=e}}t.numWorkers=4,t.maxVolume=64e3,t.surfaceTypeMap={VDW:_.SurfaceType.VDW,MS:_.SurfaceType.MS,SAS:_.SurfaceType.SAS,SES:_.SurfaceType.SES};function r(o,e){if(o=(0,P.getElement)(o),!!o){e=e||{};try{var n=new t(o,e);return n}catch(a){throw"error creating viewer: "+a}}}function h(o,e={},n={}){if(o=(0,P.getElement)(o),!!o){var a=[],g=document.createElement("canvas");n.rows=e.rows,n.cols=e.cols,n.control_all=e.control_all!=null?e.control_all:!1,o.appendChild(g);try{for(var f=0;f<e.rows;f++){for(var E=[],w=0;w<e.cols;w++){n.row=f,n.col=w,n.canvas=g,n.viewers=a,n.control_all=e.control_all;var R=r(o,(0,P.extend)({},n));E.push(R)}a.unshift(E)}}catch(z){throw"error creating viewer grid: "+z}return a}}function s(o){var e=this;if(o=(0,P.getElement)(o),!!o){var n=h(o,{rows:1,cols:2,control_all:!0});this.glviewer1=n[0][0],this.glviewer2=n[0][1],this.glviewer1.setAutoEyeSeparation(!1),this.glviewer2.setAutoEyeSeparation(!0),this.glviewer1.linkViewer(this.glviewer2),this.glviewer2.linkViewer(this.glviewer1);for(var a=Object.getOwnPropertyNames(this.glviewer1.__proto__).filter(function(f){return typeof e.glviewer1[f]=="function"}),g=0;g<a.length;g++)this[a[g]]=function(f){return function(){var E=this.glviewer1[f].apply(this.glviewer1,arguments),w=this.glviewer2[f].apply(this.glviewer2,arguments);return[E,w]}}(a[g]);this.setCoordinates=function(f,E,w){for(var R=0;R<f.length;R++)f[R].setCoordinates(E,w)},this.surfacesFinished=function(){return this.glviewer1.surfacesFinished()&&this.glviewer2.surfacesFinished()},this.isAnimated=function(){return this.glviewer1.isAnimated()||this.glviewer2.isAnimated()},this.render=function(f){this.glviewer1.render(),this.glviewer2.render(),f&&f(this)},this.getCanvas=function(){return this.glviewer1.getCanvas()}}}},"./src/Gradient.ts":(X,L,c)=>{c.r(L),c.d(L,{CustomLinear:()=>v,Gradient:()=>_,GradientType:()=>T,ROYGB:()=>y,RWB:()=>u,Sinebow:()=>C,builtinGradients:()=>M,getGradient:()=>P,normalizeValue:()=>D});var A=c("./src/colors.ts");class T{}function D(p,x,t){return x>=p?(t<p&&(t=p),t>x&&(t=x),{lo:p,hi:x,val:t}):(t>p&&(t=p),t<x&&(t=x),t=p-t+x,{lo:x,hi:p,val:t})}function P(p){if(p instanceof T)return p;if(p.gradient!==void 0&&M[p.gradient]){let x=p.min===void 0?-1:p.min,t=p.max===void 0?1:p.max;return p.mid===void 0?p.colors===void 0?new M[p.gradient](x,t):new M[p.gradient](x,t,p.colors):new M[p.gradient](x,t,p.mid)}return p}class u extends T{constructor(x,t,r){super(),this.gradient="RWB",this.mult=1,this.mid=r,this.min=x,this.max=t,typeof t>"u"&&Array.isArray(x)&&x.length>=2?(this.max=x[1],this.min=x[0]):x&&t&&!Array.isArray(x)&&(this.min=x,this.max=t)}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}valueToHex(x,t){var r,h;if(x=this.mult*x,t?(r=t[0],h=t[1]):(r=this.min,h=this.max),x===void 0)return 16777215;var s=D(r,h,x);r=s.lo,h=s.hi,x=s.val;var o=(h+r)/2;t&&typeof t[2]<"u"?o=t[2]:typeof this.mid<"u"?o=this.mid:o=(r+h)/2;var e,n;return x<o?(e=Math.floor(255*Math.sqrt((x-r)/(o-r))),n=16711680+256*e+e,n):x>o?(e=Math.floor(255*Math.sqrt(1-(x-o)/(h-o))),n=65536*e+256*e+255,n):16777215}}class y extends T{constructor(x,t){super(),this.gradient="ROYGB",this.mult=1,this.min=x,this.max=t,typeof t>"u"&&Array.isArray(x)&&x.length>=2?(this.max=x[1],this.min=x[0]):x&&t&&!Array.isArray(x)&&(this.min=x,this.max=t)}valueToHex(x,t){var r,h;if(x=this.mult*x,t?(r=t[0],h=t[1]):(r=this.min,h=this.max),typeof x>"u")return 16777215;var s=D(r,h,x);r=s.lo,h=s.hi,x=s.val;var o=(r+h)/2,e=(r+o)/2,n=(o+h)/2,a,g;return x<e?(a=Math.floor(255*Math.sqrt((x-r)/(e-r))),g=16711680+256*a+0,g):x<o?(a=Math.floor(255*Math.sqrt(1-(x-e)/(o-e))),g=65536*a+65280+0,g):x<n?(a=Math.floor(255*Math.sqrt((x-o)/(n-o))),g=65280+1*a,g):(a=Math.floor(255*Math.sqrt(1-(x-n)/(h-n))),g=0+256*a+255,g)}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}}class C extends T{constructor(x,t){super(),this.gradient="Sinebow",this.mult=1,this.min=x,this.max=t,typeof t>"u"&&Array.isArray(x)&&x.length>=2&&(this.max=x[1],this.min=x[0]),t<x&&(this.mult=-1,this.min*=-1,this.max*=-1)}valueToHex(x,t){var r,h;if(x=this.mult*x,t?(r=t[0],h=t[1]):(r=this.min,h=this.max),typeof x>"u")return 16777215;var s=_.normalizeValue(r,h,x);r=s.lo,h=s.hi,x=s.val;var o=(x-r)/(h-r),e=5*o/6+.5,n=Math.sin(Math.PI*e);n*=n*255;var a=Math.sin(Math.PI*(e+1/3));a*=a*255;var g=Math.sin(Math.PI*(e+2/3));return g*=g*255,65536*Math.floor(n)+256*Math.floor(g)+1*Math.floor(a)}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}}class v extends T{constructor(x,t,r){super(),this.gradient="linear",this.colors=new Array;var h;if(Array.isArray(x)&&x.length>=2?(this.max=x[1],this.min=x[0],h=t):(this.min=x,this.max=t,h=r),h)for(let s of h)this.colors.push(A.CC.color(s));else this.colors.push(A.CC.color(0))}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}valueToHex(x,t){var r,h;if(t?(r=t[0],h=t[1]):(r=this.min,h=this.max),x===void 0)return 16777215;var s=D(r,h,x);r=s.lo,h=s.hi,x=s.val;let o=this.colors.length,e=(h-r)/o,n=Math.min(Math.floor((x-r)/e),o-1),a=Math.min(n+1,o-1),g=(x-r-n*e)/e,f=this.colors[n],E=this.colors[a];return new A.Color(f.r+g*(E.r-f.r),f.g+g*(E.g-f.g),f.b+g*(E.b-f.b)).getHex()}}const M={rwb:u,RWB:u,roygb:y,ROYGB:y,sinebow:C,linear:v};class _ extends T{valueToHex(x,t){return 0}range(){return null}}_.RWB=u,_.ROYGB=y,_.Sinebow=C,_.CustomLinear=v,_.builtinGradients=M,_.normalizeValue=D,_.getGradient=P},"./src/Label.ts":(X,L,c)=>{c.r(L),c.d(L,{Label:()=>C,LabelCount:()=>P});var A=c("./src/WebGL/index.ts"),T=c("./src/Gradient.ts"),D=c("./src/colors.ts");let P=0;function u(v,M,_,p,x,t,r){v.beginPath(),v.moveTo(M+t,_),v.lineTo(M+p-t,_),v.quadraticCurveTo(M+p,_,M+p,_+t),v.lineTo(M+p,_+x-t),v.quadraticCurveTo(M+p,_+x,M+p-t,_+x),v.lineTo(M+t,_+x),v.quadraticCurveTo(M,_+x,M,_+x-t),v.lineTo(M,_+t),v.quadraticCurveTo(M,_,M+t,_),v.closePath(),v.fill(),r&&v.stroke()}function y(v,M,_){var p=_;return typeof v<"u"&&(v instanceof D.Color?p=v.scaled():(p=D.CC.color(v),typeof p.scaled<"u"&&(p=p.scaled()))),typeof M<"u"&&(p.a=parseFloat(M)),p}class C{constructor(M,_){this.id=P++,this.stylespec=_||{},this.canvas=document.createElement("canvas"),this.canvas.width=134,this.canvas.height=35,this.context=this.canvas.getContext("2d"),this.sprite=new A.Sprite,this.text=M,this.frame=this.stylespec.frame}getStyle(){return this.stylespec}setContext(){var M=this.stylespec,_=typeof M.useScreen>"u"?!1:M.useScreen,p=M.showBackground;(p==="0"||p==="false")&&(p=!1),typeof p>"u"&&(p=!0);var x=M.font?M.font:"sans-serif",t=parseInt(M.fontSize)?parseInt(M.fontSize):18,r=y(M.fontColor,M.fontOpacity,{r:255,g:255,b:255,a:1}),h=M.padding?M.padding:4,s=M.borderThickness?M.borderThickness:0,o=y(M.backgroundColor,M.backgroundOpacity,{r:0,g:0,b:0,a:1}),e=y(M.borderColor,M.borderOpacity,o),n=M.position?M.position:{x:-10,y:1,z:1},a=M.inFront!==void 0?M.inFront:!0;(a==="false"||a==="0")&&(a=!1);var g=M.alignment||A.SpriteAlignment.topLeft;typeof g=="string"&&g in A.SpriteAlignment&&(g=A.SpriteAlignment[g]);var f="";M.bold&&(f="bold "),this.context.font=f+t+"px  "+x;var E=this.context.measureText(this.text),w=E.width;p||(s=0);var R=w+2.5*s+2*h,z=t*1.25+2*s+2*h;if(M.backgroundImage){var S=M.backgroundImage,I=M.backgroundWidth?M.backgroundWidth:S.width,F=M.backgroundHeight?M.backgroundHeight:S.height;I>R&&(R=I),F>z&&(z=F)}if(this.canvas.width=R,this.canvas.height=z,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),f="",M.bold&&(f="bold "),this.context.font=f+t+"px  "+x,this.context.fillStyle="rgba("+o.r+","+o.g+","+o.b+","+o.a+")",this.context.strokeStyle="rgba("+e.r+","+e.g+","+e.b+","+e.a+")",M.backgroundGradient){let B=this.context.createLinearGradient(0,z/2,R,z/2),W=T.Gradient.getGradient(M.backgroundGradient),V=W.range(),k=-1,U=1;V&&(k=V[0],U=V[1]);let j=U-k;for(let q=0;q<1.01;q+=.1){let ie=y(W.valueToHex(k+j*q)),ge="rgba("+ie.r+","+ie.g+","+ie.b+","+ie.a+")";B.addColorStop(q,ge)}this.context.fillStyle=B}this.context.lineWidth=s,p&&u(this.context,s,s,R-2*s,z-2*s,6,s>0),M.backgroundImage&&this.context.drawImage(S,0,0,R,z),this.context.fillStyle="rgba("+r.r+","+r.g+","+r.b+","+r.a+")",this.context.fillText(this.text,s+h,t+s+h,w);var G=new A.Texture(this.canvas);G.needsUpdate=!0,this.sprite.material=new A.SpriteMaterial({map:G,useScreenCoordinates:_,alignment:g,depthTest:!a,screenOffset:M.screenOffset||null}),this.sprite.scale.set(1,1,1),this.sprite.position.set(n.x,n.y,n.z)}dispose(){this.sprite.material.map!==void 0&&this.sprite.material.map.dispose(),this.sprite.material!==void 0&&this.sprite.material.dispose()}}},"./src/ProteinSurface4.ts":(X,L,c)=>{c.r(L),c.d(L,{MarchingCube:()=>y,MarchingCubeInitializer:()=>u,PointGrid:()=>C,ProteinSurface:()=>v,SurfaceType:()=>T,setSyncSurface:()=>P,syncSurface:()=>D});var A=c("./src/WebGL/math/index.ts"),T;(function(M){M[M.VDW=1]="VDW",M[M.MS=2]="MS",M[M.SAS=3]="SAS",M[M.SES=4]="SES"})(T||(T={}));var D=!1;function P(M){D=M}(window.navigator.userAgent.indexOf("MSIE ")>=0||window.navigator.userAgent.indexOf("Trident/")>=0)&&(D=!0);class u{constructor(){this.ISDONE=2,this.edgeTable=new Uint32Array([0,0,0,0,0,0,0,2816,0,0,0,1792,0,3328,3584,3840,0,0,0,138,0,21,0,134,0,0,0,652,0,2067,3865,3600,0,0,0,42,0,0,0,294,0,0,21,28,0,3875,1049,3360,0,168,162,170,0,645,2475,2210,0,687,293,172,4010,3747,3497,3232,0,0,0,0,0,69,0,900,0,0,0,1792,138,131,1608,1920,0,81,0,2074,84,85,84,86,0,81,0,3676,330,1105,1881,1616,0,0,0,42,0,69,0,502,0,0,21,3580,138,2035,1273,1520,2816,104,2337,106,840,581,367,102,2816,3695,3429,3180,1898,1635,1385,1120,0,0,0,0,0,0,0,3910,0,0,69,588,42,2083,41,2880,0,0,0,1722,0,2293,4095,3830,0,255,757,764,2538,2291,3065,2800,0,0,81,338,0,3925,1119,3414,84,855,85,340,2130,2899,89,2384,1792,712,194,1162,4036,3781,3535,3270,708,719,197,204,3018,2755,2505,2240,0,0,0,0,168,420,168,1958,162,162,676,2988,170,163,680,928,3328,3096,3328,3642,52,53,1855,1590,2340,2111,2869,2620,298,51,825,560,3584,3584,3090,3482,1668,1941,1183,1430,146,2975,2069,2460,154,915,153,400,3840,3592,3329,3082,1796,1541,1295,1030,2818,2575,2309,2060,778,515,265,0]),this.triTable=[[],[],[],[],[],[],[],[11,9,8],[],[],[],[8,10,9],[],[10,8,11],[9,11,10],[8,10,9,8,11,10],[],[],[],[1,7,3],[],[4,2,0],[],[2,1,7],[],[],[],[2,7,3,2,9,7],[],[1,4,11,1,0,4],[3,8,0,11,9,4,11,10,9],[4,11,9,11,10,9],[],[],[],[5,3,1],[],[],[],[2,5,8,2,1,5],[],[],[2,4,0],[3,2,4],[],[0,9,1,8,10,5,8,11,10],[3,4,0,3,10,4],[5,8,10,8,11,10],[],[3,5,7],[7,1,5],[1,7,3,1,5,7],[],[9,2,0,9,7,2],[0,3,8,1,7,11,1,5,7],[11,1,7,1,5,7],[],[9,1,0,5,3,2,5,7,3],[8,2,5,8,0,2],[2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[],[],[],[],[],[0,6,2],[],[7,2,9,7,9,8],[],[],[],[8,10,9],[7,1,3],[7,1,0],[6,9,3,6,10,9],[7,10,8,10,9,8],[],[6,0,4],[],[11,1,4,11,3,1],[2,4,6],[2,0,4,2,4,6],[2,4,6],[1,4,2,4,6,2],[],[6,0,4],[],[2,11,3,6,9,4,6,10,9],[8,6,1,8,1,3],[10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[],[],[],[5,3,1],[],[0,6,2],[],[7,4,8,5,2,1,5,6,2],[],[],[2,4,0],[7,4,8,2,11,3,10,5,6],[7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[9,11,8],[3,5,6],[0,5,11,0,11,8],[6,3,5,3,1,5],[3,9,6,3,8,9],[9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[],[],[],[],[],[],[],[1,10,2,9,11,6,9,8,11],[],[],[6,0,2],[3,6,9,3,2,6],[3,5,1],[0,5,1,0,11,5],[0,3,5],[6,9,11,9,8,11],[],[],[],[4,5,9,7,1,10,7,3,1],[],[11,6,7,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[],[],[0,6,4],[8,6,4,8,1,6],[],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[4,2,6],[1,0,9,2,4,8,2,6,4],[2,4,0,2,6,4],[8,2,4,2,6,4],[11,4,1,11,6,4],[0,9,1,4,11,6,4,8,11],[3,6,0,6,4,0],[8,6,4,8,11,6],[10,8,9],[6,3,9,6,7,3],[6,7,1],[10,7,1,7,3,1],[7,11,6,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2],[1,0,9,3,6,7,3,2,6],[7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[],[],[],[],[5,3,7],[8,5,2,8,7,5],[5,3,7],[1,10,2,5,8,7,5,9,8],[1,7,5],[1,7,5],[9,2,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[0,7,1,7,5,1],[9,3,5,3,7,5],[9,7,5,9,8,7],[8,10,11],[3,4,10,3,10,11],[8,10,11],[5,9,4,1,11,3,1,10,11],[2,4,5],[5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[2,8,5,2,11,8],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[11,9,10],[11,9,10],[1,11,4,1,10,11],[8,7,4,11,1,10,11,3,1],[2,7,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[1,7,4],[3,2,11,4,8,7,9,1,0],[11,4,2,4,0,2],[2,11,3,7,4,8],[4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[3,9,11,9,10,11],[0,10,8,10,11,8],[10,3,1,10,11,3],[2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]],this.edgeTable2=[0,265,515,778,2060,2309,2575,2822,1030,1295,1541,1804,3082,3331,3593,3840,400,153,915,666,2460,2197,2975,2710,1430,1183,1941,1692,3482,3219,3993,3728,560,825,51,314,2620,2869,2111,2358,1590,1855,1077,1340,3642,3891,3129,3376,928,681,419,170,2988,2725,2479,2214,1958,1711,1445,1196,4010,3747,3497,3232,2240,2505,2755,3018,204,453,719,966,3270,3535,3781,4044,1226,1475,1737,1984,2384,2137,2899,2650,348,85,863,598,3414,3167,3925,3676,1370,1107,1881,1616,2800,3065,2291,2554,764,1013,255,502,3830,4095,3317,3580,1786,2035,1273,1520,2912,2665,2403,2154,876,613,367,102,3942,3695,3429,3180,1898,1635,1385,1120,1120,1385,1635,1898,3180,3429,3695,3942,102,367,613,876,2154,2403,2665,2912,1520,1273,2035,1786,3580,3317,4095,3830,502,255,1013,764,2554,2291,3065,2800,1616,1881,1107,1370,3676,3925,3167,3414,598,863,85,348,2650,2899,2137,2384,1984,1737,1475,1226,4044,3781,3535,3270,966,719,453,204,3018,2755,2505,2240,3232,3497,3747,4010,1196,1445,1711,1958,2214,2479,2725,2988,170,419,681,928,3376,3129,3891,3642,1340,1077,1855,1590,2358,2111,2869,2620,314,51,825,560,3728,3993,3219,3482,1692,1941,1183,1430,2710,2975,2197,2460,666,915,153,400,3840,3593,3331,3082,1804,1541,1295,1030,2822,2575,2309,2060,778,515,265,0],this.triTable2=[[],[8,3,0],[9,0,1],[8,3,1,8,1,9],[11,2,3],[11,2,0,11,0,8],[11,2,3,0,1,9],[2,1,11,1,9,11,11,9,8],[10,1,2],[8,3,0,1,2,10],[9,0,2,9,2,10],[3,2,8,2,10,8,8,10,9],[10,1,3,10,3,11],[1,0,10,0,8,10,10,8,11],[0,3,9,3,11,9,9,11,10],[8,10,9,8,11,10],[8,4,7],[3,0,4,3,4,7],[1,9,0,8,4,7],[9,4,1,4,7,1,1,7,3],[2,3,11,7,8,4],[7,11,4,11,2,4,4,2,0],[3,11,2,4,7,8,9,0,1],[2,7,11,2,1,7,1,4,7,1,9,4],[10,1,2,8,4,7],[2,10,1,0,4,7,0,7,3],[4,7,8,0,2,10,0,10,9],[2,7,3,2,9,7,7,9,4,2,10,9],[8,4,7,11,10,1,11,1,3],[11,4,7,1,4,11,1,11,10,1,0,4],[3,8,0,7,11,4,11,9,4,11,10,9],[7,11,4,4,11,9,11,10,9],[9,5,4],[3,0,8,4,9,5],[5,4,0,5,0,1],[4,8,5,8,3,5,5,3,1],[11,2,3,9,5,4],[9,5,4,8,11,2,8,2,0],[3,11,2,1,5,4,1,4,0],[8,5,4,2,5,8,2,8,11,2,1,5],[2,10,1,9,5,4],[0,8,3,5,4,9,10,1,2],[10,5,2,5,4,2,2,4,0],[3,4,8,3,2,4,2,5,4,2,10,5],[5,4,9,1,3,11,1,11,10],[0,9,1,4,8,5,8,10,5,8,11,10],[3,4,0,3,10,4,4,10,5,3,11,10],[4,8,5,5,8,10,8,11,10],[9,5,7,9,7,8],[0,9,3,9,5,3,3,5,7],[8,0,7,0,1,7,7,1,5],[1,7,3,1,5,7],[11,2,3,8,9,5,8,5,7],[9,2,0,9,7,2,2,7,11,9,5,7],[0,3,8,2,1,11,1,7,11,1,5,7],[2,1,11,11,1,7,1,5,7],[1,2,10,5,7,8,5,8,9],[9,1,0,10,5,2,5,3,2,5,7,3],[5,2,10,8,2,5,8,5,7,8,0,2],[10,5,2,2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[11,7,6],[0,8,3,11,7,6],[9,0,1,11,7,6],[7,6,11,3,1,9,3,9,8],[2,3,7,2,7,6],[8,7,0,7,6,0,0,6,2],[1,9,0,3,7,6,3,6,2],[7,6,2,7,2,9,2,1,9,7,9,8],[1,2,10,6,11,7],[2,10,1,7,6,11,8,3,0],[11,7,6,10,9,0,10,0,2],[7,6,11,3,2,8,8,2,10,8,10,9],[6,10,7,10,1,7,7,1,3],[6,10,1,6,1,7,7,1,0,7,0,8],[9,0,3,6,9,3,6,10,9,6,3,7],[6,10,7,7,10,8,10,9,8],[8,4,6,8,6,11],[11,3,6,3,0,6,6,0,4],[0,1,9,4,6,11,4,11,8],[1,9,4,11,1,4,11,3,1,11,4,6],[3,8,2,8,4,2,2,4,6],[2,0,4,2,4,6],[1,9,0,3,8,2,2,8,4,2,4,6],[9,4,1,1,4,2,4,6,2],[10,1,2,11,8,4,11,4,6],[10,1,2,11,3,6,6,3,0,6,0,4],[0,2,10,0,10,9,4,11,8,4,6,11],[2,11,3,6,9,4,6,10,9],[8,4,6,8,6,1,6,10,1,8,1,3],[1,0,10,10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[9,5,4,7,6,11],[4,9,5,3,0,8,11,7,6],[6,11,7,4,0,1,4,1,5],[6,11,7,4,8,5,5,8,3,5,3,1],[4,9,5,6,2,3,6,3,7],[9,5,4,8,7,0,0,7,6,0,6,2],[4,0,1,4,1,5,6,3,7,6,2,3],[7,4,8,5,2,1,5,6,2],[6,11,7,1,2,10,9,5,4],[11,7,6,8,3,0,1,2,10,9,5,4],[11,7,6,10,5,2,2,5,4,2,4,0],[7,4,8,2,11,3,10,5,6],[4,9,5,6,10,7,7,10,1,7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[5,6,9,6,11,9,9,11,8],[0,9,5,0,5,3,3,5,6,3,6,11],[0,1,5,0,5,11,5,6,11,0,11,8],[11,3,6,6,3,5,3,1,5],[9,5,6,3,9,6,3,8,9,3,6,2],[5,6,9,9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[1,2,10,5,6,9,9,6,11,9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[10,6,5],[8,3,0,10,6,5],[0,1,9,5,10,6],[10,6,5,9,8,3,9,3,1],[3,11,2,10,6,5],[6,5,10,2,0,8,2,8,11],[1,9,0,6,5,10,11,2,3],[1,10,2,5,9,6,9,11,6,9,8,11],[1,2,6,1,6,5],[0,8,3,2,6,5,2,5,1],[5,9,6,9,0,6,6,0,2],[9,6,5,3,6,9,3,9,8,3,2,6],[11,6,3,6,5,3,3,5,1],[0,5,1,0,11,5,5,11,6,0,8,11],[0,5,9,0,3,5,3,6,5,3,11,6],[5,9,6,6,9,11,9,8,11],[10,6,5,4,7,8],[5,10,6,7,3,0,7,0,4],[5,10,6,0,1,9,8,4,7],[4,5,9,6,7,10,7,1,10,7,3,1],[7,8,4,2,3,11,10,6,5],[11,6,7,10,2,5,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[7,8,4,5,1,2,5,2,6],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,8,0,7,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,4,5,8,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[10,6,4,10,4,9],[8,3,0,9,10,6,9,6,4],[1,10,0,10,6,0,0,6,4],[8,6,4,8,1,6,6,1,10,8,3,1],[2,3,11,6,4,9,6,9,10],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,11,6,3,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[9,1,4,1,2,4,4,2,6],[1,0,9,3,2,8,2,4,8,2,6,4],[2,4,0,2,6,4],[3,2,8,8,2,4,2,6,4],[1,4,9,11,4,1,11,1,3,11,6,4],[0,9,1,4,11,6,4,8,11],[11,6,3,3,6,0,6,4,0],[8,6,4,8,11,6],[6,7,10,7,8,10,10,8,9],[9,3,0,6,3,9,6,9,10,6,7,3],[6,1,10,6,7,1,7,0,1,7,8,0],[6,7,10,10,7,1,7,3,1],[7,11,6,3,8,2,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2,2,9,1,7,8,9],[1,0,9,3,6,7,3,2,6],[8,0,7,7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[11,7,5,11,5,10],[3,0,8,7,5,10,7,10,11],[9,0,1,10,11,7,10,7,5],[3,1,9,3,9,8,7,10,11,7,5,10],[10,2,5,2,3,5,5,3,7],[5,10,2,8,5,2,8,7,5,8,2,0],[9,0,1,10,2,5,5,2,3,5,3,7],[1,10,2,5,8,7,5,9,8],[2,11,1,11,7,1,1,7,5],[0,8,3,2,11,1,1,11,7,1,7,5],[9,0,2,9,2,7,2,11,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[8,7,0,0,7,1,7,5,1],[0,3,9,9,3,5,3,7,5],[9,7,5,9,8,7],[4,5,8,5,10,8,8,10,11],[3,0,4,3,4,10,4,5,10,3,10,11],[0,1,9,4,5,8,8,5,10,8,10,11],[5,9,4,1,11,3,1,10,11],[3,8,4,3,4,2,2,4,5,2,5,10],[10,2,5,5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[8,4,5,2,8,5,2,11,8,2,5,1],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[4,5,8,8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[7,4,11,4,9,11,11,9,10],[3,0,8,7,4,11,11,4,9,11,9,10],[11,7,4,1,11,4,1,10,11,1,4,0],[8,7,4,11,1,10,11,3,1],[2,3,7,2,7,9,7,4,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[2,11,7,2,7,1,1,7,4,1,4,9],[3,2,11,4,8,7,9,1,0],[7,4,11,11,4,2,4,0,2],[2,11,3,7,4,8],[9,1,4,4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[0,9,3,3,9,11,9,10,11],[1,10,0,0,10,8,10,11,8],[10,3,1,10,11,3],[3,8,2,2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[2,11,1,1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]]}march(_,p,x,t){let r=!!t.fulltable,h=t.hasOwnProperty("origin")&&t.origin.hasOwnProperty("x")?t.origin:{x:0,y:0,z:0},s=!!t.voxel,o=t.matrix,e=t.nX||0,n=t.nY||0,a=t.nZ||0,g=t.scale||1,f=null;t.unitCube?f=t.unitCube:f={x:g,y:g,z:g};let E=new Int32Array(e*n*a),w,R;for(w=0,R=E.length;w<R;++w)E[w]=-1;let z=function(G,B,W,V,k,U){let j={x:0,y:0,z:0},q=!!(V&1<<k),ie=!!(V&1<<U),ge=k;if(!q&&ie&&(ge=U),ge&1&&W++,ge&2&&B++,ge&4&&G++,o){let ve=new A.Vector3(G,B,W);ve=ve.applyMatrix4(o),j={x:ve.x,y:ve.y,z:ve.z}}else j.x=h.x+f.x*G,j.y=h.y+f.y*B,j.z=h.z+f.z*W;let he=(n*G+B)*a+W;return s?(p.push(j),p.length-1):(E[he]<0&&(E[he]=p.length,p.push(j)),E[he])},S=new Int32Array(12),I=r?this.edgeTable2:this.edgeTable,F=r?this.triTable2:this.triTable;for(w=0;w<e-1;++w)for(let G=0;G<n-1;++G)for(let B=0;B<a-1;++B){let W=0;for(let U=0;U<8;++U){let j=(n*(w+((U&4)>>2))+G+((U&2)>>1))*a+B+(U&1),q=!!(_[j]&this.ISDONE);W|=q<<U}if(W===0||W===255)continue;let V=I[W];if(V===0)continue;let k=F[W];V&1&&(S[0]=z(w,G,B,W,0,1)),V&2&&(S[1]=z(w,G,B,W,1,3)),V&4&&(S[2]=z(w,G,B,W,3,2)),V&8&&(S[3]=z(w,G,B,W,2,0)),V&16&&(S[4]=z(w,G,B,W,4,5)),V&32&&(S[5]=z(w,G,B,W,5,7)),V&64&&(S[6]=z(w,G,B,W,7,6)),V&128&&(S[7]=z(w,G,B,W,6,4)),V&256&&(S[8]=z(w,G,B,W,0,4)),V&512&&(S[9]=z(w,G,B,W,1,5)),V&1024&&(S[10]=z(w,G,B,W,3,7)),V&2048&&(S[11]=z(w,G,B,W,2,6));for(let U=0;U<k.length;U+=3){let j=S[k[U]],q=S[k[U+1]],ie=S[k[U+2]];s&&U>=3&&(p.push(p[j]),j=p.length-1,p.push(p[q]),q=p.length-1,p.push(p[ie]),ie=p.length-1),x.push(j),x.push(q),x.push(ie)}}}laplacianSmooth(_,p,x){let t=new Array(p.length),r,h,s,o,e;for(r=0,h=p.length;r<h;r++)t[r]={x:0,y:0,z:0};let n=new Array(20),a;for(r=0;r<20;r++)n[r]=new Array(p.length);for(r=0,h=p.length;r<h;r++)n[0][r]=0;for(r=0,h=x.length/3;r<h;r++){let E=r*3,w=r*3+1,R=r*3+2;for(a=!0,s=0,o=n[0][x[E]];s<o;s++)if(x[w]==n[s+1][x[E]]){a=!1;break}for(a&&(n[0][x[E]]++,n[n[0][x[E]]][x[E]]=x[w]),a=!0,s=0,o=n[0][x[E]];s<o;s++)if(x[R]==n[s+1][x[E]]){a=!1;break}for(a&&(n[0][x[E]]++,n[n[0][x[E]]][x[E]]=x[R]),a=!0,s=0,o=n[0][x[w]];s<o;s++)if(x[E]==n[s+1][x[w]]){a=!1;break}for(a&&(n[0][x[w]]++,n[n[0][x[w]]][x[w]]=x[E]),a=!0,s=0,o=n[0][x[w]];s<o;s++)if(x[R]==n[s+1][x[w]]){a=!1;break}for(a&&(n[0][x[w]]++,n[n[0][x[w]]][x[w]]=x[R]),a=!0,s=0;s<n[0][x[R]];s++)if(x[E]==n[s+1][x[R]]){a=!1;break}for(a&&(n[0][x[R]]++,n[n[0][x[R]]][x[R]]=x[E]),a=!0,s=0,o=n[0][x[R]];s<o;s++)if(x[w]==n[s+1][x[R]]){a=!1;break}a&&(n[0][x[R]]++,n[n[0][x[R]]][x[R]]=x[w])}let g=1,f=.5;for(e=0;e<_;e++){for(r=0,h=p.length;r<h;r++)if(n[0][r]<3)t[r].x=p[r].x,t[r].y=p[r].y,t[r].z=p[r].z;else if(n[0][r]==3||n[0][r]==4){for(t[r].x=0,t[r].y=0,t[r].z=0,s=0,o=n[0][r];s<o;s++)t[r].x+=p[n[s+1][r]].x,t[r].y+=p[n[s+1][r]].y,t[r].z+=p[n[s+1][r]].z;t[r].x+=f*p[r].x,t[r].y+=f*p[r].y,t[r].z+=f*p[r].z,t[r].x/=f+n[0][r],t[r].y/=f+n[0][r],t[r].z/=f+n[0][r]}else{for(t[r].x=0,t[r].y=0,t[r].z=0,s=0,o=n[0][r];s<o;s++)t[r].x+=p[n[s+1][r]].x,t[r].y+=p[n[s+1][r]].y,t[r].z+=p[n[s+1][r]].z;t[r].x+=g*p[r].x,t[r].y+=g*p[r].y,t[r].z+=g*p[r].z,t[r].x/=g+n[0][r],t[r].y/=g+n[0][r],t[r].z/=g+n[0][r]}for(r=0,h=p.length;r<h;r++)p[r].x=t[r].x,p[r].y=t[r].y,p[r].z=t[r].z}}}let y=new u;class C{constructor(_,p,x){this.data=new Int32Array(_*p*x*3),this.width=p,this.height=x}set(_,p,x,t){let r=((_*this.width+p)*this.height+x)*3;this.data[r]=t.ix,this.data[r+1]=t.iy,this.data[r+2]=t.iz}get(_,p,x){let t=((_*this.width+p)*this.height+x)*3;return{ix:this.data[t],iy:this.data[t+1],iz:this.data[t+2]}}}class v{constructor(){this.INOUT=1,this.ISDONE=2,this.ISBOUND=4,this.ptranx=0,this.ptrany=0,this.ptranz=0,this.probeRadius=1.4,this.defaultScaleFactor=2,this.scaleFactor=this.defaultScaleFactor,this.pHeight=0,this.pWidth=0,this.pLength=0,this.cutRadius=0,this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,this.pminx=0,this.pminy=0,this.pminz=0,this.pmaxx=0,this.pmaxy=0,this.pmaxz=0,this.depty={},this.widxz={},this.faces=[],this.verts=[],this.vdwRadii={H:1.2,Li:1.82,Na:2.27,K:2.75,C:1.7,N:1.55,O:1.52,F:1.47,P:1.8,S:1.8,CL:1.75,BR:1.85,SE:1.9,ZN:1.39,CU:1.4,NI:1.63,X:2},this.nb=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])],v.MarchingCube||(v.MarchingCube=new u)}getVDWIndex(_){return!_.elem||typeof this.vdwRadii[_.elem]>"u"?"X":_.elem}getFacesAndVertices(_){let p={};for(let r=0,h=_.length;r<h;r++)p[_[r]]=!0;let x=this.verts;for(let r=0,h=x.length;r<h;r++)x[r].x=x[r].x/this.scaleFactor-this.ptranx,x[r].y=x[r].y/this.scaleFactor-this.ptrany,x[r].z=x[r].z/this.scaleFactor-this.ptranz;let t=[];for(let r=0,h=this.faces.length;r<h;r+=3){let s=this.faces[r],o=this.faces[r+1],e=this.faces[r+2],n=x[s].atomid,a=x[o].atomid,g=x[e].atomid,f=n;a<f&&(f=a),g<f&&(f=g),p[f]&&s!==o&&o!==e&&s!==e&&(t.push(s),t.push(o),t.push(e))}return this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,{vertices:x,faces:t}}initparm(_,p,x){x>1e6&&(this.scaleFactor=this.defaultScaleFactor/2);let t=1/this.scaleFactor*5.5;this.pminx=_[0][0],this.pmaxx=_[1][0],this.pminy=_[0][1],this.pmaxy=_[1][1],this.pminz=_[0][2],this.pmaxz=_[1][2],p?(this.pminx-=this.probeRadius+t,this.pminy-=this.probeRadius+t,this.pminz-=this.probeRadius+t,this.pmaxx+=this.probeRadius+t,this.pmaxy+=this.probeRadius+t,this.pmaxz+=this.probeRadius+t):(this.pminx-=t,this.pminy-=t,this.pminz-=t,this.pmaxx+=t,this.pmaxy+=t,this.pmaxz+=t),this.pminx=Math.floor(this.pminx*this.scaleFactor)/this.scaleFactor,this.pminy=Math.floor(this.pminy*this.scaleFactor)/this.scaleFactor,this.pminz=Math.floor(this.pminz*this.scaleFactor)/this.scaleFactor,this.pmaxx=Math.ceil(this.pmaxx*this.scaleFactor)/this.scaleFactor,this.pmaxy=Math.ceil(this.pmaxy*this.scaleFactor)/this.scaleFactor,this.pmaxz=Math.ceil(this.pmaxz*this.scaleFactor)/this.scaleFactor,this.ptranx=-this.pminx,this.ptrany=-this.pminy,this.ptranz=-this.pminz,this.pLength=Math.ceil(this.scaleFactor*(this.pmaxx-this.pminx))+1,this.pWidth=Math.ceil(this.scaleFactor*(this.pmaxy-this.pminy))+1,this.pHeight=Math.ceil(this.scaleFactor*(this.pmaxz-this.pminz))+1,this.boundingatom(p),this.cutRadius=this.probeRadius*this.scaleFactor,this.vpBits=new Uint8Array(this.pLength*this.pWidth*this.pHeight),this.vpDistance=new Float64Array(this.pLength*this.pWidth*this.pHeight),this.vpAtomID=new Int32Array(this.pLength*this.pWidth*this.pHeight)}boundingatom(_){let p={};for(const x in this.vdwRadii){let t=this.vdwRadii[x];_?p[x]=(t+this.probeRadius)*this.scaleFactor+.5:p[x]=t*this.scaleFactor+.5;let r=p[x]*p[x];this.widxz[x]=Math.floor(p[x])+1,this.depty[x]=new Int32Array(this.widxz[x]*this.widxz[x]);let h=0;for(let s=0;s<this.widxz[x];s++)for(let o=0;o<this.widxz[x];o++){let e=s*s+o*o;if(e>r)this.depty[x][h]=-1;else{let n=Math.sqrt(r-e);this.depty[x][h]=Math.floor(n)}h++}}}fillvoxels(_,p){for(let x=0,t=this.vpBits.length;x<t;x++)this.vpBits[x]=0,this.vpDistance[x]=-1,this.vpAtomID[x]=-1;for(let x in p){let t=_[p[x]];t!==void 0&&this.fillAtom(t,_)}for(let x=0,t=this.vpBits.length;x<t;x++)this.vpBits[x]&this.INOUT&&(this.vpBits[x]|=this.ISDONE)}fillAtom(_,p){let x=Math.floor(.5+this.scaleFactor*(_.x+this.ptranx)),t=Math.floor(.5+this.scaleFactor*(_.y+this.ptrany)),r=Math.floor(.5+this.scaleFactor*(_.z+this.ptranz)),h=this.getVDWIndex(_),s=0,o=this.pWidth*this.pHeight;for(let e=0,n=this.widxz[h];e<n;e++)for(let a=0;a<n;a++){if(this.depty[h][s]!=-1){for(let g=-1;g<2;g++)for(let f=-1;f<2;f++)for(let E=-1;E<2;E++)if(g!==0&&f!==0&&E!==0){let w=g*e,R=E*a;for(let z=0;z<=this.depty[h][s];z++){let S=z*f,I=x+w,F=t+S,G=r+R;if(I<0||F<0||G<0||I>=this.pLength||F>=this.pWidth||G>=this.pHeight)continue;let B=I*o+F*this.pHeight+G;if(!(this.vpBits[B]&this.INOUT))this.vpBits[B]|=this.INOUT,this.vpAtomID[B]=_.serial;else{let W=p[this.vpAtomID[B]];if(W.serial!=_.serial){let V=x+w-Math.floor(.5+this.scaleFactor*(W.x+this.ptranx)),k=t+S-Math.floor(.5+this.scaleFactor*(W.y+this.ptrany)),U=r+R-Math.floor(.5+this.scaleFactor*(W.z+this.ptranz));w*w+S*S+R*R<V*V+k*k+U*U&&(this.vpAtomID[B]=_.serial)}}}}}s++}}fillvoxelswaals(_,p){for(let x=0,t=this.vpBits.length;x<t;x++)this.vpBits[x]&=~this.ISDONE;for(let x in p){let t=_[p[x]];t!==void 0&&this.fillAtomWaals(t,_)}}fillAtomWaals(_,p){let x=0,t=Math.floor(.5+this.scaleFactor*(_.x+this.ptranx)),r=Math.floor(.5+this.scaleFactor*(_.y+this.ptrany)),h=Math.floor(.5+this.scaleFactor*(_.z+this.ptranz)),s=this.getVDWIndex(_),o=this.pWidth*this.pHeight;for(let e=0,n=this.widxz[s];e<n;e++)for(let a=0;a<n;a++){if(this.depty[s][x]!=-1){for(let g=-1;g<2;g++)for(let f=-1;f<2;f++)for(let E=-1;E<2;E++)if(g!==0&&f!==0&&E!==0){let w=g*e,R=E*a;for(let z=0;z<=this.depty[s][x];z++){let S=z*f,I=t+w,F=r+S,G=h+R;if(I<0||F<0||G<0||I>=this.pLength||F>=this.pWidth||G>=this.pHeight)continue;let B=I*o+F*this.pHeight+G;if(!(this.vpBits[B]&this.ISDONE))this.vpBits[B]|=this.ISDONE,this.vpAtomID[B]=_.serial;else{let W=p[this.vpAtomID[B]];if(W.serial!=_.serial){let V=t+w-Math.floor(.5+this.scaleFactor*(W.x+this.ptranx)),k=r+S-Math.floor(.5+this.scaleFactor*(W.y+this.ptrany)),U=h+R-Math.floor(.5+this.scaleFactor*(W.z+this.ptranz));w*w+S*S+R*R<V*V+k*k+U*U&&(this.vpAtomID[B]=_.serial)}}}}}x++}}buildboundary(){let _=this.pWidth*this.pHeight;for(let p=0;p<this.pLength;p++)for(let x=0;x<this.pHeight;x++)for(let t=0;t<this.pWidth;t++){let r=p*_+t*this.pHeight+x;if(this.vpBits[r]&this.INOUT){let h=0;for(;h<26;){let s=p+this.nb[h][0],o=x+this.nb[h][2],e=t+this.nb[h][1];if(s>-1&&s<this.pLength&&e>-1&&e<this.pWidth&&o>-1&&o<this.pHeight&&!(this.vpBits[s*_+e*this.pHeight+o]&this.INOUT)){this.vpBits[r]|=this.ISBOUND;break}else h++}}}}fastdistancemap(){let _=new C(this.pLength,this.pWidth,this.pHeight),p=this.pWidth*this.pHeight,x=this.cutRadius*this.cutRadius,t=[],r=[],h;for(let e=0;e<this.pLength;e++)for(let n=0;n<this.pWidth;n++)for(let a=0;a<this.pHeight;a++)if(h=e*p+n*this.pHeight+a,this.vpBits[h]&=~this.ISDONE,this.vpBits[h]&this.INOUT&&this.vpBits[h]&this.ISBOUND){let g={ix:e,iy:n,iz:a};_.set(e,n,a,g),t.push(g),this.vpDistance[h]=0,this.vpBits[h]|=this.ISDONE,this.vpBits[h]&=~this.ISBOUND}do{r=this.fastoneshell(t,_),t=[];for(let e=0,n=r.length;e<n;e++)h=p*r[e].ix+this.pHeight*r[e].iy+r[e].iz,this.vpBits[h]&=~this.ISBOUND,this.vpDistance[h]<=1.0404*x&&t.push({ix:r[e].ix,iy:r[e].iy,iz:r[e].iz})}while(t.length!==0);t=[],r=[],_=null;let s=this.scaleFactor-.5;s<0&&(s=0);let o=x-.5/(.1+s);for(let e=0;e<this.pLength;e++)for(let n=0;n<this.pWidth;n++)for(let a=0;a<this.pHeight;a++)h=e*p+n*this.pHeight+a,this.vpBits[h]&=~this.ISBOUND,this.vpBits[h]&this.INOUT&&(!(this.vpBits[h]&this.ISDONE)||this.vpBits[h]&this.ISDONE&&this.vpDistance[h]>=o)&&(this.vpBits[h]|=this.ISBOUND)}fastoneshell(_,p){let x,t,r,h,s,o,e,n,a,g=[];if(_.length===0)return g;let f={ix:-1,iy:-1,iz:-1},E=this.pWidth*this.pHeight;for(let w=0,R=_.length;w<R;w++){x=_[w].ix,t=_[w].iy,r=_[w].iz,n=p.get(x,t,r);for(let z=0;z<6;z++)f.ix=x+this.nb[z][0],f.iy=t+this.nb[z][1],f.iz=r+this.nb[z][2],f.ix<this.pLength&&f.ix>-1&&f.iy<this.pWidth&&f.iy>-1&&f.iz<this.pHeight&&f.iz>-1&&(a=f.ix*E+this.pHeight*f.iy+f.iz,this.vpBits[a]&this.INOUT&&!(this.vpBits[a]&this.ISDONE)?(p.set(f.ix,f.iy,r+this.nb[z][2],n),h=f.ix-n.ix,s=f.iy-n.iy,o=f.iz-n.iz,e=h*h+s*s+o*o,this.vpDistance[a]=e,this.vpBits[a]|=this.ISDONE,this.vpBits[a]|=this.ISBOUND,g.push({ix:f.ix,iy:f.iy,iz:f.iz})):this.vpBits[a]&this.INOUT&&this.vpBits[a]&this.ISDONE&&(h=f.ix-n.ix,s=f.iy-n.iy,o=f.iz-n.iz,e=h*h+s*s+o*o,e<this.vpDistance[a]&&(p.set(f.ix,f.iy,f.iz,n),this.vpDistance[a]=e,this.vpBits[a]&this.ISBOUND||(this.vpBits[a]|=this.ISBOUND,g.push({ix:f.ix,iy:f.iy,iz:f.iz})))))}for(let w=0,R=_.length;w<R;w++){x=_[w].ix,t=_[w].iy,r=_[w].iz,n=p.get(x,t,r);for(let z=6;z<18;z++)f.ix=x+this.nb[z][0],f.iy=t+this.nb[z][1],f.iz=r+this.nb[z][2],f.ix<this.pLength&&f.ix>-1&&f.iy<this.pWidth&&f.iy>-1&&f.iz<this.pHeight&&f.iz>-1&&(a=f.ix*E+this.pHeight*f.iy+f.iz,this.vpBits[a]&this.INOUT&&!(this.vpBits[a]&this.ISDONE)?(p.set(f.ix,f.iy,r+this.nb[z][2],n),h=f.ix-n.ix,s=f.iy-n.iy,o=f.iz-n.iz,e=h*h+s*s+o*o,this.vpDistance[a]=e,this.vpBits[a]|=this.ISDONE,this.vpBits[a]|=this.ISBOUND,g.push({ix:f.ix,iy:f.iy,iz:f.iz})):this.vpBits[a]&this.INOUT&&this.vpBits[a]&this.ISDONE&&(h=f.ix-n.ix,s=f.iy-n.iy,o=f.iz-n.iz,e=h*h+s*s+o*o,e<this.vpDistance[a]&&(p.set(f.ix,f.iy,f.iz,n),this.vpDistance[a]=e,this.vpBits[a]&this.ISBOUND||(this.vpBits[a]|=this.ISBOUND,g.push({ix:f.ix,iy:f.iy,iz:f.iz})))))}for(let w=0,R=_.length;w<R;w++){x=_[w].ix,t=_[w].iy,r=_[w].iz,n=p.get(x,t,r);for(let z=18;z<26;z++)f.ix=x+this.nb[z][0],f.iy=t+this.nb[z][1],f.iz=r+this.nb[z][2],f.ix<this.pLength&&f.ix>-1&&f.iy<this.pWidth&&f.iy>-1&&f.iz<this.pHeight&&f.iz>-1&&(a=f.ix*E+this.pHeight*f.iy+f.iz,this.vpBits[a]&this.INOUT&&!(this.vpBits[a]&this.ISDONE)?(p.set(f.ix,f.iy,r+this.nb[z][2],n),h=f.ix-n.ix,s=f.iy-n.iy,o=f.iz-n.iz,e=h*h+s*s+o*o,this.vpDistance[a]=e,this.vpBits[a]|=this.ISDONE,this.vpBits[a]|=this.ISBOUND,g.push({ix:f.ix,iy:f.iy,iz:f.iz})):this.vpBits[a]&this.INOUT&&this.vpBits[a]&this.ISDONE&&(h=f.ix-n.ix,s=f.iy-n.iy,o=f.iz-n.iz,e=h*h+s*s+o*o,e<this.vpDistance[a]&&(p.set(f.ix,f.iy,f.iz,n),this.vpDistance[a]=e,this.vpBits[a]&this.ISBOUND||(this.vpBits[a]|=this.ISBOUND,g.push({ix:f.ix,iy:f.iy,iz:f.iz})))))}return g}marchingcubeinit(_){for(let p=0,x=this.vpBits.length;p<x;p++)_==1?this.vpBits[p]&=~this.ISBOUND:_==4?(this.vpBits[p]&=~this.ISDONE,this.vpBits[p]&this.ISBOUND&&(this.vpBits[p]|=this.ISDONE),this.vpBits[p]&=~this.ISBOUND):_==2?this.vpBits[p]&this.ISBOUND&&this.vpBits[p]&this.ISDONE?this.vpBits[p]&=~this.ISBOUND:this.vpBits[p]&this.ISBOUND&&!(this.vpBits[p]&this.ISDONE)&&(this.vpBits[p]|=this.ISDONE):_==3&&(this.vpBits[p]&=~this.ISBOUND)}marchingcube(_){this.marchingcubeinit(_),this.verts=[],this.faces=[],v.MarchingCube.march(this.vpBits,this.verts,this.faces,{smooth:1,nX:this.pLength,nY:this.pWidth,nZ:this.pHeight});let p=this.pWidth*this.pHeight;for(let x=0,t=this.verts.length;x<t;x++)this.verts[x].atomid=this.vpAtomID[this.verts[x].x*p+this.pHeight*this.verts[x].y+this.verts[x].z];v.MarchingCube.laplacianSmooth(1,this.verts,this.faces)}}v.MarchingCube=new u},"./src/VolumeData.ts":(X,L,c)=>{c.r(L),c.d(L,{VolumeData:()=>y});var A=c("./src/utilities.ts"),T=c("./src/WebGL/math/index.ts"),D=c("./src/parsers/VASP.ts"),P=c("./src/parsers/CUBE.ts"),u=c("./node_modules/pako/dist/pako.esm.mjs");class y{constructor(v,M,_){if(this.unit={x:1,y:1,z:1},this.origin={x:0,y:0,z:0},this.size={x:0,y:0,z:0},this.data=new Float32Array([]),this.matrix=null,this.inversematrix=null,this.isbinary=new Set(["ccp4","CCP4"]),this.getCoordinates=function(h){var s=h/(this.size.y*this.size.z),o=h%(this.size.y*this.size.z),e=h%this.size.z;return s*=this.unit.x,o*=this.unit.y,e*=this.unit.z,s+=this.origin.x,o+=this.origin.y,e+=this.origin.z,{x:s,y:o,z:e}},this.vasp=function(h){var s=h.replace(/^\s+/,"").split(/[\n\r]/),o=(0,D.VASP)(h)[0],e=o.length;if(e==0){console.log("No good formating of CHG or CHGCAR file, not atomic information provided in the file."),this.data=[];return}var n=1.889725992,a=.036749309,g=parseFloat(s[1]),f;f=s[2].replace(/^\s+/,"").split(/\s+/);var E=new T.Vector3(parseFloat(f[0]),parseFloat(f[1]),parseFloat(f[2])).multiplyScalar(g*n);f=s[3].replace(/^\s+/,"").split(/\s+/);var w=new T.Vector3(parseFloat(f[0]),parseFloat(f[1]),parseFloat(f[2])).multiplyScalar(g*n);f=s[4].replace(/^\s+/,"").split(/\s+/);var R=new T.Vector3(parseFloat(f[0]),parseFloat(f[1]),parseFloat(f[2])).multiplyScalar(g*n),z=E.x*(w.y*R.z-R.y*w.z)-w.x*(E.y*R.z-R.y*E.z)+R.x*(E.y*w.z-w.y*E.z);z=Math.abs(z)/Math.pow(n,3);var S=1/z;s.splice(0,8+e+1);var I=s[0].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),F=Math.abs(parseFloat(I[0])),G=Math.abs(parseFloat(I[1])),B=Math.abs(parseFloat(I[2])),W=this.origin=new T.Vector3(0,0,0);this.size={x:F,y:G,z:B},this.unit=new T.Vector3(E.x,w.y,R.z),E=E.multiplyScalar(1/(n*F)),w=w.multiplyScalar(1/(n*G)),R=R.multiplyScalar(1/(n*B)),(E.y!=0||E.z!=0||w.x!=0||w.z!=0||R.x!=0||R.y!=0)&&(this.matrix=new T.Matrix4(E.x,w.x,R.x,0,E.y,w.y,R.y,0,E.z,w.z,R.z,0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,new T.Matrix4().makeTranslation(W.x,W.y,W.z)),this.origin=new T.Vector3(0,0,0),this.unit=new T.Vector3(1,1,1)),s.splice(0,1);var V=s.join(" ");V=V.replace(/^\s+/,"");var k=V.split(/[\s\r]+/);k.splice(F*G*B+1);for(var U=Float32Array.from(k,parseFloat),j=0;j<U.length;j++)U[j]=U[j]*S*a;this.data=U},this.dx=function(h){var s=h.split(/[\n\r]+/),o,e=/gridpositions\s+counts\s+(\d+)\s+(\d+)\s+(\d+)/,n=/^origin\s+(\S+)\s+(\S+)\s+(\S+)/,a=/^delta\s+(\S+)\s+(\S+)\s+(\S+)/,g=/data follows/,f=0;for(f=0;f<s.length;f++){var E=s[f];if(o=e.exec(E)){var w=parseInt(o[1]),R=parseInt(o[2]),z=parseInt(o[3]);this.size={x:w,y:R,z}}else if(o=a.exec(E)){var S=parseFloat(o[1]);if((parseFloat(o[2])!=0||parseFloat(o[3])!=0)&&console.log("Non-orthogonal delta matrix not currently supported in dx format"),f+=1,E=s[f],o=a.exec(E),o==null){console.log("Parse error in dx delta matrix");return}var I=parseFloat(o[2]);if((parseFloat(o[1])!=0||parseFloat(o[3])!=0)&&console.log("Non-orthogonal delta matrix not currently supported in dx format"),f+=1,E=s[f],o=a.exec(E),o==null){console.log("Parse error in dx delta matrix");return}var F=parseFloat(o[3]);(parseFloat(o[1])!=0||parseFloat(o[2])!=0)&&console.log("Non-orthogonal delta matrix not currently supported in dx format"),this.unit=new T.Vector3(S,I,F)}else if(o=n.exec(E)){var G=parseFloat(o[1]),B=parseFloat(o[2]),W=parseFloat(o[3]);this.origin=new T.Vector3(G,B,W)}else if(o=g.exec(E))break}if(f+=1,!this.size||!this.origin||!this.unit||!this.size){console.log("Error parsing dx format");return}var V=s.splice(f).join(" "),k=V.split(/[\s\r]+/);this.data=Float32Array.from(k,parseFloat)},M=M.toLowerCase(),/\.gz$/.test(M)){M=M.replace(/\.gz$/,"");try{this[M]&&this.isbinary.has(M)?(typeof v=="string"&&(v=(0,A.base64ToArray)(v)),v=(0,u.inflate)(v)):v=new TextDecoder("utf-8").decode((0,u.inflate)(v))}catch(h){console.log(h)}}if(this[M]&&(this.isbinary.has(M)&&typeof v=="string"&&(v=(0,A.base64ToArray)(v)),this[M](v)),_){if(_.negate)for(let h=0,s=this.data.length;h<s;h++)this.data[h]=-this.data[h];if(_.normalize){var p=0;for(let h=0,s=this.data.length;h<s;h++)p+=this.data[h];var x=p/this.data.length;p=0;for(let h=0,s=this.data.length;h<s;h++){var t=this.data[h]-x;p+=t*t}var r=p/this.data.length;for(let h=0,s=this.data.length;h<s;h++)this.data[h]=(this.data[h]-x)/r}}}getIndex(v,M,_){if(this.matrix){this.inversematrix==null&&(this.inversematrix=new T.Matrix4().getInverse(this.matrix));var p=new T.Vector3(v,M,_);p=p.applyMatrix4(this.inversematrix),v=p.x,M=p.y,_=p.z}else v-=this.origin.x,M-=this.origin.y,_-=this.origin.z,v/=this.unit.x,M/=this.unit.y,_/=this.unit.z;return v=Math.round(v),M=Math.round(M),_=Math.round(_),v<0||v>=this.size.x||M<0||M>=this.size.y||_<0||_>=this.size.z?-1:v*this.size.y*this.size.z+M*this.size.z+_}getVal(v,M,_){let p=this.getIndex(v,M,_);return p<0?0:this.data[p]}cube(v){var M=v.split(/\r?\n/);if(!(M.length<6)){var _=(0,P.CUBE)(v,{}).modelData[0].cryst,p=M[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),x=parseFloat(p[0]),t=Math.abs(x);this.origin=_.origin,this.size=_.size,this.unit=_.unit,this.matrix=_.matrix4;var r=6;x<0&&r++;var h=M.splice(t+r).join(" ");h=h.replace(/^\s+/,"");var s=h.split(/[\s\r]+/);this.data=Float32Array.from(s,parseFloat)}}ccp4(v){var M={};v=new Int8Array(v);var _=new Int32Array(v.buffer,0,56),p=new Float32Array(v.buffer,0,56),x=new DataView(v.buffer);if(M.MAP=String.fromCharCode(x.getUint8(208),x.getUint8(209),x.getUint8(210),x.getUint8(211)),M.MACHST=[x.getUint8(212),x.getUint8(213)],M.MACHST[0]===17&&M.MACHST[1]===17)for(var t=v.byteLength,r=0;r<t;r+=4)x.setFloat32(r,x.getFloat32(r),!0);M.NX=_[0],M.NY=_[1],M.NZ=_[2],M.MODE=_[3],M.NXSTART=_[4],M.NYSTART=_[5],M.NZSTART=_[6],M.MX=_[7],M.MY=_[8],M.MZ=_[9],M.xlen=p[10],M.ylen=p[11],M.zlen=p[12],M.alpha=p[13],M.beta=p[14],M.gamma=p[15],M.MAPC=_[16],M.MAPR=_[17],M.MAPS=_[18],M.DMIN=p[19],M.DMAX=p[20],M.DMEAN=p[21],M.ISPG=_[22],M.NSYMBT=_[23],M.LSKFLG=_[24],M.originX=p[49],M.originY=p[50],M.originZ=p[51],M.ARMS=p[54];var h=M,s=[h.xlen,0,0],o=[h.ylen*Math.cos(Math.PI/180*h.gamma),h.ylen*Math.sin(Math.PI/180*h.gamma),0],e=[h.zlen*Math.cos(Math.PI/180*h.beta),h.zlen*(Math.cos(Math.PI/180*h.alpha)-Math.cos(Math.PI/180*h.gamma)*Math.cos(Math.PI/180*h.beta))/Math.sin(Math.PI/180*h.gamma),0];e[2]=Math.sqrt(h.zlen*h.zlen*Math.sin(Math.PI/180*h.beta)*Math.sin(Math.PI/180*h.beta)-e[1]*e[1]);var n=[0,s,o,e],a=[0,h.MX,h.MY,h.MZ],g=[0,h.MAPC,h.MAPR,h.MAPS];this.matrix=new T.Matrix4,this.matrix.set(n[g[1]][0]/a[g[1]],n[g[2]][0]/a[g[2]],n[g[3]][0]/a[g[3]],0,n[g[1]][1]/a[g[1]],n[g[2]][1]/a[g[2]],n[g[3]][1]/a[g[3]],0,n[g[1]][2]/a[g[1]],n[g[2]][2]/a[g[2]],n[g[3]][2]/a[g[3]],0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,new T.Matrix4().makeTranslation(h.NXSTART+h.originX,h.NYSTART+h.originY,h.NZSTART+h.originZ)),this.origin=new T.Vector3(0,0,0),this.unit=new T.Vector3(1,1,1),this.size={x:M.NX,y:M.NY,z:M.NZ},this.dimensionorder=[M.MAPC,M.MAPR,M.MAPS];var f=new Float32Array(v.buffer,1024+M.NSYMBT),E=M.NX,w=M.NY,R=M.NZ;this.data=new Float32Array(E*w*R);for(let z=0;z<E;z++)for(let S=0;S<w;S++)for(let I=0;I<R;I++)this.data[(z*w+S)*R+I]=f[(I*w+S)*E+z]}}},"./src/VolumetricRender.ts":(X,L,c)=>{c.r(L),c.d(L,{GLVolumetricRender:()=>y});var A=c("./src/WebGL/shapes/index.ts"),T=c("./src/WebGL/math/index.ts"),D=c("./src/WebGL/index.ts"),P=c("./src/colors.ts"),u=c("./src/GLShape.ts");class y{static interpolateArray(v,M){function _(e,n,a){return e+(n-e)*a}var p=[],x=(v.length-1)/(M-1);p[0]=v[0];for(var t=1;t<M-1;t++){var r=t*x,h=Math.floor(r),s=Math.ceil(r),o=r-h;p[t]=_(v[h],v[s],o)}return p[M-1]=v[v.length-1],p}constructor(v,M){this.hidden=!1,this.boundingSphere=new A.Sphere,this.renderedShapeObj=null,this.shapeObj=null,this.subsamples=5,this.data=null,this.transferfunctionbuffer=[],this.min=0,this.max=0,M=M||{};var _=Object.assign([],M.transferfn);this.subsamples=M.subsamples||5;let p=256;_.forEach(function(E){E.value=parseFloat(E.value)}),_.sort(function(E,w){return E.value-w.value}),this.min=_[0].value,_.length==0&&_.push(_[0]),this.max=_[_.length-1].value;var x,t,r,h,s,o,e,n,a,g;for(let E=0;E<_.length-1;E++)if(r=P.CC.color(_[E].color),h=P.CC.color(_[E+1].color),a=_[E].opacity,g=_[E+1].opacity,x=Math.floor((_[E].value-this.min)*p/(this.max-this.min)),t=Math.floor((_[E+1].value-this.min)*p/(this.max-this.min)),x!=t){s=y.interpolateArray([r.r*255,h.r*255],t-x),o=y.interpolateArray([r.g*255,h.g*255],t-x),e=y.interpolateArray([r.b*255,h.b*255],t-x),n=y.interpolateArray([a*255,g*255],t-x);for(let w=0;w<s.length;w++)this.transferfunctionbuffer.push(s[w]),this.transferfunctionbuffer.push(o[w]),this.transferfunctionbuffer.push(e[w]),this.transferfunctionbuffer.push(n[w])}if(this.transferfunctionbuffer=new Uint8ClampedArray(this.transferfunctionbuffer),v.matrix){let E=new T.Vector3(0,0,0),w=new T.Vector3(v.size.x,v.size.y,v.size.z),R=new T.Vector3(1,1,1);E.applyMatrix4(v.matrix),w.applyMatrix4(v.matrix),R.applyMatrix4(v.matrix).sub(E),this.extent=[[E.x,E.y,E.z],[w.x,w.y,w.z]];for(let F=1;F<7;F++)w.x=F&1?v.size.x:0,w.y=F&2?v.size.y:0,w.z=F&4?v.size.z:0,w.applyMatrix4(v.matrix),this.extent[0][0]=Math.min(this.extent[0][0],w.x),this.extent[0][1]=Math.min(this.extent[0][1],w.y),this.extent[0][2]=Math.min(this.extent[0][2],w.z),this.extent[1][0]=Math.max(this.extent[1][0],w.x),this.extent[1][1]=Math.max(this.extent[1][1],w.y),this.extent[1][2]=Math.max(this.extent[1][2],w.z);let z=w.x-E.x,S=w.y-E.y,I=w.z-E.z;this.maxdepth=Math.sqrt(z*z+S*S+I*I),this.minunit=Math.min(Math.min(R.x,R.y),R.z),this.texmatrix=new T.Matrix4().identity().scale({x:v.size.x,y:v.size.y,z:v.size.z}),this.texmatrix=this.texmatrix.multiplyMatrices(v.matrix,this.texmatrix),this.texmatrix=this.texmatrix.getInverse(this.texmatrix)}else{this.texmatrix=new T.Matrix4().identity();let E=v.unit.x*v.size.x,w=v.unit.y*v.size.y,R=v.unit.z*v.size.z;this.texmatrix.makeTranslation(-v.origin.x/E,-v.origin.y/w,-v.origin.z/R),this.texmatrix.scale({x:1/E,y:1/w,z:1/R}),this.minunit=Math.min(Math.min(v.unit.x,v.unit.y),v.unit.z),this.extent=[[v.origin.x,v.origin.y,v.origin.z],[v.origin.x+E,v.origin.y+w,v.origin.z+R]],this.maxdepth=Math.sqrt(E*E+w*w+R*R)}var f=new u.GLShape({});if(f.addBox({corner:{x:this.extent[0][0],y:this.extent[0][1],z:this.extent[0][2]},dimensions:{w:this.extent[1][0]-this.extent[0][0],h:this.extent[1][1]-this.extent[0][1],d:this.extent[1][2]-this.extent[0][2]}}),this.geo=f.finalize(),this.boundingSphere.center=new T.Vector3((this.extent[0][0]+this.extent[1][0])/2,(this.extent[0][1]+this.extent[1][1])/2,(this.extent[0][2]+this.extent[1][2])/2),this.boundingSphere.radius=this.maxdepth/2,M.coords!==void 0&&M.seldist!==void 0){let E=new Uint8Array(v.data.length),w=M.seldist,R=w*w;for(let z=0,S=M.coords.length;z<S;z++){let I=M.coords[z],F=I.x-w,G=I.y-w,B=I.z-w,W=I.x+w,V=I.y+w,k=I.z+w;if(v.getIndex(F,G,B)>=0||v.getIndex(W,V,k)>=0)for(let U=F;U<W;U+=this.minunit)for(let j=G;j<V;j+=this.minunit)for(let q=B;q<k;q+=this.minunit){let ie=v.getIndex(U,j,q);ie>=0&&!E[ie]&&(U-I.x)*(U-I.x)+(j-I.y)*(j-I.y)+(q-I.z)*(q-I.z)<R&&(E[ie]=1)}}for(let z=0,S=v.data.length;z<S;z++)E[z]==0&&(v.data[z]=1/0)}this.data=v}globj(v){if(this.renderedShapeObj&&(v.remove(this.renderedShapeObj),this.renderedShapeObj=null),!this.hidden){this.shapeObj=new D.Object3D;var M=null,_=new D.Texture(this.data,!0),p=new D.Texture(this.transferfunctionbuffer,!1);_.needsUpdate=!0,p.needsUpdate=!0,p.flipY=!1,M=new D.VolumetricMaterial({transferfn:p,transfermin:this.min,transfermax:this.max,map:_,extent:this.extent,maxdepth:this.maxdepth,texmatrix:this.texmatrix,unit:this.minunit,subsamples:this.subsamples});var x=new D.Mesh(this.geo,M);this.shapeObj.add(x),this.renderedShapeObj=this.shapeObj.clone(),v.add(this.renderedShapeObj)}}removegl(v){this.renderedShapeObj&&(this.renderedShapeObj.geometry!==void 0&&this.renderedShapeObj.geometry.dispose(),this.renderedShapeObj.material!==void 0&&this.renderedShapeObj.material.dispose(),v.remove(this.renderedShapeObj),this.renderedShapeObj=null),this.shapeObj=null}get position(){return this.boundingSphere.center}get x(){return this.boundingSphere.center.x}get y(){return this.boundingSphere.center.y}get z(){return this.boundingSphere.center.z}}},"./src/WebGL/Camera.ts":(X,L,c)=>{c.r(L),c.d(L,{Camera:()=>D});var A=c("./src/WebGL/core/index.ts"),T=c("./src/WebGL/math/index.ts");class D extends A.Object3D{constructor(u=50,y=1,C=.1,v=2e3,M=!1){super(),this.projectionMatrix=new T.Matrix4,this.projectionMatrixInverse=new T.Matrix4,this.matrixWorldInverse=new T.Matrix4,this.fov=u,this.aspect=y,this.near=C,this.far=v;var _=this.position.z;this.right=_*Math.tan(Math.PI/180*u),this.left=-this.right,this.top=this.right/this.aspect,this.bottom=-this.top,this.ortho=!!M,this.updateProjectionMatrix()}lookAt(u){this.matrix.lookAt(this.position,u,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!1&&this.rotation instanceof T.Vector3?this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):console.error("Unimplemented math operation."))}updateProjectionMatrix(){this.ortho?this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far):this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)}}},"./src/WebGL/Fog.ts":(X,L,c)=>{c.r(L),c.d(L,{Fog:()=>T});var A=c("./src/colors.ts");class T{constructor(P,u=1,y=1e3){this.name="",this.color=new A.Color(P),this.near=u,this.far=y}clone(){return new T(this.color.getHex(),this.near,this.far)}}},"./src/WebGL/Renderer.ts":(X,L,c)=>{c.r(L),c.d(L,{Renderer:()=>p});var A=c("./src/WebGL/Camera.ts"),T=c("./src/WebGL/constants/Sides.ts"),D=c("./src/WebGL/constants/TextureConstants.ts"),P=c("./src/WebGL/core/index.ts"),u=c("./src/colors.ts"),y=c("./src/WebGL/materials/index.ts"),C=c("./src/WebGL/math/index.ts"),v=c("./src/WebGL/objects/index.ts"),M=c("./src/WebGL/shaders/index.ts"),_=c("./src/WebGL/SpritePlugin.ts");class p{constructor(t){this.context=null,this.devicePixelRatio=1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.autoUpdateObjects=!0,this.autoUpdateScene=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}},this._programs=[],this._programs_counter=0,this._webglversion=1,this._currentProgram=null,this._currentMaterialId=-1,this._currentGeometryGroupHash=null,this._currentCamera=null,this._geometryGroupCounter=0,this._oldDoubleSided=-1,this._oldFlipSided=-1,this._oldDepthTest=-1,this._oldDepthWrite=-1,this._oldPolygonOffset=null,this._oldLineWidth=null,this._viewportWidth=0,this._viewportHeight=0,this._currentWidth=0,this._currentHeight=0,this._enabledAttributes={},this._projScreenMatrix=new C.Matrix4,this._vector3=new C.Vector3,this._worldInverse=new C.Matrix4,this._projInverse=new C.Matrix4,this._textureMatrix=new C.Matrix4,this._direction=new C.Vector3,this._lightsNeedUpdate=!0,this._lights={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},this.sprites=new _.SpritePlugin,this._screenshader=null,this._vertexattribpos=null,this._screenQuadVBO=null,this._fb=null,this._targetTexture=null,this._depthTexture=null,t=t||{},this.row=t.row,this.col=t.col,this.rows=t.rows,this.cols=t.cols,this._canvas=t.canvas!==void 0?t.canvas:document.createElement("canvas"),this._precision=t.precision!==void 0?t.precision:"highp",this._alpha=t.alpha!==void 0?t.alpha:!0,this._premultipliedAlpha=t.premultipliedAlpha!==void 0?t.premultipliedAlpha:!0,this._antialias=t.antialias!==void 0?t.antialias:!1,this._stencil=t.stencil!==void 0?t.stencil:!0,this._preserveDrawingBuffer=t.preserveDrawingBuffer!==void 0?t.preserveDrawingBuffer:!1,this._clearColor=t.clearColor!==void 0?new u.Color(t.clearColor):new u.Color(0),this._clearAlpha=t.clearAlpha!==void 0?t.clearAlpha:0,this._outlineMaterial=new y.MeshOutlineMaterial(t.outline),this._outlineSphereImposterMaterial=new y.SphereImposterOutlineMaterial(t.outline),this._outlineStickImposterMaterial=new y.StickImposterOutlineMaterial(t.outline),this._outlineEnabled=!!t.outline,this.domElement=this._canvas,this._canvas.id=t.id,this.initGL(),this.setDefaultGLState(),this.context=this._gl,this.isWebGL1()?this._extInstanced=this._gl.getExtension("ANGLE_instanced_arrays"):this._extInstanced={vertexAttribDivisorANGLE:this._gl.vertexAttribDivisor.bind(this._gl),drawElementsInstancedANGLE:this._gl.drawElementsInstanced.bind(this._gl)},this._extFragDepth=this._gl.getExtension("EXT_frag_depth"),this._extFloatLinear=this._gl.getExtension("OES_texture_float_linear"),this._extColorBufferFloat=this._gl.getExtension("EXT_color_buffer_float"),this.sprites.init(this)}supportedExtensions(){return{supportsAIA:!!this._extInstanced,supportsImposters:!!this._extFragDepth||!this.isWebGL1(),regen:!1}}getContext(){return this._gl}getCanvas(){return this._canvas}isLost(){return this._gl.isContextLost()}getPrecision(){return this._precision}setClearColorHex(t,r){this._clearColor.setHex(t),this._clearAlpha=r,this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha)}enableOutline(t){this._outlineMaterial=new y.MeshOutlineMaterial(t),this._outlineSphereImposterMaterial=new y.SphereImposterOutlineMaterial(t),this._outlineStickImposterMaterial=new y.StickImposterOutlineMaterial(t),this._outlineEnabled=!0}disableOutline(){this._outlineEnabled=!1}setViewport(){if(this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null){var t=this._canvas.width/this.cols,r=this._canvas.height/this.rows;this._viewportWidth=t,this._viewportHeight=r,this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(t*this.col,r*this.row,t,r),this._gl.viewport(t*this.col,r*this.row,t,r)}}setSize(t,r){if(this.devicePixelRatio=window.devicePixelRatio!==void 0?window.devicePixelRatio:1,this._antialias&&this.devicePixelRatio<2&&(this.devicePixelRatio*=2),this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null){var h=t/this.cols,s=r/this.rows;this._canvas.width=t*this.devicePixelRatio,this._canvas.height=r*this.devicePixelRatio,this._viewportWidth=h*this.devicePixelRatio,this._viewportHeight=s*this.devicePixelRatio,this._canvas.style.width=t+"px",this._canvas.style.height=r+"px",this.setViewport()}else this._viewportWidth=this._canvas.width=t*this.devicePixelRatio,this._viewportHeight=this._canvas.height=r*this.devicePixelRatio,this._canvas.style.width=t+"px",this._canvas.style.height=r+"px",this._gl.viewport(0,0,this._gl.drawingBufferWidth,this._gl.drawingBufferHeight);this.initFrameBuffer()}clear(t,r,h){var s=0;(t===void 0||t)&&(s|=this._gl.COLOR_BUFFER_BIT),(r===void 0||r)&&(s|=this._gl.DEPTH_BUFFER_BIT),(h===void 0||h)&&(s|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(s)}clearTarget(t,r,h){this.clear(t,r,h)}setMaterialFaces(t,r){var h=t.side===T.DoubleSide,s=t.side===T.BackSide;t.imposter||(s=r?!s:s),this._oldDoubleSided!==h&&(h?this._gl.disable(this._gl.CULL_FACE):this._gl.enable(this._gl.CULL_FACE),this._oldDoubleSided=h),this._oldFlipSided!==s&&(s?this._gl.frontFace(this._gl.CW):this._gl.frontFace(this._gl.CCW),this._oldFlipSided=s),this._gl.cullFace(this._gl.BACK)}setDepthTest(t){this._oldDepthTest!==t&&(t?this._gl.enable(this._gl.DEPTH_TEST):this._gl.disable(this._gl.DEPTH_TEST),this._oldDepthTest=t)}setDepthWrite(t){this._oldDepthWrite!==t&&(this._gl.depthMask(t),this._oldDepthWrite=t)}setBlending(t){t?(this._gl.enable(this._gl.BLEND),this._gl.blendEquationSeparate(this._gl.FUNC_ADD,this._gl.FUNC_ADD),this._gl.blendFuncSeparate(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA)):this._gl.disable(this._gl.BLEND)}initMaterial(t,r,h,s){t.addEventListener("dispose",this.onMaterialDispose.bind(this));var o,e;if(e=t.shaderID,e){var n=M.ShaderLib[e];t.vertexShader=n.vertexShader,t.fragmentShader=n.fragmentShader,t.uniforms=M.ShaderUtils.clone(n.uniforms)}o={wireframe:t.wireframe,fragdepth:t.imposter,volumetric:t.volumetric},t.program=this.buildProgram(t.fragmentShader,t.vertexShader,t.uniforms,o)}renderBuffer(t,r,h,s,o,e){if(s.visible){var n,a;if(n=this.setProgram(t,r,h,s,e,this),!!n){a=n.attributes;var g=!1,f=s.wireframe?1:0,E=o.id*16777215+n.id*2+f;E!==this._currentGeometryGroupHash&&(this._currentGeometryGroupHash=E,g=!0),g&&(this.disableAttributes(),a.position>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,o.__webglVertexBuffer),this.enableAttribute(a.position),this._gl.vertexAttribPointer(a.position,3,this._gl.FLOAT,!1,0,0)),a.color>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,o.__webglColorBuffer),this.enableAttribute(a.color),this._gl.vertexAttribPointer(a.color,3,this._gl.FLOAT,!1,0,0)),a.normal>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,o.__webglNormalBuffer),this.enableAttribute(a.normal),this._gl.vertexAttribPointer(a.normal,3,this._gl.FLOAT,!1,0,0)),a.offset>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,o.__webglOffsetBuffer),this.enableAttribute(a.offset),this._gl.vertexAttribPointer(a.offset,3,this._gl.FLOAT,!1,0,0)),a.radius>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,o.__webglRadiusBuffer),this.enableAttribute(a.radius),this._gl.vertexAttribPointer(a.radius,1,this._gl.FLOAT,!1,0,0)));var w,R;if(e instanceof v.Mesh){if(s.shaderID==="instanced"){var z=s.sphere.geometryGroups[0];g&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,o.__webglVertexBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,z.vertexArray,this._gl.STATIC_DRAW),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,o.__webglNormalBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,z.normalArray,this._gl.STATIC_DRAW),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,o.__webglFaceBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,z.faceArray,this._gl.STATIC_DRAW)),w=z.faceidx,this._extInstanced.vertexAttribDivisorANGLE(a.offset,1),this._extInstanced.vertexAttribDivisorANGLE(a.radius,1),this._extInstanced.vertexAttribDivisorANGLE(a.color,1),this._extInstanced.drawElementsInstancedANGLE(this._gl.TRIANGLES,w,this._gl.UNSIGNED_SHORT,0,o.radiusArray.length),this._extInstanced.vertexAttribDivisorANGLE(a.offset,0),this._extInstanced.vertexAttribDivisorANGLE(a.radius,0),this._extInstanced.vertexAttribDivisorANGLE(a.color,0)}else s.wireframe?(R=o.lineidx,this.setLineWidth(s.wireframeLinewidth),g&&this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,o.__webglLineBuffer),this._gl.drawElements(this._gl.LINES,R,this._gl.UNSIGNED_SHORT,0)):(w=o.faceidx,g&&this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,o.__webglFaceBuffer),this._gl.drawElements(this._gl.TRIANGLES,w,this._gl.UNSIGNED_SHORT,0));this.info.render.calls++,this.info.render.vertices+=w,this.info.render.faces+=w/3}else e instanceof v.Line&&(R=o.vertices,this.setLineWidth(s.linewidth),this._gl.drawArrays(this._gl.LINES,0,R),this.info.render.calls++)}}}render(t,r,h){if(!(r instanceof A.Camera)){console.error("Renderer.render: camera is not an instance of Camera.");return}var s,o,e,n,a,g=t.__lights,f=t.fog;this._currentMaterialId=-1,this._lightsNeedUpdate=!0,this.autoUpdateScene&&t.updateMatrixWorld(),r.parent===void 0&&r.updateMatrixWorld(),r.matrixWorldInverse.getInverse(r.matrixWorld),this._projScreenMatrix.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this.autoUpdateObjects&&this.initWebGLObjects(t),this.info.render.calls=0,this.info.render.vertices=0,this.info.render.faces=0,this.info.render.points=0,this._currentWidth=this._viewportWidth,this._currentHeight=this._viewportHeight,this.setViewport(),this.setFrameBuffer(),(this.autoClear||h)&&(this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha),this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil)),a=t.__webglObjects;var E=!1;for(s=0,o=a.length;s<o;s++)e=a[s],n=e.object,e.render=!1,n.visible&&(this.setupMatrices(n,r),this.unrollBufferMaterial(e),e.render=!0,e.volumetric&&(E=!0));var w=null;this.setBlending(!1),this.renderObjects(t.__webglObjects,!0,"opaque",r,g,f,!1,w),this.renderSprites(t,r,!1),this.renderObjects(t.__webglObjects,!0,"blank",r,g,f,!0,w),this.renderObjects(t.__webglObjects,!1,"transparent",r,g,f,!0,w),E&&this._fb&&(this.reinitFrameBuffer(),this.renderObjects(t.__webglObjects,!1,"volumetric",r,g,f,!0,w)),this.renderFrameBuffertoScreen(),this.setDepthTest(!0),this.setDepthWrite(!0),this.renderSprites(t,r,!0)}reinitFrameBuffer(){this.isWebGL1()||(this._fb=this._gl.createFramebuffer(),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._fb),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._targetTexture,0))}setFrameBuffer(){if(this.isWebGL1()||!this._fb)return;let t=this._viewportWidth,r=this._viewportHeight;this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(0,0,t,r),this._gl.viewport(0,0,t,r),this._gl.bindTexture(this._gl.TEXTURE_2D,this._targetTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,t,r,0,this._gl.RGBA,this._gl.UNSIGNED_BYTE,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.bindTexture(this._gl.TEXTURE_2D,this._depthTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.DEPTH_COMPONENT32F,t,r,0,this._gl.DEPTH_COMPONENT,this._gl.FLOAT,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._fb),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._targetTexture,0),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._depthTexture,0)}initFrameBuffer(){if(this.isWebGL1())return;let t=this._viewportWidth,r=this._viewportHeight;this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(0,0,t,r),this._gl.viewport(0,0,t,r),this._targetTexture=this._gl.createTexture(),this._depthTexture=this._gl.createTexture(),this._fb=this._gl.createFramebuffer();var h=M.ShaderLib.screen;this._screenshader=this.buildProgram(h.fragmentShader,h.vertexShader,h.uniforms,{}),this._vertexattribpos=this._gl.getAttribLocation(this._screenshader,"vertexPosition");var s=[1,1,-1,1,-1,-1,-1,-1,1,-1,1,1];this._screenQuadVBO=this._gl.createBuffer(),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(s),this._gl.STATIC_DRAW)}renderFrameBuffertoScreen(){this.isWebGL1()||this._fb===null||(this.setViewport(),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._gl.frontFace(this._gl.CCW),this._gl.cullFace(this._gl.BACK),this._gl.useProgram(this._screenshader),this._currentProgram=this._screenshader,this.setDepthTest(-1),this.setDepthWrite(-1),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.enableVertexAttribArray(this._vertexattribpos),this._gl.vertexAttribPointer(this._vertexattribpos,2,this._gl.FLOAT,!1,0,0),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,this._targetTexture),this._gl.drawArrays(this._gl.TRIANGLES,0,6))}initWebGLObjects(t){if(t.__webglObjects||(t.__webglObjects=[],t.__webglObjectsImmediate=[],t.__webglSprites=[],t.__webglFlares=[]),t.__objectsAdded.length){for(;t.__objectsAdded.length;)this.addObject(t.__objectsAdded[0],t),t.__objectsAdded.splice(0,1);this._currentGeometryGroupHash=-1}for(;t.__objectsRemoved.length;)this.removeObject(t.__objectsRemoved[0],t),t.__objectsRemoved.splice(0,1);for(var r=0,h=t.__webglObjects.length;r<h;r++)this.updateObject(t.__webglObjects[r].object)}getYRatio(){return this.rows!==void 0&&this.row!==void 0?this.rows:1}getXRatio(){return this.cols!==void 0&&this.col!==void 0?this.cols:1}getAspect(t,r){(t==null||r==null)&&(t=this._canvas.width,r=this._canvas.height);var h=t/r;if(this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null){var s=t/this.cols,o=r/this.rows;h=s/o}return h}setTexture(t,r,h){if(t.needsUpdate){t.__webglInit||(t.__webglInit=!0,t.addEventListener("dispose",this.onTextureDispose.bind(this)),t.__webglTexture=this._gl.createTexture(),this.info.memory.textures++),this._gl.activeTexture(this._gl.TEXTURE0+r);var s=h?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D;this._gl.bindTexture(s,t.__webglTexture),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,t.flipY),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,t.unpackAlignment),this._gl.pixelStorei(this._gl.PACK_ALIGNMENT,t.unpackAlignment);var o=this.paramToGL(t.format),e=this.paramToGL(t.type);if(h)this.setTextureParameters(this._gl.TEXTURE_3D,t),this._gl.texImage3D(this._gl.TEXTURE_3D,0,this._gl.R32F,t.image.size.z,t.image.size.y,t.image.size.x,0,this._gl.RED,this._gl.FLOAT,t.image.data);else{var n=t.image,a=n.width,g=n.height;typeof a>"u"&&(a=n.length,o==this._gl.RGBA&&(a/=4),g=1),this.setTextureParameters(this._gl.TEXTURE_2D,t),this.isWebGL1()?this._gl.texImage2D(this._gl.TEXTURE_2D,0,o,o,e,t.image):this._gl.texImage2D(this._gl.TEXTURE_2D,0,o,a,g,0,o,e,t.image)}t.needsUpdate=!1,t.onUpdate&&t.onUpdate()}else this._gl.activeTexture(this._gl.TEXTURE0+r),h?this._gl.bindTexture(this._gl.TEXTURE_3D,t.__webglTexture):this._gl.bindTexture(this._gl.TEXTURE_2D,t.__webglTexture)}supportsVolumetric(){return!this.isWebGL1()}enableAttribute(t){this._enabledAttributes[t]||(this._gl.enableVertexAttribArray(t),this._enabledAttributes[t]=!0)}disableAttributes(){for(let t in this._enabledAttributes)this._enabledAttributes[t]&&(this._gl.disableVertexAttribArray(t),this._enabledAttributes[t]=!1)}setPolygonOffset(t,r,h){this._oldPolygonOffset!==t&&(t?this._gl.enable(this._gl.POLYGON_OFFSET_FILL):this._gl.disable(this._gl.POLYGON_OFFSET_FILL))}setLineWidth(t){t!==this._oldLineWidth&&(this._gl.lineWidth(t),this._oldLineWidth=t)}deallocateGeometry(t){if(t.__webglInit=void 0,t.__webglVertexBuffer!==void 0&&this._gl.deleteBuffer(t.__webglVertexBuffer),t.__webglColorBuffer!==void 0&&this._gl.deleteBuffer(t.__webglColorBuffer),t.geometryGroups!==void 0)for(var r=0,h=t.groups;r<h;r++){var s=t.geometryGroups[r];s.__webglVertexBuffer!==void 0&&this._gl.deleteBuffer(s.__webglVertexBuffer),s.__webglColorBuffer!==void 0&&this._gl.deleteBuffer(s.__webglColorBuffer),s.__webglNormalBuffer!==void 0&&this._gl.deleteBuffer(s.__webglNormalBuffer),s.__webglFaceBuffer!==void 0&&this._gl.deleteBuffer(s.__webglFaceBuffer),s.__webglLineBuffer!==void 0&&this._gl.deleteBuffer(s.__webglLineBuffer)}}deallocateMaterial(t){var r=t.program;if(r!==void 0){t.program=void 0;var h,s,o,e=!1;for(h=0,s=this._programs.length;h<s;h++)if(o=this._programs[h],o.program===r){o.usedTimes--,o.usedTimes===0&&(e=!0);break}if(e===!0){var n=[];for(h=0,s=this._programs.length;h<s;h++)o=this._programs[h],o.program!==r&&n.push(o);this._programs=n,this._gl.deleteProgram(r),this.info.memory.programs--}}}deallocateTexture(t){if(t.image&&t.image.__webglTextureCube)this._gl.deleteTexture(t.image.__webglTextureCube);else{if(!t.__webglInit)return;t.__webglInit=!1,this._gl.deleteTexture(t.__webglTexture)}}onGeometryDispose(t){var r=t.target;r.removeEventListener("dispose",this.onGeometryDispose),this.deallocateGeometry(r),this.info.memory.geometries--}onTextureDispose(t){var r=t.target;r.removeEventListener("dispose",this.onTextureDispose),this.deallocateTexture(r),this.info.memory.textures--}onMaterialDispose(t){var r=t.target;r.removeEventListener("dispose",this.onMaterialDispose),this.deallocateMaterial(r)}getShader(t,r){var h;return!this.isWebGL1()&&!r.startsWith("#version")&&(r=r.replace(/gl_FragDepthEXT/g,"gl_FragDepth"),t=="fragment"?r=r.replace(/varying/g,"in"):r=r.replace(/varying/g,"out"),r=r.replace(/attribute/g,"in"),r=r.replace(/texture2D/g,"texture"),r=r.replace(/\/\/DEFINEFRAGCOLOR/g,"out vec4 glFragColor;"),r=r.replace(/gl_FragColor/g,"glFragColor"),r=`#version 300 es
`+r),t==="fragment"?h=this._gl.createShader(this._gl.FRAGMENT_SHADER):t==="vertex"&&(h=this._gl.createShader(this._gl.VERTEX_SHADER)),h==null?null:(this._gl.shaderSource(h,r),this._gl.compileShader(h),this._gl.getShaderParameter(h,this._gl.COMPILE_STATUS)?h:(console.error(this._gl.getShaderInfoLog(h)),console.error("could not initialize shader"),null))}buildProgram(t,r,h,s){var o,e,n,a,g=[];g.push(t),g.push(r);for(o in s)g.push(o),g.push(s[o]);for(a=g.join(),o=0,e=this._programs.length;o<e;o++){var f=this._programs[o];if(f.code===a)return f.usedTimes++,f.program}if(this.isWebGL1()&&s.volumetric)throw new Error("Volumetric rendering requires webgl2 which is not supported by your hardware.");if(n=this._gl.createProgram(),n==null)return null;var E=this._precision,w="precision "+E+" float;",R=[s.volumetric?"#version 300 es":"",w].join(`
`),z=[s.volumetric?"#version 300 es":"",s.fragdepth&&this.isWebGL1()?"#extension GL_EXT_frag_depth: enable":"",s.wireframe?"#define WIREFRAME 1":"",w].join(`
`),S=this.getShader("fragment",z+t),I=this.getShader("vertex",R+r);I!=null&&this._gl.attachShader(n,I),S!=null&&this._gl.attachShader(n,S),this._gl.linkProgram(n),this._gl.getProgramParameter(n,this._gl.LINK_STATUS)||console.error("Could not initialize shader"),n.uniforms={},n.attributes={};var F,G,B;F=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix"];for(G in h)F.push(G);for(B=0;B<F.length;B++){var W=F[B];n.uniforms[W]=this._gl.getUniformLocation(n,W)}for(F=["position","normal","color","lineDistance","offset","radius"],B=0;B<F.length;B++){var V=F[B];n.attributes[V]=this._gl.getAttribLocation(n,V)}return n.id=this._programs_counter++,this._programs.push({program:n,code:a,usedTimes:1}),this.info.memory.programs=this._programs.length,n}setProgram(t,r,h,s,o,e){if(s.needsUpdate&&(s.program&&this.deallocateMaterial(s),this.initMaterial(s,r,h,o),s.needsUpdate=!1),s.program==null)return null;var n=!1,a=s.program,g=a.uniforms,f=s.uniforms;if(a!=this._currentProgram&&(this._gl.useProgram(a),this._currentProgram=a,n=!0),s.id!=this._currentMaterialId&&(this._currentMaterialId=s.id,n=!0),t!=this._currentCamera&&(this._currentCamera=t,n=!0),this._gl.uniformMatrix4fv(g.projectionMatrix,!1,t.projectionMatrix.elements),this._gl.uniformMatrix4fv(g.modelViewMatrix,!1,o._modelViewMatrix.elements),this._gl.uniformMatrix3fv(g.normalMatrix,!1,o._normalMatrix.elements),n){if(f.fogColor.value=h.color,f.fogNear.value=h.near,f.fogFar.value=h.far,s.shaderID.startsWith("lambert")||s.shaderID==="instanced"||s.shaderID.endsWith("imposter"))this._gl.uniformMatrix4fv(g.viewMatrix,!1,t.matrixWorldInverse.elements),this._lightsNeedUpdate&&(this.setupLights(a,r),this._lightsNeedUpdate=!1),f.directionalLightColor.value=this._lights.directional.colors,f.directionalLightDirection.value=this._lights.directional.positions;else if(s.shaderID.endsWith("outline"))f.outlineColor.value=s.outlineColor,f.outlineWidth.value=s.outlineWidth,f.outlinePushback.value=s.outlinePushback;else if(s.shaderID==="volumetric"){o._modelViewMatrix.getScale(this._direction),this._worldInverse.getInverse(o._modelViewMatrix),this._projInverse.getInverse(t.projectionMatrix),this._textureMatrix.multiplyMatrices(o.material.texmatrix,this._worldInverse),this._gl.uniformMatrix4fv(g.textmat,!1,this._textureMatrix.elements),this._gl.uniformMatrix4fv(g.projinv,!1,this._projInverse.elements);let E=Math.min(Math.min(this._direction.x,this._direction.y),this._direction.z);f.step.value=o.material.unit*E,f.maxdepth.value=o.material.maxdepth*E,f.transfermax.value=o.material.transfermax,f.transfermin.value=o.material.transfermin,f.subsamples.value=o.material.subsamples,e.setTexture(o.material.transferfn,4,!1),e.setTexture(o.material.map,3,!0),this._gl.activeTexture(this._gl.TEXTURE5),this._gl.bindTexture(this._gl.TEXTURE_2D,this._depthTexture)}f.opacity.value=s.opacity,this.loadMaterialUniforms(g,f)}return a}loadMaterialUniforms(t,r){var h,s,o,e;for(h in r)t[h]&&(s=r[h].type,o=r[h].value,e=t[h],s==="f"?this._gl.uniform1f(e,o):s==="i"?this._gl.uniform1i(e,o):s==="fv"?this._gl.uniform3fv(e,o):s==="c"?this._gl.uniform3f(e,o.r,o.g,o.b):s==="f4"&&this._gl.uniform4f(e,o[0],o[1],o[2],o[3]))}addObject(t,r){var h,s,o,e;if(!t.__webglInit&&(t.__webglInit=!0,t._modelViewMatrix=new C.Matrix4,t._normalMatrix=new C.Matrix3,t.geometry!==void 0&&t.geometry.__webglInit===void 0&&(t.geometry.__webglInit=!0,t.geometry.addEventListener("dispose",this.onGeometryDispose.bind(this))),t instanceof v.Mesh||t instanceof v.Line))for(o=t.geometry,h=0,s=o.geometryGroups.length;h<s;h++)e=o.geometryGroups[h],e.id=this._geometryGroupCounter++,e.__webglVertexBuffer||(t instanceof v.Mesh?(this.createMeshBuffers(e),o.elementsNeedUpdate=!0,o.normalsNeedUpdate=!0):t instanceof v.Line&&this.createLineBuffers(e),o.verticesNeedUpdate=!0,o.colorsNeedUpdate=!0);if(!t.__webglActive){if(t instanceof v.Mesh||t instanceof v.Line)for(o=t.geometry,h=0,s=o.geometryGroups.length;h<s;h++)e=o.geometryGroups[h],this.addBuffer(r.__webglObjects,e,t);else t instanceof v.Sprite&&r.__webglSprites.push(t);t.__webglActive=!0}}updateObject(t){var r=t.geometry,h;if(t instanceof v.Mesh||t instanceof v.Line){for(var s=0,o=r.geometryGroups.length;s<o;s++)h=r.geometryGroups[s],(r.verticesNeedUpdate||r.elementsNeedUpdate||r.colorsNeedUpdate||r.normalsNeedUpdate)&&this.setBuffers(h,this._gl.STATIC_DRAW);r.verticesNeedUpdate=!1,r.elementsNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.buffersNeedUpdate=!1}}removeObject(t,r){t instanceof v.Mesh||t instanceof v.Line?this.removeInstances(r.__webglObjects,t):t instanceof v.Sprite&&this.removeInstancesDirect(r.__webglSprites,t),t.__webglActive=!1}removeInstances(t,r){for(var h=t.length-1;h>=0;--h)t[h].object===r&&t.splice(h,1)}removeInstancesDirect(t,r){for(var h=t.length-1;h>=0;--h)t[h]===r&&t.splice(h,1)}unrollBufferMaterial(t){var r=t.object,h=r.material;if(h.volumetric)t.opaque=null,t.transparent=null,t.volumetric=h;else if(h.transparent){if(t.opaque=null,t.volumetric=null,t.transparent=h,!h.wireframe){var s=h.clone();s.opacity=0,t.blank=s}}else t.opaque=h,t.transparent=null,t.volumetric=null}setBuffers(t,r){var h=t.vertexArray,s=t.colorArray;if(t.__webglOffsetBuffer!==void 0?(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.__webglOffsetBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,h,r)):(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.__webglVertexBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,h,r)),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.__webglColorBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,s,r),t.normalArray&&t.__webglNormalBuffer!==void 0){var o=t.normalArray;this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.__webglNormalBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,o,r)}if(t.radiusArray&&t.__webglRadiusBuffer!==void 0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.__webglRadiusBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,t.radiusArray,r)),t.faceArray&&t.__webglFaceBuffer!==void 0){var e=t.faceArray;this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t.__webglFaceBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,e,r)}if(t.lineArray&&t.__webglLineBuffer!==void 0){var n=t.lineArray;this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t.__webglLineBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,n,r)}}createMeshBuffers(t){t.radiusArray&&(t.__webglRadiusBuffer=this._gl.createBuffer()),t.useOffset&&(t.__webglOffsetBuffer=this._gl.createBuffer()),t.__webglVertexBuffer=this._gl.createBuffer(),t.__webglNormalBuffer=this._gl.createBuffer(),t.__webglColorBuffer=this._gl.createBuffer(),t.__webglFaceBuffer=this._gl.createBuffer(),t.__webglLineBuffer=this._gl.createBuffer(),this.info.memory.geometries++}createLineBuffers(t){t.__webglVertexBuffer=this._gl.createBuffer(),t.__webglColorBuffer=this._gl.createBuffer(),this.info.memory.geometries++}addBuffer(t,r,h){t.push({buffer:r,object:h,opaque:null,transparent:null})}setupMatrices(t,r){t._modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld),t._normalMatrix.getInverse(t._modelViewMatrix),t._normalMatrix.transpose()}filterFallback(t){return this._gl.LINEAR}setTextureParameters(t,r){t==this._gl.TEXTURE_2D?(this._gl.texParameteri(t,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(t,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(t,this._gl.TEXTURE_MAG_FILTER,this.filterFallback(r.magFilter)),this._gl.texParameteri(t,this._gl.TEXTURE_MIN_FILTER,this.filterFallback(r.minFilter))):(this._gl.texParameteri(t,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(t,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(t,this._gl.TEXTURE_WRAP_R,this._gl.CLAMP_TO_EDGE),this._extColorBufferFloat&&this._extFloatLinear?(this._gl.texParameteri(t,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(t,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR)):(this._gl.texParameteri(t,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(t,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST)))}paramToGL(t){return t===D.UnsignedByteType?this._gl.UNSIGNED_BYTE:t===D.RGBAFormat?this._gl.RGBA:t===D.NearestFilter?this._gl.NEAREST:0}setupLights(t,r){var h,s,o,e=0,n=0,a=0,g,f,E=this._lights,w=E.directional.colors,R=E.directional.positions,z=0,S=0;for(h=0,s=r.length;h<s;h++)if(o=r[h],g=o.color,f=o.intensity,o instanceof P.Light){if(this._direction.getPositionFromMatrix(o.matrixWorld),this._vector3.getPositionFromMatrix(o.target.matrixWorld),this._direction.sub(this._vector3),this._direction.normalize(),this._direction.x===0&&this._direction.y===0&&this._direction.z===0)continue;R[S]=this._direction.x,R[S+1]=this._direction.y,R[S+2]=this._direction.z,w[S]=g.r*f,w[S+1]=g.g*f,w[S+2]=g.b*f,S+=3,z++}E.ambient[0]=e,E.ambient[1]=n,E.ambient[2]=a,E.directional.length=z}initGL(){try{if(!(this._gl=this._canvas.getContext("webgl2",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:this._stencil,preserveDrawingBuffer:this._preserveDrawingBuffer}))&&!(this._gl=this._canvas.getContext("experimental-webgl",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:this._stencil,preserveDrawingBuffer:this._preserveDrawingBuffer}))&&!(this._gl=this._canvas.getContext("webgl",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:this._stencil,preserveDrawingBuffer:this._preserveDrawingBuffer})))throw"Error creating WebGL context.";var t=this._gl.getParameter(this._gl.VERSION);this._webglversion=parseInt(t[6])}catch(r){console.error(r)}}isWebGL1(){return this._webglversion==1}setDefaultGLState(){this._gl.clearColor(0,0,0,1),this._gl.clearDepth(1),this._gl.clearStencil(0),this._gl.enable(this._gl.DEPTH_TEST),this._gl.depthFunc(this._gl.LEQUAL),this._gl.frontFace(this._gl.CCW),this._gl.cullFace(this._gl.BACK),this._gl.enable(this._gl.CULL_FACE),this._gl.enable(this._gl.BLEND),this._gl.blendEquation(this._gl.FUNC_ADD),this._gl.blendFunc(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha)}renderObjects(t,r,h,s,o,e,n,w){var g,f,E,w,R,z,S;r?(R=t.length-1,z=-1,S=-1):(R=0,z=t.length,S=1);for(var I=R;I!==z;I+=S)if(g=t[I],g.render){if(f=g.object,E=g.buffer,w=g[h],!w)continue;n&&this.setBlending(!0),this.setDepthTest(w.depthTest),this.setDepthWrite(w.depthWrite),this.setPolygonOffset(w.polygonOffset,w.polygonOffsetFactor,w.polygonOffsetUnits);var F=f._modelViewMatrix.isReflected();this.setMaterialFaces(w,F),this.renderBuffer(s,o,e,w,E,f),(this._outlineEnabled||w.outline)&&(w.shaderID=="sphereimposter"?this.renderBuffer(s,o,e,this._outlineSphereImposterMaterial,E,f):w.shaderID=="stickimposter"?this.renderBuffer(s,o,e,this._outlineStickImposterMaterial,E,f):!w.wireframe&&w.shaderID!=="basic"&&w.opacity!==0&&this.renderBuffer(s,o,e,this._outlineMaterial,E,f))}}renderSprites(t,r,h){this._currentGeometryGroupHash=-1,this._currentProgram=null,this._currentCamera=null,this._oldDepthWrite=-1,this._oldDepthTest=-1,this._oldDoubleSided=-1,this._currentMaterialId=-1,this._oldFlipSided=-1,this._lightsNeedUpdate=!0,this.sprites.render(t,r,this._currentWidth,this._currentHeight,h),this._currentGeometryGroupHash=-1,this._currentProgram=null,this._currentCamera=null,this._oldDepthWrite=-1,this._oldDepthTest=-1,this._oldDoubleSided=-1,this._currentMaterialId=-1,this._oldFlipSided=-1}}},"./src/WebGL/SpritePlugin.ts":(X,L,c)=>{c.r(L),c.d(L,{SpritePlugin:()=>T});var A=c("./src/WebGL/shaders/index.ts");class T{constructor(){this.sprite={vertices:null,faces:null,vertexBuffer:null,elementBuffer:null,program:null,attributes:{},uniforms:null}}init(u){this.gl=u.context,this.renderer=u,this.precision=u.getPrecision(),this.sprite.vertices=new Float32Array(16),this.sprite.faces=new Uint16Array(6);var y=0;this.sprite.vertices[y++]=-1,this.sprite.vertices[y++]=-1,this.sprite.vertices[y++]=0,this.sprite.vertices[y++]=0,this.sprite.vertices[y++]=1,this.sprite.vertices[y++]=-1,this.sprite.vertices[y++]=1,this.sprite.vertices[y++]=0,this.sprite.vertices[y++]=1,this.sprite.vertices[y++]=1,this.sprite.vertices[y++]=1,this.sprite.vertices[y++]=1,this.sprite.vertices[y++]=-1,this.sprite.vertices[y++]=1,this.sprite.vertices[y++]=0,this.sprite.vertices[y++]=1,y=0,this.sprite.faces[y++]=0,this.sprite.faces[y++]=1,this.sprite.faces[y++]=2,this.sprite.faces[y++]=0,this.sprite.faces[y++]=2,this.sprite.faces[y++]=3,this.sprite.vertexBuffer=this.gl.createBuffer(),this.sprite.elementBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.sprite.vertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.sprite.vertices,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.elementBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.faces,this.gl.STATIC_DRAW),this.sprite.program=this.createProgram(A.ShaderLib.sprite,this.precision||1),this.sprite.attributes={};const C={};this.sprite.attributes.position=this.gl.getAttribLocation(this.sprite.program,"position"),this.sprite.attributes.uv=this.gl.getAttribLocation(this.sprite.program,"uv"),C.uvOffset=this.gl.getUniformLocation(this.sprite.program,"uvOffset"),C.uvScale=this.gl.getUniformLocation(this.sprite.program,"uvScale"),C.rotation=this.gl.getUniformLocation(this.sprite.program,"rotation"),C.scale=this.gl.getUniformLocation(this.sprite.program,"scale"),C.alignment=this.gl.getUniformLocation(this.sprite.program,"alignment"),C.color=this.gl.getUniformLocation(this.sprite.program,"color"),C.map=this.gl.getUniformLocation(this.sprite.program,"map"),C.opacity=this.gl.getUniformLocation(this.sprite.program,"opacity"),C.useScreenCoordinates=this.gl.getUniformLocation(this.sprite.program,"useScreenCoordinates"),C.screenPosition=this.gl.getUniformLocation(this.sprite.program,"screenPosition"),C.modelViewMatrix=this.gl.getUniformLocation(this.sprite.program,"modelViewMatrix"),C.projectionMatrix=this.gl.getUniformLocation(this.sprite.program,"projectionMatrix"),C.fogType=this.gl.getUniformLocation(this.sprite.program,"fogType"),C.fogDensity=this.gl.getUniformLocation(this.sprite.program,"fogDensity"),C.fogNear=this.gl.getUniformLocation(this.sprite.program,"fogNear"),C.fogFar=this.gl.getUniformLocation(this.sprite.program,"fogFar"),C.fogColor=this.gl.getUniformLocation(this.sprite.program,"fogColor"),C.alphaTest=this.gl.getUniformLocation(this.sprite.program,"alphaTest"),this.sprite.uniforms=C}render(u,y,C,v,M){var _,p,x,t,r,h,s,o,e,n;if(!this.gl)throw new Error("WebGLRenderer not initialized");let a=[];(_=u==null?void 0:u.__webglSprites)===null||_===void 0||_.forEach(q=>{(M&&q.material.depthTest==!1||!M&&q.material.depthTest)&&a.push(q)});let g=a.length;if(!g)return;const f=this.sprite.attributes,E=this.sprite.uniforms;if(!E)throw new Error("Uniforms not defined");var w=C*.5,R=v*.5;this.gl.useProgram(this.sprite.program),this.gl.enableVertexAttribArray(f.position),this.gl.enableVertexAttribArray(f.uv),this.gl.disable(this.gl.CULL_FACE),this.gl.enable(this.gl.BLEND),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.sprite.vertexBuffer),this.gl.vertexAttribPointer(f.position,2,this.gl.FLOAT,!1,16,0),this.gl.vertexAttribPointer(f.uv,2,this.gl.FLOAT,!1,16,8),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.elementBuffer),this.gl.uniformMatrix4fv(E.projectionMatrix,!1,y.projectionMatrix.elements),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.uniform1i(E.map,0);var z=0,S=0,I=u.fog;I?(this.gl.uniform3f(E.fogColor,I.color.r,I.color.g,I.color.b),this.gl.uniform1f(E.fogNear,I.near),this.gl.uniform1f(E.fogFar,I.far),this.gl.uniform1i(E.fogType,1),z=1,S=1):(this.gl.uniform1i(E.fogType,0),z=0,S=0);var F;let G,B,W,V,k=[];for(F=0;F<g;F++)G=a[F],B=G.material,B&&(B.depthTest==!1&&!M||!G.visible||B.opacity===0||(B.useScreenCoordinates?G.z=-G.position.z:(G._modelViewMatrix.multiplyMatrices(y.matrixWorldInverse,G.matrixWorld),G.z=-G._modelViewMatrix.elements[14])));for(a.sort(D),F=0;F<g;F++)if(G=a[F],B=G.material,!!B&&!(!G.visible||B.opacity===0)&&B.map&&B.map.image&&B.map.image.width){this.gl.uniform1f((E==null?void 0:E.alphaTest)||null,B.alphaTest);var U=B.map.image.width,j=B.map.image.height;k[0]=U*this.renderer.devicePixelRatio/C,k[1]=j*this.renderer.devicePixelRatio/v,B.useScreenCoordinates===!0?(this.gl.uniform1i(E.useScreenCoordinates,1),this.gl.uniform3f(E.screenPosition,(G.position.x*this.renderer.devicePixelRatio-w)/w,(R-G.position.y*this.renderer.devicePixelRatio)/R,Math.max(0,Math.min(1,G.position.z)))):(this.gl.uniform1i(E.useScreenCoordinates,0),this.gl.uniformMatrix4fv(E.modelViewMatrix,!1,G._modelViewMatrix.elements)),u.fog&&B.fog?V=S:V=0,z!==V&&(this.gl.uniform1i(E.fogType,V),z=V),W=1/(B.scaleByViewport?v:1),k[0]*=W*G.scale.x,k[1]*=W*G.scale.y;let q=(p=B==null?void 0:B.alignment)===null||p===void 0?void 0:p.x,ie=(x=B==null?void 0:B.alignment)===null||x===void 0?void 0:x.y;B.screenOffset&&(q=(q||0)+2*B.screenOffset.x/U,ie=(ie||0)+2*B.screenOffset.y/j),this.gl.uniform2f(E.uvScale,((t=B==null?void 0:B.uvScale)===null||t===void 0?void 0:t.x)||1,((r=B==null?void 0:B.uvScale)===null||r===void 0?void 0:r.y)||1),this.gl.uniform2f(E.uvOffset,((h=B==null?void 0:B.uvOffset)===null||h===void 0?void 0:h.x)||0,((s=B==null?void 0:B.uvOffset)===null||s===void 0?void 0:s.y)||0),this.gl.uniform2f(E.alignment,q||0,ie||0),this.gl.uniform1f(E.opacity,B.opacity),this.gl.uniform3f(E.color,((o=B==null?void 0:B.color)===null||o===void 0?void 0:o.r)||0,((e=B==null?void 0:B.color)===null||e===void 0?void 0:e.g)||0,((n=B==null?void 0:B.color)===null||n===void 0?void 0:n.b)||0),this.gl.uniform1f(E.rotation,G.rotation),this.gl.uniform2fv(E.scale,k),this.renderer.setDepthTest(B.depthTest),this.renderer.setDepthWrite(B.depthWrite),this.renderer.setTexture(B.map,0),this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0)}this.gl.enable(this.gl.CULL_FACE)}createProgram(u,y){if(!this.gl)throw new Error("WebGL Rendering context not found");var C=this.gl.createProgram();if(!C)throw new Error("Error creating webgl program");var v=this.gl.createShader(this.gl.FRAGMENT_SHADER),M=this.gl.createShader(this.gl.VERTEX_SHADER);if(!v)throw new Error("Unable to create fragment shader SpritePlugin.createProgram");if(!M)throw new Error("Unable to create vertex shader SpritePlugin.createProgram");var _="precision "+y+` float;
`;if(this.gl.shaderSource(v,_+u.fragmentShader),this.gl.shaderSource(M,_+u.vertexShader),this.gl.compileShader(v),this.gl.compileShader(M),!this.gl.getShaderParameter(v,this.gl.COMPILE_STATUS)||!this.gl.getShaderParameter(M,this.gl.COMPILE_STATUS))throw new Error(`Error compiling shader: 
      ${this.gl.getShaderInfoLog(v)} 
      ${this.gl.getShaderInfoLog(M)}`);return this.gl.attachShader(C,v),this.gl.attachShader(C,M),this.gl.linkProgram(C),this.gl.getProgramParameter(C,this.gl.LINK_STATUS)||console.error("Could not initialize shader"),C}}function D(P,u){return P.z!==u.z?u.z-P.z:u.id-P.id}},"./src/WebGL/constants/Coloring.ts":(X,L,c)=>{c.r(L),c.d(L,{Coloring:()=>A});var A;(function(T){T[T.NoColors=0]="NoColors",T[T.FaceColors=1]="FaceColors",T[T.VertexColors=2]="VertexColors"})(A||(A={}))},"./src/WebGL/constants/Shading.ts":(X,L,c)=>{c.r(L),c.d(L,{Shading:()=>A});var A;(function(T){T[T.NoShading=0]="NoShading",T[T.FlatShading=1]="FlatShading",T[T.SmoothShading=2]="SmoothShading"})(A||(A={}))},"./src/WebGL/constants/Sides.ts":(X,L,c)=>{c.r(L),c.d(L,{BackSide:()=>T,DoubleSide:()=>D,FrontSide:()=>A});const A=0,T=1,D=2},"./src/WebGL/constants/SpriteAlignment.ts":(X,L,c)=>{c.r(L),c.d(L,{SpriteAlignment:()=>T});var A=c("./src/WebGL/math/index.ts");const T={topLeft:new A.Vector2(1,-1),topCenter:new A.Vector2(0,-1),topRight:new A.Vector2(-1,-1),centerLeft:new A.Vector2(1,0),center:new A.Vector2(0,0),centerRight:new A.Vector2(-1,0),bottomLeft:new A.Vector2(1,1),bottomCenter:new A.Vector2(0,1),bottomRight:new A.Vector2(-1,1)}},"./src/WebGL/constants/TextureConstants.ts":(X,L,c)=>{c.r(L),c.d(L,{ClampToEdgeWrapping:()=>A,FloatType:()=>y,LinearFilter:()=>T,LinearMipMapLinearFilter:()=>P,NearestFilter:()=>D,R32Format:()=>M,RFormat:()=>v,RGBAFormat:()=>C,UnsignedByteType:()=>u});const A=1001,T=1006,D=1007,P=1008,u=1009,y=1010,C=1021,v=1022,M=1023},"./src/WebGL/constants/TextureOperations.ts":(X,L,c)=>{c.r(L),c.d(L,{TextureOperations:()=>A});var A;(function(T){T[T.MultiplyOperation=0]="MultiplyOperation",T[T.MixOperation=1]="MixOperation",T[T.AddOperation=2]="AddOperation"})(A||(A={}))},"./src/WebGL/constants/index.ts":(X,L,c)=>{c.r(L),c.d(L,{BackSide:()=>T.BackSide,ClampToEdgeWrapping:()=>u.ClampToEdgeWrapping,Coloring:()=>A.Coloring,DoubleSide:()=>T.DoubleSide,FloatType:()=>u.FloatType,FrontSide:()=>T.FrontSide,LinearFilter:()=>u.LinearFilter,LinearMipMapLinearFilter:()=>u.LinearMipMapLinearFilter,NearestFilter:()=>u.NearestFilter,R32Format:()=>u.R32Format,RFormat:()=>u.RFormat,RGBAFormat:()=>u.RGBAFormat,Shading:()=>D.Shading,SpriteAlignment:()=>P.SpriteAlignment,TextureOperations:()=>y.TextureOperations,UnsignedByteType:()=>u.UnsignedByteType});var A=c("./src/WebGL/constants/Coloring.ts"),T=c("./src/WebGL/constants/Sides.ts"),D=c("./src/WebGL/constants/Shading.ts"),P=c("./src/WebGL/constants/SpriteAlignment.ts"),u=c("./src/WebGL/constants/TextureConstants.ts"),y=c("./src/WebGL/constants/TextureOperations.ts")},"./src/WebGL/core/EventDispatcher.ts":(X,L,c)=>{c.r(L),c.d(L,{EventDispatcher:()=>A});class A{constructor(){this.listeners={}}dispatchEvent(D){var P=this.listeners[D.type];if(P!==void 0){D.target=this;for(var u=0,y=P.length;u<y;u++)P[u].call(this,D)}}removeEventListener(D,P){if(!P)this.listeners[D]=[];else{var u=this.listeners[D].indexOf(P);u!==-1&&this.listeners[D].splice(u,1)}}addEventListener(D,P){this.listeners[D]===void 0&&(this.listeners[D]=[]),this.listeners[D].indexOf(P)===-1&&this.listeners[D].push(P)}}},"./src/WebGL/core/Geometry.ts":(X,L,c)=>{c.r(L),c.d(L,{Geometry:()=>C,GeometryGroup:()=>y,GeometryIDCount:()=>v});var A=c("./src/WebGL/materials/LineBasicMaterial.ts"),T=c("./src/WebGL/core/EventDispatcher.ts"),D=c("./src/WebGL/math/index.ts"),P=c("./src/colors.ts");const u=65535;class y{constructor(_=0){this.vertexArray=null,this.colorArray=null,this.normalArray=null,this.radiusArray=null,this.faceArray=null,this.lineArray=null,this.vertices=0,this.faceidx=0,this.lineidx=0,this.__inittedArrays=!1,this.id=_}setColors(_){var p=this.vertexArray,x=this.colorArray;if(!p)throw new Error("vertex array not initialized");if(!x)throw new Error("color array not initialized");if(p.length!=x.length){console.log("Cannot re-color geometry group due to mismatched lengths.");return}for(var t=0;t<p.length;t+=3){var r=_(p[t],p[t+1],p[t+2]);r instanceof P.Color||(r=P.CC.color(r)),x[t]=r.r,x[t+1]=r.g,x[t+2]=r.b}}getNumVertices(){return this.vertices}getVertices(){return this.vertexArray}getCentroid(){if(!this.vertexArray)throw new Error("vertex array not initialized");for(var _=new D.Vector3,p,x,t,r,h=0;h<this.vertices;++h)p=h*3,x=this.vertexArray[p],t=this.vertexArray[p+1],r=this.vertexArray[p+2],_.x+=x,_.y+=t,_.z+=r;return _.divideScalar(this.vertices),_}setNormals(){var _=this.faceArray,p=this.vertexArray,x=this.normalArray;if(!(!this.vertices||!this.faceidx)){if(!_)throw new Error("face array not initialized");if(!p)throw new Error("vertex array not initialized");if(!x)throw new Error("normal array not initialized");for(var t,r,h,s,o,e,n,a=0;a<_.length/3;++a)t=_[a*3]*3,r=_[a*3+1]*3,h=_[a*3+2]*3,s=new D.Vector3(p[t],p[t+1],p[t+2]),o=new D.Vector3(p[r],p[r+1],p[r+2]),e=new D.Vector3(p[h],p[h+1],p[h+2]),s.subVectors(s,o),e.subVectors(e,o),e.cross(s),n=e,n.normalize(),x[t]+=n.x,x[r]+=n.x,x[h]+=n.x,x[t+1]+=n.y,x[r+1]+=n.y,x[h+1]+=n.y,x[t+2]+=n.z,x[r+2]+=n.z,x[h+2]+=n.z}}setLineIndices(){if(this.faceidx&&!(this.lineArray&&this.lineArray.length==this.faceidx*2&&this.lineidx==this.faceidx*2)){var _=this.faceArray,p=this.lineArray=new Uint16Array(this.faceidx*2);if(this.lineidx=this.faceidx*2,!_)throw new Error("face array not initialized");for(var x=0;x<this.faceidx/3;++x){var t=x*3,r=t*2,h=_[t],s=_[t+1],o=_[t+2];p[r]=h,p[r+1]=s,p[r+2]=h,p[r+3]=o,p[r+4]=s,p[r+5]=o}}}vrml(_,p){var x,t,r,h,s,o,e,n,a,g,f,E,w,R,z,S,I,F,G="";if(G+=_+`Shape {
`+_+` appearance Appearance {
`+_+`  material Material {
`+_+"   diffuseColor "+((x=p==null?void 0:p.color)===null||x===void 0?void 0:x.r)+" "+((t=p==null?void 0:p.color)===null||t===void 0?void 0:t.g)+" "+((r=p==null?void 0:p.color)===null||r===void 0?void 0:r.b)+`
`,p.wireframe&&this.colorArray){let W=this.colorArray;G+=_+"    emissiveColor "+W[0]+" "+W[1]+" "+W[2]+`
`}p!=null&&p.transparent&&(G+=_+"   transparency "+(1-p.opacity)+`
`),G+=_+`  }
`,G+=_+` }
`;var B=_;if(_+=" ",p instanceof A.LineBasicMaterial||p.wireframe){G+=_+`geometry IndexedLineSet {
`+_+` colorPerVertex TRUE
`+_+` coord Coordinate {
`+_+`  point [
`;let W,V,k;for(let U=0;U<this.vertices;++U){let j=U*3;W=(h=this.vertexArray)===null||h===void 0?void 0:h[j],V=(s=this.vertexArray)===null||s===void 0?void 0:s[j+1],k=(o=this.vertexArray)===null||o===void 0?void 0:o[j+2],G+=_+"   "+W+" "+V+" "+k+`,
`}if(G+=_+`  ]
`,G+=_+` }
`,this.colorArray&&!p.wireframe){G+=_+` color Color {
`+_+`  color [
`;for(let U=0;U<this.vertices;++U){let j=U*3;W=this.colorArray[j],V=this.colorArray[j+1],k=this.colorArray[j+2],G+=_+"   "+W+" "+V+" "+k+`,
`}G+=_+`  ]
`,G+=_+` }
`}if(G+=_+` coordIndex [
`,p.wireframe&&this.faceArray)for(let U=0;U<this.faceidx;U+=3)W=(e=this.faceArray)===null||e===void 0?void 0:e[U],V=(n=this.faceArray)===null||n===void 0?void 0:n[U+1],k=(a=this.faceArray)===null||a===void 0?void 0:a[U+2],G+=_+"  "+W+", "+V+", "+k+`, -1,
`;else for(let U=0;U<this.vertices-1;U+=2)G+=_+"  "+U+", "+(U+1)+`, -1,
`;G+=_+` ]
`,G+=_+`}
`}else{G+=_+`geometry IndexedFaceSet {
`+_+` colorPerVertex TRUE
`+_+` normalPerVertex TRUE
`+_+` solid FALSE
`,G+=_+` coord Coordinate {
`+_+`  point [
`;let W,V,k;for(let U=0;U<this.vertices;++U){let j=U*3;W=(g=this.vertexArray)===null||g===void 0?void 0:g[j],V=(f=this.vertexArray)===null||f===void 0?void 0:f[j+1],k=(E=this.vertexArray)===null||E===void 0?void 0:E[j+2],G+=_+"   "+W+" "+V+" "+k+`,
`}G+=_+`  ]
`,G+=_+` }
`,G+=_+` normal Normal {
`+_+`  vector [
`;for(let U=0;U<this.vertices;++U){let j=U*3;W=(w=this.normalArray)===null||w===void 0?void 0:w[j],V=(R=this.normalArray)===null||R===void 0?void 0:R[j+1],k=(z=this.normalArray)===null||z===void 0?void 0:z[j+2],G+=_+"   "+W+" "+V+" "+k+`,
`}if(G+=_+`  ]
`,G+=_+` }
`,this.colorArray){G+=_+` color Color {
`+_+`  color [
`;for(let U=0;U<this.vertices;++U){let j=U*3;W=this.colorArray[j],V=this.colorArray[j+1],k=this.colorArray[j+2],G+=_+"   "+W+" "+V+" "+k+`,
`}G+=_+`  ]
`,G+=_+` }
`}G+=_+` coordIndex [
`;for(let U=0;U<this.faceidx;U+=3)W=(S=this.faceArray)===null||S===void 0?void 0:S[U],V=(I=this.faceArray)===null||I===void 0?void 0:I[U+1],k=(F=this.faceArray)===null||F===void 0?void 0:F[U+2],G+=_+"  "+W+", "+V+", "+k+`, -1,
`;G+=_+` ]
`,G+=_+`}
`}return G+=B+"}",G}truncateArrayBuffers(_=!0,p=!1){var x=this.vertexArray,t=this.colorArray,r=this.normalArray,h=this.faceArray,s=this.lineArray,o=this.radiusArray;this.vertexArray=(x==null?void 0:x.subarray(0,this.vertices*3))||null,this.colorArray=(t==null?void 0:t.subarray(0,this.vertices*3))||null,_?(this.normalArray=(r==null?void 0:r.subarray(0,this.vertices*3))||null,this.faceArray=(h==null?void 0:h.subarray(0,this.faceidx))||null,this.lineidx>0?this.lineArray=(s==null?void 0:s.subarray(0,this.lineidx))||null:this.lineArray=new Uint16Array(0)):(this.normalArray=new Float32Array(0),this.faceArray=new Uint16Array(0),this.lineArray=new Uint16Array(0)),o&&(this.radiusArray=o.subarray(0,this.vertices)),p&&(this.normalArray&&(this.normalArray=new Float32Array(this.normalArray)),this.faceArray&&(this.faceArray=new Uint16Array(this.faceArray)),this.lineArray&&(this.lineArray=new Uint16Array(this.lineArray)),this.vertexArray&&(this.vertexArray=new Float32Array(this.vertexArray)),this.colorArray&&(this.colorArray=new Float32Array(this.colorArray)),this.radiusArray&&(this.radiusArray=new Float32Array(this.radiusArray))),this.__inittedArrays=!0}}class C extends T.EventDispatcher{constructor(_=!1,p=!1,x=!1){super(),this.name="",this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.buffersNeedUpdate=!1,this.imposter=!1,this.instanced=!1,this.geometryGroups=[],this.groups=0,this.id=v++,this.mesh=_,this.radii=p,this.offset=x}updateGeoGroup(_=0){var p,x=this.groups>0?this.geometryGroups[this.groups-1]:null;return(!x||x.vertices+_>(((p=x==null?void 0:x.vertexArray)===null||p===void 0?void 0:p.length)||0)/3)&&(x=this.addGeoGroup()),x}vrml(_,p){for(var x="",t=this.geometryGroups.length,r=0;r<t;r++){var h=this.geometryGroups[r];x+=h.vrml(_,p)+`,
`}return x}addGeoGroup(){var _=new y(this.geometryGroups.length);return this.geometryGroups.push(_),this.groups=this.geometryGroups.length,_.vertexArray=new Float32Array(u*3),_.colorArray=new Float32Array(u*3),this.mesh&&(_.normalArray=new Float32Array(u*3),_.faceArray=new Uint16Array(u*6),_.lineArray=new Uint16Array(u*6)),this.radii&&(_.radiusArray=new Float32Array(u)),_.useOffset=this.offset,_}setUpNormals(..._){for(var p=0;p<this.groups;p++){var x=this.geometryGroups[p];x.setNormals(..._)}}setColors(..._){for(var p=this.geometryGroups.length,x=0;x<p;x++){var t=this.geometryGroups[x];t.setColors(..._)}}setUpWireframe(..._){for(var p=0;p<this.groups;p++){var x=this.geometryGroups[p];x.setLineIndices(..._)}}initTypedArrays(){for(var _=0;_<this.groups;_++){var p=this.geometryGroups[_];p.__inittedArrays!==!0&&p.truncateArrayBuffers(this.mesh,!1)}}dispose(){this.dispatchEvent({type:"dispose"})}get vertices(){for(var _=0,p=0;p<this.groups;p++)_+=this.geometryGroups[p].vertices;return _}}let v=0},"./src/WebGL/core/Object3D.ts":(X,L,c)=>{c.r(L),c.d(L,{Light:()=>y,Object3D:()=>P,Object3DIDCount:()=>D,Scene:()=>u});var A=c("./src/WebGL/math/index.ts"),T=c("./src/colors.ts");let D=0;class P{constructor(){this.id=D++,this.name="",this.children=[],this.position=new A.Vector3,this.rotation=new A.Vector3,this.matrix=new A.Matrix4,this.matrixWorld=new A.Matrix4,this.quaternion=new A.Quaternion,this.eulerOrder="XYZ",this.up=new A.Vector3(0,1,0),this.scale=new A.Vector3(1,1,1),this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.rotationAutoUpdate=!0,this.useQuaternion=!1,this.visible=!0}lookAt(v){this.matrix.lookAt(v,this.position,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!0?console.error("Unimplemented math operation."):this.rotation instanceof A.Vector3&&this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder))}add(v){if(v===this){console.error("Can't add $3Dmol.Object3D to itself");return}v.parent=this,this.children.push(v);for(var M=this;M.parent!==void 0;)M=M.parent;M!==void 0&&M instanceof u&&M.__addObject(v)}remove(v){var M=this.children.indexOf(v);if(M!==-1){v.parent=void 0,this.children.splice(M,1);for(var _=this;_.parent!==void 0;)_=_.parent;_!==void 0&&_ instanceof u&&_.__removeObject(v)}}vrml(v){v||(v=" ");var M=2*Math.atan2(this.quaternion.lengthxyz(),this.quaternion.w),_=0,p=0,x=0;if(M!=0){let h=Math.sin(M/2);_=this.quaternion.x/h,p=this.quaternion.y/h,x=this.quaternion.z/h}var t=v+`Transform {
`+v+" center "+this.position.x+" "+this.position.y+" "+this.position.z+`
`+v+" rotation "+_+" "+p+" "+x+" "+M+`
`+v+` children [
`;this.geometry&&(t+=this.geometry.vrml(v,this.material));for(var r=0;r<this.children.length;r++)t+=this.children[r].vrml(v+" ")+`,
`;return t+=` ]
`,t+="}",t}updateMatrix(){this.matrix.setPosition(this.position),this.useQuaternion===!1&&this.rotation instanceof A.Vector3?this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(v){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||v===!0)&&(this.parent===void 0?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1;for(var M=0;M<this.children.length;M++)this.children[M].updateMatrixWorld(!0)}clone(v){v===void 0&&(v=new P),v.name=this.name,v.up.copy(this.up),v.position.copy(this.position),v.rotation instanceof A.Vector3&&this.rotation instanceof A.Vector3?v.rotation.copy(this.rotation):v.rotation=this.rotation,v.eulerOrder=this.eulerOrder,v.scale.copy(this.scale),v.rotationAutoUpdate=this.rotationAutoUpdate,v.matrix.copy(this.matrix),v.matrixWorld.copy(this.matrixWorld),v.quaternion.copy(this.quaternion),v.matrixAutoUpdate=this.matrixAutoUpdate,v.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,v.useQuaternion=this.useQuaternion,v.visible=this.visible;for(var M=0;M<this.children.length;M++){var _=this.children[M];v.add(_.clone())}return v}setVisible(v){this.visible=v;for(var M=0;M<this.children.length;M++){var _=this.children[M];_.setVisible(v)}}}class u extends P{constructor(){super(...arguments),this.fog=null,this.overrideMaterial=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]}__addObject(v){if(v instanceof y)this.__lights.indexOf(v)===-1&&this.__lights.push(v),v.target&&v.target.parent===void 0&&this.add(v.target);else if(this.__objects.indexOf(v)===-1){this.__objects.push(v),this.__objectsAdded.push(v);var M=this.__objectsRemoved.indexOf(v);M!==-1&&this.__objectsRemoved.splice(M,1)}for(var _=0;_<v.children.length;_++)this.__addObject(v.children[_])}__removeObject(v){var M;if(v instanceof y)M=this.__lights.indexOf(v),M!==-1&&this.__lights.splice(M,1);else if(M=this.__objects.indexOf(v),M!==-1){this.__objects.splice(M,1),this.__objectsRemoved.push(v);var _=this.__objectsAdded.indexOf(v);_!==-1&&this.__objectsAdded.splice(M,1)}for(var p=0;p<v.children.length;p++)this.__removeObject(v.children[p])}}class y extends P{constructor(v,M=1){super(),this.position=new A.Vector3(0,1,0),this.target=new P,this.castShadow=!1,this.onlyShadow=!1,this.color=new T.Color(v),this.intensity=M}}},"./src/WebGL/core/Projector.ts":(X,L,c)=>{c.r(L),c.d(L,{Projector:()=>D});var A=c("./src/WebGL/math/index.ts");const T=new A.Matrix4;class D{static unprojectVector(u,y){return y.projectionMatrixInverse.getInverse(y.projectionMatrix),T.multiplyMatrices(y.matrixWorld,y.projectionMatrixInverse),u.applyProjection(T)}static projectVector(u,y){return y.matrixWorldInverse.getInverse(y.matrixWorld),T.multiplyMatrices(y.projectionMatrix,y.matrixWorldInverse),u.applyProjection(T)}projectVector(u,y){return D.projectVector(u,y)}unprojectVector(u,y){return D.unprojectVector(u,y)}}},"./src/WebGL/core/Raycaster.ts":(X,L,c)=>{c.r(L),c.d(L,{Raycaster:()=>u,intersectObject:()=>h});var A=c("./src/WebGL/math/index.ts"),T=c("./src/WebGL/shapes/index.ts");const D=(s,o)=>s.distance-o.distance,P=new A.Matrix4;class u{constructor(o,e,n,a){this.precision=1e-4,this.linePrecision=.2,this.ray=new A.Ray(o,e),this.ray.direction.lengthSq()>0&&this.ray.direction.normalize(),this.near=a||0,this.far=n||1/0}set(o,e){this.ray.set(o,e)}setFromCamera(o,e){e.ortho?(this.ray.origin.set(o.x,o.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld)):(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(o.x,o.y,o.z),e.projectionMatrixInverse.getInverse(e.projectionMatrix),P.multiplyMatrices(e.matrixWorld,e.projectionMatrixInverse),this.ray.direction.applyProjection(P),this.ray.direction.sub(this.ray.origin).normalize())}intersectObjects(o,e){for(var n=[],a=0,g=e.length;a<g;a++)h(o,e[a],this,n);return n.sort(D),n}}const y=s=>Math.min(Math.max(s,-1),1);var C=new T.Sphere,v=new T.Cylinder,M=new T.Triangle,_=new A.Vector3,p=new A.Vector3,x=new A.Vector3,t=new A.Vector3,r=new A.Vector3;function h(s,o,e,n){if(r.getPositionFromMatrix(s.matrixWorld),o.intersectionShape===void 0)return n;var a=o.intersectionShape,g=e.linePrecision;g*=s.matrixWorld.getMaxScaleOnAxis();var f=g*g;if(o.boundingSphere!==void 0&&o.boundingSphere instanceof T.Sphere&&(C.copy(o.boundingSphere),C.applyMatrix4(s.matrixWorld),!e.ray.isIntersectionSphere(C)))return n;var E,w,R,z,S,I,F,G,B,W,V,k,U,j;for(E=0,w=a.triangle.length;E<w;E++)if(a.triangle[E]instanceof T.Triangle){if(M.copy(a.triangle[E]),M.applyMatrix4(s.matrixWorld),R=M.getNormal(),z=e.ray.direction.dot(R),z>=0||(_.subVectors(M.a,e.ray.origin),F=R.dot(_)/z,F<0))continue;p.copy(e.ray.direction).multiplyScalar(F).add(e.ray.origin),p.sub(M.a),x.copy(M.b).sub(M.a),t.copy(M.c).sub(M.a);var q=x.dot(t),ie=x.lengthSq(),ge=t.lengthSq();if(k=(ie*p.dot(t)-q*p.dot(x))/(ie*ge-q*q),k<0||k>1||(V=(p.dot(x)-k*q)/ie,V<0||V>1||V+k>1))continue;n.push({clickable:o,distance:F})}for(E=0,w=a.cylinder.length;E<w;E++)if(a.cylinder[E]instanceof T.Cylinder){if(v.copy(a.cylinder[E]),v.applyMatrix4(s.matrixWorld),_.subVectors(v.c1,e.ray.origin),S=_.dot(v.direction),I=_.dot(e.ray.direction),z=y(e.ray.direction.dot(v.direction)),B=1-z*z,B===0)continue;U=(z*I-S)/B,j=(I-z*S)/B,p.copy(v.direction).multiplyScalar(U).add(v.c1),x.copy(e.ray.direction).multiplyScalar(j).add(e.ray.origin),G=t.subVectors(p,x).lengthSq();var he=v.radius*v.radius;if(G<=he){if(W=(z*S-I)*(z*S-I)-B*(_.lengthSq()-S*S-he),W<=0?k=F=Math.sqrt(G):k=F=(I-z*S-Math.sqrt(W))/B,V=z*k-S,V<0||V*V>v.lengthSq()||k<0)continue;n.push({clickable:o,distance:F})}}for(E=0,w=a.line.length;E<w;E+=2){p.copy(a.line[E]),p.applyMatrix4(s.matrixWorld),x.copy(a.line[E+1]),x.applyMatrix4(s.matrixWorld),t.subVectors(x,p);var ve=t.lengthSq();t.normalize(),_.subVectors(p,e.ray.origin);var le=_.dot(t);I=_.dot(e.ray.direction),z=y(e.ray.direction.dot(t)),B=1-z*z,B!==0&&(U=(z*I-le)/B,j=(I-z*le)/B,p.add(t.multiplyScalar(U)),x.copy(e.ray.direction).multiplyScalar(j).add(e.ray.origin),G=t.subVectors(x,p).lengthSq(),G<f&&U*U<ve&&n.push({clickable:o,distance:j}))}for(E=0,w=a.sphere.length;E<w;E++)if(a.sphere[E]instanceof T.Sphere&&(C.copy(a.sphere[E]),C.applyMatrix4(s.matrixWorld),e.ray.isIntersectionSphere(C))){p.subVectors(C.center,e.ray.origin);var se=p.dot(e.ray.direction);if(W=se*se-(p.lengthSq()-C.radius*C.radius),se<0)return n;W<=0?F=se:F=se-Math.sqrt(W),n.push({clickable:o,distance:F})}return n}},"./src/WebGL/core/Texture.ts":(X,L,c)=>{c.r(L),c.d(L,{Texture:()=>u,TextureIdCount:()=>y});var A=c("./src/WebGL/constants/TextureConstants.ts"),T=c("./src/WebGL/math/index.ts"),D=c("./src/WebGL/core/EventDispatcher.ts"),P=c("./src/WebGL/core/UVMapping.ts");class u extends D.EventDispatcher{constructor(v,M){super(),this.id=y++,this.name="",this.image=v,this.mapping=new P.UVMapping,this.wrapS=A.ClampToEdgeWrapping,this.wrapT=A.ClampToEdgeWrapping,this.anisotropy=1,M?(this.format=A.RFormat,this.type=A.FloatType,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.magFilter=A.NearestFilter,this.minFilter=A.NearestFilter):(this.format=A.RGBAFormat,this.type=A.UnsignedByteType,this.offset=new T.Vector2(0,0),this.repeat=new T.Vector2(1,1),this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.magFilter=A.LinearFilter,this.minFilter=A.LinearMipMapLinearFilter),this.needsUpdate=!1,this.onUpdate=null}clone(v=new u){return v.image=this.image,v.mapping=this.mapping,v.wrapS=this.wrapS,v.wrapT=this.wrapT,v.magFilter=this.magFilter,v.minFilter=this.minFilter,v.anisotropy=this.anisotropy,v.format=this.format,v.type=this.type,v.offset.copy(this.offset),v.repeat.copy(this.repeat),v.premultiplyAlpha=this.premultiplyAlpha,v.flipY=this.flipY,v.unpackAlignment=this.unpackAlignment,v}dispose(){this.dispatchEvent({type:"dispose"})}}let y=0},"./src/WebGL/core/UVMapping.ts":(X,L,c)=>{c.r(L),c.d(L,{UVMapping:()=>A});class A{}},"./src/WebGL/core/index.ts":(X,L,c)=>{c.r(L),c.d(L,{EventDispatcher:()=>A.EventDispatcher,Geometry:()=>T.Geometry,GeometryGroup:()=>T.GeometryGroup,GeometryIDCount:()=>T.GeometryIDCount,Light:()=>D.Light,Object3D:()=>D.Object3D,Object3DIDCount:()=>D.Object3DIDCount,Projector:()=>P.Projector,Raycaster:()=>u.Raycaster,Scene:()=>D.Scene,Texture:()=>y.Texture,TextureIdCount:()=>y.TextureIdCount,UVMapping:()=>C.UVMapping,intersectObject:()=>u.intersectObject});var A=c("./src/WebGL/core/EventDispatcher.ts"),T=c("./src/WebGL/core/Geometry.ts"),D=c("./src/WebGL/core/Object3D.ts"),P=c("./src/WebGL/core/Projector.ts"),u=c("./src/WebGL/core/Raycaster.ts"),y=c("./src/WebGL/core/Texture.ts"),C=c("./src/WebGL/core/UVMapping.ts")},"./src/WebGL/index.ts":(X,L,c)=>{c.r(L),c.d(L,{BackSide:()=>A.BackSide,Camera:()=>v.Camera,ClampToEdgeWrapping:()=>A.ClampToEdgeWrapping,Coloring:()=>A.Coloring,Cylinder:()=>C.Cylinder,DoubleSide:()=>A.DoubleSide,EventDispatcher:()=>T.EventDispatcher,FloatType:()=>A.FloatType,Fog:()=>M.Fog,FrontSide:()=>A.FrontSide,Geometry:()=>T.Geometry,GeometryGroup:()=>T.GeometryGroup,GeometryIDCount:()=>T.GeometryIDCount,ImposterMaterial:()=>D.ImposterMaterial,InstancedMaterial:()=>D.InstancedMaterial,Light:()=>T.Light,Line:()=>u.Line,LineBasicMaterial:()=>D.LineBasicMaterial,LineStyle:()=>u.LineStyle,LinearFilter:()=>A.LinearFilter,LinearMipMapLinearFilter:()=>A.LinearMipMapLinearFilter,Material:()=>D.Material,MaterialIdCount:()=>D.MaterialIdCount,Matrix3:()=>P.Matrix3,Matrix4:()=>P.Matrix4,Mesh:()=>u.Mesh,MeshDoubleLambertMaterial:()=>D.MeshDoubleLambertMaterial,MeshLambertMaterial:()=>D.MeshLambertMaterial,MeshOutlineMaterial:()=>D.MeshOutlineMaterial,NearestFilter:()=>A.NearestFilter,Object3D:()=>T.Object3D,Object3DIDCount:()=>T.Object3DIDCount,Projector:()=>T.Projector,Quaternion:()=>P.Quaternion,R32Format:()=>A.R32Format,RFormat:()=>A.RFormat,RGBAFormat:()=>A.RGBAFormat,Ray:()=>P.Ray,Raycaster:()=>T.Raycaster,Renderer:()=>_.Renderer,Scene:()=>T.Scene,ShaderLib:()=>y.ShaderLib,ShaderUtils:()=>y.ShaderUtils,Shading:()=>A.Shading,Sphere:()=>C.Sphere,SphereImposterMaterial:()=>D.SphereImposterMaterial,SphereImposterOutlineMaterial:()=>D.SphereImposterOutlineMaterial,Sprite:()=>u.Sprite,SpriteAlignment:()=>A.SpriteAlignment,SpriteMaterial:()=>D.SpriteMaterial,SpritePlugin:()=>p.SpritePlugin,StickImposterMaterial:()=>D.StickImposterMaterial,StickImposterOutlineMaterial:()=>D.StickImposterOutlineMaterial,Texture:()=>T.Texture,TextureIdCount:()=>T.TextureIdCount,TextureOperations:()=>A.TextureOperations,Triangle:()=>C.Triangle,UVMapping:()=>T.UVMapping,UnsignedByteType:()=>A.UnsignedByteType,Vector2:()=>P.Vector2,Vector3:()=>P.Vector3,VolumetricMaterial:()=>D.VolumetricMaterial,basic:()=>y.basic,clamp:()=>P.clamp,clone:()=>y.clone,conversionMatrix3:()=>P.conversionMatrix3,degToRad:()=>P.degToRad,instanced:()=>y.instanced,intersectObject:()=>T.intersectObject,lambert:()=>y.lambert,lambertdouble:()=>y.lambertdouble,outline:()=>y.outline,screen:()=>y.screen,screenaa:()=>y.screenaa,sphereimposter:()=>y.sphereimposter,sphereimposteroutline:()=>y.sphereimposteroutline,sprite:()=>y.sprite,stickimposter:()=>y.stickimposter,stickimposteroutline:()=>y.stickimposteroutline,volumetric:()=>y.volumetric});var A=c("./src/WebGL/constants/index.ts"),T=c("./src/WebGL/core/index.ts"),D=c("./src/WebGL/materials/index.ts"),P=c("./src/WebGL/math/index.ts"),u=c("./src/WebGL/objects/index.ts"),y=c("./src/WebGL/shaders/index.ts"),C=c("./src/WebGL/shapes/index.ts"),v=c("./src/WebGL/Camera.ts"),M=c("./src/WebGL/Fog.ts"),_=c("./src/WebGL/Renderer.ts"),p=c("./src/WebGL/SpritePlugin.ts")},"./src/WebGL/materials/ImposterMaterial.ts":(X,L,c)=>{c.r(L),c.d(L,{ImposterMaterial:()=>y});var A=c("./src/WebGL/constants/Coloring.ts"),T=c("./src/WebGL/constants/Shading.ts"),D=c("./src/colors.ts"),P=c("./src/WebGL/math/index.ts"),u=c("./src/WebGL/materials/Material.ts");class y extends u.Material{constructor(v){super(),this.color=new D.Color(16777215),this.ambient=new D.Color(1048575),this.emissive=new D.Color(0),this.imposter=!0,this.wrapAround=!1,this.wrapRGB=new P.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=T.Shading.SmoothShading,this.shaderID=null,this.vertexColors=A.Coloring.NoColors,this.skinning=!1,this.setValues(v)}clone(v=new y){return super.clone.call(this,v),v.color.copy(this.color),v.ambient.copy(this.ambient),v.emissive.copy(this.emissive),v.wrapAround=this.wrapAround,v.wrapRGB.copy(this.wrapRGB),v.map=this.map,v.lightMap=this.lightMap,v.specularMap=this.specularMap,v.envMap=this.envMap,v.combine=this.combine,v.reflectivity=this.reflectivity,v.refractionRatio=this.refractionRatio,v.fog=this.fog,v.shading=this.shading,v.shaderID=this.shaderID,v.vertexColors=this.vertexColors,v.skinning=this.skinning,v.morphTargets=this.morphTargets,v.morphNormals=this.morphNormals,v}}},"./src/WebGL/materials/InstancedMaterial.ts":(X,L,c)=>{c.r(L),c.d(L,{InstancedMaterial:()=>y});var A=c("./src/WebGL/constants/Coloring.ts"),T=c("./src/WebGL/constants/Shading.ts"),D=c("./src/colors.ts"),P=c("./src/WebGL/math/index.ts"),u=c("./src/WebGL/materials/Material.ts");class y extends u.Material{constructor(v){super(),this.color=new D.Color(16777215),this.ambient=new D.Color(1048575),this.emissive=new D.Color(0),this.wrapAround=!1,this.wrapRGB=new P.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=T.Shading.SmoothShading,this.shaderID="instanced",this.vertexColors=A.Coloring.NoColors,this.skinning=!1,this.sphere=null,this.setValues(v)}clone(v=new y){return super.clone.call(this,v),v.color.copy(this.color),v.ambient.copy(this.ambient),v.emissive.copy(this.emissive),v.wrapAround=this.wrapAround,v.wrapRGB.copy(this.wrapRGB),v.map=this.map,v.lightMap=this.lightMap,v.specularMap=this.specularMap,v.envMap=this.envMap,v.combine=this.combine,v.reflectivity=this.reflectivity,v.refractionRatio=this.refractionRatio,v.fog=this.fog,v.shading=this.shading,v.shaderID=this.shaderID,v.vertexColors=this.vertexColors,v.skinning=this.skinning,v.morphTargets=this.morphTargets,v.morphNormals=this.morphNormals,v.sphere=this.sphere,v}}},"./src/WebGL/materials/LineBasicMaterial.ts":(X,L,c)=>{c.r(L),c.d(L,{LineBasicMaterial:()=>D});var A=c("./src/colors.ts"),T=c("./src/WebGL/materials/Material.ts");class D extends T.Material{constructor(u){super(),this.color=new A.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.shaderID="basic",this.setValues(u)}clone(u=new D){return super.clone.call(this,u),u.color.copy(this.color),u}}},"./src/WebGL/materials/Material.ts":(X,L,c)=>{c.r(L),c.d(L,{Material:()=>u,MaterialIdCount:()=>y});var A=c("./src/WebGL/constants/Sides.ts"),T=c("./src/WebGL/core/index.ts"),D=c("./src/WebGL/math/index.ts"),P=c("./src/colors.ts");class u extends T.EventDispatcher{constructor(){super(...arguments),this.id=y++,this.name="",this.side=A.FrontSide,this.opacity=1,this.transparent=!1,this.depthTest=!0,this.depthWrite=!0,this.stencilTest=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.visible=!0,this.needsUpdate=!0,this.outline=!1,this.wireframe=!1}setValues(v={}){if(v!==void 0)for(var M in v){var _=v[M];if(_===void 0){console.warn("$3Dmol.Material: '"+M+"' parameter is undefined.");continue}if(M in this){var p=this[M];p instanceof P.Color&&_ instanceof P.Color?p.copy(_):p instanceof P.Color?p.set(_):p instanceof D.Vector3&&_ instanceof D.Vector3?p.copy(_):this[M]=_}}}clone(v=new u){return v.name=this.name,v.side=this.side,v.opacity=this.opacity,v.transparent=this.transparent,v.depthTest=this.depthTest,v.depthWrite=this.depthWrite,v.stencilTest=this.stencilTest,v.polygonOffset=this.polygonOffset,v.polygonOffsetFactor=this.polygonOffsetFactor,v.polygonOffsetUnits=this.polygonOffsetUnits,v.alphaTest=this.alphaTest,v.overdraw=this.overdraw,v.visible=this.visible,v}dispose(){this.dispatchEvent({type:"dispose"})}}let y=0},"./src/WebGL/materials/MeshDoubleLambertMaterial.ts":(X,L,c)=>{c.r(L),c.d(L,{MeshDoubleLambertMaterial:()=>D});var A=c("./src/WebGL/constants/Sides.ts"),T=c("./src/WebGL/materials/MeshLambertMaterial.ts");class D extends T.MeshLambertMaterial{constructor(u){super(u),this.shaderID="lambertdouble",this.side=A.DoubleSide,this.outline=!1}clone(u=new D){return super.clone.call(this,u),u}}},"./src/WebGL/materials/MeshLambertMaterial.ts":(X,L,c)=>{c.r(L),c.d(L,{MeshLambertMaterial:()=>y});var A=c("./src/WebGL/constants/Coloring.ts"),T=c("./src/WebGL/constants/Shading.ts"),D=c("./src/WebGL/materials/Material.ts"),P=c("./src/colors.ts"),u=c("./src/WebGL/math/index.ts");class y extends D.Material{constructor(v){super(),this.color=new P.Color(16777215),this.ambient=new P.Color(1048575),this.emissive=new P.Color(0),this.wrapAround=!1,this.wrapRGB=new u.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=T.Shading.SmoothShading,this.shaderID="lambert",this.vertexColors=A.Coloring.NoColors,this.skinning=!1,this.setValues(v)}clone(v=new y){return super.clone.call(this,v),v.color.copy(this.color),v.ambient.copy(this.ambient),v.emissive.copy(this.emissive),v.wrapAround=this.wrapAround,v.wrapRGB.copy(this.wrapRGB),v.map=this.map,v.lightMap=this.lightMap,v.specularMap=this.specularMap,v.envMap=this.envMap,v.combine=this.combine,v.reflectivity=this.reflectivity,v.refractionRatio=this.refractionRatio,v.fog=this.fog,v.shading=this.shading,v.shaderID=this.shaderID,v.vertexColors=this.vertexColors,v.skinning=this.skinning,v.morphTargets=this.morphTargets,v.morphNormals=this.morphNormals,v}}},"./src/WebGL/materials/MeshOutlineMaterial.ts":(X,L,c)=>{c.r(L),c.d(L,{MeshOutlineMaterial:()=>D});var A=c("./src/colors.ts"),T=c("./src/WebGL/materials/Material.ts");class D extends T.Material{constructor(u){super(),u=u||{},this.fog=!0,this.shaderID="outline",this.wireframe=!1,this.outlineColor=u.color||new A.Color(0,0,0),this.outlineWidth=u.width||.1,this.outlinePushback=u.pushback||1}clone(u=new D){return super.clone.call(this,u),u.fog=this.fog,u.shaderID=this.shaderID,u.wireframe=this.wireframe,u}}},"./src/WebGL/materials/SphereImposterMaterial.ts":(X,L,c)=>{c.r(L),c.d(L,{SphereImposterMaterial:()=>T});var A=c("./src/WebGL/materials/ImposterMaterial.ts");class T extends A.ImposterMaterial{constructor(P){super(P),this.shaderID="sphereimposter",this.setValues(P)}clone(P=new T){return super.clone.call(this,P),P}}},"./src/WebGL/materials/SphereImposterOutlineMaterial.ts":(X,L,c)=>{c.r(L),c.d(L,{SphereImposterOutlineMaterial:()=>D});var A=c("./src/colors.ts"),T=c("./src/WebGL/materials/ImposterMaterial.ts");class D extends T.ImposterMaterial{constructor(u){super(u),u=u||{},this.shaderID="sphereimposteroutline",this.outlineColor=u.color||new A.Color(0,0,0),this.outlineWidth=u.width||.1,this.outlinePushback=u.pushback||1,this.setValues(u)}clone(u=new D){return super.clone.call(this,u),u.outlineColor=this.outlineColor,u.outlineWidth=this.outlineWidth,u.outlinePushback=this.outlinePushback,u}}},"./src/WebGL/materials/SpriteMaterial.ts":(X,L,c)=>{c.r(L),c.d(L,{SpriteMaterial:()=>y});var A=c("./src/WebGL/constants/SpriteAlignment.ts"),T=c("./src/WebGL/core/Texture.ts"),D=c("./src/colors.ts"),P=c("./src/WebGL/math/index.ts"),u=c("./src/WebGL/materials/Material.ts");class y extends u.Material{constructor(v){super(),this.color=new D.Color(16777215),this.map=new T.Texture,this.useScreenCoordinates=!0,this.fog=!1,this.uvOffset=new P.Vector2(0,0),this.uvScale=new P.Vector2(1,1),this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.screenOffset=this.screenOffset,this.scaleByViewPort=!this.sizeAttenuation,this.alignment=A.SpriteAlignment.center.clone(),this.setValues(v),v=v||{},v.depthTest===void 0&&(this.depthTest=!this.useScreenCoordinates),v.sizeAttenuation===void 0&&(this.sizeAttenuation=!this.useScreenCoordinates),v.scaleByViewPort===void 0&&(this.scaleByViewPort=!this.sizeAttenuation)}clone(v=new y){return super.clone.call(this,v),v.color.copy(this.color),v.map=this.map,v.useScreenCoordinates=this.useScreenCoordinates,v.screenOffset=this.screenOffset,v.sizeAttenuation=this.sizeAttenuation,v.scaleByViewport=this.scaleByViewPort,v.alignment.copy(this.alignment),v.uvOffset.copy(this.uvOffset),v}}},"./src/WebGL/materials/StickImposterMaterial.ts":(X,L,c)=>{c.r(L),c.d(L,{StickImposterMaterial:()=>T});var A=c("./src/WebGL/materials/ImposterMaterial.ts");class T extends A.ImposterMaterial{constructor(P){super(P),this.shaderID="stickimposter",this.setValues(P)}clone(P=new T){return super.clone.call(this,P),P}}},"./src/WebGL/materials/StickImposterOutlineMaterial.ts":(X,L,c)=>{c.r(L),c.d(L,{StickImposterOutlineMaterial:()=>D});var A=c("./src/colors.ts"),T=c("./src/WebGL/materials/ImposterMaterial.ts");class D extends T.ImposterMaterial{constructor(u={}){super(u),this.shaderID="stickimposteroutline",this.outlineColor=new A.Color(0,0,0),this.outlineWidth=.1,this.outlinePushback=1,u.color&&(this.outlineColor=u.color),u.width&&(this.outlineWidth=u.width),u.pushback&&(this.outlinePushback=u.pushback),this.setValues(u)}clone(u=new D){return super.clone.call(this,u),u.outlineColor=this.outlineColor,u.outlineWidth=this.outlineWidth,u.outlinePushback=this.outlinePushback,u}}},"./src/WebGL/materials/VolumetricMaterial.ts":(X,L,c)=>{c.r(L),c.d(L,{VolumetricMaterial:()=>P});var A=c("./src/WebGL/constants/Sides.ts"),T=c("./src/colors.ts"),D=c("./src/WebGL/materials/Material.ts");class P extends D.Material{constructor(y){super(),this.transparent=!1,this.volumetric=!0,this.color=new T.Color(16777215),this.transferfn=null,this.map=void 0,this.extent=[],this.maxdepth=100,this.unit=0,this.texmatrix=null,this.transfermin=-1,this.transfermax=1,this.subsamples=5,this.shaderID="volumetric",this.side=A.FrontSide,this.setValues(y)}clone(y=new P){return super.clone.call(this,y),y.transparent=this.transparent,y.volumetric=this.volumetric,y.color=this.color,y.transferfn=this.transferfn,y.map=this.map,y.extent=this.extent,y.maxdepth=this.maxdepth,y.unit=this.unit,y.texmatrix=this.texmatrix,y.transfermin=this.transfermin,y.transfermax=this.transfermax,y.subsamples=this.subsamples,y.shaderID=this.shaderID,y.side=this.side,y}}},"./src/WebGL/materials/index.ts":(X,L,c)=>{c.r(L),c.d(L,{ImposterMaterial:()=>A.ImposterMaterial,InstancedMaterial:()=>T.InstancedMaterial,LineBasicMaterial:()=>D.LineBasicMaterial,Material:()=>P.Material,MaterialIdCount:()=>P.MaterialIdCount,MeshDoubleLambertMaterial:()=>u.MeshDoubleLambertMaterial,MeshLambertMaterial:()=>y.MeshLambertMaterial,MeshOutlineMaterial:()=>C.MeshOutlineMaterial,SphereImposterMaterial:()=>v.SphereImposterMaterial,SphereImposterOutlineMaterial:()=>M.SphereImposterOutlineMaterial,SpriteMaterial:()=>_.SpriteMaterial,StickImposterMaterial:()=>p.StickImposterMaterial,StickImposterOutlineMaterial:()=>x.StickImposterOutlineMaterial,VolumetricMaterial:()=>t.VolumetricMaterial});var A=c("./src/WebGL/materials/ImposterMaterial.ts"),T=c("./src/WebGL/materials/InstancedMaterial.ts"),D=c("./src/WebGL/materials/LineBasicMaterial.ts"),P=c("./src/WebGL/materials/Material.ts"),u=c("./src/WebGL/materials/MeshDoubleLambertMaterial.ts"),y=c("./src/WebGL/materials/MeshLambertMaterial.ts"),C=c("./src/WebGL/materials/MeshOutlineMaterial.ts"),v=c("./src/WebGL/materials/SphereImposterMaterial.ts"),M=c("./src/WebGL/materials/SphereImposterOutlineMaterial.ts"),_=c("./src/WebGL/materials/SpriteMaterial.ts"),p=c("./src/WebGL/materials/StickImposterMaterial.ts"),x=c("./src/WebGL/materials/StickImposterOutlineMaterial.ts"),t=c("./src/WebGL/materials/VolumetricMaterial.ts")},"./src/WebGL/math/Quaternion.ts":(X,L,c)=>{c.r(L),c.d(L,{Quaternion:()=>A});class A{constructor(D,P,u,y){this.x=D||0,this.y=P||0,this.z=u||0,this.w=y!==void 0?y:1}set(D,P,u,y){return this.x=D,this.y=P,this.z=u,this.w=y,this}copy(D){return this.x=D.x,this.y=D.y,this.z=D.z,this.w=D.w,this}conjugate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}inverse(){return this.conjugate().normalize()}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthxyz(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){let D=this.length();return D===0?(this.x=0,this.y=0,this.z=0,this.w=1):(D=1/D,this.x*=D,this.y*=D,this.z*=D,this.w*=D),this}multiply(D){return this.multiplyQuaternions(this,D)}multiplyScalar(D){return this.x*=D,this.y*=D,this.z*=D,this.w*=D,this}multiplyQuaternions(D,P){const u=D.x,y=D.y,C=D.z,v=D.w,M=P.x,_=P.y,p=P.z,x=P.w;return this.x=u*x+v*M+y*p-C*_,this.y=y*x+v*_+C*M-u*p,this.z=C*x+v*p+u*_-y*M,this.w=v*x-u*M-y*_-C*p,this}sub(D){return this.x-=D.x,this.y-=D.y,this.z-=D.z,this.w-=D.w,this}clone(){return new A(this.x,this.y,this.z,this.w)}setFromEuler(D){const P=Math.cos(D.x/2),u=Math.cos(D.y/2),y=Math.cos(D.z/2),C=Math.sin(D.x/2),v=Math.sin(D.y/2),M=Math.sin(D.z/2);return this.x=C*u*y+P*v*M,this.y=P*v*y-C*u*M,this.z=P*u*M+C*v*y,this.w=P*u*y-C*v*M,this}}},"./src/WebGL/math/Vector2.ts":(X,L,c)=>{c.r(L),c.d(L,{Vector2:()=>A});class A{constructor(D,P){this.x=D||0,this.y=P||0}set(D,P){return this.x=D,this.y=P,this}subVectors(D,P){return this.x=D.x-P.x,this.y=D.y-P.y,this}copy(D){return this.x=D.x,this.y=D.y,this}clone(){return new A(this.x,this.y)}}},"./src/WebGL/math/index.ts":(X,L,c)=>{c.r(L),c.d(L,{Matrix3:()=>y.Matrix3,Matrix4:()=>y.Matrix4,Quaternion:()=>A.Quaternion,Ray:()=>y.Ray,Vector2:()=>T.Vector2,Vector3:()=>y.Vector3,clamp:()=>D.clamp,conversionMatrix3:()=>P.conversionMatrix3,degToRad:()=>u.degToRad});var A=c("./src/WebGL/math/Quaternion.ts"),T=c("./src/WebGL/math/Vector2.ts"),D=c("./src/WebGL/math/utils/clamp.ts"),P=c("./src/WebGL/math/utils/conversionMatrix3.ts"),u=c("./src/WebGL/math/utils/degToRad.ts"),y=c("./src/WebGL/math/math.ts")},"./src/WebGL/math/math.ts":(X,L,c)=>{c.r(L),c.d(L,{Matrix3:()=>_,Matrix4:()=>v,Ray:()=>p,Vector3:()=>M});var A=c("./src/WebGL/math/utils/degToRad.ts"),T=c("./src/WebGL/math/utils/clamp.ts"),D,P,u,y,C;class v{constructor(t=1,r=0,h=0,s=0,o=0,e=1,n=0,a=0,g=0,f=0,E=1,w=0,R=0,z=0,S=0,I=1){typeof t<"u"&&typeof t!="number"?this.elements=new Float32Array(t):(this.elements=new Float32Array(16),this.elements[0]=t,this.elements[4]=r,this.elements[8]=h,this.elements[12]=s,this.elements[1]=o,this.elements[5]=e,this.elements[9]=n,this.elements[13]=a,this.elements[2]=g,this.elements[6]=f,this.elements[10]=E,this.elements[14]=w,this.elements[3]=R,this.elements[7]=z,this.elements[11]=S,this.elements[15]=I)}makeScale(t,r,h){throw new Error("Method not implemented.")}set(t,r,h,s,o,e,n,a,g,f,E,w,R,z,S,I){const F=this.elements;return F[0]=t,F[4]=r,F[8]=h,F[12]=s,F[1]=o,F[5]=e,F[9]=n,F[13]=a,F[2]=g,F[6]=f,F[10]=E,F[14]=w,F[3]=R,F[7]=z,F[11]=S,F[15]=I,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}copy(t){const r=t.elements;return this.set(r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13],r[2],r[6],r[10],r[14],r[3],r[7],r[11],r[15]),this}matrix3FromTopLeft(){const t=this.elements;return new _(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10])}setRotationFromEuler(t,r){const h=this.elements,{x:s,y:o,z:e}=t,n=Math.cos(s),a=Math.sin(s),g=Math.cos(o),f=Math.sin(o),E=Math.cos(e),w=Math.sin(e);if(r===void 0||r==="XYZ"){const R=n*E,z=n*w,S=a*E,I=a*w;h[0]=g*E,h[4]=-g*w,h[8]=f,h[1]=z+S*f,h[5]=R-I*f,h[9]=-a*g,h[2]=I-R*f,h[6]=S+z*f,h[10]=n*g}else console.error(`Error with matrix4 setRotationFromEuler. Order: ${r}`);return this}setRotationFromQuaternion(t){const r=this.elements,{x:h,y:s,z:o,w:e}=t,n=h+h,a=s+s,g=o+o,f=h*n,E=h*a,w=h*g,R=s*a,z=s*g,S=o*g,I=e*n,F=e*a,G=e*g;return r[0]=1-(R+S),r[4]=E-G,r[8]=w+F,r[1]=E+G,r[5]=1-(f+S),r[9]=z-I,r[2]=w-F,r[6]=z+I,r[10]=1-(f+R),this}multiplyMatrices(t,r){const h=t.elements,s=r.elements,o=this.elements,e=h[0],n=h[4],a=h[8],g=h[12],f=h[1],E=h[5],w=h[9],R=h[13],z=h[2],S=h[6],I=h[10],F=h[14],G=h[3],B=h[7],W=h[11],V=h[15],k=s[0],U=s[4],j=s[8],q=s[12],ie=s[1],ge=s[5],he=s[9],ve=s[13],le=s[2],se=s[6],Me=s[10],be=s[14],Pe=s[3],ce=s[7],me=s[11],De=s[15];return o[0]=e*k+n*ie+a*le+g*Pe,o[4]=e*U+n*ge+a*se+g*ce,o[8]=e*j+n*he+a*Me+g*me,o[12]=e*q+n*ve+a*be+g*De,o[1]=f*k+E*ie+w*le+R*Pe,o[5]=f*U+E*ge+w*se+R*ce,o[9]=f*j+E*he+w*Me+R*me,o[13]=f*q+E*ve+w*be+R*De,o[2]=z*k+S*ie+I*le+F*Pe,o[6]=z*U+S*ge+I*se+F*ce,o[10]=z*j+S*he+I*Me+F*me,o[14]=z*q+S*ve+I*be+F*De,o[3]=G*k+B*ie+W*le+V*Pe,o[7]=G*U+B*ge+W*se+V*ce,o[11]=G*j+B*he+W*Me+V*me,o[15]=G*q+B*ve+W*be+V*De,this}multiplyScalar(t){const r=this.elements;return r[0]*=t,r[4]*=t,r[8]*=t,r[12]*=t,r[1]*=t,r[5]*=t,r[9]*=t,r[13]*=t,r[2]*=t,r[6]*=t,r[10]*=t,r[14]*=t,r[3]*=t,r[7]*=t,r[11]*=t,r[15]*=t,this}makeTranslation(t,r,h){return this.set(1,0,0,t,0,1,0,r,0,0,1,h,0,0,0,1),this}snap(t){const r=Math.pow(10,4),h=this.elements;for(let s=0;s<16;s++){const o=Math.round(h[s]);o===Math.round(h[s]*r)/r&&(h[s]=o)}return this}transpose(){const t=this.elements;let r;return r=t[1],t[1]=t[4],t[4]=r,r=t[2],t[2]=t[8],t[8]=r,r=t[6],t[6]=t[9],t[9]=r,r=t[3],t[3]=t[12],t[12]=r,r=t[7],t[7]=t[13],t[13]=r,r=t[11],t[11]=t[14],t[14]=r,this}setPosition(t){const r=this.elements;return r[12]=t.x,r[13]=t.y,r[14]=t.z,this}translate(t){const r=this.elements;return r[12]+=t.x,r[13]+=t.y,r[14]+=t.z,this}getInverse(t,r){const h=this.elements,s=t.elements,o=s[0],e=s[4],n=s[8],a=s[12],g=s[1],f=s[5],E=s[9],w=s[13],R=s[2],z=s[6],S=s[10],I=s[14],F=s[3],G=s[7],B=s[11],W=s[15];h[0]=E*I*G-w*S*G+w*z*B-f*I*B-E*z*W+f*S*W,h[4]=a*S*G-n*I*G-a*z*B+e*I*B+n*z*W-e*S*W,h[8]=n*w*G-a*E*G+a*f*B-e*w*B-n*f*W+e*E*W,h[12]=a*E*z-n*w*z-a*f*S+e*w*S+n*f*I-e*E*I,h[1]=w*S*F-E*I*F-w*R*B+g*I*B+E*R*W-g*S*W,h[5]=n*I*F-a*S*F+a*R*B-o*I*B-n*R*W+o*S*W,h[9]=a*E*F-n*w*F-a*g*B+o*w*B+n*g*W-o*E*W,h[13]=n*w*R-a*E*R+a*g*S-o*w*S-n*g*I+o*E*I,h[2]=f*I*F-w*z*F+w*R*G-g*I*G-f*R*W+g*z*W,h[6]=a*z*F-e*I*F-a*R*G+o*I*G+e*R*W-o*z*W,h[10]=e*w*F-a*f*F+a*g*G-o*w*G-e*g*W+o*f*W,h[14]=a*f*R-e*w*R-a*g*z+o*w*z+e*g*I-o*f*I,h[3]=E*z*F-f*S*F-E*R*G+g*S*G+f*R*B-g*z*B,h[7]=e*S*F-n*z*F+n*R*G-o*S*G-e*R*B+o*z*B,h[11]=n*f*F-e*E*F-n*g*G+o*E*G+e*g*B-o*f*B,h[15]=e*E*R-n*f*R+n*g*z-o*E*z-e*g*S+o*f*S;const V=o*h[0]+g*h[4]+R*h[8]+F*h[12];if(V===0){const k="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(r)throw new Error(k);return console.warn(k),this.identity(),this}return this.multiplyScalar(1/V),this}isReflected(){const t=this.elements,r=t[0],h=t[4],s=t[8],o=t[1],e=t[5],n=t[9],a=t[2],g=t[6],f=t[10];return r*e*f+o*g*s+a*h*n-a*e*s-o*h*f-r*g*n<0}scale(t){const r=this.elements,{x:h}=t,{y:s}=t,{z:o}=t;return r[0]*=h,r[4]*=s,r[8]*=o,r[1]*=h,r[5]*=s,r[9]*=o,r[2]*=h,r[6]*=s,r[10]*=o,r[3]*=h,r[7]*=s,r[11]*=o,this}getMaxScaleOnAxis(){const t=this.elements,r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],h=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(r,Math.max(h,s)))}makeFrustum(t,r,h,s,o,e){const n=this.elements,a=2*o/(r-t),g=2*o/(s-h),f=(r+t)/(r-t),E=(s+h)/(s-h),w=-(e+o)/(e-o),R=-2*e*o/(e-o);return n[0]=a,n[4]=0,n[8]=f,n[12]=0,n[1]=0,n[5]=g,n[9]=E,n[13]=0,n[2]=0,n[6]=0,n[10]=w,n[14]=R,n[3]=0,n[7]=0,n[11]=-1,n[15]=0,this}makePerspective(t,r,h,s){const o=h*Math.tan((0,A.degToRad)(t*.5)),e=-o,n=e*r,a=o*r;return this.makeFrustum(n,a,e,o,h,s)}makeOrthographic(t,r,h,s,o,e){const n=this.elements,a=1/(r-t),g=1/(h-s),f=1/(e-o),E=(r+t)*a,w=(h+s)*g,R=(e+o)*f;return n[0]=2*a,n[4]=0,n[8]=0,n[12]=-E,n[1]=0,n[5]=2*g,n[9]=0,n[13]=-w,n[2]=0,n[6]=0,n[10]=-2*f,n[14]=-R,n[3]=0,n[7]=0,n[11]=0,n[15]=1,this}isEqual(t){const r=t.elements,h=this.elements;return h[0]===r[0]&&h[4]===r[4]&&h[8]===r[8]&&h[12]===r[12]&&h[1]===r[1]&&h[5]===r[5]&&h[9]===r[9]&&h[13]===r[13]&&h[2]===r[2]&&h[6]===r[6]&&h[10]===r[10]&&h[14]===r[14]&&h[3]===r[3]&&h[7]===r[7]&&h[11]===r[11]&&h[15]===r[15]}clone(){const t=this.elements;return new v(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])}isIdentity(){const t=this.elements;return t[0]===1&&t[4]===0&&t[8]===0&&t[12]===0&&t[1]===0&&t[5]===1&&t[9]===0&&t[13]===0&&t[2]===0&&t[6]===0&&t[10]===1&&t[14]===0&&t[3]===0&&t[7]===0&&t[11]===0&&t[15]===1}isNearlyIdentity(t){return this.clone().snap(t).isIdentity()}getScale(t){const r=this.elements;return t=t||new M,u.set(r[0],r[1],r[2]),y.set(r[4],r[5],r[6]),C.set(r[8],r[9],r[10]),t.x=u.length(),t.y=y.length(),t.z=C.length(),t}lookAt(t,r,h){const s=this.elements;return C.subVectors(t,r).normalize(),C.length()===0&&(C.z=1),u.crossVectors(h,C).normalize(),u.length()===0&&(C.x+=1e-4,u.crossVectors(h,C).normalize()),y.crossVectors(C,u),s[0]=u.x,s[4]=y.x,s[8]=C.x,s[1]=u.y,s[5]=y.y,s[9]=C.y,s[2]=u.z,s[6]=y.z,s[10]=C.z,this}compose(t,r,h){const s=this.elements;return D.identity(),D.setRotationFromQuaternion(r),P.makeScale(h.x,h.y,h.z),this.multiplyMatrices(D,P),s[12]=t.x,s[13]=t.y,s[14]=t.z,this}}D=new v,P=new v;class M{constructor(t,r,h){this.x=t||0,this.y=r||0,this.z=h||0,this.atomid=void 0}set(t,r,h){return this.x=t,this.y=r,this.z=h,this}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addVectors(t,r){return this.x=t.x+r.x,this.y=t.y+r.y,this.z=t.z+r.z,this}multiplyVectors(t,r){return this.x=t.x*r.x,this.y=t.y*r.y,this.z=t.z*r.z,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subVectors(t,r){return this.x=t.x-r.x,this.y=t.y-r.y,this.z=t.z-r.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}divideScalar(t){return t!==0?(this.x/=t,this.y/=t,this.z/=t):(this.x=0,this.y=0,this.z=0),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const r=this.x-t.x,h=this.y-t.y,s=this.z-t.z;return r*r+h*h+s*s}applyMatrix3(t){const{x:r}=this,{y:h}=this,{z:s}=this,o=t.elements;return this.x=o[0]*r+o[3]*h+o[6]*s,this.y=o[1]*r+o[4]*h+o[7]*s,this.z=o[2]*r+o[5]*h+o[8]*s,this}applyMatrix4(t){const{x:r}=this,{y:h}=this,{z:s}=this,o=t.elements;return this.x=o[0]*r+o[4]*h+o[8]*s+o[12],this.y=o[1]*r+o[5]*h+o[9]*s+o[13],this.z=o[2]*r+o[6]*h+o[10]*s+o[14],this}applyProjection(t){const{x:r}=this,{y:h}=this,{z:s}=this,o=t.elements,e=o[3]*r+o[7]*h+o[11]*s+o[15];return this.x=(o[0]*r+o[4]*h+o[8]*s+o[12])/e,this.y=(o[1]*r+o[5]*h+o[9]*s+o[13])/e,this.z=(o[2]*r+o[6]*h+o[10]*s+o[14])/e,this}applyQuaternion(t){const{x:r}=this,{y:h}=this,{z:s}=this,o=t.x,e=t.y,n=t.z,a=t.w,g={};g.x=2*(h*n-s*e),g.y=2*(s*o-r*n),g.z=2*(r*e-h*o);const f={};return f.x=g.y*n-g.z*e,f.y=g.z*o-g.x*n,f.z=g.x*e-g.y*o,this.x=r+a*g.x+f.x,this.y=h+a*g.y+f.y,this.z=s+a*g.z+f.z,this}negate(){return this.multiplyScalar(-1)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}normalize(){return this.divideScalar(this.length())}cross(t){const{x:r}=this,{y:h}=this,{z:s}=this;return this.x=h*t.z-s*t.y,this.y=s*t.x-r*t.z,this.z=r*t.y-h*t.x,this}crossVectors(t,r){return this.x=t.y*r.z-t.z*r.y,this.y=t.z*r.x-t.x*r.z,this.z=t.x*r.y-t.y*r.x,this}equals(t){return this.x==t.x&&this.y==t.y&&this.z==t.z}getPositionFromMatrix(t){return this.x=t.elements[12],this.y=t.elements[13],this.z=t.elements[14],this}setEulerFromRotationMatrix(t,r){const h=t.elements,s=h[0],o=h[4],e=h[8],n=h[5],a=h[9],g=h[6],f=h[10];return r===void 0||r==="XYZ"?(this.y=Math.asin((0,T.clamp)(e,-1,1)),Math.abs(e)<.99999?(this.x=Math.atan2(-a,f),this.z=Math.atan2(-o,s)):(this.x=Math.atan2(g,n),this.z=0)):console.error(`Error with vector's setEulerFromRotationMatrix: Unknown order: ${r}`),this}rotateAboutVector(t,r){t.normalize();const h=Math.cos(r),s=Math.sin(r),o=this.clone().multiplyScalar(h),e=t.clone().cross(this).multiplyScalar(s),n=t.clone().multiplyScalar(t.clone().dot(this)).multiplyScalar(1-h),a=o.add(e).add(n);return this.x=a.x,this.y=a.y,this.z=a.z,this}setFromMatrixPosition(t){const r=t.elements;return this.x=r[12],this.y=r[13],this.z=r[14],this}transformDirection(t){const{x:r}=this,{y:h}=this,{z:s}=this,o=t.elements;return this.x=o[0]*r+o[4]*h+o[8]*s,this.y=o[1]*r+o[5]*h+o[9]*s,this.z=o[2]*r+o[6]*h+o[10]*s,this.normalize()}clone(){return new M(this.x,this.y,this.z)}unproject(t){const r=D;return r.multiplyMatrices(t.matrixWorld,r.getInverse(t.projectionMatrix)),this.applyMatrix4(r)}}u=new M,y=new M,C=new M;class _{constructor(t=1,r=0,h=0,s=0,o=1,e=0,n=0,a=0,g=1){this.elements=new Float32Array(9),this.set(t,r,h,s,o,e,n,a,g)}set(t,r,h,s,o,e,n,a,g){const f=this.elements;return f[0]=t,f[3]=r,f[6]=h,f[1]=s,f[4]=o,f[7]=e,f[2]=n,f[5]=a,f[8]=g,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const r=t.elements;this.set(r[0],r[3],r[6],r[1],r[4],r[7],r[2],r[5],r[8])}multiplyScalar(t){const r=this.elements;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=t,r[4]*=t,r[7]*=t,r[2]*=t,r[5]*=t,r[8]*=t,this}getInverse3(t){const r=t.elements,h=this.elements;h[0]=r[4]*r[8]-r[5]*r[7],h[3]=r[6]*r[5]-r[3]*r[8],h[6]=r[3]*r[7]-r[6]*r[4],h[1]=r[7]*r[2]-r[1]*r[8],h[4]=r[0]*r[8]-r[6]*r[2],h[7]=r[1]*r[6]-r[0]*r[7],h[2]=r[1]*r[5]-r[2]*r[4],h[5]=r[2]*r[3]-r[0]*r[5],h[8]=r[0]*r[4]-r[1]*r[3];const s=r[0]*h[0]+r[3]*h[1]+r[6]*h[2];return this.multiplyScalar(1/s),this}getInverse(t,r){const h=t.elements,s=this.elements;s[0]=h[10]*h[5]-h[6]*h[9],s[1]=-h[10]*h[1]+h[2]*h[9],s[2]=h[6]*h[1]-h[2]*h[5],s[3]=-h[10]*h[4]+h[6]*h[8],s[4]=h[10]*h[0]-h[2]*h[8],s[5]=-h[6]*h[0]+h[2]*h[4],s[6]=h[9]*h[4]-h[5]*h[8],s[7]=-h[9]*h[0]+h[1]*h[8],s[8]=h[5]*h[0]-h[1]*h[4];const o=h[0]*s[0]+h[1]*s[3]+h[2]*s[6];if(o===0){const e="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(r)throw new Error(e);return console.warn(e),this.identity(),this}return this.multiplyScalar(1/o),this}getDeterminant(){const t=this.elements;return t[0]*t[4]*t[8]+t[1]*t[5]*t[6]+t[2]*t[3]*t[7]-t[2]*t[4]*t[6]-t[1]*t[3]*t[8]-t[0]*t[5]*t[7]}transpose(){let t;const r=this.elements;return t=r[1],r[1]=r[3],r[3]=t,t=r[2],r[2]=r[6],r[6]=t,t=r[5],r[5]=r[7],r[7]=t,this}clone(){const t=this.elements;return new _(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])}getMatrix4(){const t=this.elements;return new v(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0)}}class p{constructor(t,r){this.origin=t!==void 0?t:new M,this.direction=r!==void 0?r:new M}set(t,r){return this.origin.copy(t),this.direction.copy(r),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,r){return(r||new M).copy(this.direction).multiplyScalar(t).add(this.origin)}recast(t){const r=u;return this.origin.copy(this.at(t,r)),this}closestPointToPoint(t,r){const h=r||new M;h.subVectors(t,this.origin);const s=h.dot(this.direction);return h.copy(this.direction).multiplyScalar(s).add(this.origin)}distanceToPoint(t){const r=u,h=r.subVectors(t,this.origin).dot(this.direction);return r.copy(this.direction).multiplyScalar(h).add(this.origin),r.distanceTo(t)}isIntersectionCylinder(){}isIntersectionSphere(t){return this.distanceToPoint(t.center)<=t.radius}isIntersectionPlane(t){return t.normal.dot(this.direction)!==0||t.distanceToPoint(this.origin)===0}distanceToPlane(t){const r=t.normal.dot(this.direction);return r===0?t.distanceToPoint(this.origin)===0?0:void 0:-(this.origin.dot(t.normal)+t.constant)/r}intersectPlane(t,r){const h=this.distanceToPlane(t);if(h!==void 0)return this.at(h,r)}applyMatrix4(t){return this.direction.add(this.origin).applyMatrix4(t),this.origin.applyMatrix4(t),this.direction.sub(this.origin),this}clone(){return new p().copy(this)}}},"./src/WebGL/math/utils/clamp.ts":(X,L,c)=>{c.r(L),c.d(L,{clamp:()=>A});function A(T,D,P){return Math.min(Math.max(T,D),P)}},"./src/WebGL/math/utils/conversionMatrix3.ts":(X,L,c)=>{c.r(L),c.d(L,{conversionMatrix3:()=>T});var A=c("./src/WebGL/math/math.ts");function T(D,P,u,y,C,v){y=y*Math.PI/180,C=C*Math.PI/180,v=v*Math.PI/180;const M=h=>h*h,_=Math.cos(y),p=Math.cos(C),x=Math.cos(v),t=Math.sin(v);return new A.Matrix3(D,P*x,u*p,0,P*t,u*(_-p*x)/t,0,0,u*Math.sqrt(1-M(_)-M(p)-M(x)+2*_*p*x)/t)}},"./src/WebGL/math/utils/degToRad.ts":(X,L,c)=>{c.r(L),c.d(L,{degToRad:()=>T});const A=Math.PI/180;function T(D){return D*A}},"./src/WebGL/objects/Line.ts":(X,L,c)=>{c.r(L),c.d(L,{Line:()=>P,LineStyle:()=>D});var A=c("./src/WebGL/materials/index.ts"),T=c("./src/WebGL/core/index.ts"),D;(function(u){u[u.LineStrip=0]="LineStrip",u[u.LinePieces=1]="LinePieces"})(D||(D={}));class P extends T.Object3D{constructor(y,C=new A.LineBasicMaterial({color:Math.random()*16777215}),v=D.LineStrip){super(),this.geometry=y,this.material=C,this.type=v}clone(y=new P(this.geometry,this.material,this.type)){return super.clone.call(this,y),y}}},"./src/WebGL/objects/Mesh.ts":(X,L,c)=>{c.r(L),c.d(L,{Mesh:()=>T});var A=c("./src/WebGL/core/index.ts");class T extends A.Object3D{constructor(P,u){super(),this.geometry=P,this.material=u}clone(P){return P===void 0&&(P=new T(this.geometry,this.material)),super.clone.call(this,P),P}}},"./src/WebGL/objects/Sprite.ts":(X,L,c)=>{c.r(L),c.d(L,{Sprite:()=>D});var A=c("./src/WebGL/materials/index.ts"),T=c("./src/WebGL/core/index.ts");class D extends T.Object3D{constructor(u=new A.SpriteMaterial){super(),this.material=u,this.rotation3d=this.rotation,this.rotation=0}updateMatrix(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),(this.scale.x!==1||this.scale.y!==1)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0}clone(u=new D(this.material)){return T.Object3D.prototype.clone.call(this,u),u}}},"./src/WebGL/objects/index.ts":(X,L,c)=>{c.r(L),c.d(L,{Line:()=>A.Line,LineStyle:()=>A.LineStyle,Mesh:()=>T.Mesh,Sprite:()=>D.Sprite});var A=c("./src/WebGL/objects/Line.ts"),T=c("./src/WebGL/objects/Mesh.ts"),D=c("./src/WebGL/objects/Sprite.ts")},"./src/WebGL/shaders/ShaderType.ts":(X,L,c)=>{c.r(L)},"./src/WebGL/shaders/index.ts":(X,L,c)=>{c.r(L),c.d(L,{ShaderLib:()=>A.ShaderLib,ShaderUtils:()=>T.ShaderUtils,basic:()=>A.basic,clone:()=>T.clone,instanced:()=>A.instanced,lambert:()=>A.lambert,lambertdouble:()=>A.lambertdouble,outline:()=>A.outline,screen:()=>A.screen,screenaa:()=>A.screenaa,sphereimposter:()=>A.sphereimposter,sphereimposteroutline:()=>A.sphereimposteroutline,sprite:()=>A.sprite,stickimposter:()=>A.stickimposter,stickimposteroutline:()=>A.stickimposteroutline,volumetric:()=>A.volumetric});var A=c("./src/WebGL/shaders/lib/index.ts"),T=c("./src/WebGL/shaders/utils/index.ts");c("./src/WebGL/shaders/ShaderType.ts")},"./src/WebGL/shaders/lib/basic/index.ts":(X,L,c)=>{c.r(L),c.d(L,{basic:()=>P});var A=c("./src/WebGL/shaders/lib/basic/uniforms.ts"),T=c("./src/WebGL/shaders/lib/basic/basic.frag"),D=c("./src/WebGL/shaders/lib/basic/basic.vert");const P={vertexShader:D.default.replace("#define GLSLIFY 1",""),fragmentShader:T.default.replace("#define GLSLIFY 1",""),uniforms:A.uniforms}},"./src/WebGL/shaders/lib/basic/uniforms.ts":(X,L,c)=>{c.r(L),c.d(L,{uniforms:()=>T});var A=c("./src/colors.ts");const T={opacity:{type:"f",value:1},fogColor:{type:"c",value:new A.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3}}},"./src/WebGL/shaders/lib/index.ts":(X,L,c)=>{c.r(L),c.d(L,{ShaderLib:()=>r,basic:()=>A.basic,instanced:()=>T.instanced,lambert:()=>D.lambert,lambertdouble:()=>P.lambertdouble,outline:()=>u.outline,screen:()=>y.screen,screenaa:()=>C.screenaa,sphereimposter:()=>v.sphereimposter,sphereimposteroutline:()=>M.sphereimposteroutline,sprite:()=>_.sprite,stickimposter:()=>p.stickimposter,stickimposteroutline:()=>x.stickimposteroutline,volumetric:()=>t.volumetric});var A=c("./src/WebGL/shaders/lib/basic/index.ts"),T=c("./src/WebGL/shaders/lib/instanced/index.ts"),D=c("./src/WebGL/shaders/lib/lambert/index.ts"),P=c("./src/WebGL/shaders/lib/lambertdouble/index.ts"),u=c("./src/WebGL/shaders/lib/outline/index.ts"),y=c("./src/WebGL/shaders/lib/screen/index.ts"),C=c("./src/WebGL/shaders/lib/screenaa/index.ts"),v=c("./src/WebGL/shaders/lib/sphereimposter/index.ts"),M=c("./src/WebGL/shaders/lib/sphereimposteroutline/index.ts"),_=c("./src/WebGL/shaders/lib/sprite/index.ts"),p=c("./src/WebGL/shaders/lib/stickimposter/index.ts"),x=c("./src/WebGL/shaders/lib/stickimposteroutline/index.ts"),t=c("./src/WebGL/shaders/lib/volumetric/index.ts");const r={basic:A.basic,instanced:T.instanced,lambert:D.lambert,lambertdouble:P.lambertdouble,outline:u.outline,screen:y.screen,screenaa:C.screenaa,sphereimposter:v.sphereimposter,sphereimposteroutline:M.sphereimposteroutline,sprite:_.sprite,stickimposter:p.stickimposter,stickimposteroutline:x.stickimposteroutline,volumetric:t.volumetric}},"./src/WebGL/shaders/lib/instanced/index.ts":(X,L,c)=>{c.r(L),c.d(L,{instanced:()=>P});var A=c("./src/WebGL/shaders/lib/instanced/uniforms.ts"),T=c("./src/WebGL/shaders/lib/instanced/instanced.frag"),D=c("./src/WebGL/shaders/lib/instanced/instanced.vert");const P={fragmentShader:T.default.replace("#define GLSLIFY 1",""),vertexShader:D.default.replace("#define GLSLIFY 1",""),uniforms:A.uniforms}},"./src/WebGL/shaders/lib/instanced/uniforms.ts":(X,L,c)=>{c.r(L),c.d(L,{uniforms:()=>T});var A=c("./src/colors.ts");const T={opacity:{type:"f",value:1},fogColor:{type:"c",value:new A.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/lambert/index.ts":(X,L,c)=>{c.r(L),c.d(L,{lambert:()=>P});var A=c("./src/WebGL/shaders/lib/lambert/uniforms.ts"),T=c("./src/WebGL/shaders/lib/lambert/lambert.frag"),D=c("./src/WebGL/shaders/lib/lambert/lambert.vert");const P={fragmentShader:T.default.replace("#define GLSLIFY 1",""),vertexShader:D.default.replace("#define GLSLIFY 1",""),uniforms:A.uniforms}},"./src/WebGL/shaders/lib/lambert/uniforms.ts":(X,L,c)=>{c.r(L),c.d(L,{uniforms:()=>T});var A=c("./src/colors.ts");const T={opacity:{type:"f",value:1},fogColor:{type:"c",value:new A.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/lambertdouble/index.ts":(X,L,c)=>{c.r(L),c.d(L,{lambertdouble:()=>P});var A=c("./src/WebGL/shaders/lib/lambertdouble/uniforms.ts"),T=c("./src/WebGL/shaders/lib/lambertdouble/lambertdouble.frag"),D=c("./src/WebGL/shaders/lib/lambertdouble/lambertdouble.vert");const P={fragmentShader:T.default.replace("#define GLSLIFY 1",""),vertexShader:D.default.replace("#define GLSLIFY 1",""),uniforms:A.uniforms}},"./src/WebGL/shaders/lib/lambertdouble/uniforms.ts":(X,L,c)=>{c.r(L),c.d(L,{uniforms:()=>T});var A=c("./src/colors.ts");const T={opacity:{type:"f",value:1},fogColor:{type:"c",value:new A.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/outline/index.ts":(X,L,c)=>{c.r(L),c.d(L,{outline:()=>P});var A=c("./src/WebGL/shaders/lib/outline/uniforms.ts"),T=c("./src/WebGL/shaders/lib/outline/outline.frag"),D=c("./src/WebGL/shaders/lib/outline/outline.vert");const P={fragmentShader:T.default.replace("#define GLSLIFY 1",""),vertexShader:D.default.replace("#define GLSLIFY 1",""),uniforms:A.uniforms}},"./src/WebGL/shaders/lib/outline/uniforms.ts":(X,L,c)=>{c.r(L),c.d(L,{uniforms:()=>T});var A=c("./src/colors.ts");const T={opacity:{type:"f",value:1},outlineColor:{type:"c",value:new A.Color(0,0,0)},fogColor:{type:"c",value:new A.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1}}},"./src/WebGL/shaders/lib/screen/index.ts":(X,L,c)=>{c.r(L),c.d(L,{screen:()=>P});var A=c("./src/WebGL/shaders/lib/screen/uniforms.ts"),T=c("./src/WebGL/shaders/lib/screen/screen.frag"),D=c("./src/WebGL/shaders/lib/screen/screen.vert");const P={fragmentShader:T.default.replace("#define GLSLIFY 1",""),vertexShader:D.default.replace("#define GLSLIFY 1",""),uniforms:A.uniforms}},"./src/WebGL/shaders/lib/screen/uniforms.ts":(X,L,c)=>{c.r(L),c.d(L,{uniforms:()=>A});const A={}},"./src/WebGL/shaders/lib/screenaa/index.ts":(X,L,c)=>{c.r(L),c.d(L,{screenaa:()=>P});var A=c("./src/WebGL/shaders/lib/screenaa/uniforms.ts"),T=c("./src/WebGL/shaders/lib/screenaa/screenaa.frag"),D=c("./src/WebGL/shaders/lib/screenaa/screenaa.vert");const P={fragmentShader:T.default.replace("#define GLSLIFY 1",""),vertexShader:D.default.replace("#define GLSLIFY 1",""),uniforms:A.uniforms}},"./src/WebGL/shaders/lib/screenaa/uniforms.ts":(X,L,c)=>{c.r(L),c.d(L,{uniforms:()=>A});const A={}},"./src/WebGL/shaders/lib/sphereimposter/index.ts":(X,L,c)=>{c.r(L),c.d(L,{sphereimposter:()=>P});var A=c("./src/WebGL/shaders/lib/sphereimposter/uniforms.ts"),T=c("./src/WebGL/shaders/lib/sphereimposter/sphereimposter.frag"),D=c("./src/WebGL/shaders/lib/sphereimposter/sphereimposter.vert");const P={vertexShader:D.default.replace("#define GLSLIFY 1",""),fragmentShader:T.default.replace("#define GLSLIFY 1",""),uniforms:A.uniforms}},"./src/WebGL/shaders/lib/sphereimposter/uniforms.ts":(X,L,c)=>{c.r(L),c.d(L,{uniforms:()=>T});var A=c("./src/colors.ts");const T={opacity:{type:"f",value:1},fogColor:{type:"c",value:new A.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/sphereimposteroutline/index.ts":(X,L,c)=>{c.r(L),c.d(L,{sphereimposteroutline:()=>P});var A=c("./src/WebGL/shaders/lib/sphereimposteroutline/uniforms.ts"),T=c("./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.frag"),D=c("./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.vert");const P={fragmentShader:T.default.replace("#define GLSLIFY 1",""),vertexShader:D.default.replace("#define GLSLIFY 1",""),uniforms:A.uniforms}},"./src/WebGL/shaders/lib/sphereimposteroutline/uniforms.ts":(X,L,c)=>{c.r(L),c.d(L,{uniforms:()=>T});var A=c("./src/colors.ts");const T={opacity:{type:"f",value:1},outlineColor:{type:"c",value:new A.Color(0,0,0)},fogColor:{type:"c",value:new A.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1}}},"./src/WebGL/shaders/lib/sprite/index.ts":(X,L,c)=>{c.r(L),c.d(L,{sprite:()=>P});var A=c("./src/WebGL/shaders/lib/sprite/uniforms.ts"),T=c("./src/WebGL/shaders/lib/sprite/sprite.frag"),D=c("./src/WebGL/shaders/lib/sprite/sprite.vert");const P={fragmentShader:T.default.replace("#define GLSLIFY 1",""),vertexShader:D.default.replace("#define GLSLIFY 1",""),uniforms:A.uniforms}},"./src/WebGL/shaders/lib/sprite/uniforms.ts":(X,L,c)=>{c.r(L),c.d(L,{uniforms:()=>A});const A={}},"./src/WebGL/shaders/lib/stickimposter/index.ts":(X,L,c)=>{c.r(L),c.d(L,{stickimposter:()=>y});var A=c("./src/WebGL/shaders/lib/stickimposter/uniforms.ts"),T=c("./src/WebGL/shaders/utils/stickimposterFragmentShader.partial.frag"),D=c("./src/WebGL/shaders/lib/stickimposter/stickimposter.partial.frag"),P=c("./src/WebGL/shaders/lib/stickimposter/stickimposter.vert");const y={fragmentShader:[T.default,D.default].join(`
`).replace("#define GLSLIFY 1",""),vertexShader:P.default.replace("#define GLSLIFY 1",""),uniforms:A.uniforms}},"./src/WebGL/shaders/lib/stickimposter/uniforms.ts":(X,L,c)=>{c.r(L),c.d(L,{uniforms:()=>T});var A=c("./src/colors.ts");const T={opacity:{type:"f",value:1},fogColor:{type:"c",value:new A.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/stickimposteroutline/index.ts":(X,L,c)=>{c.r(L),c.d(L,{stickimposteroutline:()=>u});var A=c("./src/WebGL/shaders/lib/stickimposteroutline/uniforms.ts"),T=c("./src/WebGL/shaders/utils/stickimposterFragmentShader.partial.frag"),D=c("./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.vert");const u={fragmentShader:(T.default+"gl_FragColor = vec4(color,1.0);}").replace("#define GLSLIFY 1",""),vertexShader:D.default.replace("#define GLSLIFY 1",""),uniforms:A.uniforms}},"./src/WebGL/shaders/lib/stickimposteroutline/uniforms.ts":(X,L,c)=>{c.r(L),c.d(L,{uniforms:()=>T});var A=c("./src/colors.ts");const T={opacity:{type:"f",value:1},fogColor:{type:"c",value:new A.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineColor:{type:"c",value:new A.Color(0,0,0)},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1}}},"./src/WebGL/shaders/lib/volumetric/index.ts":(X,L,c)=>{c.r(L),c.d(L,{volumetric:()=>P});var A=c("./src/WebGL/shaders/lib/volumetric/uniforms.ts"),T=c("./src/WebGL/shaders/lib/volumetric/volumetric.frag"),D=c("./src/WebGL/shaders/lib/volumetric/volumetric.vert");const P={fragmentShader:T.default.replace("#define GLSLIFY 1",""),vertexShader:D.default.replace("#define GLSLIFY 1",""),uniforms:A.uniforms}},"./src/WebGL/shaders/lib/volumetric/uniforms.ts":(X,L,c)=>{c.r(L),c.d(L,{uniforms:()=>T});var A=c("./src/colors.ts");const T={opacity:{type:"f",value:1},fogColor:{type:"c",value:new A.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},data:{type:"i",value:3},colormap:{type:"i",value:4},depthmap:{type:"i",value:5},step:{type:"f",value:1},maxdepth:{type:"f",value:100},subsamples:{type:"f",value:5},textmat:{type:"mat4",value:[]},projinv:{type:"mat4",value:[]},transfermin:{type:"f",value:-.2},transfermax:{type:"f",value:.2}}},"./src/WebGL/shaders/utils/clone.ts":(X,L,c)=>{c.r(L),c.d(L,{clone:()=>T});var A=c("./src/colors.ts");function T(D){let P={};for(const y in D){P[y]={},P[y].type=D[y].type;var u=D[y].value;u instanceof A.Color?P[y].value=u.clone():typeof u=="number"?P[y].value=u:u instanceof Array?P[y].value=[]:console.error("Error copying shader uniforms from ShaderLib: unknown type for uniform")}return P}},"./src/WebGL/shaders/utils/index.ts":(X,L,c)=>{c.r(L),c.d(L,{ShaderUtils:()=>D,clone:()=>A.clone});var A=c("./src/WebGL/shaders/utils/clone.ts"),T=c("./src/WebGL/shaders/utils/stickimposterFragmentShader.partial.frag");const D={clone:A.clone,stickimposterFragmentShader:T.default}},"./src/WebGL/shapes/Cylinder.ts":(X,L,c)=>{c.r(L),c.d(L,{Cylinder:()=>D});var A=c("./src/WebGL/math/index.ts");let T=new A.Vector3;class D{constructor(u=new A.Vector3,y=new A.Vector3,C=0){this.c1=u,this.c2=y,this.radius=C,this.direction=new A.Vector3().subVectors(this.c2,this.c1).normalize()}copy(u){return this.c1.copy(u.c1),this.c2.copy(u.c2),this.direction.copy(u.direction),this.radius=u.radius,this}lengthSq(){return T.subVectors(this.c2,this.c1).lengthSq()}applyMatrix4(u){return this.direction.add(this.c1).applyMatrix4(u),this.c1.applyMatrix4(u),this.c2.applyMatrix4(u),this.direction.sub(this.c1).normalize(),this.radius=this.radius*u.getMaxScaleOnAxis(),this}}},"./src/WebGL/shapes/Sphere.ts":(X,L,c)=>{c.r(L),c.d(L,{Sphere:()=>T});var A=c("./src/WebGL/math/index.ts");class T{constructor(P={x:0,y:0,z:0},u=0){this.center=new A.Vector3(P.x,P.y,P.z),this.radius=u}set(P,u){return this.center.copy(P),this.radius=u,this}copy(P){return this.center.copy(P.center),this.radius=P.radius,this}applyMatrix4(P){return this.center.applyMatrix4(P),this.radius=this.radius*P.getMaxScaleOnAxis(),this}translate(P){return this.center.add(P),this}equals(P){return P.center.equals(this.center)&&P.radius===this.radius}clone(){return new T().copy(this)}}},"./src/WebGL/shapes/Triangle.ts":(X,L,c)=>{c.r(L),c.d(L,{Triangle:()=>D});var A=c("./src/WebGL/math/index.ts");const T=new A.Vector3;class D{constructor(u=new A.Vector3,y=new A.Vector3,C=new A.Vector3){this.a=u,this.b=y,this.c=C}copy(u){return this.a.copy(u.a),this.b.copy(u.b),this.c.copy(u.c),this}applyMatrix4(u){return this.a.applyMatrix4(u),this.b.applyMatrix4(u),this.c.applyMatrix4(u),this}getNormal(){var u=this.a.clone();return u.sub(this.b),T.subVectors(this.c,this.b),u.cross(T),u.normalize(),u}}},"./src/WebGL/shapes/index.ts":(X,L,c)=>{c.r(L),c.d(L,{Cylinder:()=>T.Cylinder,Sphere:()=>A.Sphere,Triangle:()=>D.Triangle});var A=c("./src/WebGL/shapes/Sphere.ts"),T=c("./src/WebGL/shapes/Cylinder.ts"),D=c("./src/WebGL/shapes/Triangle.ts")},"./src/autoload.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{autoinit:()=>autoinit,autoload:()=>autoload,processing_autoinit:()=>processing_autoinit,viewers:()=>viewers});var _GLViewer__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/GLViewer.ts"),_ProteinSurface4__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/ProteinSurface4.ts"),_utilities__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/utilities.ts"),_colors__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/colors.ts"),autoinit=!1,processing_autoinit=!1,viewers={};function autoload(viewer,callback){var i,dataname,type;if(document.querySelector(".viewer_3Dmoljs")!=null&&(autoinit=!0),autoinit){processing_autoinit=!0,viewer=viewer??null;var nviewers=0;document.querySelectorAll(".viewer_3Dmoljs").forEach(viewerdiv=>{var datauri=[],datatypes=[],uri="";viewerdiv.style.position=="static"&&(viewerdiv.style.position="relative");var UI=null;if(type=null,viewerdiv.dataset.pdb)datauri.push("https://files.rcsb.org/view/"+viewerdiv.dataset.pdb+".pdb"),datatypes.push("pdb");else if(viewerdiv.dataset.cid)datatypes.push("sdf"),datauri.push("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+viewerdiv.dataset.cid+"/SDF?record_type=3d");else if(viewerdiv.dataset.href||viewerdiv.dataset.url){viewerdiv.dataset.href?uri=viewerdiv.dataset.href:uri=viewerdiv.dataset.url,datauri.push(uri),type=uri.substring(uri.lastIndexOf(".")+1),datatypes.push(type);var molName=uri.substring(uri.lastIndexOf("/")+1,uri.lastIndexOf("."));molName=="/"&&(molName=uri.substring(uri.lastIndexOf("/")+1)),viewerdiv.dataset[datatypes[datatypes.length-1]]=molName}var divdata=viewerdiv.dataset;for(i in divdata)i.substring(0,3)==="pdb"&&i!=="pdb"?(datauri.push("https://files.rcsb.org/view/"+divdata[i]+".pdb"),datatypes.push("pdb")):i.substring(0,4)==="href"&&i!=="href"?(uri=divdata[i],datauri.push(uri),datatypes.push(uri.substring(uri.lastIndexOf(".")+1))):i.substring(0,3)==="cid"&&i!=="cid"&&(datauri.push("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+divdata[i]+"/SDF?record_type=3d"),datatypes.push("sdf"));var options={};viewerdiv.dataset.options&&(options=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(viewerdiv.dataset.options));var bgcolor=_colors__WEBPACK_IMPORTED_MODULE_3__.CC.color(viewerdiv.dataset.backgroundcolor),bgalpha=viewerdiv.dataset.backgroundalpha;bgalpha=bgalpha==null?1:parseFloat(bgalpha);var style={line:{}};viewerdiv.dataset.style&&(style=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(viewerdiv.dataset.style));var select={};viewerdiv.dataset.select&&(select=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(viewerdiv.dataset.select));var selectstylelist=[],surfaces=[],labels=[],zoomto={},spin=null,d=viewerdiv.dataset,stylere=/style(.+)/,surfre=/surface(.*)/,reslabre=/labelres(.*)/,keys=[];for(dataname in d)Object.prototype.hasOwnProperty.call(d,dataname)&&keys.push(dataname);for(keys.sort(),i=0;i<keys.length;i++){dataname=keys[i];var m=stylere.exec(dataname),selname,newsel,styleobj;m&&(selname="select"+m[1],newsel=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(d[selname]),styleobj=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(d[dataname]),selectstylelist.push([newsel,styleobj])),m=surfre.exec(dataname),m&&(selname="select"+m[1],newsel=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(d[selname]),styleobj=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(d[dataname]),surfaces.push([newsel,styleobj])),m=reslabre.exec(dataname),m&&(selname="select"+m[1],newsel=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(d[selname]),styleobj=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(d[dataname]),labels.push([newsel,styleobj])),dataname=="zoomto"&&(zoomto=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(d[dataname])),dataname=="spin"&&(spin=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(d[dataname]))}var applyStyles=function(X){for(X.setStyle(select,style),UI&&UI.createSelectionAndStyle(select,style),i=0;i<selectstylelist.length;i++){let L=selectstylelist[i][0]||{},c=selectstylelist[i][1]||{line:{}};X.setStyle(L,c),UI&&UI.createSelectionAndStyle(select,style)}for(i=0;i<surfaces.length;i++){let L=surfaces[i][0]||{},c=surfaces[i][1]||{};UI?X.addSurface(_ProteinSurface4__WEBPACK_IMPORTED_MODULE_1__.SurfaceType.VDW,c,L,L).then(T=>{UI.loadSurface("VDW",L,c,T)}):X.addSurface(_ProteinSurface4__WEBPACK_IMPORTED_MODULE_1__.SurfaceType.VDW,c,L,L)}for(i=0;i<labels.length;i++){let L=labels[i][0]||{},c=labels[i][1]||{};X.addResLabels(L,c)}X.render(),X.zoomTo(zoomto),spin&&X.spin(spin.axis,spin.speed)},glviewer=viewer;try{var config=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(viewerdiv.dataset.config)||{};config.backgroundColor===void 0&&(config.backgroundColor=bgcolor),config.backgroundAlpha===void 0&&(config.backgroundAlpha=bgalpha),glviewer==null?glviewer=viewers[viewerdiv.id||nviewers++]=(0,_GLViewer__WEBPACK_IMPORTED_MODULE_0__.createViewer)(viewerdiv,config):(glviewer.setBackgroundColor(bgcolor,bgalpha),glviewer.setConfig(config),UI&&UI.initiateUI()),viewerdiv.dataset.ui&&$3Dmol.StateManager&&(UI=new $3Dmol.StateManager(glviewer))}catch(X){console.log(X),viewerdiv.textContent="WebGL appears to be disabled."}if(datauri.length!=0){let i=0;var process=function(moldata){uri=datauri[i];var type=viewerdiv.dataset.type||viewerdiv.dataset.datatype||datatypes[i];if(glviewer.addModel(moldata,type,options),UI){var modelName=viewerdiv.dataset[datatypes[i]];UI.setModelTitle(modelName)}if(i+=1,i<datauri.length)(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.get)(datauri[i]).then(process);else{if(applyStyles(glviewer),viewerdiv.dataset.callback){var runres=eval(viewerdiv.dataset.callback);typeof runres=="function"&&runres(glviewer)}processing_autoinit=!1,callback&&callback(glviewer)}};(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.get)(datauri[0]).then(process)}else{if(viewerdiv.dataset.element){var moldataid="#"+viewerdiv.dataset.element,molelem=document.querySelector(moldataid),moldata=molelem?molelem.textContent:"";type=viewerdiv.dataset.type||viewerdiv.dataset.datatype,glviewer.addModel(moldata,type,options)}if(applyStyles(glviewer),viewerdiv.dataset.callback){var runres=eval(viewerdiv.dataset.callback);typeof runres=="function"&&runres(glviewer)}processing_autoinit=!1,callback&&callback(glviewer)}})}}document.onreadystatechange=()=>{document.readyState==="complete"&&autoload()}},"./src/colors.ts":(X,L,c)=>{c.r(L),c.d(L,{CC:()=>T,Color:()=>A,builtinColorSchemes:()=>M,chains:()=>v,elementColors:()=>y,htmlColors:()=>D,residues:()=>C,ssColors:()=>P});class A{constructor(p,x,t){return this.r=0,this.g=0,this.b=0,arguments.length>1&&typeof p=="number"?(this.r=p||0,this.g=x||0,this.b=t||0,this):this.set(p||0)}set(p){return p instanceof A?p.clone():(typeof p=="number"?this.setHex(p):typeof p=="object"&&(this.r=(p==null?void 0:p.r)||0,this.g=(p==null?void 0:p.g)||0,this.b=(p==null?void 0:p.b)||0),this)}setHex(p){return p=Math.floor(p),this.r=(p>>16&255)/255,this.g=(p>>8&255)/255,this.b=(p&255)/255,this}getHex(){var p=Math.round(this.r*255),x=Math.round(this.g*255),t=Math.round(this.b*255);return p<<16|x<<8|t}clone(){return new A(this.r,this.g,this.b)}copy(p){return this.r=p.r,this.g=p.g,this.b=p.b,this}scaled(){var p={};return p.r=Math.round(this.r*255),p.g=Math.round(this.g*255),p.b=Math.round(this.b*255),p.a=1,p}}class T{static color(p){if(!p)return T.cache[0];if(p instanceof A)return p;if(typeof p=="number"&&typeof T.cache[p]<"u")return T.cache[p];if(p&&Array.isArray(p))return p.map(T.color);let x=T.getHex(p),t=new A(x);return T.cache[x]=t,t}static getHex(p){var x;if(Array.isArray(p))return p.map(T.getHex);if(typeof p=="string"){let t=p;if(!isNaN(parseInt(t)))return parseInt(t);if(t=t.trim(),t.length==4&&t[0]=="#"&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]),t.length==7&&t[0]=="#")return parseInt(t.substring(1),16);let r=T.rgbRegEx.exec(t);if(r){r[1]!=""&&console.log("WARNING: Opacity value in rgba ignored.  Specify separately as opacity attribute.");let h=0;for(let s=2;s<5;s++){h*=256;let o=r[s].endsWith("%")?255*parseFloat(r[s])/100:parseFloat(r[s]);h+=Math.round(o)}return h}return((x=window==null?void 0:window.$3Dmol)===null||x===void 0?void 0:x.htmlColors[p.toLowerCase()])||0}return p}}T.rgbRegEx=/rgb(a?)\(\s*([^ ,\)\t]+)\s*,\s*([^ ,\)\t]+)\s*,\s*([^ ,\)\t]+)/i,T.cache={0:new A(0)};const D={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgrey:11119017,darkgreen:25600,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,grey:8421504,green:32768,greenyellow:11403055,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgrey:13882323,lightgreen:9498256,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},P={pyMol:{h:16711680,s:16776960,c:65280},Jmol:{h:16711808,s:16762880,c:16777215}},u={H:16777215,He:16761035,HE:16761035,Li:11674146,LI:11674146,B:65280,C:13158600,N:9408511,O:15728640,F:14329120,Na:255,NA:255,Mg:2263842,MG:2263842,Al:8421520,AL:8421520,Si:14329120,SI:14329120,P:16753920,S:16762930,Cl:65280,CL:65280,Ca:8421520,CA:8421520,Ti:8421520,TI:8421520,Cr:8421520,CR:8421520,Mn:8421520,MN:8421520,Fe:16753920,FE:16753920,Ni:10824234,NI:10824234,Cu:10824234,CU:10824234,Zn:10824234,ZN:10824234,Br:10824234,BR:10824234,Ag:8421520,AG:8421520,I:10494192,Ba:16753920,BA:16753920,Au:14329120,AU:14329120},y={defaultColor:16716947,Jmol:{H:16777215,He:14286847,HE:14286847,Li:13402367,LI:13402367,Be:12779264,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,Ne:11789301,NE:11789301,Na:11230450,NA:11230450,Mg:9109248,MG:9109248,Al:12560038,AL:12560038,Si:1578e4,SI:1578e4,P:16744448,S:16777008,Cl:2093087,CL:2093087,Ar:8442339,AR:8442339,K:9388244,Ca:4062976,CA:4062976,Sc:15132390,SC:15132390,Ti:12567239,TI:12567239,V:10921643,Cr:9083335,CR:9083335,Mn:10255047,MN:10255047,Fe:14706227,FE:14706227,Co:15765664,CO:15765664,Ni:5296208,NI:5296208,Cu:13140019,CU:13140019,Zn:8224944,ZN:8224944,Ga:12750735,GA:12750735,Ge:6721423,GE:6721423,As:12419299,AS:12419299,Se:16752896,SE:16752896,Br:10889513,BR:10889513,Kr:6076625,KR:6076625,Rb:7351984,RB:7351984,Sr:65280,SR:65280,Y:9764863,Zr:9756896,ZR:9756896,Nb:7586505,NB:7586505,Mo:5551541,MO:5551541,Tc:3907230,TC:3907230,Ru:2396047,RU:2396047,Rh:687500,RH:687500,Pd:27013,PD:27013,Ag:12632256,AG:12632256,Cd:16767375,CD:16767375,In:10909043,IN:10909043,Sn:6717568,SN:6717568,Sb:10380213,SB:10380213,Te:13924864,TE:13924864,I:9699476,Xe:4366e3,XE:4366e3,Cs:5707663,CS:5707663,Ba:51456,BA:51456,La:7394559,LA:7394559,Ce:16777159,CE:16777159,Pr:14286791,PR:14286791,Nd:13107143,ND:13107143,Pm:10747847,PM:10747847,Sm:9437127,SM:9437127,Eu:6422471,EU:6422471,Gd:4587463,GD:4587463,Tb:3211207,TB:3211207,Dy:2097095,DY:2097095,Ho:65436,HO:65436,Er:58997,ER:58997,Tm:54354,TM:54354,Yb:48952,YB:48952,Lu:43812,LU:43812,Hf:5096191,HF:5096191,Ta:5089023,TA:5089023,W:2200790,Re:2522539,RE:2522539,Os:2516630,OS:2516630,Ir:1528967,IR:1528967,Pt:13684960,PT:13684960,Au:16765219,AU:16765219,Hg:12105936,HG:12105936,Tl:10900557,TL:10900557,Pb:5724513,PB:5724513,Bi:10375093,BI:10375093,Po:11230208,PO:11230208,At:7688005,AT:7688005,Rn:4358806,RN:4358806,Fr:4325478,FR:4325478,Ra:32e3,RA:32e3,Ac:7384058,AC:7384058,Th:47871,TH:47871,Pa:41471,PA:41471,U:36863,Np:33023,NP:33023,Pu:27647,PU:27647,Am:5528818,AM:5528818,Cm:7888099,CM:7888099,Bk:9064419,BK:9064419,Cf:10565332,CF:10565332,Es:11739092,ES:11739092,Fm:11739066,FM:11739066,Md:11734438,MD:11734438,No:12389767,NO:12389767,Lr:13041766,LR:13041766,Rf:13369433,RF:13369433,Db:13697103,DB:13697103,Sg:14221381,SG:14221381,Bh:14680120,BH:14680120,Hs:15073326,HS:15073326,Mt:15400998,MT:15400998},rasmol:u,defaultColors:Object.assign({},u),greenCarbon:Object.assign(Object.assign({},u),{C:65280}),cyanCarbon:Object.assign(Object.assign({},u),{C:65535}),magentaCarbon:Object.assign(Object.assign({},u),{C:16711935}),yellowCarbon:Object.assign(Object.assign({},u),{C:16776960}),whiteCarbon:Object.assign(Object.assign({},u),{C:16777215}),orangeCarbon:Object.assign(Object.assign({},u),{C:16753920}),purpleCarbon:Object.assign(Object.assign({},u),{C:8388736}),blueCarbon:Object.assign(Object.assign({},u),{C:255})},C={amino:{ALA:13158600,ARG:1334015,ASN:56540,ASP:15075850,CYS:15132160,GLN:56540,GLU:15075850,GLY:15461355,HIS:8553170,ILE:1016335,LEU:1016335,LYS:1334015,MET:15132160,PHE:3289770,PRO:14456450,SER:16422400,THR:16422400,TRP:11819700,TYR:3289770,VAL:1016335,ASX:16738740,GLX:16738740},shapely:{ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:16777215,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,ASX:16711935,GLX:16711935},nucleic:{A:10526975,G:16740464,I:8454143,C:16747595,T:10551200,U:16744576}},v={atom:{A:12636415,B:11599792,C:16761032,D:16777088,E:16761087,F:11596016,G:16765040,H:15761536,I:16113331,J:49151,K:13458524,L:6737322,M:10145074,N:15631086,O:52945,P:65407,Q:3978097,R:139,S:12433259,T:25600,U:8388608,V:8421376,W:8388736,X:32896,Y:12092939,Z:11674146},hetatm:{A:9478351,B:8441752,C:13602992,D:13619056,E:13603023,F:8437952,G:13607008,H:12603504,I:12955267,J:42959,K:11881548,L:5682578,M:9090346,N:12481214,O:46753,P:53103,Q:3447649,R:187,S:10854235,T:37888,U:11534336,V:11579392,W:11534512,X:45232,Y:15250963,Z:12726834}},M={ssPyMol:{prop:"ss",map:P.pyMol},ssJmol:{prop:"ss",map:P.Jmol},Jmol:{prop:"elem",map:y.Jmol},amino:{prop:"resn",map:C.amino},shapely:{prop:"resn",map:C.shapely},nucleic:{prop:"resn",map:C.nucleic},chain:{prop:"chain",map:v.atom},rasmol:{prop:"elem",map:y.rasmol},default:{prop:"elem",map:y.defaultColors},greenCarbon:{prop:"elem",map:y.greenCarbon},chainHetatm:{prop:"chain",map:v.hetatm},cyanCarbon:{prop:"elem",map:y.cyanCarbon},magentaCarbon:{prop:"elem",map:y.magentaCarbon},purpleCarbon:{prop:"elem",map:y.purpleCarbon},whiteCarbon:{prop:"elem",map:y.whiteCarbon},orangeCarbon:{prop:"elem",map:y.orangeCarbon},yellowCarbon:{prop:"elem",map:y.yellowCarbon},blueCarbon:{prop:"elem",map:y.blueCarbon}}},"./src/glcartoon.ts":(X,L,c)=>{c.r(L),c.d(L,{drawCartoon:()=>z,subdivide_spline:()=>v});var A=c("./src/WebGL/math/index.ts"),T=c("./src/WebGL/shapes/index.ts"),D=c("./src/WebGL/index.ts"),P=c("./src/Gradient.ts"),u=c("./src/colors.ts"),y=c("./src/GLDraw.ts"),C=c("./src/utilities.ts");function v(S,I){var F=[],G=S;G=[],G.push(S[0]);var B,W,V,k,U,j,q,ie,ge;for(B=1,W=S.length-1;B<W;B++)if(U=S[B],j=S[B+1],U.smoothen){var he=new A.Vector3((U.x+j.x)/2,(U.y+j.y)/2,(U.z+j.z)/2);he.atom=U.atom,G.push(he)}else G.push(U);for(G.push(S[S.length-1]),B=-1,V=G.length;B<=V-3;B++)if(k=G[B===-1?0:B],U=G[B+1],j=G[B+2],q=G[B===V-3?V-1:B+3],ie=new A.Vector3().subVectors(j,k).multiplyScalar(.5),ge=new A.Vector3().subVectors(q,U).multiplyScalar(.5),!j.skip)for(var ve=0;ve<I;ve++){var le=1/I*ve,se=U.x+le*ie.x+le*le*(-3*U.x+3*j.x-2*ie.x-ge.x)+le*le*le*(2*U.x-2*j.x+ie.x+ge.x),Me=U.y+le*ie.y+le*le*(-3*U.y+3*j.y-2*ie.y-ge.y)+le*le*le*(2*U.y-2*j.y+ie.y+ge.y),be=U.z+le*ie.z+le*le*(-3*U.z+3*j.z-2*ie.z-ge.z)+le*le*le*(2*U.z-2*j.z+ie.z+ge.z),Pe=new A.Vector3(se,Me,be);ve<I/2?Pe.atom=U.atom:Pe.atom=j.atom,F.push(Pe)}return F.push(G[G.length-1]),F}const M=.5,_=1.3,p=.8,x=.4,t=.4;function r(S,I,F,G){for(var B,W,V,k,U=0,j=I.length;U<j;U++){k=Math.round(U*(G.length-1)/j),V=u.CC.color(G[k]);var q=S.updateGeoGroup(2),ie=q.vertexArray,ge=q.colorArray,he=q.faceArray;B=q.vertices,W=B*3,ie[W]=I[U].x,ie[W+1]=I[U].y,ie[W+2]=I[U].z,ie[W+3]=F[U].x,ie[W+4]=F[U].y,ie[W+5]=F[U].z;for(var ve=0;ve<6;++ve)ge[W+3*ve]=V.r,ge[W+1+3*ve]=V.g,ge[W+2+3*ve]=V.b;if(U>0){var le=[B,B+1,B-1,B-2],se=q.faceidx;he[se]=le[0],he[se+1]=le[1],he[se+2]=le[3],he[se+3]=le[1],he[se+4]=le[2],he[se+5]=le[3],q.faceidx+=6}q.vertices+=2}}function h(S,I,F,G,B,W,V){var k,U,j,q;if(j=I.length,j<2||I[0].length<2)return;for(k=0;k<j;k++)I[k]=v(I[k],G);if(q=I[0].length,!B)return r(S,I[0],I[j-1],F);var ie,ge,he,ve,le,se,Me=[],be=[],Pe=[];for(U=0;U<j;U++)Me.push(.25+1.5*Math.sqrt((j-1)*U-Math.pow(U,2))/(j-1)),be.push(.5),Pe.push(2*(Math.pow(U/j,2)-U/j)+.6);var ce=[];for(U=0;U<j*2-1;U++)ce[U]=[U,U+1,U+1-2*j,U-2*j];ce[j*2-1]=[U,U+1-2*j,U+1-4*j,U-2*j];var me,De,Se,Ge,ke,ze,Re,Be,Ie,We;let Fe=S.updateGeoGroup();for(k=0;k<q;k++){let Z=S.groups,J=!1;Fe=S.updateGeoGroup(2*j),Z!=S.groups&&k>0&&(k=k-1,J=!0),ze=Math.round(k*(F.length-1)/q),ke=u.CC.color(F[ze]),le=he,se=ve,he=[],ve=[],ie=[],I[0][k].atom!==void 0&&(Ge=I[0][k].atom,V==="oval"?ge=Me:V==="rectangle"?ge=be:V==="parabola"&&(ge=Pe)),ge||(ge=be);var $e,Ye;for(U=0;U<j;U++)k<q-1?$e=I[U][k+1].clone().sub(I[U][k]):$e=I[U][k-1].clone().sub(I[U][k]).negate(),U<j-1?Ye=I[U+1][k].clone().sub(I[U][k]):Ye=I[U-1][k].clone().sub(I[U][k]).negate(),ie[U]=Ye.cross($e).normalize().multiplyScalar(B*ge[U]);for(U=0;U<j;U++)he[U]=I[U][k].clone().add(ie[U].clone().negate());for(U=0;U<j;U++)ve[U]=I[U][k].clone().add(ie[U]);for(Re=Fe.vertexArray,Be=Fe.colorArray,Ie=Fe.faceArray,me=Fe.vertices,De=me*3,U=0;U<j;U++)Re[De+3*U+0]=he[U].x,Re[De+3*U+1]=he[U].y,Re[De+3*U+2]=he[U].z;for(U=0;U<j;U++)Re[De+3*U+0+3*j]=ve[j-1-U].x,Re[De+3*U+1+3*j]=ve[j-1-U].y,Re[De+3*U+2+3*j]=ve[j-1-U].z;for(U=0;U<2*j;++U)Be[De+3*U+0]=ke.r,Be[De+3*U+1]=ke.g,Be[De+3*U+2]=ke.b;if(k>0&&!J){for(U=0;U<j*2;U++)We=[me+ce[U][0],me+ce[U][1],me+ce[U][2],me+ce[U][3]],Se=Fe.faceidx,Ie[Se]=We[0],Ie[Se+1]=We[1],Ie[Se+2]=We[3],Ie[Se+3]=We[1],Ie[Se+4]=We[2],Ie[Se+5]=We[3],Fe.faceidx+=6;if(Ge.clickable||Ge.hoverable){var $=[];$.push(new T.Triangle(le[0],he[0],he[j-1])),$.push(new T.Triangle(le[0],he[j-1],le[j-1])),$.push(new T.Triangle(le[j-1],he[j-1],ve[j-1])),$.push(new T.Triangle(le[j-1],ve[j-1],se[j-1])),$.push(new T.Triangle(ve[0],se[0],se[j-1])),$.push(new T.Triangle(ve[j-1],ve[0],se[j-1])),$.push(new T.Triangle(he[0],le[0],se[0])),$.push(new T.Triangle(ve[0],he[0],se[0]));for(U in $)Ge.intersectionShape.triangle.push($[U])}}Fe.vertices+=2*j}for(Re=Fe.vertexArray,Be=Fe.colorArray,Ie=Fe.faceArray,me=Fe.vertices,De=me*3,Se=Fe.faceidx,k=0;k<j-1;k++)We=[k,k+1,2*j-2-k,2*j-1-k],Se=Fe.faceidx,Ie[Se]=We[0],Ie[Se+1]=We[1],Ie[Se+2]=We[3],Ie[Se+3]=We[1],Ie[Se+4]=We[2],Ie[Se+5]=We[3],Fe.faceidx+=6;for(k=0;k<j-1;k++)We=[me-1-k,me-2-k,me-2*j+k+1,me-2*j+k],Se=Fe.faceidx,Ie[Se]=We[0],Ie[Se+1]=We[1],Ie[Se+2]=We[3],Ie[Se+3]=We[1],Ie[Se+4]=We[2],Ie[Se+5]=We[3],Fe.faceidx+=6}function s(S,I,F,G,B,W){if(!(I.length<2)){var V,k;if(V=I[0],k=I[I.length-1],V=v(V,G),k=v(k,G),!B)return r(S,V,k,F);var U=[],j,q,ie,ge,he,ve=[[0,2,-6,-8],[-4,-2,6,4],[7,-1,-5,3],[-3,5,1,-7]],le,se,Me,be,Pe,ce,me,De,Se,Ge,ke,ze,Re,Be,Ie,We,Fe;for(De=0,Se=V.length;De<Se;De++){if(Pe=Math.round(De*(F.length-1)/Se),be=u.CC.color(F[Pe]),U.push(q=V[De]),U.push(q),U.push(ie=k[De]),U.push(ie),De<Se-1){var $e=V[De+1].clone().sub(V[De]),Ye=k[De].clone().sub(V[De]);j=Ye.cross($e).normalize().multiplyScalar(B)}for(U.push(ge=V[De].clone().add(j)),U.push(ge),U.push(he=k[De].clone().add(j)),U.push(he),q.atom!==void 0&&(ce=q.atom),Be=S.updateGeoGroup(8),Ie=Be.vertexArray,We=Be.colorArray,Fe=Be.faceArray,le=Be.vertices,se=le*3,Ie[se]=q.x,Ie[se+1]=q.y,Ie[se+2]=q.z,Ie[se+3]=q.x,Ie[se+4]=q.y,Ie[se+5]=q.z,Ie[se+6]=ie.x,Ie[se+7]=ie.y,Ie[se+8]=ie.z,Ie[se+9]=ie.x,Ie[se+10]=ie.y,Ie[se+11]=ie.z,Ie[se+12]=ge.x,Ie[se+13]=ge.y,Ie[se+14]=ge.z,Ie[se+15]=ge.x,Ie[se+16]=ge.y,Ie[se+17]=ge.z,Ie[se+18]=he.x,Ie[se+19]=he.y,Ie[se+20]=he.z,Ie[se+21]=he.x,Ie[se+22]=he.y,Ie[se+23]=he.z,Ge=0;Ge<8;++Ge)We[se+3*Ge]=be.r,We[se+1+3*Ge]=be.g,We[se+2+3*Ge]=be.b;if(De>0){var $=me!==void 0&&ce!==void 0&&me.serial!==ce.serial;for(Ge=0;Ge<4;Ge++){var Z=[le+ve[Ge][0],le+ve[Ge][1],le+ve[Ge][2],le+ve[Ge][3]];if(Me=Be.faceidx,Fe[Me]=Z[0],Fe[Me+1]=Z[1],Fe[Me+2]=Z[3],Fe[Me+3]=Z[1],Fe[Me+4]=Z[2],Fe[Me+5]=Z[3],Be.faceidx+=6,ce.clickable||me.clickable||ce.hoverable||me.hoverable){var J=U[Z[3]].clone(),ae=U[Z[0]].clone(),de=U[Z[2]].clone(),Ee=U[Z[1]].clone();if(J.atom=U[Z[3]].atom||null,de.atom=U[Z[2]].atom||null,ae.atom=U[Z[0]].atom||null,Ee.atom=U[Z[1]].atom||null,$){var we=J.clone().add(ae).multiplyScalar(.5),H=de.clone().add(Ee).multiplyScalar(.5),fe=J.clone().add(Ee).multiplyScalar(.5);Ge%2===0?((me.clickable||me.hoverable)&&(ke=new T.Triangle(we,fe,J),ze=new T.Triangle(H,de,fe),Re=new T.Triangle(fe,de,J),me.intersectionShape.triangle.push(ke),me.intersectionShape.triangle.push(ze),me.intersectionShape.triangle.push(Re)),(ce.clickable||ce.hoverable)&&(ke=new T.Triangle(ae,Ee,fe),ze=new T.Triangle(Ee,H,fe),Re=new T.Triangle(ae,fe,we),ce.intersectionShape.triangle.push(ke),ce.intersectionShape.triangle.push(ze),ce.intersectionShape.triangle.push(Re))):((ce.clickable||ce.hoverable)&&(ke=new T.Triangle(we,fe,J),ze=new T.Triangle(H,de,fe),Re=new T.Triangle(fe,de,J),ce.intersectionShape.triangle.push(ke),ce.intersectionShape.triangle.push(ze),ce.intersectionShape.triangle.push(Re)),(me.clickable||me.hoverable)&&(ke=new T.Triangle(ae,Ee,fe),ze=new T.Triangle(Ee,H,fe),Re=new T.Triangle(ae,fe,we),me.intersectionShape.triangle.push(ke),me.intersectionShape.triangle.push(ze),me.intersectionShape.triangle.push(Re)))}else(ce.clickable||ce.hoverable)&&(ke=new T.Triangle(ae,Ee,J),ze=new T.Triangle(Ee,de,J),ce.intersectionShape.triangle.push(ke),ce.intersectionShape.triangle.push(ze))}}}Be.vertices+=8,me=ce}var xe=U.length-8;for(Be=S.updateGeoGroup(8),Ie=Be.vertexArray,We=Be.colorArray,Fe=Be.faceArray,le=Be.vertices,se=le*3,Me=Be.faceidx,De=0;De<4;De++){U.push(U[De*2]),U.push(U[xe+De*2]);var Te=U[De*2],ne=U[xe+De*2];Ie[se+6*De]=Te.x,Ie[se+1+6*De]=Te.y,Ie[se+2+6*De]=Te.z,Ie[se+3+6*De]=ne.x,Ie[se+4+6*De]=ne.y,Ie[se+5+6*De]=ne.z,We[se+6*De]=be.r,We[se+1+6*De]=be.g,We[se+2+6*De]=be.b,We[se+3+6*De]=be.r,We[se+4+6*De]=be.g,We[se+5+6*De]=be.b}xe+=8,ke=[le,le+2,le+6,le+4],ze=[le+1,le+5,le+7,le+3],Fe[Me]=ke[0],Fe[Me+1]=ke[1],Fe[Me+2]=ke[3],Fe[Me+3]=ke[1],Fe[Me+4]=ke[2],Fe[Me+5]=ke[3],Fe[Me+6]=ze[0],Fe[Me+7]=ze[1],Fe[Me+8]=ze[3],Fe[Me+9]=ze[1],Fe[Me+10]=ze[2],Fe[Me+11]=ze[3],Be.faceidx+=12,Be.vertices+=8}}function o(S,I,F,G,B,W,V){(!V||V==="default")&&(V="rectangle"),V==="edged"?s(S,I,F,G,B):(V==="rectangle"||V==="oval"||V==="parabola")&&h(S,I,F,G,B,W,V)}function e(S){return S&&S.elem==="C"&&S.atom==="CA"}function n(S,I){if(S&&I&&S.chain===I.chain){if(!S.hetflag&&!I.hetflag&&S.reschain===I.reschain&&(S.resi===I.resi||S.resi===I.resi-1))return!0;if(S.resi<I.resi){var F=S.x-I.x,G=S.y-I.y,B=S.z-I.z,W=F*F+G*G+B*B;if(S.atom=="CA"&&I.atom=="CA"&&W<16)return!0;if((S.atom=="P"||I.atom=="P")&&W<64)return!0}}return!1}function a(S,I,F,G,B){if(!(I==null||I.vertices==0)){B&&(I.initTypedArrays(),I.setUpNormals());var W=new D.MeshDoubleLambertMaterial;W.vertexColors=D.Coloring.FaceColors,typeof F=="number"&&F>=0&&F<1&&(W.transparent=!0,W.opacity=F),W.outline=G;var V=new D.Mesh(I,W);S.add(V)}}function g(S,I,F,G,B,W,V,k,U){var j,q,ie,ge,he,ve;if(!(!G||!B||!V)){var le=B.sub(G);le.normalize();var se=k[U];for(q=U+1;q<k.length&&(se=k[q],se.atom!=V.atom);q++);if(se=se?new A.Vector3(se.x,se.y,se.z):new A.Vector3(0,0,0),se.sub(G),V.ss==="arrow start"){var Me=se.clone().multiplyScalar(.3).cross(B);G.add(Me);var be=se.clone().cross(le).normalize();le.rotateAboutVector(be,.43)}for(V.style.cartoon.ribbon?j=V.style.cartoon.thickness||x:V.style.cartoon.width?j=V.style.cartoon.width:V.ss==="c"?V.atom==="P"?j=p:j=M:V.ss==="arrow start"?(j=_,he=!0):V.ss==="arrow end"||V.ss==="h"&&V.style.cartoon.tubes||V.ss==="tube start"?j=M:j=_,W!=null&&le.dot(W)<0&&le.negate(),le.multiplyScalar(j),q=0;q<I;q++)ie=-1+q*2/(I-1),ge=new A.Vector3(G.x+ie*le.x,G.y+ie*le.y,G.z+ie*le.z),ge.atom=V,F&&V.ss==="s"&&(ge.smoothen=!0),S[q].push(ge);if(he)for(le.multiplyScalar(2),q=0;q<I;q++)ie=-1+q*2/(I-1),ge=new A.Vector3(G.x+ie*le.x,G.y+ie*le.y,G.z+ie*le.z),ge.atom=V,ge.smoothen=!1,ge.skip=!0,S[q].push(ge);return ve=V.style.cartoon.style||"default",S.style?S.style!=ve&&(console.log("Warning: a cartoon chain's strand-style is ambiguous"),S.style="default"):S.style=ve,(V.ss==="arrow start"||V.ss==="arrow end")&&(V.ss="s"),he}}const f={C:!0,CA:!0,O:!0,P:!0,OP2:!0,O2P:!0,"O5'":!0,"O3'":!0,"C5'":!0,"C2'":!0,"O5*":!0,"O3*":!0,"C5*":!0,"C2*":!0,N1:!0,N3:!0},E={DA:!0,DG:!0,A:!0,G:!0},w={DT:!0,DC:!0,U:!0,C:!0,T:!0},R={DA:!0,DG:!0,A:!0,G:!0,DT:!0,DC:!0,U:!0,C:!0,T:!0};function z(S,I,F,G=10){let B=G,W=G;var V,k,U,j,q,ie,ge,he,ve,le,se,Me,be,Pe,ce,me,De,Se,Ge=new D.Geometry(!0),ke=new D.Geometry(!0),ze=[],Re=[],Be=1,Ie=!1,We={};for(var Fe in P.Gradient.builtinGradients)P.Gradient.builtinGradients.hasOwnProperty(Fe)&&(We[Fe]=new P.Gradient.builtinGradients[Fe](F[1],F[0]));var $e=function(K,Oe){return F&&Oe.color==="spectrum"?Oe.colorscheme in We?We[Oe.colorscheme].valueToHex(K.resi):We.sinebow.valueToHex(K.resi):(0,C.getColorFromStyle)(K,Oe).getHex()};for(he=0;he<B;he++)Re[he]=[];var Ye=!1,$=!1,Z=[];for(he in I){if(j=I[he],j.elem==="C"&&j.atom==="CA"){var J=n(U,j);J&&j.ss==="s"?Ye=!0:Ye&&(U&&k&&U.style.cartoon.arrows&&k.style.cartoon.arrows&&(U.ss="arrow end",k.ss="arrow start"),Ye=!1),J&&(U.ss==="h"||U.ss=="tube start")&&U.style.cartoon.tubes?!$&&U.ss!="tube start"&&j.style.cartoon.tubes&&(j.ss="tube start",$=!0):$&&(U.ss==="tube start"?U.ss="tube end":k&&k.style.cartoon.tubes&&(k.ss="tube end"),$=!1),k=U,U=j}j&&j.atom in f&&Z.push(j)}$&&U.style.cartoon.tubes&&(U.ss="tube end",$=!1);var ae=function(K){Re[0].length>0&&o(ke,Re,ze,W,ge,Be,Re.style);var Oe=[],Ne=null;if(K){for(he=0;he<B;he++)Oe[he]=Re[he][Re[he].length-1];Ne=ze[ze.length-1]}for(Re=[],he=0;he<B;he++)Re[he]=[];if(ze=[],K){for(he=0;he<B;he++)Re[he].push(Oe[he]);ze.push(Ne)}a(S,ke,Be,Ie,!0),a(S,Ge,Be,Ie,!1),ke=new D.Geometry(!0),Ge=new D.Geometry(!0)};U=void 0;for(var de=0;de<Z.length;de++){j=Z[de];var Ee=j.resn.trim(),we=Ee in R;if(Be=1,V=j.style.cartoon,U&&U.style.cartoon&&(Be=U.style.cartoon.opacity),U&&U.style.cartoon&&U.style.cartoon.outline&&(Ie=U.style.cartoon.outline),U&&U.style.cartoon&&(!j.style.cartoon||U.style.cartoon.opacity!=j.style.cartoon.opacity)&&ae(U.chain==j.chain),V.style==="trace"){if(!j.hetflag){if(j.elem==="C"&&j.atom==="CA"||we&&j.atom==="P"||j.atom==="BB"){if(ie=$e(j,V),(0,C.isNumeric)(V.thickness)?ge=V.thickness:ge=x,n(U,j))if(ie==q){var H=u.CC.color(ie);y.GLDraw.drawCylinder(Ge,U,j,ge,H,2,2)}else{var fe=new A.Vector3().addVectors(U,j).multiplyScalar(.5),xe=u.CC.color(q),Te=u.CC.color(ie);y.GLDraw.drawCylinder(Ge,U,fe,ge,xe,2,0),y.GLDraw.drawCylinder(Ge,fe,j,ge,Te,0,2)}if((j.clickable===!0||j.hoverable)&&j.intersectionShape!==void 0){var ne=new A.Vector3(j.x,j.y,j.z);j.intersectionShape.sphere.push(new T.Sphere(ne,ge))}U=j,q=ie}}}else{if(e(j)||we&&(j.atom==="P"||j.atom.indexOf("O5")==0)){if(Se)if(j.ss==="tube end")Se=!1,De=new A.Vector3(j.x,j.y,j.z),y.GLDraw.drawCylinder(Ge,me,De,2,u.CC.color(q),1,1),j.ss="h";else if(U.chain!=j.chain||U.ss==="tube end")Se=!1,U.ss="h",De=new A.Vector3(U.x,U.y,U.z),y.GLDraw.drawCylinder(Ge,me,De,2,u.CC.color(q),1,1);else continue;if(U&&(!n(U,j)||U.ss==="tube start")){for(U.ss==="tube start"&&(Se=!0,me=new A.Vector3(U.x,U.y,U.z),U.ss="h"),ce&&(Me?Pe=new A.Vector3().addVectors(U,Me).multiplyScalar(.5):Pe=new A.Vector3(U.x,U.y,U.z),y.GLDraw.drawCylinder(Ge,Pe,ce,t,u.CC.color(ce.color),0,2),g(Re,B,!0,Me,be,se,U,Z,de),ze.push(ie),Pe=null,ce=null),Re[0].length>0&&o(ke,Re,ze,W,ge,Be,Re.style),Re=[],he=0;he<B;he++)Re[he]=[];ze=[]}if(U===void 0||U.rescode!=j.rescode||U.resi!=j.resi){if(ce&&U!=null){Pe=new A.Vector3().addVectors(U,j).multiplyScalar(.5);var Le=Pe.clone().sub(ce).multiplyScalar(.02);Pe.add(Le),y.GLDraw.drawCylinder(Ge,Pe,ce,t,u.CC.color(ce.color),0,2),Pe=null,ce=null}ie=$e(j,V),ze.push(ie),(0,C.isNumeric)(V.thickness)?ge=V.thickness:ge=x,U=j,ve=new A.Vector3(U.x,U.y,U.z),ve.resi=U.resi,q=ie}(j.clickable===!0||j.hoverable===!0)&&(j.intersectionShape===void 0||j.intersectionShape.triangle===void 0)&&(j.intersectionShape={sphere:null,cylinder:[],line:[],triangle:[]})}else U!=null&&(e(U)&&j.atom==="O"||we&&U.atom==="P"&&(j.atom==="OP2"||j.atom==="O2P")||we&&U.atom.indexOf("O5")==0&&j.atom.indexOf("C5")==0)?(le=new A.Vector3(j.x,j.y,j.z),le.resi=j.resi,(j.atom==="OP2"||j.atom==="O2P")&&(be=new A.Vector3(j.x,j.y,j.z))):we&&j.atom.indexOf("O3")==0?Me=new A.Vector3(j.x,j.y,j.z):(j.atom==="N1"&&Ee in E||j.atom==="N3"&&Ee in w)&&(ce=new A.Vector3(j.x,j.y,j.z),ce.color=(0,C.getColorFromStyle)(j,V).getHex());le&&ve&&le.resi===ve.resi&&(g(Re,B,!0,ve,le,se,U,Z,de),se=le,ve=null,le=null,ze.push(ie))}}ce&&(Me?Pe=new A.Vector3().addVectors(U,Me).multiplyScalar(.5):Pe=new A.Vector3(U.x,U.y,U.z),y.GLDraw.drawCylinder(Ge,Pe,ce,t,u.CC.color(ce.color),0,2),g(Re,B,!0,Me,be,se,U,Z,de),ze.push(ie)),ae(!1)}},"./src/index.ts":(X,L,c)=>{c.r(L),c.d(L,{CAP:()=>t.CAP,CC:()=>T.CC,Color:()=>T.Color,CustomLinear:()=>A.CustomLinear,Cylinder:()=>C.Cylinder,GLDraw:()=>t.GLDraw,GLModel:()=>h.GLModel,GLShape:()=>x.GLShape,GLViewer:()=>s.GLViewer,GLVolumetricRender:()=>p.GLVolumetricRender,Gradient:()=>A.Gradient,GradientType:()=>A.GradientType,Label:()=>D.Label,LabelCount:()=>D.LabelCount,MarchingCube:()=>M.MarchingCube,MarchingCubeInitializer:()=>M.MarchingCubeInitializer,Matrix3:()=>y.Matrix3,Matrix4:()=>y.Matrix4,Parsers:()=>u.Parsers,PausableTimer:()=>v.PausableTimer,PointGrid:()=>M.PointGrid,ProteinSurface:()=>M.ProteinSurface,Quaternion:()=>y.Quaternion,ROYGB:()=>A.ROYGB,RWB:()=>A.RWB,Ray:()=>y.Ray,Sinebow:()=>A.Sinebow,Sphere:()=>C.Sphere,SurfaceType:()=>M.SurfaceType,Triangle:()=>C.Triangle,Vector2:()=>y.Vector2,Vector3:()=>y.Vector3,VolumeData:()=>_.VolumeData,adjustVolumeStyle:()=>v.adjustVolumeStyle,applyPartialCharges:()=>P.applyPartialCharges,autoinit:()=>o.autoinit,autoload:()=>o.autoload,base64ToArray:()=>v.base64ToArray,bondLength:()=>u.bondLength,builtinColorSchemes:()=>T.builtinColorSchemes,builtinGradients:()=>A.builtinGradients,chains:()=>T.chains,clamp:()=>y.clamp,conversionMatrix3:()=>y.conversionMatrix3,createStereoViewer:()=>s.createStereoViewer,createViewer:()=>s.createViewer,createViewerGrid:()=>s.createViewerGrid,deepCopy:()=>v.deepCopy,degToRad:()=>y.degToRad,download:()=>v.download,drawCartoon:()=>r.drawCartoon,elementColors:()=>T.elementColors,extend:()=>v.extend,get:()=>v.get,getAtomProperty:()=>v.getAtomProperty,getColorFromStyle:()=>v.getColorFromStyle,getElement:()=>v.getElement,getExtent:()=>v.getExtent,getGradient:()=>A.getGradient,getPropertyRange:()=>v.getPropertyRange,getbin:()=>v.getbin,htmlColors:()=>T.htmlColors,isEmptyObject:()=>v.isEmptyObject,isNumeric:()=>v.isNumeric,makeFunction:()=>v.makeFunction,mergeGeos:()=>v.mergeGeos,normalizeValue:()=>A.normalizeValue,partialCharges:()=>P.partialCharges,processing_autoinit:()=>o.processing_autoinit,residues:()=>T.residues,setBondLength:()=>u.setBondLength,setSyncSurface:()=>M.setSyncSurface,specStringToObject:()=>v.specStringToObject,splitMesh:()=>x.splitMesh,ssColors:()=>T.ssColors,subdivide_spline:()=>r.subdivide_spline,syncSurface:()=>M.syncSurface,viewers:()=>o.viewers});var A=c("./src/Gradient.ts"),T=c("./src/colors.ts"),D=c("./src/Label.ts"),P=c("./src/partialCharges.ts"),u=c("./src/parsers/index.ts"),y=c("./src/WebGL/math/index.ts"),C=c("./src/WebGL/shapes/index.ts"),v=c("./src/utilities.ts"),M=c("./src/ProteinSurface4.ts"),_=c("./src/VolumeData.ts"),p=c("./src/VolumetricRender.ts"),x=c("./src/GLShape.ts"),t=c("./src/GLDraw.ts"),r=c("./src/glcartoon.ts"),h=c("./src/GLModel.ts"),s=c("./src/GLViewer.ts"),o=c("./src/autoload.ts");c("./src/specs.ts"),window&&(window.$3Dmol=L)},"./src/parsers/CDJSON.ts":(X,L,c)=>{c.r(L),c.d(L,{CDJSON:()=>A});function A(T,D){var P=[[]];typeof T=="string"&&(T=JSON.parse(T));for(var u=T.m,y=u[0].a,C=u[0].b,v=u[0].s,M=D!==void 0&&D.parseStyle!==void 0?D.parseStyle:v!==void 0,_=P[P.length-1].length,p=0;p<y.length;p++){var x=y[p],t={};t.id=x.i,t.x=x.x,t.y=x.y,t.z=x.z||0,t.bonds=[],t.bondOrder=[];var r=x.l||"C";t.elem=r[0].toUpperCase()+r.substring(1).toLowerCase(),t.serial=P[P.length-1].length,M&&(t.style=v[x.s||0]),P[P.length-1].push(t)}for(let h=0;h<C.length;h++){let s=C[h],o=s.b+_,e=s.e+_,n=s.o||1,a=P[P.length-1][o],g=P[P.length-1][e];a.bonds.push(e),a.bondOrder.push(n),g.bonds.push(o),g.bondOrder.push(n)}return P}},"./src/parsers/CIF.ts":(X,L,c)=>{c.r(L),c.d(L,{CIF:()=>u});var A=c("./src/parsers/utils/computeSecondaryStructure.ts"),T=c("./src/parsers/utils/processSymmetries.ts"),D=c("./src/WebGL/index.ts"),P=c("./src/parsers/utils/assignPDBBonds.ts");function u(y,C={}){var v=[],M=!C.doAssembly,_=v.modelData=[],p=C.assignBonds===void 0?!0:C.assignBonds,x=function(Z,J,ae,de){return new D.Vector3(J,ae,de).applyMatrix3(Z)};function t(Z,J){for(var ae=[],de=0,Ee=0;Ee<Z.length;){for(;Z.substring(Ee,Ee+J.length)!==J&&Ee<Z.length;)if(Z[Ee]==="'"){for(Ee++;Ee<Z.length&&Z[Ee]!=="'";)Ee++;for(;Z.substring(Ee,Ee+J.length)!==J&&Ee<Z.length;)Ee++}else if(Z[Ee]==='"'){for(Ee++;Ee<Z.length&&Z[Ee]!=='"';)Ee++;Ee++}else Ee++;ae.push(Z.substring(de,Ee)),de=Ee=Ee+J.length}return ae}var r=y.split(/\r?\n|\r/),h=[],s=!1;for(let Z=0;Z<r.length;Z++){var o=r[Z].split("#")[0];if(s?o[0]===";"&&(s=!1):o[0]===";"&&(s=!0),s||o!==""){if(!s&&(o=o.trim(),o[0]==="_")){var e=o.split(/\s/)[0].indexOf(".");if(e>-1){let J=o.split("");J[e]="_",o=J.join(""),o=o.substring(0,e)+"_"+o.substring(e+1)}}h.push(o)}}for(var n=0;n<h.length;){for(;!h[n].startsWith("data_")||h[n]==="data_global";)n++;n++;for(var a={};n<h.length&&!h[n].startsWith("data_");)if(h[n][0]===void 0)n++;else if(h[n][0]==="_"){var g=h[n].split(/\s/)[0].toLowerCase(),f=a[g]=a[g]||[],E=h[n].substring(h[n].indexOf(g)+g.length);if(E==="")if(n++,h[n][0]===";"){var w=h[n].substring(1);for(n++;h[n]!==";";)w=w+`
`+h[n],n++;f.push(w)}else f.push(h[n]);else f.push(E.trim());n++}else if(h[n].substring(0,5)==="loop_"){n++;for(var R=[];h[n]===""||h[n][0]==="_";){if(h[n]!==""){let Z=h[n].split(/\s/)[0].toLowerCase(),J=a[Z]=a[Z]||[];R.push(J)}n++}for(var z=0;n<h.length&&h[n][0]!=="_"&&!h[n].startsWith("loop_")&&!h[n].startsWith("data_");){let Z=t(h[n]," ");for(var S=0;S<Z.length;S++)Z[S]!==""&&(R[z].push(Z[S]),z=(z+1)%R.length);n++}}else n++;_.push({symmetries:[]}),v.push([]);var I=a._atom_site_id!==void 0?a._atom_site_id.length:a._atom_site_label.length,F;if(a._cell_length_a!==void 0){var G=parseFloat(a._cell_length_a),B=parseFloat(a._cell_length_b),W=parseFloat(a._cell_length_c),V=parseFloat(a._cell_angle_alpha)||90,k=parseFloat(a._cell_angle_beta)||90,U=parseFloat(a._cell_angle_gamma)||90;F=(0,D.conversionMatrix3)(G,B,W,V,k,U),_[_.length-1].cryst={a:G,b:B,c:W,alpha:V,beta:k,gamma:U}}for(var j=0;j<I;j++)if(!(a._atom_site_group_pdb!==void 0&&a._atom_site_group_pdb[j]==="TER")){var q={};if(a._atom_site_cartn_x!==void 0)q.x=parseFloat(a._atom_site_cartn_x[j]),q.y=parseFloat(a._atom_site_cartn_y[j]),q.z=parseFloat(a._atom_site_cartn_z[j]);else{var ie=x(F,parseFloat(a._atom_site_fract_x[j]),parseFloat(a._atom_site_fract_y[j]),parseFloat(a._atom_site_fract_z[j]));q.x=ie.x,q.y=ie.y,q.z=ie.z}q.chain=a._atom_site_auth_asym_id?a._atom_site_auth_asym_id[j]:a._atom_site_label_asym_id?a._atom_site_label_asym_id[j]:void 0,q.resi=a._atom_site_auth_seq_id?parseInt(a._atom_site_auth_seq_id[j]):a._atom_site_label_seq_id?a._atom_site_label_seq_id[j]:void 0,q.resn=a._atom_site_auth_comp_id?a._atom_site_auth_comp_id[j].trim():a._atom_site_label_comp_id?a._atom_site_label_comp_id[j].trim():void 0,q.atom=a._atom_site_auth_atom_id?a._atom_site_auth_atom_id[j].replace(/"/gm,""):a._atom_site_label_atom_id?a._atom_site_label_atom_id[j].replace(/"/gm,""):void 0,q.hetflag=!a._atom_site_group_pdb||a._atom_site_group_pdb[j]==="HETA"||a._atom_site_group_pdb[j]==="HETATM";var ge="X";a._atom_site_type_symbol?ge=a._atom_site_type_symbol[j].replace(/\(?\+?\d+.*/,""):a._atom_site_label&&(ge=a._atom_site_label[j].split("_")[0].replace(/\(?\d+.*/,"")),q.elem=ge[0].toUpperCase()+ge.substring(1,2).toLowerCase(),q.bonds=[],q.ss="c",q.serial=j,q.bondOrder=[],q.properties={},v[v.length-1].push(q)}if(a._pdbx_struct_oper_list_id!==void 0&&!M)for(let Z=0;Z<a._pdbx_struct_oper_list_id.length;Z++){var he=parseFloat(a["_pdbx_struct_oper_list_matrix[1][1]"][Z]),ve=parseFloat(a["_pdbx_struct_oper_list_matrix[1][2]"][Z]),le=parseFloat(a["_pdbx_struct_oper_list_matrix[1][3]"][Z]),se=parseFloat(a["_pdbx_struct_oper_list_vector[1]"][Z]),Me=parseFloat(a["_pdbx_struct_oper_list_matrix[2][1]"][Z]),be=parseFloat(a["_pdbx_struct_oper_list_matrix[2][2]"][Z]),Pe=parseFloat(a["_pdbx_struct_oper_list_matrix[2][3]"][Z]),ce=parseFloat(a["_pdbx_struct_oper_list_vector[2]"][Z]),me=parseFloat(a["_pdbx_struct_oper_list_matrix[3][1]"][Z]),De=parseFloat(a["_pdbx_struct_oper_list_matrix[3][2]"][Z]),Se=parseFloat(a["_pdbx_struct_oper_list_matrix[3][3]"][Z]),Ge=parseFloat(a["_pdbx_struct_oper_list_vector[3]"][Z]),ke=new D.Matrix4(he,ve,le,se,Me,be,Pe,ce,me,De,Se,Ge);_[_.length-1].symmetries.push(ke)}var ze=function(Z){var J=Z.match("-");Z=Z.replace(/[-xyz]/g,"");var ae=Z.split("/"),de,Ee;return ae[1]===void 0?Ee=1:Ee=parseInt(ae[1]),ae[0]===""?de=1:de=parseInt(ae[0]),de/Ee*(J?-1:1)};if(a._symmetry_equiv_pos_as_xyz!==void 0&&!M)for(var Re=0;Re<a._symmetry_equiv_pos_as_xyz.length;Re++){var Be=a._symmetry_equiv_pos_as_xyz[Re].replace(/["' ]/g,""),Ie=Be.split(",").map(function(J){return J.replace(/-/g,"+-")});let Z=new D.Matrix4(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1);for(let J=0;J<3;J++){var We=Ie[J].split("+");for(let ae=0;ae<We.length;ae++){var Fe=We[ae];if(Fe!==""){var $e=ze(Fe);Fe.match("x")?Z.elements[J+0]=$e:Fe.match("y")?Z.elements[J+4]=$e:Fe.match("z")?Z.elements[J+8]=$e:Z.elements[J+12]=$e}}}var Ye=F.getMatrix4(),$=new D.Matrix4().getInverse(Ye,!0);Z=new D.Matrix4().multiplyMatrices(Z,$),Z=new D.Matrix4().multiplyMatrices(Ye,Z),_[_.length-1].symmetries.push(Z)}}for(let Z=0;Z<v.length;Z++)p&&!(C.duplicateAssemblyAtoms&&!C.dontConnectDuplicatedAtoms)&&(0,P.assignPDBBonds)(v[Z],C),(0,A.computeSecondaryStructure)(v[Z],C.hbondCutoff),(0,T.processSymmetries)(_[Z].symmetries,v[Z],C,_[Z].cryst),C.duplicateAssemblyAtoms&&!C.dontConnectDuplicatedAtoms&&p&&(0,P.assignPDBBonds)(v[Z],C);return v}},"./src/parsers/CUBE.ts":(X,L,c)=>{c.r(L),c.d(L,{CUBE:()=>P});var A=c("./src/WebGL/index.ts"),T=c("./src/parsers/utils/assignBonds.ts"),D=c("./src/parsers/utils/anumToSymbol.ts");function P(u,y){y=y||{};var C=[[]],v=u.split(/\r?\n/),M=y.assignBonds===void 0?!0:y.assignBonds;if(v.length<6)return C;var _=v[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),p=Math.abs(parseFloat(_[0]));let x={};var t=x.origin=new A.Vector3(parseFloat(_[1]),parseFloat(_[2]),parseFloat(_[3]));_=v[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),_=v[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var r=_[0]>0?.529177:1;t.multiplyScalar(r);var h=Math.abs(_[0]),s=new A.Vector3(parseFloat(_[1]),parseFloat(_[2]),parseFloat(_[3])).multiplyScalar(r);_=v[4].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var o=Math.abs(_[0]),e=new A.Vector3(parseFloat(_[1]),parseFloat(_[2]),parseFloat(_[3])).multiplyScalar(r);_=v[5].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var n=Math.abs(_[0]),a=new A.Vector3(parseFloat(_[1]),parseFloat(_[2]),parseFloat(_[3])).multiplyScalar(r);if(x.size={x:h,y:o,z:n},x.unit=new A.Vector3(s.x,e.y,a.z),s.y!=0||s.z!=0||e.x!=0||e.z!=0||a.x!=0||a.y!=0){x.matrix4=new A.Matrix4(s.x,e.x,a.x,0,s.y,e.y,a.y,0,s.z,e.z,a.z,0,0,0,0,1);let S=new A.Matrix4().makeTranslation(t.x,t.y,t.z);x.matrix4=x.matrix4.multiplyMatrices(S,x.matrix4),x.matrix=x.matrix4.matrix3FromTopLeft(),x.origin=new A.Vector3(0,0,0),x.unit=new A.Vector3(1,1,1)}C.modelData=[{cryst:x}],v=v.splice(6,p);for(var g=C[C.length-1].length,f=g+v.length,E=g;E<f;++E){var w={};w.serial=E;var R=v[E-g],z=R.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");w.elem=D.anumToSymbol[z[0]],w.x=parseFloat(z[2])*r,w.y=parseFloat(z[3])*r,w.z=parseFloat(z[4])*r,w.hetflag=!0,w.bonds=[],w.bondOrder=[],w.properties={},C[C.length-1].push(w)}if(M)for(let S=0;S<C.length;S++)(0,T.assignBonds)(C[S],y);return C}},"./src/parsers/GRO.ts":(X,L,c)=>{c.r(L),c.d(L,{GRO:()=>D});var A=c("./src/parsers/utils/assignPDBBonds.ts"),T=c("./src/parsers/utils/atomNameToElem.ts");function D(P,u){for(var y=[],C=P.split(/\r?\n|\r/);C.length>0&&!(C.length<3);){var v=parseInt(C[1]);if(isNaN(v)||v<=0||C.length<v+3)break;var M=[];y.push(M);for(var _=2,p=M.length,x=p+v,t=p;t<x;t++){var r=C[_++],h={};h.serial=t,h.atom=r.slice(10,15).trim(),h.elem=(0,T.atomNameToElem)(h.atom,!0),h.x=10*parseFloat(r.slice(20,28)),h.y=10*parseFloat(r.slice(28,36)),h.z=10*parseFloat(r.slice(36,44)),h.resi=parseInt(r.slice(0,5)),h.resn=r.slice(5,10).trim(),h.bonds=[],h.bondOrder=[],h.properties={},r.length>44&&(h.dx=10*parseFloat(r.slice(44,52)),h.dy=10*parseFloat(r.slice(52,60)),h.dz=10*parseFloat(r.slice(60,68))),M[t]=h}if(C.length<=_+3){var s=C[_++],o=s.trim().split(/\s+/);if(o.length==3){for(var e=0;e<3;e++)o[e]=parseFloat(o[e])*10;y.box=o}}C.splice(0,++_)}for(let n=0;n<y.length;n++)(0,A.assignPDBBonds)(y[n],u);return y}},"./src/parsers/LAMMPSTRJ.ts":(X,L,c)=>{c.r(L),c.d(L,{LAMMPSTRJ:()=>T});var A=c("./src/parsers/utils/assignBonds.ts");function T(D,P){for(var u=[],y={id:"serial",type:"atom",element:"elem",q:"charge",radius:"radius",x:"x",xu:"x",xs:"x",xsu:"x",y:"y",yu:"y",ys:"y",ysu:"y",z:"z",zu:"z",zs:"z",zsu:"z"},C=D.split(/\r?\n|\r/),v=0,M=0,_=0;_<C.length-9;){for(var p=_;p<C.length;p++)if(C[p].match(/ITEM: NUMBER OF ATOMS/)&&(M=parseInt(C[p+1])),C[p].match(/ITEM: ATOMS/)){v=p+1;break}var x=C[v-1].replace("ITEM: ATOMS ","").split(" ");u.push([]);for(let n=v;n<v+M;n++){for(var t={},r={},h=C[n].split(" "),s=0;s<h.length;s++){var o=y[x[s]];o!=null&&(o=="serial"?t[o]=parseInt(h[s]):o=="x"||o=="y"||o==="z"?t[o]=parseFloat(h[s]):o=="charge"||o=="radius"?r[o]=parseFloat(h[s]):t[o]=h[s]),t.properties=r,t.bonds=[],t.bondOrder=[]}u[u.length-1][n-v]=t}_=v+M-1}if(P.assignBonds)for(var e=0;e<u.length;e++)(0,A.assignBonds)(u[e],P);return u}},"./src/parsers/MMTF.ts":(X,L,c)=>{c.r(L),c.d(L,{MMTFparser:()=>M});var A=c("./src/utilities.ts"),T=c("./src/WebGL/index.ts"),D=c("./src/parsers/utils/computeSecondaryStructure.ts"),P=c("./src/parsers/utils/processSymmetries.ts"),u=c("./src/vendor/mmtf.js"),y=function(_){return String.fromCharCode.apply(null,_).replace(/\0/g,"")},C=function(_){return _==0||_==2||_==4?"h":_==3?"s":"c"};let v=new Set(["D-SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE","L-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING","NON-POLYMER","OTHER","PEPTIDE-LIKE","SACCHARIDE"]);function M(_,p){var x=!p.keepH,t=p.altLoc?p.altLoc:"A",r=!!p.noSecondaryStructure,h=!p.noComputeSecondaryStructure,s=!p.doAssembly,o=p.assemblyIndex?p.assemblyIndex:0;typeof _=="string"?_=(0,A.base64ToArray)(_):_=new Uint8Array(_);var e=u.decode(_),n=[[]],a=n.modelData=[],g=0,f=0,E=0,w=e.secStructList,R=e.bFactorList,z=e.altLocList,S=e.occupancyList,I=e.bondAtomList,F=e.bondOrderList,G=e.numModels;if(G==0)return n;p.multimodel||(G=1);var B,W,V,k,U,j,q=[];if(!s&&e.bioAssemblyList&&e.bioAssemblyList.length>0){var ie=e.bioAssemblyList[o].transformList;for(B=0,j=ie.length;B<j;B++){var ge=new T.Matrix4(ie[B].matrix);ge.transpose(),q.push(ge)}}var he=null;if(e.unitCell){var ve=e.unitCell;he={a:ve[0],b:ve[1],c:ve[2],alpha:ve[3],beta:ve[4],gamma:ve[5]}}let le=[];e.entityList.forEach(ue=>{ue.chainIndexList.forEach(Y=>{le[Y]=ue.type=="polymer"})});var se=0;for(U=0;U<G;U++){var Me=e.chainsPerModel[U],be=n[n.length-1],Pe=[];for(a.push({symmetries:q,cryst:he}),B=0;B<Me;++B){var ce=e.groupsPerChain[g],me=y(e.chainIdList.subarray(g*4,g*4+4));e.chainNameList&&(me=y(e.chainNameList.subarray(g*4,g*4+4)));var De=f,Se="";for(W=0;W<ce;++W){var Ge=e.groupList[e.groupTypeList[f]],ke=Ge.atomNameList.length,ze=0,Re=!1,Be=!1;if(w){ze=w[f];var Ie=C(ze);(f==0||Ie!=Se)&&(Re=!0),Se=Ie;var We=f+1;(We>=w.length||C(w[We]!=Ie))&&(Be=!0)}var Fe=e.groupIdList[f],$e=Ge.groupName;let ue=Ge.chemCompType;var Ye=E;let Y=v.has(ue)||!le[g];for(V=0;V<ke;++V){var $=Ge.elementList[V];if(x&&$=="H"){E+=1;continue}var Z="";R&&(Z=R[E]);var J="";z&&z[E]&&(J=String.fromCharCode(z[E]));var ae="";if(S&&(ae=S[E]),J!=""&&J!=t&&t!="*"){E+=1;continue}var de=e.atomIdList[E],Ee=Ge.atomNameList[V],we=0;Ge.atomChargeList&&(we=Ge.atomChargeList[V]);var H=e.xCoordList[E],fe=e.yCoordList[E],xe=e.zCoordList[E];Pe[E]=be.length,be.push({resn:$e,x:H,y:fe,z:xe,elem:$,hetflag:Y,chain:me,resi:Fe,icode:J,rescode:Fe+(J!=" "?"^"+J:""),serial:de,altLoc:J,index:E,atom:Ee,bonds:[],ss:C(ze),ssbegin:Re,ssend:Be,bondOrder:[],properties:{charge:we,occupancy:ae},b:Z}),E+=1}var Te=Ge.bondAtomList;for(V=0,k=Ge.bondOrderList.length;V<k;++V){var ne=Ye+Te[V*2],Le=Ye+Te[V*2+1],K=Ge.bondOrderList[V],Oe=Pe[ne],Ne=Pe[Le],O=be[Oe],pe=be[Ne];O&&pe&&(O.bonds.push(Ne),O.bondOrder.push(K),pe.bonds.push(Oe),pe.bondOrder.push(K))}f+=1}for(f=De,W=0;W<ce;++W)f+=1;g+=1}if(I)for(let ue=se,Y=I.length;ue<Y;ue+=2){let re=I[ue],ye=I[ue+1],je=F?F[ue/2]:1;if(re>=E){se=ue;break}let He=Pe[re],Ve=Pe[ye],qe=be[He],Et=be[Ve];qe&&Et&&(qe.bonds.push(Ve),qe.bondOrder.push(je),Et.bonds.push(He),Et.bondOrder.push(je))}p.multimodel&&(p.onemol||n.push([]))}if(!s)for(let ue=0;ue<n.length;ue++)(0,P.processSymmetries)(a[ue].symmetries,n[ue],p,a[ue].cryst);return h&&!r&&(0,D.computeSecondaryStructure)(n,p.hbondCutoff),n}},"./src/parsers/MOL2.ts":(X,L,c)=>{c.r(L),c.d(L,{MOL2:()=>T});let A={"C.1":"C",C1:"C","C.2":"C",C2:"C","C.3":"C",C3:"C","C.ar":"C",Car:"C","C.cat":"C",Ccat:"C","H.spc":"H",Hspc:"H","H.t3p":"H",Ht3p:"H","N.1":"N",N1:"N","N.2":"N",N2:"N","N.3":"N",N3:"N","N.4":"N",N4:"N","N.am":"N",Nam:"N","N.ar":"N",Nar:"N","N.p13":"N",Np13:"N","O.2":"O",O2:"O","O.3":"O",O3:"O","O.co2":"O",Oco2:"O","O.spc":"O",Ospc:"O","O.t3p":"O",Ot3p:"O","P.3":"P",P3:"P","S.2":"S",S2:"S","S.3":"S",S3:"S","S.o":"S",So:"S","S.o2":"S",So2:"S"};function T(D,P){var u=[[]],y=!1;typeof P.keepH<"u"&&(y=!P.keepH);var C=D.search(/@<TRIPOS>MOLECULE/),v=D.search(/@<TRIPOS>ATOM/);if(C==-1||v==-1)return u;for(var M=D.substring(C).split(/\r?\n|\r/);M.length>0;){var _=[],p=M[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),x=parseInt(p[0]),t=0;p.length>1&&(t=parseInt(p[1]));var r=4,h;for(h=3;h<M.length;h++)if(M[h]=="@<TRIPOS>ATOM"){r=h+1;break}var s=u[u.length-1].length,o=s+x,e;for(h=s;h<o;h++){e=M[r++],p=e.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var n={},a=p[5];if(A[a]!==void 0?a=A[a]:(a=a.split(".")[0],a=a[0].toUpperCase()+a.substring(1).toLowerCase()),n.atom=p[1],n.elem=a,!(n.elem=="H"&&y)){var g=u[u.length-1].length,f=parseInt(p[0]);n.serial=f,n.x=parseFloat(p[2]),n.y=parseFloat(p[3]),n.z=parseFloat(p[4]),n.atom=p[5];var E=parseFloat(p[8]);n.index=g,n.bonds=[],n.bondOrder=[],n.properties={charge:E,partialCharge:E},_[f]=g,u[u.length-1].push(n)}}for(var w=!1;r<M.length;)if(M[r++]=="@<TRIPOS>BOND"){w=!0;break}if(w&&t)for(h=0;h<t;h++){e=M[r++],p=e.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var R=parseInt(p[1]),z=u[u.length-1][_[R]],S=parseInt(p[2]),I=u[u.length-1][_[S]],F=parseInt(p[3]);isNaN(F)&&(F=1),z!==void 0&&I!==void 0&&(z.bonds.push(_[S]),z.bondOrder.push(F),I.bonds.push(_[R]),I.bondOrder.push(F))}if(P.multimodel){P.onemol||u.push([]),M.splice(0,r),D=M.join(`
`);continue}else break}return u}},"./src/parsers/PDB.ts":(X,L,c)=>{c.r(L),c.d(L,{PDB:()=>T});var A=c("./src/parsers/utils/getSinglePDB.ts");function T(D,P){P=P||{};var u=[],y={};u.modelData=[];for(var C=D.split(/\r?\n|\r/);C.length>0;){var v=(0,A.getSinglePDB)(C,P,y),M=v[0],_=v[1];if(C=v[2],M.length!=0){if(P.multimodel&&P.onemol&&u.length>0)for(var p=u[0].length,x=0;x<M.length;x++){var t=M[x];t.index=x;for(var r=0;r<t.bonds.length;r++)t.bonds[r]+=p;u[0].push(t)}else u.modelData.push(_),u.push(M);if(!P.multimodel)break}}return u}},"./src/parsers/PQR.ts":(X,L,c)=>{c.r(L),c.d(L,{PQR:()=>D});var A=c("./src/parsers/utils/assignPDBBonds.ts"),T=c("./src/parsers/utils/computeSecondaryStructure.ts");function D(P,u){var y=[[]],C=!u.noSecondaryStructure;y.modelData=[{symmetries:[]}];var v=[],M=P.split(/\r?\n|\r/),_;for(let w=0;w<M.length;w++){_=M[w].replace(/^\s*/,"");var p=_.substring(0,6);if(p.indexOf("END")==0)if(u.multimodel){u.onemol||y.push([]);continue}else break;else if(p=="ATOM  "||p=="HETATM"){var x;let R=parseInt(_.substring(6,11)),z=_.substring(12,16).replace(/ /g,""),S=_.substring(17,20).trim(),I=_.substring(21,22),F=parseInt(_.substring(22,26));var t=_.substring(30).trim().split(/\s+/),r=parseFloat(t[0]),h=parseFloat(t[1]),s=parseFloat(t[2]),o=parseFloat(t[3]),e=parseFloat(t[4]),n=z[0];z.length>1&&z[1].toUpperCase()!=z[1]&&(n=z.substring(0,2)),_[0]=="H"?x=!0:x=!1,v[R]=y[y.length-1].length,y[y.length-1].push({resn:S,x:r,y:h,z:s,elem:n,hetflag:x,chain:I,resi:F,serial:R,atom:z,bonds:[],ss:"c",bondOrder:[],properties:{charge:o,partialCharge:o,radius:e},pdbline:_})}else if(p=="CONECT"){var a=parseInt(_.substring(6,11)),g=y[y.length-1][v[a]];for(let R=0;R<4;R++){var f=parseInt(_.substring([11,16,21,26][R],[11,16,21,26][R]+5)),E=y[y.length-1][v[f]];g!==void 0&&E!==void 0&&(g.bonds.push(v[f]),g.bondOrder.push(1))}}}for(let w=0;w<y.length;w++)(0,A.assignPDBBonds)(y[w],u),C&&(0,T.computeSecondaryStructure)(y[w],u.hbondCutoff);return y}},"./src/parsers/PRMTOP.ts":(X,L,c)=>{c.r(L),c.d(L,{PRMTOP:()=>A});function A(T){var D=[],P,u=0,y=T.split(/\r?\n|\r/);if(y.length>0&&y[0].includes("VERSION")){var C=y.filter(function(r){return r.includes("POINTERS")||r.includes("ATOM_NAME")||r.includes("CHARGE")||r.includes("RADII")||r.includes("BONDS_INC_HYDROGEN")||r.includes("BONDS_WITHOUT_HYDROGEN")}),v=x("POINTERS");if(v==-1)return[];var M=t(v),_=parseInt(y[v+1].slice(0,M[1]));if(isNaN(_)||_<=0)return[];if(v=x("ATOM_NAME"),v==-1)return[];M=t(v);var p=M[0];for(let r=0;r<_/M[0];r++){r==parseInt(_/M[0])&&(p=_%M[0]);for(let h=0;h<p;h++){let s={},o={charge:"",radii:""};s.serial=u,s.x=0,s.y=0,s.z=0,s.atom=y[v+1].slice(M[1]*h,M[1]*(h+1)),s.elem=y[v+1].slice(M[1]*h,M[1]*h+1),s.properties=o,s.bonds=[],s.bondOrder=[],D.push(s),u++}v++}if(v=x("CHARGE"),v!=-1){M=t(v),u=0,p=M[0];for(let r=0;r<_/M[0];r++){r==parseInt(_/M[0])&&(p=_%M[0]);for(let h=0;h<p;h++)D[u].properties.charge=parseFloat(y[v+1].slice(M[1]*h,M[1]*(h+1))),u++;v++}}if(v=x("RADII"),v!=-1){M=t(v),u=0,p=M[0];for(let r=0;r<_/M[0];r++){r==parseInt(_/M[0])&&(p=_%M[0]);for(let h=0;h<p;h++)D[u].properties.radii=parseFloat(y[v+1].slice(M[1]*h,M[1]*(h+1))),u++;v++}}if(v=x("BONDS_WITHOUT_HYDROGEN"),v!=-1)for(M=t(v),u=0,p=M[0],v=v+1;!y[v].match(/^%FLAG/);){y[v+1].match(/^%FLAG/)&&(p=_%M[0]);for(let r=0;r<p;r++)u%3==0?P=parseInt(y[v].slice(M[1]*r,M[1]*(r+1))/3):u%3==1&&D[P].bonds.push(parseInt(y[v].slice(M[1]*r,M[1]*(r+1))/3)),u++;v++}if(v=x("BONDS_INC_HYDROGEN"),v!=-1)for(M=t(v),u=0,p=M[0],v=v+1;!y[v].match(/^%FLAG/);){y[v+1].match(/^%FLAG/)&&(p=_%M[0]);for(let r=0;r<p;r++)u%3==0?P=parseInt(y[v].slice(M[1]*r,M[1]*(r+1))/3):u%3==1&&D[P].bonds.push(parseInt(y[v].slice(M[1]*r,M[1]*(r+1))/3)),u++;v++}}else return[];function x(r){var h=y.indexOf(C.filter(function(s){return s.includes(r)})[0]);if(Number.isInteger(h)&&h>0){for(;!y[h].includes("FORMAT");)h++;return h}else return-1}function t(r){var h=y[r].match(/\((\d*)\S*/),s=y[r].match(/[a-zA-Z](\d*)\)\s*/);return s==null&&(s=y[r].match(/[a-zA-Z](\d*)\.\d*\)\s*/)),[h[1],s[1]]}return[D]}},"./src/parsers/SDF.ts":(X,L,c)=>{c.r(L),c.d(L,{SDF:()=>D});var A=function(P,u){var y=[[]],C=!1;for(typeof u.keepH<"u"&&(C=!u.keepH);P.length>0&&!(P.length<4);){var v=parseInt(P[3].substring(0,3));if(isNaN(v)||v<=0)break;var M=parseInt(P[3].substring(3,6)),_=4;if(P.length<4+v+M)break;var p=[],x=y[y.length-1].length,t=x+v,r,h;for(r=x;r<t;r++,_++){h=P[_];var s={},o=h.substring(31,34).replace(/ /g,"");s.atom=s.elem=o[0].toUpperCase()+o.substring(1).toLowerCase(),(s.elem!=="H"||!C)&&(s.serial=r,p[r]=y[y.length-1].length,s.x=parseFloat(h.substring(0,10)),s.y=parseFloat(h.substring(10,20)),s.z=parseFloat(h.substring(20,30)),s.hetflag=!0,s.bonds=[],s.bondOrder=[],s.properties={},s.index=y[y.length-1].length,y[y.length-1].push(s))}for(r=0;r<M;r++,_++){h=P[_];var e=p[parseInt(h.substring(0,3))-1+x],n=p[parseInt(h.substring(3,6))-1+x],a=parseFloat(h.substring(6));typeof e<"u"&&typeof n<"u"&&(y[y.length-1][e].bonds.push(n),y[y.length-1][e].bondOrder.push(a),y[y.length-1][n].bonds.push(e),y[y.length-1][n].bondOrder.push(a))}if(u.multimodel){for(u.onemol||y.push([]);P[_]!=="$$$$"&&_<P.length;)_++;P.splice(0,++_)}else break}return y},T=function(P,u){var y=[[]],C=!1;for(typeof u.keepH<"u"&&(C=!u.keepH);P.length>0&&!(P.length<8||!P[4].startsWith("M  V30 BEGIN CTAB")||!P[5].startsWith("M  V30 COUNTS")||P[5].length<14);){var v=P[5].substring(13).match(/\S+/g);if(v.length<2)break;var M=parseInt(v[0]);if(isNaN(M)||M<=0)break;var _=parseInt(v[1]),p=7;if(P.length<8+M+_)break;var x=[],t=y[y.length-1].length,r=t+M,h,s;for(h=t;h<r;h++,p++){s=P[p];var o=s.substring(6).match(/\S+/g);if(o.length>4){var e={},n=o[1].replace(/ /g,"");e.atom=e.elem=n[0].toUpperCase()+n.substring(1).toLowerCase(),(e.elem!=="H"||!C)&&(e.serial=h,x[h]=y[y.length-1].length,e.x=parseFloat(o[2]),e.y=parseFloat(o[3]),e.z=parseFloat(o[4]),e.hetflag=!0,e.bonds=[],e.bondOrder=[],e.properties={},e.index=y[y.length-1].length,y[y.length-1].push(e))}}if(P[p]==="M  V30 END ATOM")p++;else break;if(_!==0&&P[p]==="M  V30 BEGIN BOND")p++;else break;for(h=0;h<_;h++,p++){s=P[p];var a=s.substring(6).match(/\S+/g);if(a.length>3){var g=x[parseInt(a[2])-1+t],f=x[parseInt(a[3])-1+t],E=parseFloat(a[1]);typeof g<"u"&&typeof f<"u"&&(y[y.length-1][g].bonds.push(f),y[y.length-1][g].bondOrder.push(E),y[y.length-1][f].bonds.push(g),y[y.length-1][f].bondOrder.push(E))}}if(u.multimodel){for(u.onemol||y.push([]);P[p]!=="$$$$"&&p<P.length;)p++;P.splice(0,++p)}else break}return y};function D(P,u){var y="V2000",C=P.split(/\r?\n|\r/);return C.length>3&&C[3].length>38&&(y=C[3].substring(34,39)),y==="V2000"?A(C,u):y==="V3000"?T(C,u):[[""]]}},"./src/parsers/VASP.ts":(X,L,c)=>{c.r(L),c.d(L,{VASP:()=>T});var A=c("./src/WebGL/index.ts");function T(D){var P=[[]],u={},y=D.replace(/^\s+/,"").split(/\r?\n/);if(y.length<3)return P;if(y[1].match(/\d+/))u.length=parseFloat(y[1]);else return console.log("Warning: second line of the vasp structure file must be a number"),P;if(u.length<0)return console.log("Warning: Vasp implementation for negative lattice lengths is not yet available"),P;u.xVec=new Float32Array(y[2].replace(/^\s+/,"").split(/\s+/)),u.yVec=new Float32Array(y[3].replace(/^\s+/,"").split(/\s+/)),u.zVec=new Float32Array(y[4].replace(/^\s+/,"").split(/\s+/));var C=new A.Matrix3(u.xVec[0],u.xVec[1],u.xVec[2],u.yVec[0],u.yVec[1],u.yVec[2],u.zVec[0],u.zVec[1],u.zVec[2]);C.multiplyScalar(u.length),P.modelData=[{symmetries:[],cryst:{matrix:C}}];var v=y[5].replace(/\s+/,"").replace(/\s+$/,"").split(/\s+/),M=new Int16Array(y[6].replace(/^\s+/,"").split(/\s+/)),_=y[7].replace(/\s+/,"");if(_.match(/C/))_="cartesian";else if(_.match(/D/))_="direct";else return console.log("Warning: Unknown vasp mode in POSCAR file: mode must be either C(artesian) or D(irect)"),P;if(v.length!=M.length)return console.log("Warning: declaration of atomary species wrong:"),console.log(v),console.log(M),P;y.splice(0,8);for(var p=0,x=0,t=v.length;x<t;x++){for(var r=v[x],h=0,s=M[x];h<s;h++){var o=new Float32Array(y[p+h].replace(/^\s+/,"").split(/\s+/)),e={};e.elem=r,_=="cartesian"?(e.x=u.length*o[0],e.y=u.length*o[1],e.z=u.length*o[2]):(e.x=u.length*(o[0]*u.xVec[0]+o[1]*u.yVec[0]+o[2]*u.zVec[0]),e.y=u.length*(o[0]*u.xVec[1]+o[1]*u.yVec[1]+o[2]*u.zVec[1]),e.z=u.length*(o[0]*u.xVec[2]+o[1]*u.yVec[2]+o[2]*u.zVec[2])),e.bonds=[],P[0].push(e)}p+=M[x]}return P}},"./src/parsers/XYZ.ts":(X,L,c)=>{c.r(L),c.d(L,{XYZ:()=>D});var A=c("./src/WebGL/index.ts"),T=c("./src/parsers/utils/assignBonds.ts");function D(P,u){u=u||{};for(var y=[[]],C=u.assignBonds===void 0?!0:u.assignBonds,v=P.split(/\r?\n|\r/);v.length>0&&!(v.length<3);){var M=parseInt(v[0]);if(isNaN(M)||M<=0||v.length<M+2)break;var _=/Lattice\s*=\s*["\{\}]([^"\{\}]+)["\{\}]\s*/gi,p=_.exec(v[1]);if(p!=null&&p.length>1){var x=new Float32Array(p[1].split(/\s+/)),t=new A.Matrix3(x[0],x[3],x[6],x[1],x[4],x[7],x[2],x[5],x[8]);y.modelData=[{cryst:{matrix:t}}]}for(var r=2,h=y[y.length-1].length,s=h+M,o=h;o<s;o++){var e=v[r++],n=e.replace(/^\s+/,"").replace(/\s+/g," ").split(" "),a={};a.serial=o;var g=n[0];a.atom=a.elem=g[0].toUpperCase()+g.substring(1,2).toLowerCase(),a.x=parseFloat(n[1]),a.y=parseFloat(n[2]),a.z=parseFloat(n[3]),a.hetflag=!0,a.bonds=[],a.bondOrder=[],a.properties={},y[y.length-1][o]=a,n.length>=7&&(a.dx=parseFloat(n[4]),a.dy=parseFloat(n[5]),a.dz=parseFloat(n[6]))}if(u.multimodel)y.push([]),v.splice(0,r);else break}if(C)for(let E=0;E<y.length;E++)(0,T.assignBonds)(y[E],u);if(u.onemol){var f=y;y=[],y.push(f[0]);for(let E=1;E<f.length;E++){let w=y[0].length;for(let R=0;R<f[E].length;R++){let z=f[E][R];for(let S=0;S<z.bonds.length;S++)z.bonds[S]=z.bonds[S]+w;z.index=y[0].length,z.serial=y[0].length,y[0].push(z)}}}return y}},"./src/parsers/index.ts":(X,L,c)=>{c.r(L),c.d(L,{Parsers:()=>h,bondLength:()=>r.bondLength,setBondLength:()=>r.setBondLength});var A=c("./src/parsers/VASP.ts"),T=c("./src/parsers/CUBE.ts"),D=c("./src/parsers/XYZ.ts"),P=c("./src/parsers/SDF.ts"),u=c("./src/parsers/CDJSON.ts"),y=c("./src/parsers/CIF.ts"),C=c("./src/parsers/MOL2.ts"),v=c("./src/parsers/PDB.ts"),M=c("./src/parsers/PQR.ts"),_=c("./src/parsers/MMTF.ts"),p=c("./src/parsers/PRMTOP.ts"),x=c("./src/parsers/GRO.ts"),t=c("./src/parsers/LAMMPSTRJ.ts"),r=c("./src/parsers/utils/bondLength.ts");const h={vasp:A.VASP,VASP:A.VASP,cube:T.CUBE,CUBE:T.CUBE,xyz:D.XYZ,XYZ:D.XYZ,sdf:P.SDF,SDF:P.SDF,json:u.CDJSON,cdjson:u.CDJSON,CDJSON:u.CDJSON,mcif:y.CIF,cif:y.CIF,CIF:y.CIF,mol2:C.MOL2,MOL2:C.MOL2,pdb:v.PDB,PDB:v.PDB,pdbqt:v.PDB,PDBQT:v.PDB,pqr:M.PQR,PQR:M.PQR,mmtf:_.MMTFparser,MMTF:_.MMTFparser,prmtop:p.PRMTOP,PRMTOP:p.PRMTOP,gro:x.GRO,GRO:x.GRO,lammpstrj:t.LAMMPSTRJ,LAMMPSTRJ:t.LAMMPSTRJ}},"./src/parsers/utils/anumToSymbol.ts":(X,L,c)=>{c.r(L),c.d(L,{anumToSymbol:()=>A});const A={1:"H",2:"He",3:"Li",4:"Be",5:"B",6:"C",7:"N",8:"O",9:"F",10:"Ne",11:"Na",12:"Mg",13:"Al",14:"Si",15:"P",16:"S",17:"Cl",18:"Ar",19:"K",20:"Ca",21:"Sc",22:"Ti",23:"V",24:"Cr",25:"Mn",26:"Fe",27:"Co",28:"Ni",29:"Cu",30:"Zn",31:"Ga",32:"Ge",33:"As",34:"Se",35:"Br",36:"Kr",37:"Rb",38:"Sr",39:"Y",40:"Zr",41:"Nb",42:"Mo",43:"Tc",44:"Ru",45:"Rh",46:"Pd",47:"Ag",48:"Cd",49:"In",50:"Sn",51:"Sb",52:"Te",53:"I",54:"Xe",55:"Cs",56:"Ba",71:"Lu",72:"Hf",73:"Ta",74:"W",75:"Re",76:"Os",77:"Ir",78:"Pt",79:"Au",80:"Hg",81:"Tl",82:"Pb",83:"Bi",84:"Po",85:"At",86:"Rn",87:"Fr",88:"Ra",104:"Rf",105:"Db",106:"Sg",107:"Bh",108:"Hs",109:"Mt",110:"Ds",111:"Rg",112:"Cn",113:"Nh",114:"Fl",115:"Mc",116:"Lv",117:"Ts",118:"Og",57:"La",58:"Ce",59:"Pr",60:"Nd",61:"Pm",62:"Sm",63:"Eu",64:"Gd",65:"Tb",66:"Dy",67:"Ho",68:"Er",69:"Tm",70:"Yb",89:"Ac",90:"Th",91:"Pa",92:"U",93:"Np",94:"Pu",95:"Am",96:"Cm",97:"Bk",98:"Cf",99:"Es",100:"Fm",101:"Md",102:"No"}},"./src/parsers/utils/areConnected.ts":(X,L,c)=>{c.r(L),c.d(L,{areConnected:()=>D});var A=c("./src/parsers/utils/bondLength.ts");const T=new Set(["Na","K","Ca","Mg","Mn","Sr"]);function D(P,u,y){if(y&&y.unboundCations&&(T.has(P.elem)||T.has(u.elem)))return!1;let C=(0,A.bondLength)(P.elem)+(0,A.bondLength)(u.elem);C+=.25,C*=C;let v=P.x-u.x;if(v*=v,v>C)return!1;let M=P.y-u.y;if(M*=M,M>C)return!1;let _=P.z-u.z;if(_*=_,_>C)return!1;const p=v+M+_;return!(isNaN(p)||p<.5||p>C||P.altLoc!==u.altLoc&&P.altLoc!==" "&&u.altLoc!==" ")}},"./src/parsers/utils/assignBackboneHBonds.ts":(X,L,c)=>{c.r(L),c.d(L,{assignBackboneHBonds:()=>A});function A(T,D){const P=D||3.2,u=P*P,y=[];for(let C=0,v=T.length;C<v;C++){T[C].index=C;const M=T[C];!M.hetflag&&(M.atom==="N"||M.atom==="O")&&(y.push(M),M.hbondOther=null,M.hbondDistanceSq=Number.POSITIVE_INFINITY)}y.sort(function(C,v){return C.z-v.z});for(let C=0,v=y.length;C<v;C++){const M=y[C];for(let _=C+1;_<v;_++){const p=y[_],x=p.z-M.z;if(x>P)break;if(p.atom==M.atom)continue;const t=Math.abs(p.y-M.y);if(t>P)continue;const r=Math.abs(p.x-M.x);if(r>P)continue;const h=r*r+t*t+x*x;h>u||p.chain==M.chain&&Math.abs(p.resi-M.resi)<4||(h<M.hbondDistanceSq&&(M.hbondOther=p,M.hbondDistanceSq=h),h<p.hbondDistanceSq&&(p.hbondOther=M,p.hbondDistanceSq=h))}}}},"./src/parsers/utils/assignBonds.ts":(X,L,c)=>{c.r(L),c.d(L,{assignBonds:()=>P});var A=c("./src/parsers/utils/areConnected.ts");const T=[{x:0,y:0,z:1},{x:0,y:1,z:-1},{x:0,y:1,z:0},{x:0,y:1,z:1},{x:1,y:-1,z:-1},{x:1,y:-1,z:0},{x:1,y:-1,z:1},{x:1,y:0,z:-1},{x:1,y:0,z:0},{x:1,y:0,z:1},{x:1,y:1,z:-1},{x:1,y:1,z:0},{x:1,y:1,z:1}],D=4.95;function P(u,y){for(let M=0,_=u.length;M<_;M++)u[M].index||(u[M].index=M);const C={x:{y:{z:[]}}};for(let M=0;M<u.length;M++){const _=u[M],p=Math.floor(_.x/D),x=Math.floor(_.y/D),t=Math.floor(_.z/D);C[p]||(C[p]={}),C[p][x]||(C[p][x]={}),C[p][x][t]||(C[p][x][t]=[]),C[p][x][t].push(_)}function v(M,_){for(let p=0;p<M.length;p++){const x=M[p];for(let t=0;t<_.length;t++){const r=_[t];if((0,A.areConnected)(x,r,y)){const h=x.bonds.indexOf(r.index),s=r.bonds.indexOf(x.index);h===-1&&s===-1?(x.bonds.push(r.index),x.bondOrder.push(1),r.bonds.push(x.index),r.bondOrder.push(1)):h===-1?(x.bonds.push(r.index),x.bondOrder.push(r.bondOrder[s])):s===-1&&(r.bonds.push(x.index),r.bondOrder.push(x.bondOrder[h]))}}}}for(let M in C){const _=parseInt(M);for(let p in C[_]){const x=parseInt(p);for(let t in C[_][x]){const r=parseInt(t),h=C[_][x][r];for(let s=0;s<h.length;s++){const o=h[s];for(let e=s+1;e<h.length;e++){const n=h[e];(0,A.areConnected)(o,n,y)&&o.bonds.indexOf(n.index)==-1&&(o.bonds.push(n.index),o.bondOrder.push(1),n.bonds.push(o.index),n.bondOrder.push(1))}}for(let s=0;s<T.length;s++){const o=T[s];if(!C[_+o.x]||!C[_+o.x][x+o.y]||!C[_+o.x][x+o.y][r+o.z])continue;const e=C[_+o.x][x+o.y][r+o.z];v(h,e)}}}}}},"./src/parsers/utils/assignPDBBonds.ts":(X,L,c)=>{c.r(L),c.d(L,{assignPDBBonds:()=>P});var A=c("./src/parsers/utils/areConnected.ts"),T=c("./src/parsers/utils/assignBonds.ts"),D=c("./src/parsers/utils/standardResidues.ts");function P(u,y){const C=[],v=[];for(let x=0,t=u.length;x<t;x++){const r=u[x];r.index=x,r.hetflag||!D.standardResidues.has(r.resn)?v.push(r):C.push(r)}(0,T.assignBonds)(v,y),C.sort(function(x,t){return x.chain!==t.chain?x.chain<t.chain?-1:1:x.resi-t.resi});let M=-1,_=-1,p;for(let x=0,t=C.length;x<t;x++){const r=C[x];r.resi!==M&&(M=r.resi,p||_++,p=!1),r.reschain=_;for(let h=x+1;h<C.length;h++){const s=C[h];if(s.chain!==r.chain||s.resi-r.resi>1)break;(0,A.areConnected)(r,s,y)&&(r.bonds.indexOf(s.index)===-1&&(r.bonds.push(s.index),r.bondOrder.push(1),s.bonds.push(r.index),s.bondOrder.push(1)),r.resi!==s.resi&&(p=!0))}}}},"./src/parsers/utils/atomNameToElem.ts":(X,L,c)=>{c.r(L),c.d(L,{atomNameToElem:()=>T});var A=c("./src/parsers/utils/bondLength.ts");function T(D,P){let u=D.replace(/ /g,"");return u.length>0&&u[0]==="H"&&u!=="Hg"&&u!=="He"&&u!=="Hf"&&u!=="Hs"&&u!=="Ho"&&(u="H"),u.length>1&&(u=u[0].toUpperCase()+u.substring(1).toLowerCase(),A.bondTable[u]===void 0?u=u[0]:P&&(u==="Ca"||u==="Cd")&&(u="C")),u}},"./src/parsers/utils/bondLength.ts":(X,L,c)=>{c.r(L),c.d(L,{bondLength:()=>T,bondTable:()=>A,setBondLength:()=>D});let A={H:.37,He:.32,Li:1.34,Be:.9,B:.82,C:.77,N:.75,O:.73,F:.71,Ne:.69,Na:1.54,Mg:1.3,Al:1.18,Si:1.11,P:1.06,S:1.02,Cl:.99,Ar:.97,K:1.96,Ca:1.74,Sc:1.44,Ti:1.56,V:1.25,Mn:1.39,Fe:1.25,Co:1.26,Ni:1.21,Cu:1.38,Zn:1.31,Ga:1.26,Ge:1.22,Se:1.16,Br:1.14,Kr:1.1,Rb:2.11,Sr:1.92,Y:1.62,Zr:1.48,Nb:1.37,Mo:1.45,Tc:1.56,Ru:1.26,Rh:1.35,Pd:1.31,Ag:1.53,Cd:1.48,In:1.44,Sn:1.41,Sb:1.38,Te:1.35,I:1.33,Xe:1.3,Cs:2.25,Ba:1.98,Lu:1.6,Hf:1.5,Ta:1.38,W:1.46,Re:1.59,Os:1.44,Ir:1.37,Pt:1.28,Au:1.44,Hg:1.49,Tl:1.48,Pb:1.47,Bi:1.46,Rn:1.45};function T(P){return A[P]||1.6}function D(P,u){u<0&&(u=0),A[P]=u}},"./src/parsers/utils/computeSecondaryStructure.ts":(X,L,c)=>{c.r(L),c.d(L,{computeSecondaryStructure:()=>T});var A=c("./src/parsers/utils/assignBackboneHBonds.ts");function T(D,P){(0,A.assignBackboneHBonds)(D,P);const u={};let y,C,v,M,_,p;for(y=0,C=D.length;y<C;y++)if(_=D[y],u[_.chain]===void 0&&(u[_.chain]=[]),isFinite(_.hbondDistanceSq)){const x=_.hbondOther;u[x.chain]===void 0&&(u[x.chain]=[]),Math.abs(x.resi-_.resi)===4&&(u[_.chain][_.resi]="h")}for(v in u)for(M=1;M<u[v].length-1;M++){const x=u[v][M-1],t=u[v][M+1];p=u[v][M],x=="h"&&x==t&&p!=x&&(u[v][M]=x)}for(y=0,C=D.length;y<C;y++)_=D[y],isFinite(_.hbondDistanceSq)&&u[_.chain][_.resi]!="h"&&_.ss!=="h"&&(u[_.chain][_.resi]="maybesheet");for(let x=0,t=D.length;x<t;x++)if(_=D[x],isFinite(_.hbondDistanceSq)&&u[_.chain][_.resi]=="maybesheet"){let r=_.hbondOther,h=u[r.chain][r.resi];(h=="maybesheet"||h=="s")&&(u[_.chain][_.resi]="s",u[r.chain][r.resi]="s")}for(let x in u){for(let t=1;t<u[x].length-1;t++){const r=u[x][t-1],h=u[x][t+1];p=u[x][t],r=="s"&&r==h&&p!=r&&(u[x][t]=r)}for(let t=0;t<u[x].length;t++){const r=u[x][t];(r=="h"||r=="s")&&u[x][t-1]!=r&&u[x][t+1]!=r&&delete u[x][t]}}for(y=0,C=D.length;y<C;y++)_=D[y],p=u[_.chain][_.resi],delete _.hbondOther,delete _.hbondDistanceSq,!(p===void 0||p==="maybesheet")&&(_.ss=p,u[_.chain][_.resi-1]!=p&&(_.ssbegin=!0),u[_.chain][_.resi+1]!=p&&(_.ssend=!0))}},"./src/parsers/utils/getSinglePDB.ts":(X,L,c)=>{c.r(L),c.d(L,{getSinglePDB:()=>M});var A=c("./src/WebGL/index.ts"),T=c("./src/parsers/utils/atomNameToElem.ts"),D=c("./src/parsers/utils/bondLength.ts"),P=c("./src/parsers/utils/computeSecondaryStructure.ts"),u=c("./src/parsers/utils/isEmpty.ts"),y=c("./src/parsers/utils/processSymmetries.ts"),C=c("./src/parsers/utils/assignPDBBonds.ts"),v=c("./src/parsers/utils/validateBonds.ts");function M(_,p,x){const t=[],r=p.assignBonds===void 0?!0:p.assignBonds,h=!p.keepH,s=!!p.noSecondaryStructure,o=!p.noComputeSecondaryStructure,e=!p.doAssembly,n=p.altLoc?p.altLoc:"A",a={symmetries:[],cryst:void 0};let g,f=[];const E=[];let w;const R={};for(let z=0;z<_.length;z++){w=_[z].replace(/^\s*/,"");const S=w.substring(0,6);let I,F,G;if(S.indexOf("END")===0){if(f=_.slice(z+1),S==="END")for(const B in x)x.hasOwnProperty(B)&&delete x[B];break}else if(S==="ATOM  "||S==="HETATM"){let B,W,V,k,U,j,q,ie,ge,he,ve,le;if(ve=w.substring(16,17),ve!==" "&&ve!==n&&n!=="*"||(he=parseInt(w.substring(6,11)),g=w.substring(12,16).replace(/ /g,""),B=w.substring(17,20).replace(/ /g,""),W=w.substring(21,22),V=parseInt(w.substring(22,26)),k=w.substring(26,27),U=parseFloat(w.substring(30,38)),j=parseFloat(w.substring(38,46)),q=parseFloat(w.substring(46,54)),le=parseFloat(w.substring(60,68)),ge=w.substring(76,78).replace(/ /g,""),ge===""||D.bondTable[ge]===void 0?ge=(0,T.atomNameToElem)(w.substring(12,14),w[0]=="A"):ge=ge[0].toUpperCase()+ge.substring(1).toLowerCase(),ge==="H"&&h))continue;S[0]=="H"?ie=!0:ie=!1,E[he]=t.length,t.push({resn:B,x:U,y:j,z:q,elem:ge,hetflag:ie,altLoc:ve,chain:W,resi:V,icode:k,rescode:V+(k!==" "?"^"+k:""),serial:he,atom:g,bonds:[],ss:"c",bondOrder:[],properties:{},b:le,pdbline:w})}else if(S==="SHEET "){I=w.substring(21,22),F=parseInt(w.substring(22,26)),G=parseInt(w.substring(33,37)),I in x||(x[I]={}),x[I][F]="s1";for(let B=F+1;B<G;B++)x[I][B]="s";x[I][G]="s2"}else if(S==="CONECT"){const B=parseInt(w.substring(6,11)),W=E[B],V=t[W],k=[11,16,21,26];for(let U=0;U<4;U++){const j=parseInt(w.substring(k[U],k[U]+5)),q=E[j];let ie=W+":"+q;const ge=t[q];if(V!==void 0&&ge!==void 0)if(!R[ie])R[ie]=1,(V.bonds.length==0||V.bonds[V.bonds.length-1]!==q)&&(V.bonds.push(q),V.bondOrder.push(1));else{R[ie]+=1;for(let he=0;he<V.bonds.length;he++)if(V.bonds[he]==q){const ve=R[ie];ve>=4?V.bondOrder[he]=1:V.bondOrder[he]=ve}}}}else if(S==="HELIX "){I=w.substring(19,20),F=parseInt(w.substring(21,25)),G=parseInt(w.substring(33,37)),I in x||(x[I]={}),x[I][F]="h1";for(let B=F+1;B<G;B++)x[I][B]="h";x[I][G]="h2"}else if(!e&&S==="REMARK"&&w.substring(13,18)==="BIOMT"){let B,W=new A.Matrix4;for(B=1;B<=3;B++)if(w=_[z].replace(/^\s*/,""),parseInt(w.substring(18,19))==B)W.elements[B-1]=parseFloat(w.substring(23,33)),W.elements[B-1+4]=parseFloat(w.substring(33,43)),W.elements[B-1+8]=parseFloat(w.substring(43,53)),W.elements[B-1+12]=parseFloat(w.substring(53)),z++;else for(;w.substring(13,18)==="BIOMT";)z++,w=_[z].replace(/^\s*/,"");W.elements[3]=0,W.elements[7]=0,W.elements[11]=0,W.elements[15]=1,a.symmetries.push(W),z--}else if(S==="CRYST1"){let B,W,V,k,U,j;B=parseFloat(w.substring(7,15)),W=parseFloat(w.substring(16,24)),V=parseFloat(w.substring(25,33)),k=parseFloat(w.substring(34,40)),U=parseFloat(w.substring(41,47)),j=parseFloat(w.substring(48,54)),a.cryst={a:B,b:W,c:V,alpha:k,beta:U,gamma:j}}else if(S==="ANISOU"){const B=parseInt(w.substring(6,11)),W=E[B],V=t[W];if(V){const k=w.substring(30).trim().split(/\s+/),U={u11:parseInt(k[0]),u22:parseInt(k[1]),u33:parseInt(k[2]),u12:parseInt(k[3]),u13:parseInt(k[4]),u23:parseInt(k[5])};V.uMat=U}}}if((0,v.validateBonds)(t,E),r&&(0,C.assignPDBBonds)(t,p),e||(0,y.processSymmetries)(a.symmetries,t,p,a.cryst),o&&!s&&(0,P.computeSecondaryStructure)(t,p.hbondCutoff),!(0,u.isEmpty)(x))for(let z=0;z<t.length;z++){const S=t[z];if(S!==void 0&&S.chain in x&&S.resi in x[S.chain]){const I=x[S.chain][S.resi];S.ss=I[0],I.length>1&&(I[1]=="1"?S.ssbegin=!0:I[1]=="2"&&(S.ssend=!0))}}return[t,a,f]}},"./src/parsers/utils/isEmpty.ts":(X,L,c)=>{c.r(L),c.d(L,{isEmpty:()=>A});function A(T){for(const D in T)return!1;return!0}},"./src/parsers/utils/processSymmetries.ts":(X,L,c)=>{c.r(L),c.d(L,{processSymmetries:()=>T});var A=c("./src/WebGL/index.ts");function T(D,P,u,y){const C=!u.duplicateAssemblyAtoms,v=P.length;let M=v,_=-1,p=null,x=null;(u.normalizeAssembly||u.wrapAtoms)&&y&&(p=(0,A.conversionMatrix3)(y.a,y.b,y.c,y.alpha,y.beta,y.gamma),x=new A.Matrix3,x.getInverse3(p));let t=function(s){let o=s.clone().applyMatrix3(x);const e=[o.x,o.y,o.z],n=[0,0,0];for(let g=0;g<3;g++){for(;e[g]<-.001;)e[g]+=1,n[g]+=1;for(;e[g]>1.001;)e[g]-=1,n[g]-=1}const a=new A.Vector3(n[0],n[1],n[2]);return a.applyMatrix3(p),a};if(u.normalizeAssembly&&y)for(let s=0;s<D.length;s++){const o=new A.Vector3(0,0,0);for(let n=0;n<v;n++){const a=new A.Vector3(P[n].x,P[n].y,P[n].z);a.applyMatrix4(D[s]),o.add(a)}o.divideScalar(v);const e=t(o);D[s].isNearlyIdentity()&&e.lengthSq()>.001&&(_=s),D[s].translate(e)}if(C){if(D.length>1)for(let s=0;s<P.length;s++){var r=[];for(let o=0;o<D.length;o++)if(!D[o].isNearlyIdentity()){var h=new A.Vector3;h.set(P[s].x,P[s].y,P[s].z),h.applyMatrix4(D[o]),r.push(h)}P[s].symmetries=r}}else{for(let s=0;s<v;s++)P[s].sym=-1;for(let s=0;s<D.length;s++)if(!D[s].isNearlyIdentity()&&_!=s){let o=new A.Vector3;for(let e=0;e<v;e++){const n=[];for(let g=0;g<P[e].bonds.length;g++)n.push(P[e].bonds[g]+M);if(o.set(P[e].x,P[e].y,P[e].z),o.applyMatrix4(D[s]),u.wrapAtoms&&y){let g=t(o);o.add(g)}const a={};for(const g in P[e])a[g]=P[e][g];a.x=o.x,a.y=o.y,a.z=o.z,a.bonds=n,a.sym=s,a.index=P.length,P.push(a)}M=P.length}else for(let o=0;o<v;o++)P[o].sym=s;if(u.wrapAtoms&&y){let s=new A.Vector3;for(let o=0;o<v;o++){s.set(P[o].x,P[o].y,P[o].z);let e=t(s);s.add(e),P[o].x=s.x,P[o].y=s.y,P[o].z=s.z}}if(_>=0){const s=new A.Vector3;for(let o=0;o<v;o++)s.set(P[o].x,P[o].y,P[o].z),s.applyMatrix4(D[_]),P[o].x=s.x,P[o].y=s.y,P[o].z=s.z}D.length=0}}},"./src/parsers/utils/standardResidues.ts":(X,L,c)=>{c.r(L),c.d(L,{standardResidues:()=>A});const A=new Set(["ABU","ACD","ALA","ALB","ALI","ARG","AR0","ASN","ASP","ASX","BAS","CYS","CYH","CYX","CSS","CSH","GLN","GLU","GLX","GLY","HIS","HIE","HID","HIP","HYP","ILE","ILU","LEU","LYS","MET","PCA","PGA","PHE","PR0","PRO","PRZ","SER","THR","TRP","TYR","VAL","A","1MA","C","5MC","OMC","G","1MG","2MG","M2G","7MG","OMG","YG","I","T","U","+U","H2U","5MU","PSU","ACE","F0R","H2O","HOH","WAT"])},"./src/parsers/utils/validateBonds.ts":(X,L,c)=>{c.r(L),c.d(L,{validateBonds:()=>A});function A(T,D){for(let P=0,u=T.length;P<u;P++){const y=T[P];for(let C=0;C<y.bonds.length;C++){const v=y.bonds[C],M=T[v],_=D[y.serial];M&&_&&M.bonds.indexOf(_)<0&&(M.bonds.push(_),M.bondOrder.push(y.bondOrder[C]))}}}},"./src/partialCharges.ts":(X,L,c)=>{c.r(L),c.d(L,{applyPartialCharges:()=>T,partialCharges:()=>A});const A={"ALA:N":-.15,"ALA:CA":.1,"ALA:CB":0,"ALA:C":.6,"ALA:O":-.55,"ARG:N":-.15,"ARG:CA":.1,"ARG:CB":0,"ARG:CG":0,"ARG:CD":.1,"ARG:NE":-.1,"ARG:CZ":.5,"ARG:NH1":.25,"ARG:NH2":.25,"ARG:C":.6,"ARG:O":-.55,"ASN:N":-.15,"ASN:CA":.1,"ASN:CB":0,"ASN:CG":.55,"ASN:OD1":-.55,"ASN:ND2":0,"ASN:C":.6,"ASN:O":-.55,"ASP:N":-.15,"ASP:CA":.1,"ASP:CB":0,"ASP:CG":.14,"ASP:OD1":-.57,"ASP:OD2":-.57,"ASP:C":.6,"ASP:O":-.55,"CYS:N":-.15,"CYS:CA":.1,"CYS:CB":.19,"CYS:SG":-.19,"CYS:C":.6,"CYS:O":-.55,"GLN:N":-.15,"GLN:CA":.1,"GLN:CB":0,"GLN:CG":0,"GLN:CD":.55,"GLN:OE1":-.55,"GLN:NE2":0,"GLN:C":.6,"GLN:O":-.55,"GLU:N":-.15,"GLU:CA":.1,"GLU:CB":0,"GLU:CG":0,"GLU:CD":.14,"GLU:OE1":-.57,"GLU:OE2":-.57,"GLU:C":.6,"GLU:O":-.55,"GLY:N":-.15,"GLY:CA":.1,"GLY:C":.6,"GLY:O":-.55,"HIS:N":-.15,"HIS:CA":.1,"HIS:CB":0,"HIS:CG":.1,"HIS:ND1":-.1,"HIS:CD2":.1,"HIS:NE2":-.4,"HIS:CE1":.3,"HIS:C":.6,"HIS:O":-.55,"ILE:N":-.15,"ILE:CA":.1,"ILE:CB":0,"ILE:CG2":0,"ILE:CG1":0,"ILE:CD":0,"ILE:C":.6,"ILE:O":-.55,"LEU:N":-.15,"LEU:CA":.1,"LEU:CB":0,"LEU:CG":0,"LEU:CD1":0,"LEU:CD2":0,"LEU:C":.6,"LEU:O":-.55,"LYS:N":-.15,"LYS:CA":.1,"LYS:CB":0,"LYS:CG":0,"LYS:CD":0,"LYS:CE":.25,"LYS:NZ":.75,"LYS:C":.6,"LYS:O":-.55,"MET:N":-.15,"MET:CA":.1,"MET:CB":0,"MET:CG":.06,"MET:SD":-.12,"MET:CE":.06,"MET:C":.6,"MET:O":-.55,"PHE:N":-.15,"PHE:CA":.1,"PHE:CB":0,"PHE:CG":0,"PHE:CD1":0,"PHE:CD2":0,"PHE:CE1":0,"PHE:CE2":0,"PHE:CZ":0,"PHE:C":.6,"PHE:O":-.55,"PRO:N":-.25,"PRO:CD":.1,"PRO:CA":.1,"PRO:CB":0,"PRO:CG":0,"PRO:C":.6,"PRO:O":-.55,"SER:N":-.15,"SER:CA":.1,"SER:CB":.25,"SER:OG":-.25,"SER:C":.6,"SER:O":-.55,"THR:N":-.15,"THR:CA":.1,"THR:CB":.25,"THR:OG1":-.25,"THR:CG2":0,"THR:C":.6,"THR:O":-.55,"TRP:N":-.15,"TRP:CA":.1,"TRP:CB":0,"TRP:CG":-.03,"TRP:CD2":.1,"TRP:CE2":-.04,"TRP:CE3":-.03,"TRP:CD1":.06,"TRP:NE1":-.06,"TRP:CZ2":0,"TRP:CZ3":0,"TRP:CH2":0,"TRP:C":.6,"TRP:O":-.55,"TYR:N":-.15,"TYR:CA":.1,"TYR:CB":0,"TYR:CG":0,"TYR:CD1":0,"TYR:CE1":0,"TYR:CD2":0,"TYR:CE2":0,"TYR:CZ":.25,"TYR:OH":-.25,"TYR:C":.6,"TYR:O":-.55,"VAL:N":-.15,"VAL:CA":.1,"VAL:CB":0,"VAL:CG1":0,"VAL:CG2":0,"VAL:C":.6,"VAL:O":-.55};function T(D,P){if((!P||typeof D.partialCharge>"u")&&D.resn&&D.atom){var u=D.resn+":"+D.atom;D.properties.partialCharge=A[u]}}},"./src/specs.ts":(X,L,c)=>{c.r(L)},"./src/utilities.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{PausableTimer:()=>PausableTimer,adjustVolumeStyle:()=>adjustVolumeStyle,base64ToArray:()=>base64ToArray,deepCopy:()=>deepCopy,download:()=>download,extend:()=>extend,get:()=>get,getAtomProperty:()=>getAtomProperty,getColorFromStyle:()=>getColorFromStyle,getElement:()=>getElement,getExtent:()=>getExtent,getPropertyRange:()=>getPropertyRange,getbin:()=>getbin,isEmptyObject:()=>isEmptyObject,isNumeric:()=>isNumeric,makeFunction:()=>makeFunction,mergeGeos:()=>mergeGeos,specStringToObject:()=>specStringToObject});var _Gradient__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/Gradient.ts"),_VolumeData__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/VolumeData.ts"),_colors__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/colors.ts");function extend(X,L){for(var c in L)L.hasOwnProperty(c)&&L[c]!==void 0&&(X[c]=L[c]);return X}function deepCopy(X){let L,c,A;if(X==null)return{};if(typeof X!="object"||X===null)return X;L=Array.isArray(X)?[]:{};for(A in X)c=X[A],L[A]=deepCopy(c);return L}function isNumeric(X){var L=typeof X;return(L==="number"||L==="string")&&!isNaN(X-parseFloat(X))}function isEmptyObject(X){var L;for(L in X)return!1;return!0}function makeFunction(callback){return callback&&typeof callback=="string"&&(callback=eval("("+callback+")")),callback&&typeof callback!="function"?null:callback}function adjustVolumeStyle(X){X&&(X.volformat&&!(X.voldata instanceof _VolumeData__WEBPACK_IMPORTED_MODULE_1__.VolumeData)&&(X.voldata=new _VolumeData__WEBPACK_IMPORTED_MODULE_1__.VolumeData(X.voldata,X.volformat)),X.volscheme&&(X.volscheme=_Gradient__WEBPACK_IMPORTED_MODULE_0__.Gradient.getGradient(X.volscheme)))}function getExtent(X,L){var c,A,T,D,P,u,y,C,v,M,_=!L;if(c=A=T=9999,D=P=u=-9999,y=C=v=M=0,X.length===0)return[[0,0,0],[0,0,0],[0,0,0]];for(var p=0;p<X.length;p++){var x=X[p];if(!(typeof x>"u"||!isFinite(x.x)||!isFinite(x.y)||!isFinite(x.z))&&(M++,y+=x.x,C+=x.y,v+=x.z,c=c<x.x?c:x.x,A=A<x.y?A:x.y,T=T<x.z?T:x.z,D=D>x.x?D:x.x,P=P>x.y?P:x.y,u=u>x.z?u:x.z,x.symmetries&&_))for(var t=0;t<x.symmetries.length;t++)M++,y+=x.symmetries[t].x,C+=x.symmetries[t].y,v+=x.symmetries[t].z,c=c<x.symmetries[t].x?c:x.symmetries[t].x,A=A<x.symmetries[t].y?A:x.symmetries[t].y,T=T<x.symmetries[t].z?T:x.symmetries[t].z,D=D>x.symmetries[t].x?D:x.symmetries[t].x,P=P>x.symmetries[t].y?P:x.symmetries[t].y,u=u>x.symmetries[t].z?u:x.symmetries[t].z}return[[c,A,T],[D,P,u],[y/M,C/M,v/M]]}function getPropertyRange(X,L){for(var c=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY,T=0,D=X.length;T<D;T++){var P=X[T],u=getAtomProperty(P,L);u!=null&&(u<c&&(c=u),u>A&&(A=u))}return!isFinite(c)&&!isFinite(A)?c=A=0:isFinite(c)?isFinite(A)||(A=c):c=A,[c,A]}class PausableTimer{constructor(L,c,A){this.total_time_run=0,this.fn=L,this.arg=A,this.countdown=c,this.start_time=new Date().getTime(),this.ident=setTimeout(L,c,A)}cancel(){clearTimeout(this.ident)}pause(){clearTimeout(this.ident),this.total_time_run=new Date().getTime()-this.start_time}resume(){this.ident=setTimeout(this.fn,Math.max(0,this.countdown-this.total_time_run),this.arg)}}function base64ToArray(X){for(var L=window.atob(X),c=L.length,A=new Uint8Array(c),T=0;T<c;T++)A[T]=L.charCodeAt(T);return A}function getAtomProperty(X,L){var c=null;return X.properties&&typeof X.properties[L]<"u"?c=X.properties[L]:typeof X[L]<"u"&&(c=X[L]),c}function mergeGeos(X,L){var c=L.geometry;c!==void 0&&X.geometryGroups.push(c.geometryGroups[0])}function specStringToObject(X){if(typeof X=="object")return X;if(typeof X>"u"||X==null)return X;try{return JSON.parse(X)}catch{}X=X.replace(/%7E/g,"~");var L=function(_){return isNumeric(_)?Math.floor(parseFloat(_))==parseInt(_)||_.indexOf(".")>=0?parseFloat(_):parseInt(_):_==="true"?!0:_==="false"?!1:_},c={};if(X==="all")return c;for(var A=X.split(";"),T=0;T<A.length;T++){var D=A[T].split(":"),P=D[0],u={},y=D[1];if(y)if(y=y.replace(/~/g,"="),y.indexOf("=")!==-1)for(var C=y.split(","),v=0;v<C.length;v++){var M=C[v].split("=",2);u[M[0]]=L(M[1])}else y.indexOf(",")!==-1?u=y.split(","):u=L(y);c[P]=u}return c}function checkStatus(X){if(!X.ok)throw new Error(`HTTP ${X.status} - ${X.statusText}`);return X}function get(X,L){var c=fetch(X).then(checkStatus).then(A=>A.text());return L?c.then(L):c}function getbin(X,L,c,A){var T;return c=="POST"?T=fetch(X,{method:"POST",body:A}).then(D=>checkStatus(D)).then(D=>D.arrayBuffer()):T=fetch(X).then(D=>checkStatus(D)).then(D=>D.arrayBuffer()),L?T.then(L):T}function download(X,L,c,A){var T="",D="",P="",u="",y=null,C=L.addModel();if(X.indexOf(":")<0&&(X.length==4?X="pdb:"+X:isNaN(X)?X="url:"+X:X="cid:"+X),X.substring(0,5)==="mmtf:")D=c&&c.pdbUri?c.pdbUri:"https://mmtf.rcsb.org/v1.0/full/",X=X.substring(5).toUpperCase(),u=D+X,c&&typeof c.noComputeSecondaryStructure>"u"&&(c.noComputeSecondaryStructure=!0),y=new Promise(function(M){getbin(u).then(function(_){C.addMolData(_,"mmtf",c),L.zoomTo(),L.render(),M(C)},function(){console.log("fetch of "+u+" failed.")})});else{if(X.substring(0,4)==="pdb:"){if(T="mmtf",c&&c.format&&(T=c.format),c&&typeof c.noComputeSecondaryStructure>"u"&&(c.noComputeSecondaryStructure=!0),X=X.substring(4).toUpperCase(),!X.match(/^[1-9][A-Za-z0-9]{3}$/)){alert("Wrong PDB ID");return}T=="mmtf"?(P=c&&c.mmtfUri?c.mmtfUri:"https://mmtf.rcsb.org/v1.0/full/",u=P+X.toUpperCase()):(D=c&&c.pdbUri?c.pdbUri:"https://files.rcsb.org/view/",u=D+X+"."+T)}else if(X.substring(0,4)=="cid:"){if(T="sdf",X=X.substring(4),!X.match(/^[0-9]+$/)){alert("Wrong Compound ID");return}u="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+X+"/SDF?record_type=3d"}else X.substring(0,4)=="url:"&&(u=X.substring(4),T=u);var v=function(M){C.addMolData(M,T,c),L.zoomTo(),L.render()};y=new Promise(function(M){T=="mmtf"?getbin(u).then(function(_){v(_),M(C)}).catch(function(){D=c&&c.pdbUri?c.pdbUri:"https://files.rcsb.org/view/",u=D+X+".pdb",T="pdb",console.log("falling back to pdb format"),get(u).then(function(_){v(_),M(C)}).catch(function(_){v(""),M(C),console.log("fetch of "+u+" failed: "+_.statusText)})}):get(u).then(function(_){v(_),M(C)}).catch(function(_){v(""),M(C),console.log("fetch of "+u+" failed: "+_.statusText)})})}return A?(y.then(function(M){A(M)}),C):y}function getColorFromStyle(X,L){let c=L.colorscheme;if(typeof _colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[c]<"u")c=_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[c];else if(typeof c=="string"&&c.endsWith("Carbon")){let P=c.substring(0,c.lastIndexOf("Carbon")).toLowerCase();if(typeof _colors__WEBPACK_IMPORTED_MODULE_2__.htmlColors[P]<"u"){let u=Object.assign({},_colors__WEBPACK_IMPORTED_MODULE_2__.elementColors.defaultColors);u.C=_colors__WEBPACK_IMPORTED_MODULE_2__.htmlColors[P],_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[c]={prop:"elem",map:u},c=_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[c]}}let A=X.color;if(typeof L.color<"u"&&L.color!="spectrum"&&(A=L.color),typeof c<"u"){let P,u;if(typeof _colors__WEBPACK_IMPORTED_MODULE_2__.elementColors[c]<"u")c=_colors__WEBPACK_IMPORTED_MODULE_2__.elementColors[c],typeof c[X[c.prop]]<"u"&&(A=c.map[X[c.prop]]);else if(typeof c[X[c.prop]]<"u")A=c.map[X[c.prop]];else if(typeof c.prop<"u"&&typeof c.gradient<"u"){P=c.prop;var T=c.gradient;typeof _Gradient__WEBPACK_IMPORTED_MODULE_0__.builtinGradients[T]<"u"&&(T=new _Gradient__WEBPACK_IMPORTED_MODULE_0__.builtinGradients[T](c.min,c.max,c.mid?c.mid:c.colors));let y=T.range()||[-1,1];u=getAtomProperty(X,P),u!=null&&(A=T.valueToHex(u,y))}else typeof c.prop<"u"&&typeof c.map<"u"?(P=c.prop,u=getAtomProperty(X,P),typeof c.map[u]<"u"&&(A=c.map[u])):typeof L.colorscheme[X.elem]<"u"?A=L.colorscheme[X.elem]:console.log("Could not interpret colorscheme "+c)}else typeof L.colorfunc<"u"&&(A=L.colorfunc(X));return _colors__WEBPACK_IMPORTED_MODULE_2__.CC.color(A)}function getElement(X){let L=X;return typeof X=="string"?L=document.querySelector("#"+X):typeof X=="object"&&X.get&&(L=X.get(0)),L}},"./node_modules/upng-js/UPNG.js":(X,L,c)=>{(function(){var A={},T;X.exports=A,T=c("./node_modules/upng-js/node_modules/pako/index.js"),function(D,P){D.toRGBA8=function(u){var y=u.width,C=u.height;if(u.tabs.acTL==null)return[D.toRGBA8.decodeImage(u.data,y,C,u).buffer];var v=[];u.frames[0].data==null&&(u.frames[0].data=u.data);for(var M,_=new Uint8Array(y*C*4),p=0;p<u.frames.length;p++){var x=u.frames[p],t=x.rect.x,r=x.rect.y,h=x.rect.width,s=x.rect.height,o=D.toRGBA8.decodeImage(x.data,h,s,u);if(p==0?M=o:x.blend==0?D._copyTile(o,h,s,M,y,C,t,r,0):x.blend==1&&D._copyTile(o,h,s,M,y,C,t,r,1),v.push(M.buffer),M=M.slice(0),x.dispose!=0){if(x.dispose==1)D._copyTile(_,h,s,M,y,C,t,r,0);else if(x.dispose==2){for(var e=p-1;u.frames[e].dispose==2;)e--;M=new Uint8Array(v[e]).slice(0)}}}return v},D.toRGBA8.decodeImage=function(u,y,C,v){var M=y*C,_=D.decode._getBPP(v),p=Math.ceil(y*_/8),x=new Uint8Array(M*4),t=new Uint32Array(x.buffer),r=v.ctype,h=v.depth,s=D._bin.readUshort;if(r==6){var o=M<<2;if(h==8)for(var e=0;e<o;e++)x[e]=u[e];if(h==16)for(var e=0;e<o;e++)x[e]=u[e<<1]}else if(r==2){var n=v.tabs.tRNS,a=-1,g=-1,f=-1;if(n&&(a=n[0],g=n[1],f=n[2]),h==8)for(var e=0;e<M;e++){var E=e<<2,w=e*3;x[E]=u[w],x[E+1]=u[w+1],x[E+2]=u[w+2],x[E+3]=255,a!=-1&&u[w]==a&&u[w+1]==g&&u[w+2]==f&&(x[E+3]=0)}if(h==16)for(var e=0;e<M;e++){var E=e<<2,w=e*6;x[E]=u[w],x[E+1]=u[w+2],x[E+2]=u[w+4],x[E+3]=255,a!=-1&&s(u,w)==a&&s(u,w+2)==g&&s(u,w+4)==f&&(x[E+3]=0)}}else if(r==3){var R=v.tabs.PLTE,z=v.tabs.tRNS,S=z?z.length:0;if(h==1)for(var I=0;I<C;I++)for(var F=I*p,G=I*y,e=0;e<y;e++){var E=G+e<<2,B=u[F+(e>>3)]>>7-((e&7)<<0)&1,W=3*B;x[E]=R[W],x[E+1]=R[W+1],x[E+2]=R[W+2],x[E+3]=B<S?z[B]:255}if(h==2)for(var I=0;I<C;I++)for(var F=I*p,G=I*y,e=0;e<y;e++){var E=G+e<<2,B=u[F+(e>>2)]>>6-((e&3)<<1)&3,W=3*B;x[E]=R[W],x[E+1]=R[W+1],x[E+2]=R[W+2],x[E+3]=B<S?z[B]:255}if(h==4)for(var I=0;I<C;I++)for(var F=I*p,G=I*y,e=0;e<y;e++){var E=G+e<<2,B=u[F+(e>>1)]>>4-((e&1)<<2)&15,W=3*B;x[E]=R[W],x[E+1]=R[W+1],x[E+2]=R[W+2],x[E+3]=B<S?z[B]:255}if(h==8)for(var e=0;e<M;e++){var E=e<<2,B=u[e],W=3*B;x[E]=R[W],x[E+1]=R[W+1],x[E+2]=R[W+2],x[E+3]=B<S?z[B]:255}}else if(r==4){if(h==8)for(var e=0;e<M;e++){var E=e<<2,V=e<<1,k=u[V];x[E]=k,x[E+1]=k,x[E+2]=k,x[E+3]=u[V+1]}if(h==16)for(var e=0;e<M;e++){var E=e<<2,V=e<<2,k=u[V];x[E]=k,x[E+1]=k,x[E+2]=k,x[E+3]=u[V+2]}}else if(r==0){var a=v.tabs.tRNS?v.tabs.tRNS:-1;if(h==1)for(var e=0;e<M;e++){var k=255*(u[e>>3]>>7-(e&7)&1),U=k==a*255?0:255;t[e]=U<<24|k<<16|k<<8|k}if(h==2)for(var e=0;e<M;e++){var k=85*(u[e>>2]>>6-((e&3)<<1)&3),U=k==a*85?0:255;t[e]=U<<24|k<<16|k<<8|k}if(h==4)for(var e=0;e<M;e++){var k=17*(u[e>>1]>>4-((e&1)<<2)&15),U=k==a*17?0:255;t[e]=U<<24|k<<16|k<<8|k}if(h==8)for(var e=0;e<M;e++){var k=u[e],U=k==a?0:255;t[e]=U<<24|k<<16|k<<8|k}if(h==16)for(var e=0;e<M;e++){var k=u[e<<1],U=s(u,e<<1)==a?0:255;t[e]=U<<24|k<<16|k<<8|k}}return x},D.decode=function(u){for(var y=new Uint8Array(u),C=8,v=D._bin,M=v.readUshort,_=v.readUint,p={tabs:{},frames:[]},x=new Uint8Array(y.length),t=0,r,h=0,s=[137,80,78,71,13,10,26,10],o=0;o<8;o++)if(y[o]!=s[o])throw"The input is not a PNG file!";for(;C<y.length;){var e=v.readUint(y,C);C+=4;var n=v.readASCII(y,C,4);if(C+=4,n=="IHDR")D.decode._IHDR(y,C,p);else if(n=="IDAT"){for(var o=0;o<e;o++)x[t+o]=y[C+o];t+=e}else if(n=="acTL")p.tabs[n]={num_frames:_(y,C),num_plays:_(y,C+4)},r=new Uint8Array(y.length);else if(n=="fcTL"){if(h!=0){var a=p.frames[p.frames.length-1];a.data=D.decode._decompress(p,r.slice(0,h),a.rect.width,a.rect.height),h=0}var g={x:_(y,C+12),y:_(y,C+16),width:_(y,C+4),height:_(y,C+8)},f=M(y,C+22);f=M(y,C+20)/(f==0?100:f);var E={rect:g,delay:Math.round(f*1e3),dispose:y[C+24],blend:y[C+25]};p.frames.push(E)}else if(n=="fdAT"){for(var o=0;o<e-4;o++)r[h+o]=y[C+o+4];h+=e-4}else if(n=="pHYs")p.tabs[n]=[v.readUint(y,C),v.readUint(y,C+4),y[C+8]];else if(n=="cHRM"){p.tabs[n]=[];for(var o=0;o<8;o++)p.tabs[n].push(v.readUint(y,C+o*4))}else if(n=="tEXt"){p.tabs[n]==null&&(p.tabs[n]={});var w=v.nextZero(y,C),R=v.readASCII(y,C,w-C),z=v.readASCII(y,w+1,C+e-w-1);p.tabs[n][R]=z}else if(n=="iTXt"){p.tabs[n]==null&&(p.tabs[n]={});var w=0,S=C;w=v.nextZero(y,S);var R=v.readASCII(y,S,w-S);S=w+1,y[S],y[S+1],S+=2,w=v.nextZero(y,S),v.readASCII(y,S,w-S),S=w+1,w=v.nextZero(y,S),v.readUTF8(y,S,w-S),S=w+1;var z=v.readUTF8(y,S,e-(S-C));p.tabs[n][R]=z}else if(n=="PLTE")p.tabs[n]=v.readBytes(y,C,e);else if(n=="hIST"){var I=p.tabs.PLTE.length/3;p.tabs[n]=[];for(var o=0;o<I;o++)p.tabs[n].push(M(y,C+o*2))}else if(n=="tRNS")p.ctype==3?p.tabs[n]=v.readBytes(y,C,e):p.ctype==0?p.tabs[n]=M(y,C):p.ctype==2&&(p.tabs[n]=[M(y,C),M(y,C+2),M(y,C+4)]);else if(n=="gAMA")p.tabs[n]=v.readUint(y,C)/1e5;else if(n=="sRGB")p.tabs[n]=y[C];else if(n=="bKGD")p.ctype==0||p.ctype==4?p.tabs[n]=[M(y,C)]:p.ctype==2||p.ctype==6?p.tabs[n]=[M(y,C),M(y,C+2),M(y,C+4)]:p.ctype==3&&(p.tabs[n]=y[C]);else if(n=="IEND"){if(h!=0){var a=p.frames[p.frames.length-1];a.data=D.decode._decompress(p,r.slice(0,h),a.rect.width,a.rect.height),h=0}p.data=D.decode._decompress(p,x,p.width,p.height);break}C+=e,v.readUint(y,C),C+=4}return delete p.compress,delete p.interlace,delete p.filter,p},D.decode._decompress=function(u,y,C,v){return u.compress==0&&(y=D.decode._inflate(y)),u.interlace==0?y=D.decode._filterZero(y,u,0,C,v):u.interlace==1&&(y=D.decode._readInterlace(y,u)),y},D.decode._inflate=function(u){return P.inflate(u)},D.decode._readInterlace=function(u,y){for(var C=y.width,v=y.height,M=D.decode._getBPP(y),_=M>>3,p=Math.ceil(C*M/8),x=new Uint8Array(v*p),t=0,r=[0,0,4,0,2,0,1],h=[0,4,0,2,0,1,0],s=[8,8,8,4,4,2,2],o=[8,8,4,4,2,2,1],e=0;e<7;){for(var n=s[e],a=o[e],g=0,f=0,E=r[e];E<v;)E+=n,f++;for(var w=h[e];w<C;)w+=a,g++;var R=Math.ceil(g*M/8);D.decode._filterZero(u,y,t,g,f);for(var z=0,S=r[e];S<v;){for(var I=h[e],F=t+z*R<<3;I<C;){if(M==1){var G=u[F>>3];G=G>>7-(F&7)&1,x[S*p+(I>>3)]|=G<<7-((I&3)<<0)}if(M==2){var G=u[F>>3];G=G>>6-(F&7)&3,x[S*p+(I>>2)]|=G<<6-((I&3)<<1)}if(M==4){var G=u[F>>3];G=G>>4-(F&7)&15,x[S*p+(I>>1)]|=G<<4-((I&1)<<2)}if(M>=8)for(var B=S*p+I*_,W=0;W<_;W++)x[B+W]=u[(F>>3)+W];F+=M,I+=a}z++,S+=n}g*f!=0&&(t+=f*(1+R)),e=e+1}return x},D.decode._getBPP=function(u){var y=[1,null,3,1,2,null,4][u.ctype];return y*u.depth},D.decode._filterZero=function(u,y,C,v,M){var _=D.decode._getBPP(y),p=Math.ceil(v*_/8),x=D.decode._paeth;_=Math.ceil(_/8);for(var t=0;t<M;t++){var r=C+t*p,h=r+t+1,s=u[h-1];if(s==0)for(var o=0;o<p;o++)u[r+o]=u[h+o];else if(s==1){for(var o=0;o<_;o++)u[r+o]=u[h+o];for(var o=_;o<p;o++)u[r+o]=u[h+o]+u[r+o-_]&255}else if(t==0){for(var o=0;o<_;o++)u[r+o]=u[h+o];if(s==2)for(var o=_;o<p;o++)u[r+o]=u[h+o]&255;if(s==3)for(var o=_;o<p;o++)u[r+o]=u[h+o]+(u[r+o-_]>>1)&255;if(s==4)for(var o=_;o<p;o++)u[r+o]=u[h+o]+x(u[r+o-_],0,0)&255}else{if(s==2)for(var o=0;o<p;o++)u[r+o]=u[h+o]+u[r+o-p]&255;if(s==3){for(var o=0;o<_;o++)u[r+o]=u[h+o]+(u[r+o-p]>>1)&255;for(var o=_;o<p;o++)u[r+o]=u[h+o]+(u[r+o-p]+u[r+o-_]>>1)&255}if(s==4){for(var o=0;o<_;o++)u[r+o]=u[h+o]+x(0,u[r+o-p],0)&255;for(var o=_;o<p;o++)u[r+o]=u[h+o]+x(u[r+o-_],u[r+o-p],u[r+o-_-p])&255}}}return u},D.decode._paeth=function(u,y,C){var v=u+y-C,M=Math.abs(v-u),_=Math.abs(v-y),p=Math.abs(v-C);return M<=_&&M<=p?u:_<=p?y:C},D.decode._IHDR=function(u,y,C){var v=D._bin;C.width=v.readUint(u,y),y+=4,C.height=v.readUint(u,y),y+=4,C.depth=u[y],y++,C.ctype=u[y],y++,C.compress=u[y],y++,C.filter=u[y],y++,C.interlace=u[y],y++},D._bin={nextZero:function(u,y){for(;u[y]!=0;)y++;return y},readUshort:function(u,y){return u[y]<<8|u[y+1]},writeUshort:function(u,y,C){u[y]=C>>8&255,u[y+1]=C&255},readUint:function(u,y){return u[y]*16777216+(u[y+1]<<16|u[y+2]<<8|u[y+3])},writeUint:function(u,y,C){u[y]=C>>24&255,u[y+1]=C>>16&255,u[y+2]=C>>8&255,u[y+3]=C&255},readASCII:function(u,y,C){for(var v="",M=0;M<C;M++)v+=String.fromCharCode(u[y+M]);return v},writeASCII:function(u,y,C){for(var v=0;v<C.length;v++)u[y+v]=C.charCodeAt(v)},readBytes:function(u,y,C){for(var v=[],M=0;M<C;M++)v.push(u[y+M]);return v},pad:function(u){return u.length<2?"0"+u:u},readUTF8:function(u,y,C){for(var v="",M,_=0;_<C;_++)v+="%"+D._bin.pad(u[y+_].toString(16));try{M=decodeURIComponent(v)}catch{return D._bin.readASCII(u,y,C)}return M}},D._copyTile=function(u,y,C,v,M,_,p,x,t){for(var r=Math.min(y,M),h=Math.min(C,_),s=0,o=0,e=0;e<h;e++)for(var n=0;n<r;n++)if(p>=0&&x>=0?(s=e*y+n<<2,o=(x+e)*M+p+n<<2):(s=(-x+e)*y-p+n<<2,o=e*M+n<<2),t==0)v[o]=u[s],v[o+1]=u[s+1],v[o+2]=u[s+2],v[o+3]=u[s+3];else if(t==1){var a=u[s+3]*.00392156862745098,g=u[s]*a,f=u[s+1]*a,E=u[s+2]*a,w=v[o+3]*(1/255),R=v[o]*w,z=v[o+1]*w,S=v[o+2]*w,I=1-a,F=a+w*I,G=F==0?0:1/F;v[o+3]=255*F,v[o+0]=(g+R*I)*G,v[o+1]=(f+z*I)*G,v[o+2]=(E+S*I)*G}else if(t==2){var a=u[s+3],g=u[s],f=u[s+1],E=u[s+2],w=v[o+3],R=v[o],z=v[o+1],S=v[o+2];a==w&&g==R&&f==z&&E==S?(v[o]=0,v[o+1]=0,v[o+2]=0,v[o+3]=0):(v[o]=g,v[o+1]=f,v[o+2]=E,v[o+3]=a)}else if(t==3){var a=u[s+3],g=u[s],f=u[s+1],E=u[s+2],w=v[o+3],R=v[o],z=v[o+1],S=v[o+2];if(a==w&&g==R&&f==z&&E==S)continue;if(a<220&&w>20)return!1}return!0},D.encode=function(u,y,C,v,M,_){v==null&&(v=0),_==null&&(_=!1);for(var p=new Uint8Array(u[0].byteLength*u.length+100),x=[137,80,78,71,13,10,26,10],t=0;t<8;t++)p[t]=x[t];var r=8,h=D._bin,s=D.crc.crc,o=h.writeUint,e=h.writeUshort,n=h.writeASCII,a=D.encode.compressPNG(u,y,C,v,_);o(p,r,13),r+=4,n(p,r,"IHDR"),r+=4,o(p,r,y),r+=4,o(p,r,C),r+=4,p[r]=a.depth,r++,p[r]=a.ctype,r++,p[r]=0,r++,p[r]=0,r++,p[r]=0,r++,o(p,r,s(p,r-17,17)),r+=4,o(p,r,1),r+=4,n(p,r,"sRGB"),r+=4,p[r]=1,r++,o(p,r,s(p,r-5,5)),r+=4;var g=u.length>1;if(g&&(o(p,r,8),r+=4,n(p,r,"acTL"),r+=4,o(p,r,u.length),r+=4,o(p,r,0),r+=4,o(p,r,s(p,r-12,12)),r+=4),a.ctype==3){var f=a.plte.length;o(p,r,f*3),r+=4,n(p,r,"PLTE"),r+=4;for(var t=0;t<f;t++){var E=t*3,w=a.plte[t],R=w&255,z=w>>8&255,S=w>>16&255;p[r+E+0]=R,p[r+E+1]=z,p[r+E+2]=S}if(r+=f*3,o(p,r,s(p,r-f*3-4,f*3+4)),r+=4,a.gotAlpha){o(p,r,f),r+=4,n(p,r,"tRNS"),r+=4;for(var t=0;t<f;t++)p[r+t]=a.plte[t]>>24&255;r+=f,o(p,r,s(p,r-f-4,f+4)),r+=4}}for(var I=0,F=0;F<a.frames.length;F++){var G=a.frames[F];g&&(o(p,r,26),r+=4,n(p,r,"fcTL"),r+=4,o(p,r,I++),r+=4,o(p,r,G.rect.width),r+=4,o(p,r,G.rect.height),r+=4,o(p,r,G.rect.x),r+=4,o(p,r,G.rect.y),r+=4,e(p,r,M[F]),r+=2,e(p,r,1e3),r+=2,p[r]=G.dispose,r++,p[r]=G.blend,r++,o(p,r,s(p,r-30,30)),r+=4);var B=G.cimg,f=B.length;o(p,r,f+(F==0?0:4)),r+=4;var W=r;n(p,r,F==0?"IDAT":"fdAT"),r+=4,F!=0&&(o(p,r,I++),r+=4);for(var t=0;t<f;t++)p[r+t]=B[t];r+=f,o(p,r,s(p,W,r-W)),r+=4}return o(p,r,0),r+=4,n(p,r,"IEND"),r+=4,o(p,r,s(p,r-4,4)),r+=4,p.buffer.slice(0,r)},D.encode.compressPNG=function(u,y,C,v,M){for(var _=D.encode.compress(u,y,C,v,!1,M),p=0;p<u.length;p++){var x=_.frames[p];x.rect.width;var t=x.rect.height,r=x.bpl,h=x.bpp,s=new Uint8Array(t*r+t);x.cimg=D.encode._filterZero(x.img,t,h,r,s)}return _},D.encode.compress=function(u,y,C,v,M,_){_==null&&(_=!1);for(var p=6,x=8,t=4,r=255,h=0;h<u.length;h++)for(var s=new Uint8Array(u[h]),o=s.length,e=0;e<o;e+=4)r&=s[e+3];var n=r!=255,a={},g=[];if(u.length!=0&&(a[0]=0,g.push(0),v!=0&&v--),v!=0){var f=D.quantize(u,v,M);u=f.bufs;for(var e=0;e<f.plte.length;e++){var E=f.plte[e].est.rgba;a[E]==null&&(a[E]=g.length,g.push(E))}}else for(var h=0;h<u.length;h++)for(var w=new Uint32Array(u[h]),o=w.length,e=0;e<o;e++){var E=w[e];if((e<y||E!=w[e-1]&&E!=w[e-y])&&a[E]==null&&(a[E]=g.length,g.push(E),g.length>=300))break}var R=n?M:!1,z=g.length;z<=256&&_==!1&&(z<=2?x=1:z<=4?x=2:z<=16?x=4:x=8,M&&(x=8),n=!0);for(var S=[],h=0;h<u.length;h++){var I=new Uint8Array(u[h]),F=new Uint32Array(I.buffer),G=0,B=0,W=y,V=C,k=0;if(h!=0&&!R){for(var U=M||h==1||S[S.length-2].dispose==2?1:2,j=0,q=1e9,ie=0;ie<U;ie++){for(var ce=new Uint8Array(u[h-1-ie]),ge=new Uint32Array(u[h-1-ie]),he=y,ve=C,le=-1,se=-1,Me=0;Me<C;Me++)for(var be=0;be<y;be++){var e=Me*y+be;F[e]!=ge[e]&&(be<he&&(he=be),be>le&&(le=be),Me<ve&&(ve=Me),Me>se&&(se=Me))}var Pe=le==-1?1:(le-he+1)*(se-ve+1);Pe<q&&(q=Pe,j=ie,le==-1?(G=B=0,W=V=1):(G=he,B=ve,W=le-he+1,V=se-ve+1))}var ce=new Uint8Array(u[h-1-j]);j==1&&(S[S.length-1].dispose=2);var me=new Uint8Array(W*V*4);new Uint32Array(me.buffer),D._copyTile(ce,y,C,me,W,V,-G,-B,0),D._copyTile(I,y,C,me,W,V,-G,-B,3)?(D._copyTile(I,y,C,me,W,V,-G,-B,2),k=1):(D._copyTile(I,y,C,me,W,V,-G,-B,0),k=0),I=me,F=new Uint32Array(I.buffer)}var De=4*W;if(z<=256&&_==!1){De=Math.ceil(x*W/8);for(var me=new Uint8Array(De*V),Me=0;Me<V;Me++){var e=Me*De,Se=Me*W;if(x==8)for(var be=0;be<W;be++)me[e+be]=a[F[Se+be]];else if(x==4)for(var be=0;be<W;be++)me[e+(be>>1)]|=a[F[Se+be]]<<4-(be&1)*4;else if(x==2)for(var be=0;be<W;be++)me[e+(be>>2)]|=a[F[Se+be]]<<6-(be&3)*2;else if(x==1)for(var be=0;be<W;be++)me[e+(be>>3)]|=a[F[Se+be]]<<7-(be&7)*1}I=me,p=3,t=1}else if(n==!1&&u.length==1){for(var me=new Uint8Array(W*V*3),Ge=W*V,e=0;e<Ge;e++){var ke=e*3,ze=e*4;me[ke]=I[ze],me[ke+1]=I[ze+1],me[ke+2]=I[ze+2]}I=me,p=2,t=3,De=3*W}S.push({rect:{x:G,y:B,width:W,height:V},img:I,bpl:De,bpp:t,blend:k,dispose:R?1:0})}return{ctype:p,depth:x,plte:g,gotAlpha:n,frames:S}},D.encode._filterZero=function(u,y,C,v,M){for(var _=[],p=0;p<5;p++)if(!(y*v>5e5&&(p==2||p==3||p==4))){for(var x=0;x<y;x++)D.encode._filterLine(M,u,x,v,C,p);if(_.push(P.deflate(M)),C==1)break}for(var t,r=1e9,h=0;h<_.length;h++)_[h].length<r&&(t=h,r=_[h].length);return _[t]},D.encode._filterLine=function(u,y,C,v,M,_){var p=C*v,x=p+C,t=D.decode._paeth;if(u[x]=_,x++,_==0)for(var r=0;r<v;r++)u[x+r]=y[p+r];else if(_==1){for(var r=0;r<M;r++)u[x+r]=y[p+r];for(var r=M;r<v;r++)u[x+r]=y[p+r]-y[p+r-M]+256&255}else if(C==0){for(var r=0;r<M;r++)u[x+r]=y[p+r];if(_==2)for(var r=M;r<v;r++)u[x+r]=y[p+r];if(_==3)for(var r=M;r<v;r++)u[x+r]=y[p+r]-(y[p+r-M]>>1)+256&255;if(_==4)for(var r=M;r<v;r++)u[x+r]=y[p+r]-t(y[p+r-M],0,0)+256&255}else{if(_==2)for(var r=0;r<v;r++)u[x+r]=y[p+r]+256-y[p+r-v]&255;if(_==3){for(var r=0;r<M;r++)u[x+r]=y[p+r]+256-(y[p+r-v]>>1)&255;for(var r=M;r<v;r++)u[x+r]=y[p+r]+256-(y[p+r-v]+y[p+r-M]>>1)&255}if(_==4){for(var r=0;r<M;r++)u[x+r]=y[p+r]+256-t(0,y[p+r-v],0)&255;for(var r=M;r<v;r++)u[x+r]=y[p+r]+256-t(y[p+r-M],y[p+r-v],y[p+r-M-v])&255}}},D.crc={table:function(){for(var u=new Uint32Array(256),y=0;y<256;y++){for(var C=y,v=0;v<8;v++)C&1?C=3988292384^C>>>1:C=C>>>1;u[y]=C}return u}(),update:function(u,y,C,v){for(var M=0;M<v;M++)u=D.crc.table[(u^y[C+M])&255]^u>>>8;return u},crc:function(u,y,C){return D.crc.update(4294967295,u,y,C)^4294967295}},D.quantize=function(u,y,C){for(var v=[],M=0,_=0;_<u.length;_++)v.push(D.encode.alphaMul(new Uint8Array(u[_]),C)),M+=u[_].byteLength;for(var p=new Uint8Array(M),x=new Uint32Array(p.buffer),t=0,_=0;_<v.length;_++){for(var r=v[_],h=r.length,s=0;s<h;s++)p[t+s]=r[s];t+=h}var o={i0:0,i1:p.length,bst:null,est:null,tdst:0,left:null,right:null};o.bst=D.quantize.stats(p,o.i0,o.i1),o.est=D.quantize.estats(o.bst);for(var e=[o];e.length<y;){for(var n=0,a=0,_=0;_<e.length;_++)e[_].est.L>n&&(n=e[_].est.L,a=_);if(n<.001)break;var g=e[a],f=D.quantize.splitPixels(p,x,g.i0,g.i1,g.est.e,g.est.eMq255),E={i0:g.i0,i1:f,bst:null,est:null,tdst:0,left:null,right:null};E.bst=D.quantize.stats(p,E.i0,E.i1),E.est=D.quantize.estats(E.bst);var w={i0:f,i1:g.i1,bst:null,est:null,tdst:0,left:null,right:null};w.bst={R:[],m:[],N:g.bst.N-E.bst.N};for(var _=0;_<16;_++)w.bst.R[_]=g.bst.R[_]-E.bst.R[_];for(var _=0;_<4;_++)w.bst.m[_]=g.bst.m[_]-E.bst.m[_];w.est=D.quantize.estats(w.bst),g.left=E,g.right=w,e[a]=E,e.push(w)}e.sort(function(U,j){return j.bst.N-U.bst.N});for(var R=0;R<v.length;R++){for(var z=D.quantize.planeDst,S=new Uint8Array(v[R].buffer),I=new Uint32Array(v[R].buffer),F=S.length,_=0;_<F;_+=4){for(var G=S[_]*.00392156862745098,B=S[_+1]*(1/255),W=S[_+2]*(1/255),V=S[_+3]*(1/255),k=o;k.left;)k=z(k.est,G,B,W,V)<=0?k.left:k.right;I[_>>2]=k.est.rgba}v[R]=I.buffer}return{bufs:v,plte:e}},D.quantize.getNearest=function(u,y,C,v,M){if(u.left==null)return u.tdst=D.quantize.dist(u.est.q,y,C,v,M),u;var _=D.quantize.planeDst(u.est,y,C,v,M),p=u.left,x=u.right;_>0&&(p=u.right,x=u.left);var t=D.quantize.getNearest(p,y,C,v,M);if(t.tdst<=_*_)return t;var r=D.quantize.getNearest(x,y,C,v,M);return r.tdst<t.tdst?r:t},D.quantize.planeDst=function(u,y,C,v,M){var _=u.e;return _[0]*y+_[1]*C+_[2]*v+_[3]*M-u.eMq},D.quantize.dist=function(u,y,C,v,M){var _=y-u[0],p=C-u[1],x=v-u[2],t=M-u[3];return _*_+p*p+x*x+t*t},D.quantize.splitPixels=function(u,y,C,v,M,_){var p=D.quantize.vecDot;for(v-=4;C<v;){for(;p(u,C,M)<=_;)C+=4;for(;p(u,v,M)>_;)v-=4;if(C>=v)break;var x=y[C>>2];y[C>>2]=y[v>>2],y[v>>2]=x,C+=4,v-=4}for(;p(u,C,M)>_;)C-=4;return C+4},D.quantize.vecDot=function(u,y,C){return u[y]*C[0]+u[y+1]*C[1]+u[y+2]*C[2]+u[y+3]*C[3]},D.quantize.stats=function(u,y,C){for(var v=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],M=[0,0,0,0],_=C-y>>2,p=y;p<C;p+=4){var x=u[p]*.00392156862745098,t=u[p+1]*(1/255),r=u[p+2]*(1/255),h=u[p+3]*(1/255);M[0]+=x,M[1]+=t,M[2]+=r,M[3]+=h,v[0]+=x*x,v[1]+=x*t,v[2]+=x*r,v[3]+=x*h,v[5]+=t*t,v[6]+=t*r,v[7]+=t*h,v[10]+=r*r,v[11]+=r*h,v[15]+=h*h}return v[4]=v[1],v[8]=v[2],v[12]=v[3],v[9]=v[6],v[13]=v[7],v[14]=v[11],{R:v,m:M,N:_}},D.quantize.estats=function(u){var y=u.R,C=u.m,v=u.N,M=C[0],_=C[1],p=C[2],x=C[3],t=v==0?0:1/v,r=[y[0]-M*M*t,y[1]-M*_*t,y[2]-M*p*t,y[3]-M*x*t,y[4]-_*M*t,y[5]-_*_*t,y[6]-_*p*t,y[7]-_*x*t,y[8]-p*M*t,y[9]-p*_*t,y[10]-p*p*t,y[11]-p*x*t,y[12]-x*M*t,y[13]-x*_*t,y[14]-x*p*t,y[15]-x*x*t],h=r,s=D.M4,o=[.5,.5,.5,.5],e=0,n=0;if(v!=0)for(var a=0;a<10&&(o=s.multVec(h,o),n=Math.sqrt(s.dot(o,o)),o=s.sml(1/n,o),!(Math.abs(n-e)<1e-9));a++)e=n;var g=[M*t,_*t,p*t,x*t],f=s.dot(s.sml(255,g),o),E=g[3]<.001?0:1/g[3];return{Cov:r,q:g,e:o,L:e,eMq255:f,eMq:s.dot(o,g),rgba:(Math.round(255*g[3])<<24|Math.round(255*g[2]*E)<<16|Math.round(255*g[1]*E)<<8|Math.round(255*g[0]*E)<<0)>>>0}},D.M4={multVec:function(u,y){return[u[0]*y[0]+u[1]*y[1]+u[2]*y[2]+u[3]*y[3],u[4]*y[0]+u[5]*y[1]+u[6]*y[2]+u[7]*y[3],u[8]*y[0]+u[9]*y[1]+u[10]*y[2]+u[11]*y[3],u[12]*y[0]+u[13]*y[1]+u[14]*y[2]+u[15]*y[3]]},dot:function(u,y){return u[0]*y[0]+u[1]*y[1]+u[2]*y[2]+u[3]*y[3]},sml:function(u,y){return[u*y[0],u*y[1],u*y[2],u*y[3]]}},D.encode.alphaMul=function(u,y){for(var C=new Uint8Array(u.length),v=u.length>>2,M=0;M<v;M++){var _=M<<2,p=u[_+3];y&&(p=p<128?0:255);var x=p*(1/255);C[_+0]=u[_+0]*x,C[_+1]=u[_+1]*x,C[_+2]=u[_+2]*x,C[_+3]=p}return C}}(A,T)})()},"./node_modules/upng-js/node_modules/pako/index.js":(X,L,c)=>{var A=c("./node_modules/upng-js/node_modules/pako/lib/utils/common.js").assign,T=c("./node_modules/upng-js/node_modules/pako/lib/deflate.js"),D=c("./node_modules/upng-js/node_modules/pako/lib/inflate.js"),P=c("./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js"),u={};A(u,T,D,P),X.exports=u},"./node_modules/upng-js/node_modules/pako/lib/deflate.js":(X,L,c)=>{var A=c("./node_modules/upng-js/node_modules/pako/lib/zlib/deflate.js"),T=c("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),D=c("./node_modules/upng-js/node_modules/pako/lib/utils/strings.js"),P=c("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),u=c("./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js"),y=Object.prototype.toString,C=0,v=4,M=0,_=1,p=2,x=-1,t=0,r=8;function h(n){if(!(this instanceof h))return new h(n);this.options=T.assign({level:x,method:r,chunkSize:16384,windowBits:15,memLevel:8,strategy:t,to:""},n||{});var a=this.options;a.raw&&a.windowBits>0?a.windowBits=-a.windowBits:a.gzip&&a.windowBits>0&&a.windowBits<16&&(a.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var g=A.deflateInit2(this.strm,a.level,a.method,a.windowBits,a.memLevel,a.strategy);if(g!==M)throw new Error(P[g]);if(a.header&&A.deflateSetHeader(this.strm,a.header),a.dictionary){var f;if(typeof a.dictionary=="string"?f=D.string2buf(a.dictionary):y.call(a.dictionary)==="[object ArrayBuffer]"?f=new Uint8Array(a.dictionary):f=a.dictionary,g=A.deflateSetDictionary(this.strm,f),g!==M)throw new Error(P[g]);this._dict_set=!0}}h.prototype.push=function(n,a){var g=this.strm,f=this.options.chunkSize,E,w;if(this.ended)return!1;w=a===~~a?a:a===!0?v:C,typeof n=="string"?g.input=D.string2buf(n):y.call(n)==="[object ArrayBuffer]"?g.input=new Uint8Array(n):g.input=n,g.next_in=0,g.avail_in=g.input.length;do{if(g.avail_out===0&&(g.output=new T.Buf8(f),g.next_out=0,g.avail_out=f),E=A.deflate(g,w),E!==_&&E!==M)return this.onEnd(E),this.ended=!0,!1;(g.avail_out===0||g.avail_in===0&&(w===v||w===p))&&(this.options.to==="string"?this.onData(D.buf2binstring(T.shrinkBuf(g.output,g.next_out))):this.onData(T.shrinkBuf(g.output,g.next_out)))}while((g.avail_in>0||g.avail_out===0)&&E!==_);return w===v?(E=A.deflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===M):(w===p&&(this.onEnd(M),g.avail_out=0),!0)},h.prototype.onData=function(n){this.chunks.push(n)},h.prototype.onEnd=function(n){n===M&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=T.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};function s(n,a){var g=new h(a);if(g.push(n,!0),g.err)throw g.msg||P[g.err];return g.result}function o(n,a){return a=a||{},a.raw=!0,s(n,a)}function e(n,a){return a=a||{},a.gzip=!0,s(n,a)}L.Deflate=h,L.deflate=s,L.deflateRaw=o,L.gzip=e},"./node_modules/upng-js/node_modules/pako/lib/inflate.js":(X,L,c)=>{var A=c("./node_modules/upng-js/node_modules/pako/lib/zlib/inflate.js"),T=c("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),D=c("./node_modules/upng-js/node_modules/pako/lib/utils/strings.js"),P=c("./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js"),u=c("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),y=c("./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js"),C=c("./node_modules/upng-js/node_modules/pako/lib/zlib/gzheader.js"),v=Object.prototype.toString;function M(x){if(!(this instanceof M))return new M(x);this.options=T.assign({chunkSize:16384,windowBits:0,to:""},x||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(x&&x.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new y,this.strm.avail_out=0;var r=A.inflateInit2(this.strm,t.windowBits);if(r!==P.Z_OK)throw new Error(u[r]);if(this.header=new C,A.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=D.string2buf(t.dictionary):v.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=A.inflateSetDictionary(this.strm,t.dictionary),r!==P.Z_OK)))throw new Error(u[r])}M.prototype.push=function(x,t){var r=this.strm,h=this.options.chunkSize,s=this.options.dictionary,o,e,n,a,g,f=!1;if(this.ended)return!1;e=t===~~t?t:t===!0?P.Z_FINISH:P.Z_NO_FLUSH,typeof x=="string"?r.input=D.binstring2buf(x):v.call(x)==="[object ArrayBuffer]"?r.input=new Uint8Array(x):r.input=x,r.next_in=0,r.avail_in=r.input.length;do{if(r.avail_out===0&&(r.output=new T.Buf8(h),r.next_out=0,r.avail_out=h),o=A.inflate(r,P.Z_NO_FLUSH),o===P.Z_NEED_DICT&&s&&(o=A.inflateSetDictionary(this.strm,s)),o===P.Z_BUF_ERROR&&f===!0&&(o=P.Z_OK,f=!1),o!==P.Z_STREAM_END&&o!==P.Z_OK)return this.onEnd(o),this.ended=!0,!1;r.next_out&&(r.avail_out===0||o===P.Z_STREAM_END||r.avail_in===0&&(e===P.Z_FINISH||e===P.Z_SYNC_FLUSH))&&(this.options.to==="string"?(n=D.utf8border(r.output,r.next_out),a=r.next_out-n,g=D.buf2string(r.output,n),r.next_out=a,r.avail_out=h-a,a&&T.arraySet(r.output,r.output,n,a,0),this.onData(g)):this.onData(T.shrinkBuf(r.output,r.next_out))),r.avail_in===0&&r.avail_out===0&&(f=!0)}while((r.avail_in>0||r.avail_out===0)&&o!==P.Z_STREAM_END);return o===P.Z_STREAM_END&&(e=P.Z_FINISH),e===P.Z_FINISH?(o=A.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===P.Z_OK):(e===P.Z_SYNC_FLUSH&&(this.onEnd(P.Z_OK),r.avail_out=0),!0)},M.prototype.onData=function(x){this.chunks.push(x)},M.prototype.onEnd=function(x){x===P.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=T.flattenChunks(this.chunks)),this.chunks=[],this.err=x,this.msg=this.strm.msg};function _(x,t){var r=new M(t);if(r.push(x,!0),r.err)throw r.msg||u[r.err];return r.result}function p(x,t){return t=t||{},t.raw=!0,_(x,t)}L.Inflate=M,L.inflate=_,L.inflateRaw=p,L.ungzip=_},"./node_modules/upng-js/node_modules/pako/lib/utils/common.js":(X,L)=>{var c=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function A(P,u){return Object.prototype.hasOwnProperty.call(P,u)}L.assign=function(P){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var y=u.shift();if(y){if(typeof y!="object")throw new TypeError(y+"must be non-object");for(var C in y)A(y,C)&&(P[C]=y[C])}}return P},L.shrinkBuf=function(P,u){return P.length===u?P:P.subarray?P.subarray(0,u):(P.length=u,P)};var T={arraySet:function(P,u,y,C,v){if(u.subarray&&P.subarray){P.set(u.subarray(y,y+C),v);return}for(var M=0;M<C;M++)P[v+M]=u[y+M]},flattenChunks:function(P){var u,y,C,v,M,_;for(C=0,u=0,y=P.length;u<y;u++)C+=P[u].length;for(_=new Uint8Array(C),v=0,u=0,y=P.length;u<y;u++)M=P[u],_.set(M,v),v+=M.length;return _}},D={arraySet:function(P,u,y,C,v){for(var M=0;M<C;M++)P[v+M]=u[y+M]},flattenChunks:function(P){return[].concat.apply([],P)}};L.setTyped=function(P){P?(L.Buf8=Uint8Array,L.Buf16=Uint16Array,L.Buf32=Int32Array,L.assign(L,T)):(L.Buf8=Array,L.Buf16=Array,L.Buf32=Array,L.assign(L,D))},L.setTyped(c)},"./node_modules/upng-js/node_modules/pako/lib/utils/strings.js":(X,L,c)=>{var A=c("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),T=!0,D=!0;try{String.fromCharCode.apply(null,[0])}catch{T=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{D=!1}for(var P=new A.Buf8(256),u=0;u<256;u++)P[u]=u>=252?6:u>=248?5:u>=240?4:u>=224?3:u>=192?2:1;P[254]=P[254]=1,L.string2buf=function(C){var v,M,_,p,x,t=C.length,r=0;for(p=0;p<t;p++)M=C.charCodeAt(p),(M&64512)===55296&&p+1<t&&(_=C.charCodeAt(p+1),(_&64512)===56320&&(M=65536+(M-55296<<10)+(_-56320),p++)),r+=M<128?1:M<2048?2:M<65536?3:4;for(v=new A.Buf8(r),x=0,p=0;x<r;p++)M=C.charCodeAt(p),(M&64512)===55296&&p+1<t&&(_=C.charCodeAt(p+1),(_&64512)===56320&&(M=65536+(M-55296<<10)+(_-56320),p++)),M<128?v[x++]=M:M<2048?(v[x++]=192|M>>>6,v[x++]=128|M&63):M<65536?(v[x++]=224|M>>>12,v[x++]=128|M>>>6&63,v[x++]=128|M&63):(v[x++]=240|M>>>18,v[x++]=128|M>>>12&63,v[x++]=128|M>>>6&63,v[x++]=128|M&63);return v};function y(C,v){if(v<65534&&(C.subarray&&D||!C.subarray&&T))return String.fromCharCode.apply(null,A.shrinkBuf(C,v));for(var M="",_=0;_<v;_++)M+=String.fromCharCode(C[_]);return M}L.buf2binstring=function(C){return y(C,C.length)},L.binstring2buf=function(C){for(var v=new A.Buf8(C.length),M=0,_=v.length;M<_;M++)v[M]=C.charCodeAt(M);return v},L.buf2string=function(C,v){var M,_,p,x,t=v||C.length,r=new Array(t*2);for(_=0,M=0;M<t;){if(p=C[M++],p<128){r[_++]=p;continue}if(x=P[p],x>4){r[_++]=65533,M+=x-1;continue}for(p&=x===2?31:x===3?15:7;x>1&&M<t;)p=p<<6|C[M++]&63,x--;if(x>1){r[_++]=65533;continue}p<65536?r[_++]=p:(p-=65536,r[_++]=55296|p>>10&1023,r[_++]=56320|p&1023)}return y(r,_)},L.utf8border=function(C,v){var M;for(v=v||C.length,v>C.length&&(v=C.length),M=v-1;M>=0&&(C[M]&192)===128;)M--;return M<0||M===0?v:M+P[C[M]]>v?M:v}},"./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js":X=>{function L(c,A,T,D){for(var P=c&65535|0,u=c>>>16&65535|0,y=0;T!==0;){y=T>2e3?2e3:T,T-=y;do P=P+A[D++]|0,u=u+P|0;while(--y);P%=65521,u%=65521}return P|u<<16|0}X.exports=L},"./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js":X=>{X.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},"./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js":X=>{function L(){for(var T,D=[],P=0;P<256;P++){T=P;for(var u=0;u<8;u++)T=T&1?3988292384^T>>>1:T>>>1;D[P]=T}return D}var c=L();function A(T,D,P,u){var y=c,C=u+P;T^=-1;for(var v=u;v<C;v++)T=T>>>8^y[(T^D[v])&255];return T^-1}X.exports=A},"./node_modules/upng-js/node_modules/pako/lib/zlib/deflate.js":(X,L,c)=>{var A=c("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),T=c("./node_modules/upng-js/node_modules/pako/lib/zlib/trees.js"),D=c("./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js"),P=c("./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js"),u=c("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),y=0,C=1,v=3,M=4,_=5,p=0,x=1,t=-2,r=-3,h=-5,s=-1,o=1,e=2,n=3,a=4,g=0,f=2,E=8,w=9,R=15,z=8,S=29,I=256,F=I+1+S,G=30,B=19,W=2*F+1,V=15,k=3,U=258,j=U+k+1,q=32,ie=42,ge=69,he=73,ve=91,le=103,se=113,Me=666,be=1,Pe=2,ce=3,me=4,De=3;function Se(O,pe){return O.msg=u[pe],pe}function Ge(O){return(O<<1)-(O>4?9:0)}function ke(O){for(var pe=O.length;--pe>=0;)O[pe]=0}function ze(O){var pe=O.state,ue=pe.pending;ue>O.avail_out&&(ue=O.avail_out),ue!==0&&(A.arraySet(O.output,pe.pending_buf,pe.pending_out,ue,O.next_out),O.next_out+=ue,pe.pending_out+=ue,O.total_out+=ue,O.avail_out-=ue,pe.pending-=ue,pe.pending===0&&(pe.pending_out=0))}function Re(O,pe){T._tr_flush_block(O,O.block_start>=0?O.block_start:-1,O.strstart-O.block_start,pe),O.block_start=O.strstart,ze(O.strm)}function Be(O,pe){O.pending_buf[O.pending++]=pe}function Ie(O,pe){O.pending_buf[O.pending++]=pe>>>8&255,O.pending_buf[O.pending++]=pe&255}function We(O,pe,ue,Y){var re=O.avail_in;return re>Y&&(re=Y),re===0?0:(O.avail_in-=re,A.arraySet(pe,O.input,O.next_in,re,ue),O.state.wrap===1?O.adler=D(O.adler,pe,re,ue):O.state.wrap===2&&(O.adler=P(O.adler,pe,re,ue)),O.next_in+=re,O.total_in+=re,re)}function Fe(O,pe){var ue=O.max_chain_length,Y=O.strstart,re,ye,je=O.prev_length,He=O.nice_match,Ve=O.strstart>O.w_size-j?O.strstart-(O.w_size-j):0,qe=O.window,Et=O.w_mask,nt=O.prev,rt=O.strstart+U,tt=qe[Y+je-1],yt=qe[Y+je];O.prev_length>=O.good_match&&(ue>>=2),He>O.lookahead&&(He=O.lookahead);do if(re=pe,!(qe[re+je]!==yt||qe[re+je-1]!==tt||qe[re]!==qe[Y]||qe[++re]!==qe[Y+1])){Y+=2,re++;do;while(qe[++Y]===qe[++re]&&qe[++Y]===qe[++re]&&qe[++Y]===qe[++re]&&qe[++Y]===qe[++re]&&qe[++Y]===qe[++re]&&qe[++Y]===qe[++re]&&qe[++Y]===qe[++re]&&qe[++Y]===qe[++re]&&Y<rt);if(ye=U-(rt-Y),Y=rt-U,ye>je){if(O.match_start=pe,je=ye,ye>=He)break;tt=qe[Y+je-1],yt=qe[Y+je]}}while((pe=nt[pe&Et])>Ve&&--ue!==0);return je<=O.lookahead?je:O.lookahead}function $e(O){var pe=O.w_size,ue,Y,re,ye,je;do{if(ye=O.window_size-O.lookahead-O.strstart,O.strstart>=pe+(pe-j)){A.arraySet(O.window,O.window,pe,pe,0),O.match_start-=pe,O.strstart-=pe,O.block_start-=pe,Y=O.hash_size,ue=Y;do re=O.head[--ue],O.head[ue]=re>=pe?re-pe:0;while(--Y);Y=pe,ue=Y;do re=O.prev[--ue],O.prev[ue]=re>=pe?re-pe:0;while(--Y);ye+=pe}if(O.strm.avail_in===0)break;if(Y=We(O.strm,O.window,O.strstart+O.lookahead,ye),O.lookahead+=Y,O.lookahead+O.insert>=k)for(je=O.strstart-O.insert,O.ins_h=O.window[je],O.ins_h=(O.ins_h<<O.hash_shift^O.window[je+1])&O.hash_mask;O.insert&&(O.ins_h=(O.ins_h<<O.hash_shift^O.window[je+k-1])&O.hash_mask,O.prev[je&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=je,je++,O.insert--,!(O.lookahead+O.insert<k)););}while(O.lookahead<j&&O.strm.avail_in!==0)}function Ye(O,pe){var ue=65535;for(ue>O.pending_buf_size-5&&(ue=O.pending_buf_size-5);;){if(O.lookahead<=1){if($e(O),O.lookahead===0&&pe===y)return be;if(O.lookahead===0)break}O.strstart+=O.lookahead,O.lookahead=0;var Y=O.block_start+ue;if((O.strstart===0||O.strstart>=Y)&&(O.lookahead=O.strstart-Y,O.strstart=Y,Re(O,!1),O.strm.avail_out===0)||O.strstart-O.block_start>=O.w_size-j&&(Re(O,!1),O.strm.avail_out===0))return be}return O.insert=0,pe===M?(Re(O,!0),O.strm.avail_out===0?ce:me):(O.strstart>O.block_start&&(Re(O,!1),O.strm.avail_out===0),be)}function $(O,pe){for(var ue,Y;;){if(O.lookahead<j){if($e(O),O.lookahead<j&&pe===y)return be;if(O.lookahead===0)break}if(ue=0,O.lookahead>=k&&(O.ins_h=(O.ins_h<<O.hash_shift^O.window[O.strstart+k-1])&O.hash_mask,ue=O.prev[O.strstart&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=O.strstart),ue!==0&&O.strstart-ue<=O.w_size-j&&(O.match_length=Fe(O,ue)),O.match_length>=k)if(Y=T._tr_tally(O,O.strstart-O.match_start,O.match_length-k),O.lookahead-=O.match_length,O.match_length<=O.max_lazy_match&&O.lookahead>=k){O.match_length--;do O.strstart++,O.ins_h=(O.ins_h<<O.hash_shift^O.window[O.strstart+k-1])&O.hash_mask,ue=O.prev[O.strstart&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=O.strstart;while(--O.match_length!==0);O.strstart++}else O.strstart+=O.match_length,O.match_length=0,O.ins_h=O.window[O.strstart],O.ins_h=(O.ins_h<<O.hash_shift^O.window[O.strstart+1])&O.hash_mask;else Y=T._tr_tally(O,0,O.window[O.strstart]),O.lookahead--,O.strstart++;if(Y&&(Re(O,!1),O.strm.avail_out===0))return be}return O.insert=O.strstart<k-1?O.strstart:k-1,pe===M?(Re(O,!0),O.strm.avail_out===0?ce:me):O.last_lit&&(Re(O,!1),O.strm.avail_out===0)?be:Pe}function Z(O,pe){for(var ue,Y,re;;){if(O.lookahead<j){if($e(O),O.lookahead<j&&pe===y)return be;if(O.lookahead===0)break}if(ue=0,O.lookahead>=k&&(O.ins_h=(O.ins_h<<O.hash_shift^O.window[O.strstart+k-1])&O.hash_mask,ue=O.prev[O.strstart&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=O.strstart),O.prev_length=O.match_length,O.prev_match=O.match_start,O.match_length=k-1,ue!==0&&O.prev_length<O.max_lazy_match&&O.strstart-ue<=O.w_size-j&&(O.match_length=Fe(O,ue),O.match_length<=5&&(O.strategy===o||O.match_length===k&&O.strstart-O.match_start>4096)&&(O.match_length=k-1)),O.prev_length>=k&&O.match_length<=O.prev_length){re=O.strstart+O.lookahead-k,Y=T._tr_tally(O,O.strstart-1-O.prev_match,O.prev_length-k),O.lookahead-=O.prev_length-1,O.prev_length-=2;do++O.strstart<=re&&(O.ins_h=(O.ins_h<<O.hash_shift^O.window[O.strstart+k-1])&O.hash_mask,ue=O.prev[O.strstart&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=O.strstart);while(--O.prev_length!==0);if(O.match_available=0,O.match_length=k-1,O.strstart++,Y&&(Re(O,!1),O.strm.avail_out===0))return be}else if(O.match_available){if(Y=T._tr_tally(O,0,O.window[O.strstart-1]),Y&&Re(O,!1),O.strstart++,O.lookahead--,O.strm.avail_out===0)return be}else O.match_available=1,O.strstart++,O.lookahead--}return O.match_available&&(Y=T._tr_tally(O,0,O.window[O.strstart-1]),O.match_available=0),O.insert=O.strstart<k-1?O.strstart:k-1,pe===M?(Re(O,!0),O.strm.avail_out===0?ce:me):O.last_lit&&(Re(O,!1),O.strm.avail_out===0)?be:Pe}function J(O,pe){for(var ue,Y,re,ye,je=O.window;;){if(O.lookahead<=U){if($e(O),O.lookahead<=U&&pe===y)return be;if(O.lookahead===0)break}if(O.match_length=0,O.lookahead>=k&&O.strstart>0&&(re=O.strstart-1,Y=je[re],Y===je[++re]&&Y===je[++re]&&Y===je[++re])){ye=O.strstart+U;do;while(Y===je[++re]&&Y===je[++re]&&Y===je[++re]&&Y===je[++re]&&Y===je[++re]&&Y===je[++re]&&Y===je[++re]&&Y===je[++re]&&re<ye);O.match_length=U-(ye-re),O.match_length>O.lookahead&&(O.match_length=O.lookahead)}if(O.match_length>=k?(ue=T._tr_tally(O,1,O.match_length-k),O.lookahead-=O.match_length,O.strstart+=O.match_length,O.match_length=0):(ue=T._tr_tally(O,0,O.window[O.strstart]),O.lookahead--,O.strstart++),ue&&(Re(O,!1),O.strm.avail_out===0))return be}return O.insert=0,pe===M?(Re(O,!0),O.strm.avail_out===0?ce:me):O.last_lit&&(Re(O,!1),O.strm.avail_out===0)?be:Pe}function ae(O,pe){for(var ue;;){if(O.lookahead===0&&($e(O),O.lookahead===0)){if(pe===y)return be;break}if(O.match_length=0,ue=T._tr_tally(O,0,O.window[O.strstart]),O.lookahead--,O.strstart++,ue&&(Re(O,!1),O.strm.avail_out===0))return be}return O.insert=0,pe===M?(Re(O,!0),O.strm.avail_out===0?ce:me):O.last_lit&&(Re(O,!1),O.strm.avail_out===0)?be:Pe}function de(O,pe,ue,Y,re){this.good_length=O,this.max_lazy=pe,this.nice_length=ue,this.max_chain=Y,this.func=re}var Ee;Ee=[new de(0,0,0,0,Ye),new de(4,4,8,4,$),new de(4,5,16,8,$),new de(4,6,32,32,$),new de(4,4,16,16,Z),new de(8,16,32,32,Z),new de(8,16,128,128,Z),new de(8,32,128,256,Z),new de(32,128,258,1024,Z),new de(32,258,258,4096,Z)];function we(O){O.window_size=2*O.w_size,ke(O.head),O.max_lazy_match=Ee[O.level].max_lazy,O.good_match=Ee[O.level].good_length,O.nice_match=Ee[O.level].nice_length,O.max_chain_length=Ee[O.level].max_chain,O.strstart=0,O.block_start=0,O.lookahead=0,O.insert=0,O.match_length=O.prev_length=k-1,O.match_available=0,O.ins_h=0}function H(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=E,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new A.Buf16(W*2),this.dyn_dtree=new A.Buf16((2*G+1)*2),this.bl_tree=new A.Buf16((2*B+1)*2),ke(this.dyn_ltree),ke(this.dyn_dtree),ke(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new A.Buf16(V+1),this.heap=new A.Buf16(2*F+1),ke(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new A.Buf16(2*F+1),ke(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function fe(O){var pe;return!O||!O.state?Se(O,t):(O.total_in=O.total_out=0,O.data_type=f,pe=O.state,pe.pending=0,pe.pending_out=0,pe.wrap<0&&(pe.wrap=-pe.wrap),pe.status=pe.wrap?ie:se,O.adler=pe.wrap===2?0:1,pe.last_flush=y,T._tr_init(pe),p)}function xe(O){var pe=fe(O);return pe===p&&we(O.state),pe}function Te(O,pe){return!O||!O.state||O.state.wrap!==2?t:(O.state.gzhead=pe,p)}function ne(O,pe,ue,Y,re,ye){if(!O)return t;var je=1;if(pe===s&&(pe=6),Y<0?(je=0,Y=-Y):Y>15&&(je=2,Y-=16),re<1||re>w||ue!==E||Y<8||Y>15||pe<0||pe>9||ye<0||ye>a)return Se(O,t);Y===8&&(Y=9);var He=new H;return O.state=He,He.strm=O,He.wrap=je,He.gzhead=null,He.w_bits=Y,He.w_size=1<<He.w_bits,He.w_mask=He.w_size-1,He.hash_bits=re+7,He.hash_size=1<<He.hash_bits,He.hash_mask=He.hash_size-1,He.hash_shift=~~((He.hash_bits+k-1)/k),He.window=new A.Buf8(He.w_size*2),He.head=new A.Buf16(He.hash_size),He.prev=new A.Buf16(He.w_size),He.lit_bufsize=1<<re+6,He.pending_buf_size=He.lit_bufsize*4,He.pending_buf=new A.Buf8(He.pending_buf_size),He.d_buf=1*He.lit_bufsize,He.l_buf=3*He.lit_bufsize,He.level=pe,He.strategy=ye,He.method=ue,xe(O)}function Le(O,pe){return ne(O,pe,E,R,z,g)}function K(O,pe){var ue,Y,re,ye;if(!O||!O.state||pe>_||pe<0)return O?Se(O,t):t;if(Y=O.state,!O.output||!O.input&&O.avail_in!==0||Y.status===Me&&pe!==M)return Se(O,O.avail_out===0?h:t);if(Y.strm=O,ue=Y.last_flush,Y.last_flush=pe,Y.status===ie)if(Y.wrap===2)O.adler=0,Be(Y,31),Be(Y,139),Be(Y,8),Y.gzhead?(Be(Y,(Y.gzhead.text?1:0)+(Y.gzhead.hcrc?2:0)+(Y.gzhead.extra?4:0)+(Y.gzhead.name?8:0)+(Y.gzhead.comment?16:0)),Be(Y,Y.gzhead.time&255),Be(Y,Y.gzhead.time>>8&255),Be(Y,Y.gzhead.time>>16&255),Be(Y,Y.gzhead.time>>24&255),Be(Y,Y.level===9?2:Y.strategy>=e||Y.level<2?4:0),Be(Y,Y.gzhead.os&255),Y.gzhead.extra&&Y.gzhead.extra.length&&(Be(Y,Y.gzhead.extra.length&255),Be(Y,Y.gzhead.extra.length>>8&255)),Y.gzhead.hcrc&&(O.adler=P(O.adler,Y.pending_buf,Y.pending,0)),Y.gzindex=0,Y.status=ge):(Be(Y,0),Be(Y,0),Be(Y,0),Be(Y,0),Be(Y,0),Be(Y,Y.level===9?2:Y.strategy>=e||Y.level<2?4:0),Be(Y,De),Y.status=se);else{var je=E+(Y.w_bits-8<<4)<<8,He=-1;Y.strategy>=e||Y.level<2?He=0:Y.level<6?He=1:Y.level===6?He=2:He=3,je|=He<<6,Y.strstart!==0&&(je|=q),je+=31-je%31,Y.status=se,Ie(Y,je),Y.strstart!==0&&(Ie(Y,O.adler>>>16),Ie(Y,O.adler&65535)),O.adler=1}if(Y.status===ge)if(Y.gzhead.extra){for(re=Y.pending;Y.gzindex<(Y.gzhead.extra.length&65535)&&!(Y.pending===Y.pending_buf_size&&(Y.gzhead.hcrc&&Y.pending>re&&(O.adler=P(O.adler,Y.pending_buf,Y.pending-re,re)),ze(O),re=Y.pending,Y.pending===Y.pending_buf_size));)Be(Y,Y.gzhead.extra[Y.gzindex]&255),Y.gzindex++;Y.gzhead.hcrc&&Y.pending>re&&(O.adler=P(O.adler,Y.pending_buf,Y.pending-re,re)),Y.gzindex===Y.gzhead.extra.length&&(Y.gzindex=0,Y.status=he)}else Y.status=he;if(Y.status===he)if(Y.gzhead.name){re=Y.pending;do{if(Y.pending===Y.pending_buf_size&&(Y.gzhead.hcrc&&Y.pending>re&&(O.adler=P(O.adler,Y.pending_buf,Y.pending-re,re)),ze(O),re=Y.pending,Y.pending===Y.pending_buf_size)){ye=1;break}Y.gzindex<Y.gzhead.name.length?ye=Y.gzhead.name.charCodeAt(Y.gzindex++)&255:ye=0,Be(Y,ye)}while(ye!==0);Y.gzhead.hcrc&&Y.pending>re&&(O.adler=P(O.adler,Y.pending_buf,Y.pending-re,re)),ye===0&&(Y.gzindex=0,Y.status=ve)}else Y.status=ve;if(Y.status===ve)if(Y.gzhead.comment){re=Y.pending;do{if(Y.pending===Y.pending_buf_size&&(Y.gzhead.hcrc&&Y.pending>re&&(O.adler=P(O.adler,Y.pending_buf,Y.pending-re,re)),ze(O),re=Y.pending,Y.pending===Y.pending_buf_size)){ye=1;break}Y.gzindex<Y.gzhead.comment.length?ye=Y.gzhead.comment.charCodeAt(Y.gzindex++)&255:ye=0,Be(Y,ye)}while(ye!==0);Y.gzhead.hcrc&&Y.pending>re&&(O.adler=P(O.adler,Y.pending_buf,Y.pending-re,re)),ye===0&&(Y.status=le)}else Y.status=le;if(Y.status===le&&(Y.gzhead.hcrc?(Y.pending+2>Y.pending_buf_size&&ze(O),Y.pending+2<=Y.pending_buf_size&&(Be(Y,O.adler&255),Be(Y,O.adler>>8&255),O.adler=0,Y.status=se)):Y.status=se),Y.pending!==0){if(ze(O),O.avail_out===0)return Y.last_flush=-1,p}else if(O.avail_in===0&&Ge(pe)<=Ge(ue)&&pe!==M)return Se(O,h);if(Y.status===Me&&O.avail_in!==0)return Se(O,h);if(O.avail_in!==0||Y.lookahead!==0||pe!==y&&Y.status!==Me){var Ve=Y.strategy===e?ae(Y,pe):Y.strategy===n?J(Y,pe):Ee[Y.level].func(Y,pe);if((Ve===ce||Ve===me)&&(Y.status=Me),Ve===be||Ve===ce)return O.avail_out===0&&(Y.last_flush=-1),p;if(Ve===Pe&&(pe===C?T._tr_align(Y):pe!==_&&(T._tr_stored_block(Y,0,0,!1),pe===v&&(ke(Y.head),Y.lookahead===0&&(Y.strstart=0,Y.block_start=0,Y.insert=0))),ze(O),O.avail_out===0))return Y.last_flush=-1,p}return pe!==M?p:Y.wrap<=0?x:(Y.wrap===2?(Be(Y,O.adler&255),Be(Y,O.adler>>8&255),Be(Y,O.adler>>16&255),Be(Y,O.adler>>24&255),Be(Y,O.total_in&255),Be(Y,O.total_in>>8&255),Be(Y,O.total_in>>16&255),Be(Y,O.total_in>>24&255)):(Ie(Y,O.adler>>>16),Ie(Y,O.adler&65535)),ze(O),Y.wrap>0&&(Y.wrap=-Y.wrap),Y.pending!==0?p:x)}function Oe(O){var pe;return!O||!O.state?t:(pe=O.state.status,pe!==ie&&pe!==ge&&pe!==he&&pe!==ve&&pe!==le&&pe!==se&&pe!==Me?Se(O,t):(O.state=null,pe===se?Se(O,r):p))}function Ne(O,pe){var ue=pe.length,Y,re,ye,je,He,Ve,qe,Et;if(!O||!O.state||(Y=O.state,je=Y.wrap,je===2||je===1&&Y.status!==ie||Y.lookahead))return t;for(je===1&&(O.adler=D(O.adler,pe,ue,0)),Y.wrap=0,ue>=Y.w_size&&(je===0&&(ke(Y.head),Y.strstart=0,Y.block_start=0,Y.insert=0),Et=new A.Buf8(Y.w_size),A.arraySet(Et,pe,ue-Y.w_size,Y.w_size,0),pe=Et,ue=Y.w_size),He=O.avail_in,Ve=O.next_in,qe=O.input,O.avail_in=ue,O.next_in=0,O.input=pe,$e(Y);Y.lookahead>=k;){re=Y.strstart,ye=Y.lookahead-(k-1);do Y.ins_h=(Y.ins_h<<Y.hash_shift^Y.window[re+k-1])&Y.hash_mask,Y.prev[re&Y.w_mask]=Y.head[Y.ins_h],Y.head[Y.ins_h]=re,re++;while(--ye);Y.strstart=re,Y.lookahead=k-1,$e(Y)}return Y.strstart+=Y.lookahead,Y.block_start=Y.strstart,Y.insert=Y.lookahead,Y.lookahead=0,Y.match_length=Y.prev_length=k-1,Y.match_available=0,O.next_in=Ve,O.input=qe,O.avail_in=He,Y.wrap=je,p}L.deflateInit=Le,L.deflateInit2=ne,L.deflateReset=xe,L.deflateResetKeep=fe,L.deflateSetHeader=Te,L.deflate=K,L.deflateEnd=Oe,L.deflateSetDictionary=Ne,L.deflateInfo="pako deflate (from Nodeca project)"},"./node_modules/upng-js/node_modules/pako/lib/zlib/gzheader.js":X=>{function L(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}X.exports=L},"./node_modules/upng-js/node_modules/pako/lib/zlib/inffast.js":X=>{var L=30,c=12;X.exports=function(T,D){var P,u,y,C,v,M,_,p,x,t,r,h,s,o,e,n,a,g,f,E,w,R,z,S,I;P=T.state,u=T.next_in,S=T.input,y=u+(T.avail_in-5),C=T.next_out,I=T.output,v=C-(D-T.avail_out),M=C+(T.avail_out-257),_=P.dmax,p=P.wsize,x=P.whave,t=P.wnext,r=P.window,h=P.hold,s=P.bits,o=P.lencode,e=P.distcode,n=(1<<P.lenbits)-1,a=(1<<P.distbits)-1;e:do{s<15&&(h+=S[u++]<<s,s+=8,h+=S[u++]<<s,s+=8),g=o[h&n];t:for(;;){if(f=g>>>24,h>>>=f,s-=f,f=g>>>16&255,f===0)I[C++]=g&65535;else if(f&16){E=g&65535,f&=15,f&&(s<f&&(h+=S[u++]<<s,s+=8),E+=h&(1<<f)-1,h>>>=f,s-=f),s<15&&(h+=S[u++]<<s,s+=8,h+=S[u++]<<s,s+=8),g=e[h&a];i:for(;;){if(f=g>>>24,h>>>=f,s-=f,f=g>>>16&255,f&16){if(w=g&65535,f&=15,s<f&&(h+=S[u++]<<s,s+=8,s<f&&(h+=S[u++]<<s,s+=8)),w+=h&(1<<f)-1,w>_){T.msg="invalid distance too far back",P.mode=L;break e}if(h>>>=f,s-=f,f=C-v,w>f){if(f=w-f,f>x&&P.sane){T.msg="invalid distance too far back",P.mode=L;break e}if(R=0,z=r,t===0){if(R+=p-f,f<E){E-=f;do I[C++]=r[R++];while(--f);R=C-w,z=I}}else if(t<f){if(R+=p+t-f,f-=t,f<E){E-=f;do I[C++]=r[R++];while(--f);if(R=0,t<E){f=t,E-=f;do I[C++]=r[R++];while(--f);R=C-w,z=I}}}else if(R+=t-f,f<E){E-=f;do I[C++]=r[R++];while(--f);R=C-w,z=I}for(;E>2;)I[C++]=z[R++],I[C++]=z[R++],I[C++]=z[R++],E-=3;E&&(I[C++]=z[R++],E>1&&(I[C++]=z[R++]))}else{R=C-w;do I[C++]=I[R++],I[C++]=I[R++],I[C++]=I[R++],E-=3;while(E>2);E&&(I[C++]=I[R++],E>1&&(I[C++]=I[R++]))}}else if(f&64){T.msg="invalid distance code",P.mode=L;break e}else{g=e[(g&65535)+(h&(1<<f)-1)];continue i}break}}else if(f&64)if(f&32){P.mode=c;break e}else{T.msg="invalid literal/length code",P.mode=L;break e}else{g=o[(g&65535)+(h&(1<<f)-1)];continue t}break}}while(u<y&&C<M);E=s>>3,u-=E,s-=E<<3,h&=(1<<s)-1,T.next_in=u,T.next_out=C,T.avail_in=u<y?5+(y-u):5-(u-y),T.avail_out=C<M?257+(M-C):257-(C-M),P.hold=h,P.bits=s}},"./node_modules/upng-js/node_modules/pako/lib/zlib/inflate.js":(X,L,c)=>{var A=c("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),T=c("./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js"),D=c("./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js"),P=c("./node_modules/upng-js/node_modules/pako/lib/zlib/inffast.js"),u=c("./node_modules/upng-js/node_modules/pako/lib/zlib/inftrees.js"),y=0,C=1,v=2,M=4,_=5,p=6,x=0,t=1,r=2,h=-2,s=-3,o=-4,e=-5,n=8,a=1,g=2,f=3,E=4,w=5,R=6,z=7,S=8,I=9,F=10,G=11,B=12,W=13,V=14,k=15,U=16,j=17,q=18,ie=19,ge=20,he=21,ve=22,le=23,se=24,Me=25,be=26,Pe=27,ce=28,me=29,De=30,Se=31,Ge=32,ke=852,ze=592,Re=15,Be=Re;function Ie(ne){return(ne>>>24&255)+(ne>>>8&65280)+((ne&65280)<<8)+((ne&255)<<24)}function We(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new A.Buf16(320),this.work=new A.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Fe(ne){var Le;return!ne||!ne.state?h:(Le=ne.state,ne.total_in=ne.total_out=Le.total=0,ne.msg="",Le.wrap&&(ne.adler=Le.wrap&1),Le.mode=a,Le.last=0,Le.havedict=0,Le.dmax=32768,Le.head=null,Le.hold=0,Le.bits=0,Le.lencode=Le.lendyn=new A.Buf32(ke),Le.distcode=Le.distdyn=new A.Buf32(ze),Le.sane=1,Le.back=-1,x)}function $e(ne){var Le;return!ne||!ne.state?h:(Le=ne.state,Le.wsize=0,Le.whave=0,Le.wnext=0,Fe(ne))}function Ye(ne,Le){var K,Oe;return!ne||!ne.state||(Oe=ne.state,Le<0?(K=0,Le=-Le):(K=(Le>>4)+1,Le<48&&(Le&=15)),Le&&(Le<8||Le>15))?h:(Oe.window!==null&&Oe.wbits!==Le&&(Oe.window=null),Oe.wrap=K,Oe.wbits=Le,$e(ne))}function $(ne,Le){var K,Oe;return ne?(Oe=new We,ne.state=Oe,Oe.window=null,K=Ye(ne,Le),K!==x&&(ne.state=null),K):h}function Z(ne){return $(ne,Be)}var J=!0,ae,de;function Ee(ne){if(J){var Le;for(ae=new A.Buf32(512),de=new A.Buf32(32),Le=0;Le<144;)ne.lens[Le++]=8;for(;Le<256;)ne.lens[Le++]=9;for(;Le<280;)ne.lens[Le++]=7;for(;Le<288;)ne.lens[Le++]=8;for(u(C,ne.lens,0,288,ae,0,ne.work,{bits:9}),Le=0;Le<32;)ne.lens[Le++]=5;u(v,ne.lens,0,32,de,0,ne.work,{bits:5}),J=!1}ne.lencode=ae,ne.lenbits=9,ne.distcode=de,ne.distbits=5}function we(ne,Le,K,Oe){var Ne,O=ne.state;return O.window===null&&(O.wsize=1<<O.wbits,O.wnext=0,O.whave=0,O.window=new A.Buf8(O.wsize)),Oe>=O.wsize?(A.arraySet(O.window,Le,K-O.wsize,O.wsize,0),O.wnext=0,O.whave=O.wsize):(Ne=O.wsize-O.wnext,Ne>Oe&&(Ne=Oe),A.arraySet(O.window,Le,K-Oe,Ne,O.wnext),Oe-=Ne,Oe?(A.arraySet(O.window,Le,K-Oe,Oe,0),O.wnext=Oe,O.whave=O.wsize):(O.wnext+=Ne,O.wnext===O.wsize&&(O.wnext=0),O.whave<O.wsize&&(O.whave+=Ne))),0}function H(ne,Le){var K,Oe,Ne,O,pe,ue,Y,re,ye,je,He,Ve,qe,Et,nt=0,rt,tt,yt,vt,Rt,St,_t,mt,gt=new A.Buf8(4),Ct,wt,Wt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!ne||!ne.state||!ne.output||!ne.input&&ne.avail_in!==0)return h;K=ne.state,K.mode===B&&(K.mode=W),pe=ne.next_out,Ne=ne.output,Y=ne.avail_out,O=ne.next_in,Oe=ne.input,ue=ne.avail_in,re=K.hold,ye=K.bits,je=ue,He=Y,mt=x;e:for(;;)switch(K.mode){case a:if(K.wrap===0){K.mode=W;break}for(;ye<16;){if(ue===0)break e;ue--,re+=Oe[O++]<<ye,ye+=8}if(K.wrap&2&&re===35615){K.check=0,gt[0]=re&255,gt[1]=re>>>8&255,K.check=D(K.check,gt,2,0),re=0,ye=0,K.mode=g;break}if(K.flags=0,K.head&&(K.head.done=!1),!(K.wrap&1)||(((re&255)<<8)+(re>>8))%31){ne.msg="incorrect header check",K.mode=De;break}if((re&15)!==n){ne.msg="unknown compression method",K.mode=De;break}if(re>>>=4,ye-=4,_t=(re&15)+8,K.wbits===0)K.wbits=_t;else if(_t>K.wbits){ne.msg="invalid window size",K.mode=De;break}K.dmax=1<<_t,ne.adler=K.check=1,K.mode=re&512?F:B,re=0,ye=0;break;case g:for(;ye<16;){if(ue===0)break e;ue--,re+=Oe[O++]<<ye,ye+=8}if(K.flags=re,(K.flags&255)!==n){ne.msg="unknown compression method",K.mode=De;break}if(K.flags&57344){ne.msg="unknown header flags set",K.mode=De;break}K.head&&(K.head.text=re>>8&1),K.flags&512&&(gt[0]=re&255,gt[1]=re>>>8&255,K.check=D(K.check,gt,2,0)),re=0,ye=0,K.mode=f;case f:for(;ye<32;){if(ue===0)break e;ue--,re+=Oe[O++]<<ye,ye+=8}K.head&&(K.head.time=re),K.flags&512&&(gt[0]=re&255,gt[1]=re>>>8&255,gt[2]=re>>>16&255,gt[3]=re>>>24&255,K.check=D(K.check,gt,4,0)),re=0,ye=0,K.mode=E;case E:for(;ye<16;){if(ue===0)break e;ue--,re+=Oe[O++]<<ye,ye+=8}K.head&&(K.head.xflags=re&255,K.head.os=re>>8),K.flags&512&&(gt[0]=re&255,gt[1]=re>>>8&255,K.check=D(K.check,gt,2,0)),re=0,ye=0,K.mode=w;case w:if(K.flags&1024){for(;ye<16;){if(ue===0)break e;ue--,re+=Oe[O++]<<ye,ye+=8}K.length=re,K.head&&(K.head.extra_len=re),K.flags&512&&(gt[0]=re&255,gt[1]=re>>>8&255,K.check=D(K.check,gt,2,0)),re=0,ye=0}else K.head&&(K.head.extra=null);K.mode=R;case R:if(K.flags&1024&&(Ve=K.length,Ve>ue&&(Ve=ue),Ve&&(K.head&&(_t=K.head.extra_len-K.length,K.head.extra||(K.head.extra=new Array(K.head.extra_len)),A.arraySet(K.head.extra,Oe,O,Ve,_t)),K.flags&512&&(K.check=D(K.check,Oe,Ve,O)),ue-=Ve,O+=Ve,K.length-=Ve),K.length))break e;K.length=0,K.mode=z;case z:if(K.flags&2048){if(ue===0)break e;Ve=0;do _t=Oe[O+Ve++],K.head&&_t&&K.length<65536&&(K.head.name+=String.fromCharCode(_t));while(_t&&Ve<ue);if(K.flags&512&&(K.check=D(K.check,Oe,Ve,O)),ue-=Ve,O+=Ve,_t)break e}else K.head&&(K.head.name=null);K.length=0,K.mode=S;case S:if(K.flags&4096){if(ue===0)break e;Ve=0;do _t=Oe[O+Ve++],K.head&&_t&&K.length<65536&&(K.head.comment+=String.fromCharCode(_t));while(_t&&Ve<ue);if(K.flags&512&&(K.check=D(K.check,Oe,Ve,O)),ue-=Ve,O+=Ve,_t)break e}else K.head&&(K.head.comment=null);K.mode=I;case I:if(K.flags&512){for(;ye<16;){if(ue===0)break e;ue--,re+=Oe[O++]<<ye,ye+=8}if(re!==(K.check&65535)){ne.msg="header crc mismatch",K.mode=De;break}re=0,ye=0}K.head&&(K.head.hcrc=K.flags>>9&1,K.head.done=!0),ne.adler=K.check=0,K.mode=B;break;case F:for(;ye<32;){if(ue===0)break e;ue--,re+=Oe[O++]<<ye,ye+=8}ne.adler=K.check=Ie(re),re=0,ye=0,K.mode=G;case G:if(K.havedict===0)return ne.next_out=pe,ne.avail_out=Y,ne.next_in=O,ne.avail_in=ue,K.hold=re,K.bits=ye,r;ne.adler=K.check=1,K.mode=B;case B:if(Le===_||Le===p)break e;case W:if(K.last){re>>>=ye&7,ye-=ye&7,K.mode=Pe;break}for(;ye<3;){if(ue===0)break e;ue--,re+=Oe[O++]<<ye,ye+=8}switch(K.last=re&1,re>>>=1,ye-=1,re&3){case 0:K.mode=V;break;case 1:if(Ee(K),K.mode=ge,Le===p){re>>>=2,ye-=2;break e}break;case 2:K.mode=j;break;case 3:ne.msg="invalid block type",K.mode=De}re>>>=2,ye-=2;break;case V:for(re>>>=ye&7,ye-=ye&7;ye<32;){if(ue===0)break e;ue--,re+=Oe[O++]<<ye,ye+=8}if((re&65535)!==(re>>>16^65535)){ne.msg="invalid stored block lengths",K.mode=De;break}if(K.length=re&65535,re=0,ye=0,K.mode=k,Le===p)break e;case k:K.mode=U;case U:if(Ve=K.length,Ve){if(Ve>ue&&(Ve=ue),Ve>Y&&(Ve=Y),Ve===0)break e;A.arraySet(Ne,Oe,O,Ve,pe),ue-=Ve,O+=Ve,Y-=Ve,pe+=Ve,K.length-=Ve;break}K.mode=B;break;case j:for(;ye<14;){if(ue===0)break e;ue--,re+=Oe[O++]<<ye,ye+=8}if(K.nlen=(re&31)+257,re>>>=5,ye-=5,K.ndist=(re&31)+1,re>>>=5,ye-=5,K.ncode=(re&15)+4,re>>>=4,ye-=4,K.nlen>286||K.ndist>30){ne.msg="too many length or distance symbols",K.mode=De;break}K.have=0,K.mode=q;case q:for(;K.have<K.ncode;){for(;ye<3;){if(ue===0)break e;ue--,re+=Oe[O++]<<ye,ye+=8}K.lens[Wt[K.have++]]=re&7,re>>>=3,ye-=3}for(;K.have<19;)K.lens[Wt[K.have++]]=0;if(K.lencode=K.lendyn,K.lenbits=7,Ct={bits:K.lenbits},mt=u(y,K.lens,0,19,K.lencode,0,K.work,Ct),K.lenbits=Ct.bits,mt){ne.msg="invalid code lengths set",K.mode=De;break}K.have=0,K.mode=ie;case ie:for(;K.have<K.nlen+K.ndist;){for(;nt=K.lencode[re&(1<<K.lenbits)-1],rt=nt>>>24,tt=nt>>>16&255,yt=nt&65535,!(rt<=ye);){if(ue===0)break e;ue--,re+=Oe[O++]<<ye,ye+=8}if(yt<16)re>>>=rt,ye-=rt,K.lens[K.have++]=yt;else{if(yt===16){for(wt=rt+2;ye<wt;){if(ue===0)break e;ue--,re+=Oe[O++]<<ye,ye+=8}if(re>>>=rt,ye-=rt,K.have===0){ne.msg="invalid bit length repeat",K.mode=De;break}_t=K.lens[K.have-1],Ve=3+(re&3),re>>>=2,ye-=2}else if(yt===17){for(wt=rt+3;ye<wt;){if(ue===0)break e;ue--,re+=Oe[O++]<<ye,ye+=8}re>>>=rt,ye-=rt,_t=0,Ve=3+(re&7),re>>>=3,ye-=3}else{for(wt=rt+7;ye<wt;){if(ue===0)break e;ue--,re+=Oe[O++]<<ye,ye+=8}re>>>=rt,ye-=rt,_t=0,Ve=11+(re&127),re>>>=7,ye-=7}if(K.have+Ve>K.nlen+K.ndist){ne.msg="invalid bit length repeat",K.mode=De;break}for(;Ve--;)K.lens[K.have++]=_t}}if(K.mode===De)break;if(K.lens[256]===0){ne.msg="invalid code -- missing end-of-block",K.mode=De;break}if(K.lenbits=9,Ct={bits:K.lenbits},mt=u(C,K.lens,0,K.nlen,K.lencode,0,K.work,Ct),K.lenbits=Ct.bits,mt){ne.msg="invalid literal/lengths set",K.mode=De;break}if(K.distbits=6,K.distcode=K.distdyn,Ct={bits:K.distbits},mt=u(v,K.lens,K.nlen,K.ndist,K.distcode,0,K.work,Ct),K.distbits=Ct.bits,mt){ne.msg="invalid distances set",K.mode=De;break}if(K.mode=ge,Le===p)break e;case ge:K.mode=he;case he:if(ue>=6&&Y>=258){ne.next_out=pe,ne.avail_out=Y,ne.next_in=O,ne.avail_in=ue,K.hold=re,K.bits=ye,P(ne,He),pe=ne.next_out,Ne=ne.output,Y=ne.avail_out,O=ne.next_in,Oe=ne.input,ue=ne.avail_in,re=K.hold,ye=K.bits,K.mode===B&&(K.back=-1);break}for(K.back=0;nt=K.lencode[re&(1<<K.lenbits)-1],rt=nt>>>24,tt=nt>>>16&255,yt=nt&65535,!(rt<=ye);){if(ue===0)break e;ue--,re+=Oe[O++]<<ye,ye+=8}if(tt&&!(tt&240)){for(vt=rt,Rt=tt,St=yt;nt=K.lencode[St+((re&(1<<vt+Rt)-1)>>vt)],rt=nt>>>24,tt=nt>>>16&255,yt=nt&65535,!(vt+rt<=ye);){if(ue===0)break e;ue--,re+=Oe[O++]<<ye,ye+=8}re>>>=vt,ye-=vt,K.back+=vt}if(re>>>=rt,ye-=rt,K.back+=rt,K.length=yt,tt===0){K.mode=be;break}if(tt&32){K.back=-1,K.mode=B;break}if(tt&64){ne.msg="invalid literal/length code",K.mode=De;break}K.extra=tt&15,K.mode=ve;case ve:if(K.extra){for(wt=K.extra;ye<wt;){if(ue===0)break e;ue--,re+=Oe[O++]<<ye,ye+=8}K.length+=re&(1<<K.extra)-1,re>>>=K.extra,ye-=K.extra,K.back+=K.extra}K.was=K.length,K.mode=le;case le:for(;nt=K.distcode[re&(1<<K.distbits)-1],rt=nt>>>24,tt=nt>>>16&255,yt=nt&65535,!(rt<=ye);){if(ue===0)break e;ue--,re+=Oe[O++]<<ye,ye+=8}if(!(tt&240)){for(vt=rt,Rt=tt,St=yt;nt=K.distcode[St+((re&(1<<vt+Rt)-1)>>vt)],rt=nt>>>24,tt=nt>>>16&255,yt=nt&65535,!(vt+rt<=ye);){if(ue===0)break e;ue--,re+=Oe[O++]<<ye,ye+=8}re>>>=vt,ye-=vt,K.back+=vt}if(re>>>=rt,ye-=rt,K.back+=rt,tt&64){ne.msg="invalid distance code",K.mode=De;break}K.offset=yt,K.extra=tt&15,K.mode=se;case se:if(K.extra){for(wt=K.extra;ye<wt;){if(ue===0)break e;ue--,re+=Oe[O++]<<ye,ye+=8}K.offset+=re&(1<<K.extra)-1,re>>>=K.extra,ye-=K.extra,K.back+=K.extra}if(K.offset>K.dmax){ne.msg="invalid distance too far back",K.mode=De;break}K.mode=Me;case Me:if(Y===0)break e;if(Ve=He-Y,K.offset>Ve){if(Ve=K.offset-Ve,Ve>K.whave&&K.sane){ne.msg="invalid distance too far back",K.mode=De;break}Ve>K.wnext?(Ve-=K.wnext,qe=K.wsize-Ve):qe=K.wnext-Ve,Ve>K.length&&(Ve=K.length),Et=K.window}else Et=Ne,qe=pe-K.offset,Ve=K.length;Ve>Y&&(Ve=Y),Y-=Ve,K.length-=Ve;do Ne[pe++]=Et[qe++];while(--Ve);K.length===0&&(K.mode=he);break;case be:if(Y===0)break e;Ne[pe++]=K.length,Y--,K.mode=he;break;case Pe:if(K.wrap){for(;ye<32;){if(ue===0)break e;ue--,re|=Oe[O++]<<ye,ye+=8}if(He-=Y,ne.total_out+=He,K.total+=He,He&&(ne.adler=K.check=K.flags?D(K.check,Ne,He,pe-He):T(K.check,Ne,He,pe-He)),He=Y,(K.flags?re:Ie(re))!==K.check){ne.msg="incorrect data check",K.mode=De;break}re=0,ye=0}K.mode=ce;case ce:if(K.wrap&&K.flags){for(;ye<32;){if(ue===0)break e;ue--,re+=Oe[O++]<<ye,ye+=8}if(re!==(K.total&4294967295)){ne.msg="incorrect length check",K.mode=De;break}re=0,ye=0}K.mode=me;case me:mt=t;break e;case De:mt=s;break e;case Se:return o;case Ge:default:return h}return ne.next_out=pe,ne.avail_out=Y,ne.next_in=O,ne.avail_in=ue,K.hold=re,K.bits=ye,(K.wsize||He!==ne.avail_out&&K.mode<De&&(K.mode<Pe||Le!==M))&&we(ne,ne.output,ne.next_out,He-ne.avail_out),je-=ne.avail_in,He-=ne.avail_out,ne.total_in+=je,ne.total_out+=He,K.total+=He,K.wrap&&He&&(ne.adler=K.check=K.flags?D(K.check,Ne,He,ne.next_out-He):T(K.check,Ne,He,ne.next_out-He)),ne.data_type=K.bits+(K.last?64:0)+(K.mode===B?128:0)+(K.mode===ge||K.mode===k?256:0),(je===0&&He===0||Le===M)&&mt===x&&(mt=e),mt}function fe(ne){if(!ne||!ne.state)return h;var Le=ne.state;return Le.window&&(Le.window=null),ne.state=null,x}function xe(ne,Le){var K;return!ne||!ne.state||(K=ne.state,!(K.wrap&2))?h:(K.head=Le,Le.done=!1,x)}function Te(ne,Le){var K=Le.length,Oe,Ne,O;return!ne||!ne.state||(Oe=ne.state,Oe.wrap!==0&&Oe.mode!==G)?h:Oe.mode===G&&(Ne=1,Ne=T(Ne,Le,K,0),Ne!==Oe.check)?s:(O=we(ne,Le,K,K),O?(Oe.mode=Se,o):(Oe.havedict=1,x))}L.inflateReset=$e,L.inflateReset2=Ye,L.inflateResetKeep=Fe,L.inflateInit=Z,L.inflateInit2=$,L.inflate=H,L.inflateEnd=fe,L.inflateGetHeader=xe,L.inflateSetDictionary=Te,L.inflateInfo="pako inflate (from Nodeca project)"},"./node_modules/upng-js/node_modules/pako/lib/zlib/inftrees.js":(X,L,c)=>{var A=c("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),T=15,D=852,P=592,u=0,y=1,C=2,v=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],M=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],_=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],p=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];X.exports=function(t,r,h,s,o,e,n,a){var g=a.bits,f=0,E=0,w=0,R=0,z=0,S=0,I=0,F=0,G=0,B=0,W,V,k,U,j,q=null,ie=0,ge,he=new A.Buf16(T+1),ve=new A.Buf16(T+1),le=null,se=0,Me,be,Pe;for(f=0;f<=T;f++)he[f]=0;for(E=0;E<s;E++)he[r[h+E]]++;for(z=g,R=T;R>=1&&he[R]===0;R--);if(z>R&&(z=R),R===0)return o[e++]=20971520,o[e++]=20971520,a.bits=1,0;for(w=1;w<R&&he[w]===0;w++);for(z<w&&(z=w),F=1,f=1;f<=T;f++)if(F<<=1,F-=he[f],F<0)return-1;if(F>0&&(t===u||R!==1))return-1;for(ve[1]=0,f=1;f<T;f++)ve[f+1]=ve[f]+he[f];for(E=0;E<s;E++)r[h+E]!==0&&(n[ve[r[h+E]]++]=E);if(t===u?(q=le=n,ge=19):t===y?(q=v,ie-=257,le=M,se-=257,ge=256):(q=_,le=p,ge=-1),B=0,E=0,f=w,j=e,S=z,I=0,k=-1,G=1<<z,U=G-1,t===y&&G>D||t===C&&G>P)return 1;for(;;){Me=f-I,n[E]<ge?(be=0,Pe=n[E]):n[E]>ge?(be=le[se+n[E]],Pe=q[ie+n[E]]):(be=96,Pe=0),W=1<<f-I,V=1<<S,w=V;do V-=W,o[j+(B>>I)+V]=Me<<24|be<<16|Pe|0;while(V!==0);for(W=1<<f-1;B&W;)W>>=1;if(W!==0?(B&=W-1,B+=W):B=0,E++,--he[f]===0){if(f===R)break;f=r[h+n[E]]}if(f>z&&(B&U)!==k){for(I===0&&(I=z),j+=w,S=f-I,F=1<<S;S+I<R&&(F-=he[S+I],!(F<=0));)S++,F<<=1;if(G+=1<<S,t===y&&G>D||t===C&&G>P)return 1;k=B&U,o[k]=z<<24|S<<16|j-e|0}}return B!==0&&(o[j+B]=f-I<<24|4194304|0),a.bits=z,0}},"./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js":X=>{X.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},"./node_modules/upng-js/node_modules/pako/lib/zlib/trees.js":(X,L,c)=>{var A=c("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),T=4,D=0,P=1,u=2;function y(H){for(var fe=H.length;--fe>=0;)H[fe]=0}var C=0,v=1,M=2,_=3,p=258,x=29,t=256,r=t+1+x,h=30,s=19,o=2*r+1,e=15,n=16,a=7,g=256,f=16,E=17,w=18,R=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],z=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],I=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],F=512,G=new Array((r+2)*2);y(G);var B=new Array(h*2);y(B);var W=new Array(F);y(W);var V=new Array(p-_+1);y(V);var k=new Array(x);y(k);var U=new Array(h);y(U);function j(H,fe,xe,Te,ne){this.static_tree=H,this.extra_bits=fe,this.extra_base=xe,this.elems=Te,this.max_length=ne,this.has_stree=H&&H.length}var q,ie,ge;function he(H,fe){this.dyn_tree=H,this.max_code=0,this.stat_desc=fe}function ve(H){return H<256?W[H]:W[256+(H>>>7)]}function le(H,fe){H.pending_buf[H.pending++]=fe&255,H.pending_buf[H.pending++]=fe>>>8&255}function se(H,fe,xe){H.bi_valid>n-xe?(H.bi_buf|=fe<<H.bi_valid&65535,le(H,H.bi_buf),H.bi_buf=fe>>n-H.bi_valid,H.bi_valid+=xe-n):(H.bi_buf|=fe<<H.bi_valid&65535,H.bi_valid+=xe)}function Me(H,fe,xe){se(H,xe[fe*2],xe[fe*2+1])}function be(H,fe){var xe=0;do xe|=H&1,H>>>=1,xe<<=1;while(--fe>0);return xe>>>1}function Pe(H){H.bi_valid===16?(le(H,H.bi_buf),H.bi_buf=0,H.bi_valid=0):H.bi_valid>=8&&(H.pending_buf[H.pending++]=H.bi_buf&255,H.bi_buf>>=8,H.bi_valid-=8)}function ce(H,fe){var xe=fe.dyn_tree,Te=fe.max_code,ne=fe.stat_desc.static_tree,Le=fe.stat_desc.has_stree,K=fe.stat_desc.extra_bits,Oe=fe.stat_desc.extra_base,Ne=fe.stat_desc.max_length,O,pe,ue,Y,re,ye,je=0;for(Y=0;Y<=e;Y++)H.bl_count[Y]=0;for(xe[H.heap[H.heap_max]*2+1]=0,O=H.heap_max+1;O<o;O++)pe=H.heap[O],Y=xe[xe[pe*2+1]*2+1]+1,Y>Ne&&(Y=Ne,je++),xe[pe*2+1]=Y,!(pe>Te)&&(H.bl_count[Y]++,re=0,pe>=Oe&&(re=K[pe-Oe]),ye=xe[pe*2],H.opt_len+=ye*(Y+re),Le&&(H.static_len+=ye*(ne[pe*2+1]+re)));if(je!==0){do{for(Y=Ne-1;H.bl_count[Y]===0;)Y--;H.bl_count[Y]--,H.bl_count[Y+1]+=2,H.bl_count[Ne]--,je-=2}while(je>0);for(Y=Ne;Y!==0;Y--)for(pe=H.bl_count[Y];pe!==0;)ue=H.heap[--O],!(ue>Te)&&(xe[ue*2+1]!==Y&&(H.opt_len+=(Y-xe[ue*2+1])*xe[ue*2],xe[ue*2+1]=Y),pe--)}}function me(H,fe,xe){var Te=new Array(e+1),ne=0,Le,K;for(Le=1;Le<=e;Le++)Te[Le]=ne=ne+xe[Le-1]<<1;for(K=0;K<=fe;K++){var Oe=H[K*2+1];Oe!==0&&(H[K*2]=be(Te[Oe]++,Oe))}}function De(){var H,fe,xe,Te,ne,Le=new Array(e+1);for(xe=0,Te=0;Te<x-1;Te++)for(k[Te]=xe,H=0;H<1<<R[Te];H++)V[xe++]=Te;for(V[xe-1]=Te,ne=0,Te=0;Te<16;Te++)for(U[Te]=ne,H=0;H<1<<z[Te];H++)W[ne++]=Te;for(ne>>=7;Te<h;Te++)for(U[Te]=ne<<7,H=0;H<1<<z[Te]-7;H++)W[256+ne++]=Te;for(fe=0;fe<=e;fe++)Le[fe]=0;for(H=0;H<=143;)G[H*2+1]=8,H++,Le[8]++;for(;H<=255;)G[H*2+1]=9,H++,Le[9]++;for(;H<=279;)G[H*2+1]=7,H++,Le[7]++;for(;H<=287;)G[H*2+1]=8,H++,Le[8]++;for(me(G,r+1,Le),H=0;H<h;H++)B[H*2+1]=5,B[H*2]=be(H,5);q=new j(G,R,t+1,r,e),ie=new j(B,z,0,h,e),ge=new j(new Array(0),S,0,s,a)}function Se(H){var fe;for(fe=0;fe<r;fe++)H.dyn_ltree[fe*2]=0;for(fe=0;fe<h;fe++)H.dyn_dtree[fe*2]=0;for(fe=0;fe<s;fe++)H.bl_tree[fe*2]=0;H.dyn_ltree[g*2]=1,H.opt_len=H.static_len=0,H.last_lit=H.matches=0}function Ge(H){H.bi_valid>8?le(H,H.bi_buf):H.bi_valid>0&&(H.pending_buf[H.pending++]=H.bi_buf),H.bi_buf=0,H.bi_valid=0}function ke(H,fe,xe,Te){Ge(H),Te&&(le(H,xe),le(H,~xe)),A.arraySet(H.pending_buf,H.window,fe,xe,H.pending),H.pending+=xe}function ze(H,fe,xe,Te){var ne=fe*2,Le=xe*2;return H[ne]<H[Le]||H[ne]===H[Le]&&Te[fe]<=Te[xe]}function Re(H,fe,xe){for(var Te=H.heap[xe],ne=xe<<1;ne<=H.heap_len&&(ne<H.heap_len&&ze(fe,H.heap[ne+1],H.heap[ne],H.depth)&&ne++,!ze(fe,Te,H.heap[ne],H.depth));)H.heap[xe]=H.heap[ne],xe=ne,ne<<=1;H.heap[xe]=Te}function Be(H,fe,xe){var Te,ne,Le=0,K,Oe;if(H.last_lit!==0)do Te=H.pending_buf[H.d_buf+Le*2]<<8|H.pending_buf[H.d_buf+Le*2+1],ne=H.pending_buf[H.l_buf+Le],Le++,Te===0?Me(H,ne,fe):(K=V[ne],Me(H,K+t+1,fe),Oe=R[K],Oe!==0&&(ne-=k[K],se(H,ne,Oe)),Te--,K=ve(Te),Me(H,K,xe),Oe=z[K],Oe!==0&&(Te-=U[K],se(H,Te,Oe)));while(Le<H.last_lit);Me(H,g,fe)}function Ie(H,fe){var xe=fe.dyn_tree,Te=fe.stat_desc.static_tree,ne=fe.stat_desc.has_stree,Le=fe.stat_desc.elems,K,Oe,Ne=-1,O;for(H.heap_len=0,H.heap_max=o,K=0;K<Le;K++)xe[K*2]!==0?(H.heap[++H.heap_len]=Ne=K,H.depth[K]=0):xe[K*2+1]=0;for(;H.heap_len<2;)O=H.heap[++H.heap_len]=Ne<2?++Ne:0,xe[O*2]=1,H.depth[O]=0,H.opt_len--,ne&&(H.static_len-=Te[O*2+1]);for(fe.max_code=Ne,K=H.heap_len>>1;K>=1;K--)Re(H,xe,K);O=Le;do K=H.heap[1],H.heap[1]=H.heap[H.heap_len--],Re(H,xe,1),Oe=H.heap[1],H.heap[--H.heap_max]=K,H.heap[--H.heap_max]=Oe,xe[O*2]=xe[K*2]+xe[Oe*2],H.depth[O]=(H.depth[K]>=H.depth[Oe]?H.depth[K]:H.depth[Oe])+1,xe[K*2+1]=xe[Oe*2+1]=O,H.heap[1]=O++,Re(H,xe,1);while(H.heap_len>=2);H.heap[--H.heap_max]=H.heap[1],ce(H,fe),me(xe,Ne,H.bl_count)}function We(H,fe,xe){var Te,ne=-1,Le,K=fe[0*2+1],Oe=0,Ne=7,O=4;for(K===0&&(Ne=138,O=3),fe[(xe+1)*2+1]=65535,Te=0;Te<=xe;Te++)Le=K,K=fe[(Te+1)*2+1],!(++Oe<Ne&&Le===K)&&(Oe<O?H.bl_tree[Le*2]+=Oe:Le!==0?(Le!==ne&&H.bl_tree[Le*2]++,H.bl_tree[f*2]++):Oe<=10?H.bl_tree[E*2]++:H.bl_tree[w*2]++,Oe=0,ne=Le,K===0?(Ne=138,O=3):Le===K?(Ne=6,O=3):(Ne=7,O=4))}function Fe(H,fe,xe){var Te,ne=-1,Le,K=fe[0*2+1],Oe=0,Ne=7,O=4;for(K===0&&(Ne=138,O=3),Te=0;Te<=xe;Te++)if(Le=K,K=fe[(Te+1)*2+1],!(++Oe<Ne&&Le===K)){if(Oe<O)do Me(H,Le,H.bl_tree);while(--Oe!==0);else Le!==0?(Le!==ne&&(Me(H,Le,H.bl_tree),Oe--),Me(H,f,H.bl_tree),se(H,Oe-3,2)):Oe<=10?(Me(H,E,H.bl_tree),se(H,Oe-3,3)):(Me(H,w,H.bl_tree),se(H,Oe-11,7));Oe=0,ne=Le,K===0?(Ne=138,O=3):Le===K?(Ne=6,O=3):(Ne=7,O=4)}}function $e(H){var fe;for(We(H,H.dyn_ltree,H.l_desc.max_code),We(H,H.dyn_dtree,H.d_desc.max_code),Ie(H,H.bl_desc),fe=s-1;fe>=3&&H.bl_tree[I[fe]*2+1]===0;fe--);return H.opt_len+=3*(fe+1)+5+5+4,fe}function Ye(H,fe,xe,Te){var ne;for(se(H,fe-257,5),se(H,xe-1,5),se(H,Te-4,4),ne=0;ne<Te;ne++)se(H,H.bl_tree[I[ne]*2+1],3);Fe(H,H.dyn_ltree,fe-1),Fe(H,H.dyn_dtree,xe-1)}function $(H){var fe=4093624447,xe;for(xe=0;xe<=31;xe++,fe>>>=1)if(fe&1&&H.dyn_ltree[xe*2]!==0)return D;if(H.dyn_ltree[18]!==0||H.dyn_ltree[20]!==0||H.dyn_ltree[26]!==0)return P;for(xe=32;xe<t;xe++)if(H.dyn_ltree[xe*2]!==0)return P;return D}var Z=!1;function J(H){Z||(De(),Z=!0),H.l_desc=new he(H.dyn_ltree,q),H.d_desc=new he(H.dyn_dtree,ie),H.bl_desc=new he(H.bl_tree,ge),H.bi_buf=0,H.bi_valid=0,Se(H)}function ae(H,fe,xe,Te){se(H,(C<<1)+(Te?1:0),3),ke(H,fe,xe,!0)}function de(H){se(H,v<<1,3),Me(H,g,G),Pe(H)}function Ee(H,fe,xe,Te){var ne,Le,K=0;H.level>0?(H.strm.data_type===u&&(H.strm.data_type=$(H)),Ie(H,H.l_desc),Ie(H,H.d_desc),K=$e(H),ne=H.opt_len+3+7>>>3,Le=H.static_len+3+7>>>3,Le<=ne&&(ne=Le)):ne=Le=xe+5,xe+4<=ne&&fe!==-1?ae(H,fe,xe,Te):H.strategy===T||Le===ne?(se(H,(v<<1)+(Te?1:0),3),Be(H,G,B)):(se(H,(M<<1)+(Te?1:0),3),Ye(H,H.l_desc.max_code+1,H.d_desc.max_code+1,K+1),Be(H,H.dyn_ltree,H.dyn_dtree)),Se(H),Te&&Ge(H)}function we(H,fe,xe){return H.pending_buf[H.d_buf+H.last_lit*2]=fe>>>8&255,H.pending_buf[H.d_buf+H.last_lit*2+1]=fe&255,H.pending_buf[H.l_buf+H.last_lit]=xe&255,H.last_lit++,fe===0?H.dyn_ltree[xe*2]++:(H.matches++,fe--,H.dyn_ltree[(V[xe]+t+1)*2]++,H.dyn_dtree[ve(fe)*2]++),H.last_lit===H.lit_bufsize-1}L._tr_init=J,L._tr_stored_block=ae,L._tr_flush_block=Ee,L._tr_tally=we,L._tr_align=de},"./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js":X=>{function L(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}X.exports=L},"./src/SurfaceWorker.js":()=>{$3Dmol.workerString=(function(){self.onmessage=function(X){var L=X.data,c=L.type;if(c<0)self.atomData=L.atoms,self.volume=L.volume,self.ps=new ProteinSurface;else{var A=self.ps;A.initparm(L.expandedExtent,c!=1,self.volume),A.fillvoxels(self.atomData,L.extendedAtoms),A.buildboundary(),(c===4||c===2)&&(A.fastdistancemap(),A.boundingatom(!1),A.fillvoxelswaals(self.atomData,L.extendedAtoms)),A.marchingcube(c);var T=A.getFacesAndVertices(L.atomsToShow);self.postMessage(T)}}}).toString().replace(/(^.*?\{|\}$)/g,""),$3Dmol.workerString+=`;
function _classCallCheck() {};`,$3Dmol.workerString+=`;
`+$3Dmol.Vector3.toString(),$3Dmol.workerString+=`;
`+$3Dmol.MarchingCubeInitializer.toString()+`;

`,$3Dmol.workerString+=`;
`+$3Dmol.PointGrid.toString()+`;
`,$3Dmol.workerString+=`;
var ProteinSurface = `+$3Dmol.ProteinSurface.toString()+`;
`,$3Dmol.SurfaceWorker=window.URL?window.URL.createObjectURL(new Blob([$3Dmol.workerString],{type:"text/javascript"})):void 0},"./src/exporter.js":X=>{typeof X.exports=="object"&&(X.exports=window.$3Dmol)},"./src/vendor/mmtf.js":function(X,L){(function(c,A){A(L)})(this,function(c){function A($,Z,J){for(var ae=($.byteLength,0),de=J.length;de>ae;ae++){var Ee=J.charCodeAt(ae);if(128>Ee)$.setUint8(Z++,Ee>>>0&127|0);else if(2048>Ee)$.setUint8(Z++,Ee>>>6&31|192),$.setUint8(Z++,Ee>>>0&63|128);else if(65536>Ee)$.setUint8(Z++,Ee>>>12&15|224),$.setUint8(Z++,Ee>>>6&63|128),$.setUint8(Z++,Ee>>>0&63|128);else{if(!(1114112>Ee))throw new Error("bad codepoint "+Ee);$.setUint8(Z++,Ee>>>18&7|240),$.setUint8(Z++,Ee>>>12&63|128),$.setUint8(Z++,Ee>>>6&63|128),$.setUint8(Z++,Ee>>>0&63|128)}}}function T($){for(var Z=0,J=0,ae=$.length;ae>J;J++){var de=$.charCodeAt(J);if(128>de)Z+=1;else if(2048>de)Z+=2;else if(65536>de)Z+=3;else{if(!(1114112>de))throw new Error("bad codepoint "+de);Z+=4}}return Z}function D($,Z,J){var ae=typeof $;if(ae==="string"){var de=T($);if(32>de)return Z.setUint8(J,160|de),A(Z,J+1,$),1+de;if(256>de)return Z.setUint8(J,217),Z.setUint8(J+1,de),A(Z,J+2,$),2+de;if(65536>de)return Z.setUint8(J,218),Z.setUint16(J+1,de),A(Z,J+3,$),3+de;if(4294967296>de)return Z.setUint8(J,219),Z.setUint32(J+1,de),A(Z,J+5,$),5+de}if($ instanceof Uint8Array){var de=$.byteLength,Ee=new Uint8Array(Z.buffer);if(256>de)return Z.setUint8(J,196),Z.setUint8(J+1,de),Ee.set($,J+2),2+de;if(65536>de)return Z.setUint8(J,197),Z.setUint16(J+1,de),Ee.set($,J+3),3+de;if(4294967296>de)return Z.setUint8(J,198),Z.setUint32(J+1,de),Ee.set($,J+5),5+de}if(ae==="number"){if(!isFinite($))throw new Error("Number not finite: "+$);if(Math.floor($)!==$)return Z.setUint8(J,203),Z.setFloat64(J+1,$),9;if($>=0){if(128>$)return Z.setUint8(J,$),1;if(256>$)return Z.setUint8(J,204),Z.setUint8(J+1,$),2;if(65536>$)return Z.setUint8(J,205),Z.setUint16(J+1,$),3;if(4294967296>$)return Z.setUint8(J,206),Z.setUint32(J+1,$),5;throw new Error("Number too big 0x"+$.toString(16))}if($>=-32)return Z.setInt8(J,$),1;if($>=-128)return Z.setUint8(J,208),Z.setInt8(J+1,$),2;if($>=-32768)return Z.setUint8(J,209),Z.setInt16(J+1,$),3;if($>=-2147483648)return Z.setUint8(J,210),Z.setInt32(J+1,$),5;throw new Error("Number too small -0x"+(-$).toString(16).substr(1))}if($===null)return Z.setUint8(J,192),1;if(ae==="boolean")return Z.setUint8(J,$?195:194),1;if(ae==="object"){var de,fe=0,we=Array.isArray($);if(we)de=$.length;else{var H=Object.keys($);de=H.length}var fe;if(16>de?(Z.setUint8(J,de|(we?144:128)),fe=1):65536>de?(Z.setUint8(J,we?220:222),Z.setUint16(J+1,de),fe=3):4294967296>de&&(Z.setUint8(J,we?221:223),Z.setUint32(J+1,de),fe=5),we)for(var xe=0;de>xe;xe++)fe+=D($[xe],Z,J+fe);else for(var xe=0;de>xe;xe++){var Te=H[xe];fe+=D(Te,Z,J+fe),fe+=D($[Te],Z,J+fe)}return fe}throw new Error("Unknown type "+ae)}function P($){var Z=typeof $;if(Z==="string"){var J=T($);if(32>J)return 1+J;if(256>J)return 2+J;if(65536>J)return 3+J;if(4294967296>J)return 5+J}if($ instanceof Uint8Array){var J=$.byteLength;if(256>J)return 2+J;if(65536>J)return 3+J;if(4294967296>J)return 5+J}if(Z==="number"){if(Math.floor($)!==$)return 9;if($>=0){if(128>$)return 1;if(256>$)return 2;if(65536>$)return 3;if(4294967296>$)return 5;throw new Error("Number too big 0x"+$.toString(16))}if($>=-32)return 1;if($>=-128)return 2;if($>=-32768)return 3;if($>=-2147483648)return 5;throw new Error("Number too small -0x"+$.toString(16).substr(1))}if(Z==="boolean"||$===null)return 1;if(Z==="object"){var J,ae=0;if(Array.isArray($)){J=$.length;for(var de=0;J>de;de++)ae+=P($[de])}else{var Ee=Object.keys($);J=Ee.length;for(var de=0;J>de;de++){var we=Ee[de];ae+=P(we)+P($[we])}}if(16>J)return 1+ae;if(65536>J)return 3+ae;if(4294967296>J)return 5+ae;throw new Error("Array or object too long 0x"+J.toString(16))}throw new Error("Unknown type "+Z)}function u($){var Z=new ArrayBuffer(P($)),J=new DataView(Z);return D($,J,0),new Uint8Array(Z)}function y($,Z,J){return Z?new $(Z.buffer,Z.byteOffset,Z.byteLength/(J||1)):void 0}function C($){return y(DataView,$)}function v($){return y(Uint8Array,$)}function M($){return y(Int8Array,$)}function _($){return y(Int32Array,$,4)}function p($){return y(Float32Array,$,4)}function x($,Z){var J=$.length/2;Z||(Z=new Int16Array(J));for(var ae=0,de=0;J>ae;++ae,de+=2)Z[ae]=$[de]<<8^$[de+1]<<0;return Z}function t($,Z){var J=$.length;Z||(Z=new Uint8Array(2*J));for(var ae=C(Z),de=0;J>de;++de)ae.setInt16(2*de,$[de]);return v(Z)}function r($,Z){var J=$.length/4;Z||(Z=new Int32Array(J));for(var ae=0,de=0;J>ae;++ae,de+=4)Z[ae]=$[de]<<24^$[de+1]<<16^$[de+2]<<8^$[de+3]<<0;return Z}function h($,Z){var J=$.length;Z||(Z=new Uint8Array(4*J));for(var ae=C(Z),de=0;J>de;++de)ae.setInt32(4*de,$[de]);return v(Z)}function s($,Z){var J=$.length;Z||(Z=new Float32Array(J/4));for(var ae=C(Z),de=C($),Ee=0,we=0,H=J/4;H>Ee;++Ee,we+=4)ae.setFloat32(we,de.getFloat32(we),!0);return Z}function o($,Z,J){var ae=$.length,de=1/Z;J||(J=new Float32Array(ae));for(var Ee=0;ae>Ee;++Ee)J[Ee]=$[Ee]*de;return J}function e($,Z,J){var ae=$.length;J||(J=new Int32Array(ae));for(var de=0;ae>de;++de)J[de]=Math.round($[de]*Z);return J}function n($,Z){var J,ae;if(!Z){var de=0;for(J=0,ae=$.length;ae>J;J+=2)de+=$[J+1];Z=new $.constructor(de)}var Ee=0;for(J=0,ae=$.length;ae>J;J+=2)for(var we=$[J],H=$[J+1],fe=0;H>fe;++fe)Z[Ee]=we,++Ee;return Z}function a($){if($.length===0)return new Int32Array;var Z,J,ae=2;for(Z=1,J=$.length;J>Z;++Z)$[Z-1]!==$[Z]&&(ae+=2);var de=new Int32Array(ae),Ee=0,we=1;for(Z=1,J=$.length;J>Z;++Z)$[Z-1]!==$[Z]?(de[Ee]=$[Z-1],de[Ee+1]=we,we=1,Ee+=2):++we;return de[Ee]=$[$.length-1],de[Ee+1]=we,de}function g($,Z){var J=$.length;Z||(Z=new $.constructor(J)),J&&(Z[0]=$[0]);for(var ae=1;J>ae;++ae)Z[ae]=$[ae]+Z[ae-1];return Z}function f($,Z){var J=$.length;Z||(Z=new $.constructor(J)),Z[0]=$[0];for(var ae=1;J>ae;++ae)Z[ae]=$[ae]-$[ae-1];return Z}function E($,Z){var J,ae,de=$ instanceof Int8Array?127:32767,Ee=-de-1,we=$.length;if(!Z){var H=0;for(J=0;we>J;++J)$[J]<de&&$[J]>Ee&&++H;Z=new Int32Array(H)}for(J=0,ae=0;we>J;){for(var fe=0;$[J]===de||$[J]===Ee;)fe+=$[J],++J;fe+=$[J],++J,Z[ae]=fe,++ae}return Z}function w($,Z){var J,ae=Z?127:32767,de=-ae-1,Ee=$.length,we=0;for(J=0;Ee>J;++J){var H=$[J];H===0?++we:H>0?(we+=Math.ceil(H/ae),H%ae===0&&(we+=1)):(we+=Math.ceil(H/de),H%de===0&&(we+=1))}var fe=Z?new Int8Array(we):new Int16Array(we),xe=0;for(J=0;Ee>J;++J){var H=$[J];if(H>=0)for(;H>=ae;)fe[xe]=ae,++xe,H-=ae;else for(;de>=H;)fe[xe]=de,++xe,H-=de;fe[xe]=H,++xe}return fe}function R($,Z){return g(n($),Z)}function z($){return a(f($))}function S($,Z,J){return o(n($,_(J)),Z,J)}function I($,Z){return a(e($,Z))}function F($,Z,J){return o(g($,_(J)),Z,J)}function G($,Z,J){return f(e($,Z),J)}function B($,Z,J){return o(E($,_(J)),Z,J)}function W($,Z,J){var ae=E($,_(J));return F(ae,Z,p(ae))}function V($,Z,J){return w(G($,Z),J)}function k(Ee){var Z=C(Ee),J=Z.getInt32(0),ae=Z.getInt32(4),de=Ee.subarray(8,12),Ee=Ee.subarray(12);return[J,Ee,ae,de]}function U($,Z,J,ae){var de=new ArrayBuffer(12+ae.byteLength),Ee=new Uint8Array(de),we=new DataView(de);return we.setInt32(0,$),we.setInt32(4,Z),J&&Ee.set(J,8),Ee.set(ae,12),Ee}function j($){var Z=$.length,J=v($);return U(2,Z,void 0,J)}function q($){var Z=$.length,J=h($);return U(4,Z,void 0,J)}function ie($,Z){var J=$.length/Z,ae=h([Z]),de=v($);return U(5,J,ae,de)}function ge($){var Z=$.length,J=h(a($));return U(6,Z,void 0,J)}function he($){var Z=$.length,J=h(z($));return U(8,Z,void 0,J)}function ve($,Z){var J=$.length,ae=h([Z]),de=h(I($,Z));return U(9,J,ae,de)}function le($,Z){var J=$.length,ae=h([Z]),de=t(V($,Z));return U(10,J,ae,de)}function se($){var Z={};return Re.forEach(function(J){$[J]!==void 0&&(Z[J]=$[J])}),$.bondAtomList&&(Z.bondAtomList=q($.bondAtomList)),$.bondOrderList&&(Z.bondOrderList=j($.bondOrderList)),Z.xCoordList=le($.xCoordList,1e3),Z.yCoordList=le($.yCoordList,1e3),Z.zCoordList=le($.zCoordList,1e3),$.bFactorList&&(Z.bFactorList=le($.bFactorList,100)),$.atomIdList&&(Z.atomIdList=he($.atomIdList)),$.altLocList&&(Z.altLocList=ge($.altLocList)),$.occupancyList&&(Z.occupancyList=ve($.occupancyList,100)),Z.groupIdList=he($.groupIdList),Z.groupTypeList=q($.groupTypeList),$.secStructList&&(Z.secStructList=j($.secStructList)),$.insCodeList&&(Z.insCodeList=ge($.insCodeList)),$.sequenceIndexList&&(Z.sequenceIndexList=he($.sequenceIndexList)),Z.chainIdList=ie($.chainIdList,4),$.chainNameList&&(Z.chainNameList=ie($.chainNameList,4)),Z}function Me($){function Z(fe){for(var xe={},Te=0;fe>Te;Te++){var ne=Ee();xe[ne]=Ee()}return xe}function J(fe){var xe=$.subarray(we,we+fe);return we+=fe,xe}function ae(fe){var xe=$.subarray(we,we+fe);we+=fe;var Te=65535;if(fe>Te){for(var ne=[],Le=0;Le<xe.length;Le+=Te)ne.push(String.fromCharCode.apply(null,xe.subarray(Le,Le+Te)));return ne.join("")}return String.fromCharCode.apply(null,xe)}function de(fe){for(var xe=new Array(fe),Te=0;fe>Te;Te++)xe[Te]=Ee();return xe}function Ee(){var fe,xe,Te=$[we];if(!(128&Te))return we++,Te;if((240&Te)===128)return xe=15&Te,we++,Z(xe);if((240&Te)===144)return xe=15&Te,we++,de(xe);if((224&Te)===160)return xe=31&Te,we++,ae(xe);if((224&Te)===224)return fe=H.getInt8(we),we++,fe;switch(Te){case 192:return we++,null;case 194:return we++,!1;case 195:return we++,!0;case 196:return xe=H.getUint8(we+1),we+=2,J(xe);case 197:return xe=H.getUint16(we+1),we+=3,J(xe);case 198:return xe=H.getUint32(we+1),we+=5,J(xe);case 202:return fe=H.getFloat32(we+1),we+=5,fe;case 203:return fe=H.getFloat64(we+1),we+=9,fe;case 204:return fe=$[we+1],we+=2,fe;case 205:return fe=H.getUint16(we+1),we+=3,fe;case 206:return fe=H.getUint32(we+1),we+=5,fe;case 208:return fe=H.getInt8(we+1),we+=2,fe;case 209:return fe=H.getInt16(we+1),we+=3,fe;case 210:return fe=H.getInt32(we+1),we+=5,fe;case 217:return xe=H.getUint8(we+1),we+=2,ae(xe);case 218:return xe=H.getUint16(we+1),we+=3,ae(xe);case 219:return xe=H.getUint32(we+1),we+=5,ae(xe);case 220:return xe=H.getUint16(we+1),we+=3,de(xe);case 221:return xe=H.getUint32(we+1),we+=5,de(xe);case 222:return xe=H.getUint16(we+1),we+=3,Z(xe);case 223:return xe=H.getUint32(we+1),we+=5,Z(xe)}throw new Error("Unknown type 0x"+Te.toString(16))}var we=0,H=new DataView($.buffer);return Ee()}function be($,Z,J,ae){switch($){case 1:return s(Z);case 2:return M(Z);case 3:return x(Z);case 4:return r(Z);case 5:return v(Z);case 6:return n(r(Z),new Uint8Array(J));case 7:return n(r(Z));case 8:return R(r(Z));case 9:return S(r(Z),r(ae)[0]);case 10:return W(x(Z),r(ae)[0]);case 11:return o(x(Z),r(ae)[0]);case 12:return B(x(Z),r(ae)[0]);case 13:return B(M(Z),r(ae)[0]);case 14:return E(x(Z));case 15:return E(M(Z))}}function Pe($,Z){Z=Z||{};var J=Z.ignoreFields,ae={};return Ie.forEach(function(de){var Ee=J?J.indexOf(de)!==-1:!1,we=$[de];Ee||we===void 0||(we instanceof Uint8Array?ae[de]=be.apply(null,k(we)):ae[de]=we)}),ae}function ce($){return String.fromCharCode.apply(null,$).replace(/\0/g,"")}function me($,Z,J){J=J||{};var ae,de,Ee,we,H,fe,xe=J.firstModelOnly,Te=Z.onModel,ne=Z.onChain,Le=Z.onGroup,K=Z.onAtom,Oe=Z.onBond,Ne=0,O=0,pe=0,ue=0,Y=0,re=-1,ye=$.chainNameList,je=$.secStructList,He=$.insCodeList,Ve=$.sequenceIndexList,qe=$.atomIdList,Et=$.bFactorList,nt=$.altLocList,rt=$.occupancyList,tt=$.bondAtomList,yt=$.bondOrderList;for(ae=0,de=$.chainsPerModel.length;de>ae&&!(xe&&Ne>0);++ae){var vt=$.chainsPerModel[Ne];for(Te&&Te({chainCount:vt,modelIndex:Ne}),Ee=0;vt>Ee;++Ee){var Rt=$.groupsPerChain[O];if(ne){var St=ce($.chainIdList.subarray(4*O,4*O+4)),_t=null;ye&&(_t=ce(ye.subarray(4*O,4*O+4))),ne({groupCount:Rt,chainIndex:O,modelIndex:Ne,chainId:St,chainName:_t})}for(we=0;Rt>we;++we){var mt=$.groupList[$.groupTypeList[pe]],gt=mt.atomNameList.length;if(Le){var Ct=null;je&&(Ct=je[pe]);var wt=null;$.insCodeList&&(wt=String.fromCharCode(He[pe]));var Wt=null;Ve&&(Wt=Ve[pe]),Le({atomCount:gt,groupIndex:pe,chainIndex:O,modelIndex:Ne,groupId:$.groupIdList[pe],groupType:$.groupTypeList[pe],groupName:mt.groupName,singleLetterCode:mt.singleLetterCode,chemCompType:mt.chemCompType,secStruct:Ct,insCode:wt,sequenceIndex:Wt})}for(H=0;gt>H;++H){if(K){var di=null;qe&&(di=qe[ue]);var Gt=null;Et&&(Gt=Et[ue]);var ci=null;nt&&(ci=String.fromCharCode(nt[ue]));var ui=null;rt&&(ui=rt[ue]),K({atomIndex:ue,groupIndex:pe,chainIndex:O,modelIndex:Ne,atomId:di,element:mt.elementList[H],atomName:mt.atomNameList[H],formalCharge:mt.formalChargeList[H],xCoord:$.xCoordList[ue],yCoord:$.yCoordList[ue],zCoord:$.zCoordList[ue],bFactor:Gt,altLoc:ci,occupancy:ui})}ue+=1}if(Oe){var vi=mt.bondAtomList;for(H=0,fe=mt.bondOrderList.length;fe>H;++H)Oe({atomIndex1:ue-gt+vi[2*H],atomIndex2:ue-gt+vi[2*H+1],bondOrder:mt.bondOrderList[H]})}pe+=1}O+=1}if(Y=re+1,re=ue-1,Oe&&tt)for(H=0,fe=tt.length;fe>H;H+=2){var qt=tt[H],gi=tt[H+1];(qt>=Y&&re>=qt||gi>=Y&&re>=gi)&&Oe({atomIndex1:qt,atomIndex2:gi,bondOrder:yt?yt[H/2]:null})}Ne+=1}}function De($){return u(se($))}function Se($,Z){$ instanceof ArrayBuffer&&($=new Uint8Array($));var J;return J=$ instanceof Uint8Array?Me($):$,Pe(J,Z)}function Ge($,Z,J,ae){function de(){try{var we=Se(Ee.response);J(we)}catch(H){ae(H)}}var Ee=new XMLHttpRequest;Ee.addEventListener("load",de,!0),Ee.addEventListener("error",ae,!0),Ee.responseType="arraybuffer",Ee.open("GET",Z+$.toUpperCase()),Ee.send()}function ke($,Z,J){Ge($,$e,Z,J)}function ze($,Z,J){Ge($,Ye,Z,J)}var Re=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"],Be=["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"],Ie=Re.concat(Be),We="v1.0.1",Fe="//mmtf.rcsb.org/v1.0/",$e=Fe+"full/",Ye=Fe+"reduced/";c.encode=De,c.decode=Se,c.traverse=me,c.fetch=ke,c.fetchReduced=ze,c.version=We,c.fetchUrl=$e,c.fetchReducedUrl=Ye,c.encodeMsgpack=u,c.encodeMmtf=se,c.decodeMsgpack=Me,c.decodeMmtf=Pe})},"./node_modules/pako/dist/pako.esm.mjs":(X,L,c)=>{c.r(L),c.d(L,{Deflate:()=>Nr,Inflate:()=>Hr,constants:()=>Xr,default:()=>Hs,deflate:()=>Vr,deflateRaw:()=>kr,gzip:()=>jr,inflate:()=>Kr,inflateRaw:()=>Zr,ungzip:()=>Yr});/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const A=4,T=0,D=1,P=2;function u(l){let N=l.length;for(;--N>=0;)l[N]=0}const y=0,C=1,v=2,M=3,_=258,p=29,x=256,t=x+1+p,r=30,h=19,s=2*t+1,o=15,e=16,n=7,a=256,g=16,f=17,E=18,w=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),R=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),z=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),S=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),I=512,F=new Array((t+2)*2);u(F);const G=new Array(r*2);u(G);const B=new Array(I);u(B);const W=new Array(_-M+1);u(W);const V=new Array(p);u(V);const k=new Array(r);u(k);function U(l,N,b,Q,te){this.static_tree=l,this.extra_bits=N,this.extra_base=b,this.elems=Q,this.max_length=te,this.has_stree=l&&l.length}let j,q,ie;function ge(l,N){this.dyn_tree=l,this.max_code=0,this.stat_desc=N}const he=l=>l<256?B[l]:B[256+(l>>>7)],ve=(l,N)=>{l.pending_buf[l.pending++]=N&255,l.pending_buf[l.pending++]=N>>>8&255},le=(l,N,b)=>{l.bi_valid>e-b?(l.bi_buf|=N<<l.bi_valid&65535,ve(l,l.bi_buf),l.bi_buf=N>>e-l.bi_valid,l.bi_valid+=b-e):(l.bi_buf|=N<<l.bi_valid&65535,l.bi_valid+=b)},se=(l,N,b)=>{le(l,b[N*2],b[N*2+1])},Me=(l,N)=>{let b=0;do b|=l&1,l>>>=1,b<<=1;while(--N>0);return b>>>1},be=l=>{l.bi_valid===16?(ve(l,l.bi_buf),l.bi_buf=0,l.bi_valid=0):l.bi_valid>=8&&(l.pending_buf[l.pending++]=l.bi_buf&255,l.bi_buf>>=8,l.bi_valid-=8)},Pe=(l,N)=>{const b=N.dyn_tree,Q=N.max_code,te=N.stat_desc.static_tree,ee=N.stat_desc.has_stree,Ae=N.stat_desc.extra_bits,_e=N.stat_desc.extra_base,Xe=N.stat_desc.max_length;let oe,Ce,ft,Ze,Ue,Qe,bt=0;for(Ze=0;Ze<=o;Ze++)l.bl_count[Ze]=0;for(b[l.heap[l.heap_max]*2+1]=0,oe=l.heap_max+1;oe<s;oe++)Ce=l.heap[oe],Ze=b[b[Ce*2+1]*2+1]+1,Ze>Xe&&(Ze=Xe,bt++),b[Ce*2+1]=Ze,!(Ce>Q)&&(l.bl_count[Ze]++,Ue=0,Ce>=_e&&(Ue=Ae[Ce-_e]),Qe=b[Ce*2],l.opt_len+=Qe*(Ze+Ue),ee&&(l.static_len+=Qe*(te[Ce*2+1]+Ue)));if(bt!==0){do{for(Ze=Xe-1;l.bl_count[Ze]===0;)Ze--;l.bl_count[Ze]--,l.bl_count[Ze+1]+=2,l.bl_count[Xe]--,bt-=2}while(bt>0);for(Ze=Xe;Ze!==0;Ze--)for(Ce=l.bl_count[Ze];Ce!==0;)ft=l.heap[--oe],!(ft>Q)&&(b[ft*2+1]!==Ze&&(l.opt_len+=(Ze-b[ft*2+1])*b[ft*2],b[ft*2+1]=Ze),Ce--)}},ce=(l,N,b)=>{const Q=new Array(o+1);let te=0,ee,Ae;for(ee=1;ee<=o;ee++)te=te+b[ee-1]<<1,Q[ee]=te;for(Ae=0;Ae<=N;Ae++){let _e=l[Ae*2+1];_e!==0&&(l[Ae*2]=Me(Q[_e]++,_e))}},me=()=>{let l,N,b,Q,te;const ee=new Array(o+1);for(b=0,Q=0;Q<p-1;Q++)for(V[Q]=b,l=0;l<1<<w[Q];l++)W[b++]=Q;for(W[b-1]=Q,te=0,Q=0;Q<16;Q++)for(k[Q]=te,l=0;l<1<<R[Q];l++)B[te++]=Q;for(te>>=7;Q<r;Q++)for(k[Q]=te<<7,l=0;l<1<<R[Q]-7;l++)B[256+te++]=Q;for(N=0;N<=o;N++)ee[N]=0;for(l=0;l<=143;)F[l*2+1]=8,l++,ee[8]++;for(;l<=255;)F[l*2+1]=9,l++,ee[9]++;for(;l<=279;)F[l*2+1]=7,l++,ee[7]++;for(;l<=287;)F[l*2+1]=8,l++,ee[8]++;for(ce(F,t+1,ee),l=0;l<r;l++)G[l*2+1]=5,G[l*2]=Me(l,5);j=new U(F,w,x+1,t,o),q=new U(G,R,0,r,o),ie=new U(new Array(0),z,0,h,n)},De=l=>{let N;for(N=0;N<t;N++)l.dyn_ltree[N*2]=0;for(N=0;N<r;N++)l.dyn_dtree[N*2]=0;for(N=0;N<h;N++)l.bl_tree[N*2]=0;l.dyn_ltree[a*2]=1,l.opt_len=l.static_len=0,l.sym_next=l.matches=0},Se=l=>{l.bi_valid>8?ve(l,l.bi_buf):l.bi_valid>0&&(l.pending_buf[l.pending++]=l.bi_buf),l.bi_buf=0,l.bi_valid=0},Ge=(l,N,b,Q)=>{const te=N*2,ee=b*2;return l[te]<l[ee]||l[te]===l[ee]&&Q[N]<=Q[b]},ke=(l,N,b)=>{const Q=l.heap[b];let te=b<<1;for(;te<=l.heap_len&&(te<l.heap_len&&Ge(N,l.heap[te+1],l.heap[te],l.depth)&&te++,!Ge(N,Q,l.heap[te],l.depth));)l.heap[b]=l.heap[te],b=te,te<<=1;l.heap[b]=Q},ze=(l,N,b)=>{let Q,te,ee=0,Ae,_e;if(l.sym_next!==0)do Q=l.pending_buf[l.sym_buf+ee++]&255,Q+=(l.pending_buf[l.sym_buf+ee++]&255)<<8,te=l.pending_buf[l.sym_buf+ee++],Q===0?se(l,te,N):(Ae=W[te],se(l,Ae+x+1,N),_e=w[Ae],_e!==0&&(te-=V[Ae],le(l,te,_e)),Q--,Ae=he(Q),se(l,Ae,b),_e=R[Ae],_e!==0&&(Q-=k[Ae],le(l,Q,_e)));while(ee<l.sym_next);se(l,a,N)},Re=(l,N)=>{const b=N.dyn_tree,Q=N.stat_desc.static_tree,te=N.stat_desc.has_stree,ee=N.stat_desc.elems;let Ae,_e,Xe=-1,oe;for(l.heap_len=0,l.heap_max=s,Ae=0;Ae<ee;Ae++)b[Ae*2]!==0?(l.heap[++l.heap_len]=Xe=Ae,l.depth[Ae]=0):b[Ae*2+1]=0;for(;l.heap_len<2;)oe=l.heap[++l.heap_len]=Xe<2?++Xe:0,b[oe*2]=1,l.depth[oe]=0,l.opt_len--,te&&(l.static_len-=Q[oe*2+1]);for(N.max_code=Xe,Ae=l.heap_len>>1;Ae>=1;Ae--)ke(l,b,Ae);oe=ee;do Ae=l.heap[1],l.heap[1]=l.heap[l.heap_len--],ke(l,b,1),_e=l.heap[1],l.heap[--l.heap_max]=Ae,l.heap[--l.heap_max]=_e,b[oe*2]=b[Ae*2]+b[_e*2],l.depth[oe]=(l.depth[Ae]>=l.depth[_e]?l.depth[Ae]:l.depth[_e])+1,b[Ae*2+1]=b[_e*2+1]=oe,l.heap[1]=oe++,ke(l,b,1);while(l.heap_len>=2);l.heap[--l.heap_max]=l.heap[1],Pe(l,N),ce(b,Xe,l.bl_count)},Be=(l,N,b)=>{let Q,te=-1,ee,Ae=N[0*2+1],_e=0,Xe=7,oe=4;for(Ae===0&&(Xe=138,oe=3),N[(b+1)*2+1]=65535,Q=0;Q<=b;Q++)ee=Ae,Ae=N[(Q+1)*2+1],!(++_e<Xe&&ee===Ae)&&(_e<oe?l.bl_tree[ee*2]+=_e:ee!==0?(ee!==te&&l.bl_tree[ee*2]++,l.bl_tree[g*2]++):_e<=10?l.bl_tree[f*2]++:l.bl_tree[E*2]++,_e=0,te=ee,Ae===0?(Xe=138,oe=3):ee===Ae?(Xe=6,oe=3):(Xe=7,oe=4))},Ie=(l,N,b)=>{let Q,te=-1,ee,Ae=N[0*2+1],_e=0,Xe=7,oe=4;for(Ae===0&&(Xe=138,oe=3),Q=0;Q<=b;Q++)if(ee=Ae,Ae=N[(Q+1)*2+1],!(++_e<Xe&&ee===Ae)){if(_e<oe)do se(l,ee,l.bl_tree);while(--_e!==0);else ee!==0?(ee!==te&&(se(l,ee,l.bl_tree),_e--),se(l,g,l.bl_tree),le(l,_e-3,2)):_e<=10?(se(l,f,l.bl_tree),le(l,_e-3,3)):(se(l,E,l.bl_tree),le(l,_e-11,7));_e=0,te=ee,Ae===0?(Xe=138,oe=3):ee===Ae?(Xe=6,oe=3):(Xe=7,oe=4)}},We=l=>{let N;for(Be(l,l.dyn_ltree,l.l_desc.max_code),Be(l,l.dyn_dtree,l.d_desc.max_code),Re(l,l.bl_desc),N=h-1;N>=3&&l.bl_tree[S[N]*2+1]===0;N--);return l.opt_len+=3*(N+1)+5+5+4,N},Fe=(l,N,b,Q)=>{let te;for(le(l,N-257,5),le(l,b-1,5),le(l,Q-4,4),te=0;te<Q;te++)le(l,l.bl_tree[S[te]*2+1],3);Ie(l,l.dyn_ltree,N-1),Ie(l,l.dyn_dtree,b-1)},$e=l=>{let N=4093624447,b;for(b=0;b<=31;b++,N>>>=1)if(N&1&&l.dyn_ltree[b*2]!==0)return T;if(l.dyn_ltree[9*2]!==0||l.dyn_ltree[10*2]!==0||l.dyn_ltree[13*2]!==0)return D;for(b=32;b<x;b++)if(l.dyn_ltree[b*2]!==0)return D;return T};let Ye=!1;const $=l=>{Ye||(me(),Ye=!0),l.l_desc=new ge(l.dyn_ltree,j),l.d_desc=new ge(l.dyn_dtree,q),l.bl_desc=new ge(l.bl_tree,ie),l.bi_buf=0,l.bi_valid=0,De(l)},Z=(l,N,b,Q)=>{le(l,(y<<1)+(Q?1:0),3),Se(l),ve(l,b),ve(l,~b),b&&l.pending_buf.set(l.window.subarray(N,N+b),l.pending),l.pending+=b},J=l=>{le(l,C<<1,3),se(l,a,F),be(l)},ae=(l,N,b,Q)=>{let te,ee,Ae=0;l.level>0?(l.strm.data_type===P&&(l.strm.data_type=$e(l)),Re(l,l.l_desc),Re(l,l.d_desc),Ae=We(l),te=l.opt_len+3+7>>>3,ee=l.static_len+3+7>>>3,ee<=te&&(te=ee)):te=ee=b+5,b+4<=te&&N!==-1?Z(l,N,b,Q):l.strategy===A||ee===te?(le(l,(C<<1)+(Q?1:0),3),ze(l,F,G)):(le(l,(v<<1)+(Q?1:0),3),Fe(l,l.l_desc.max_code+1,l.d_desc.max_code+1,Ae+1),ze(l,l.dyn_ltree,l.dyn_dtree)),De(l),Q&&Se(l)},de=(l,N,b)=>(l.pending_buf[l.sym_buf+l.sym_next++]=N,l.pending_buf[l.sym_buf+l.sym_next++]=N>>8,l.pending_buf[l.sym_buf+l.sym_next++]=b,N===0?l.dyn_ltree[b*2]++:(l.matches++,N--,l.dyn_ltree[(W[b]+x+1)*2]++,l.dyn_dtree[he(N)*2]++),l.sym_next===l.sym_end);var Ee=$,we=Z,H=ae,fe=de,xe=J,Te={_tr_init:Ee,_tr_stored_block:we,_tr_flush_block:H,_tr_tally:fe,_tr_align:xe},Le=(l,N,b,Q)=>{let te=l&65535|0,ee=l>>>16&65535|0,Ae=0;for(;b!==0;){Ae=b>2e3?2e3:b,b-=Ae;do te=te+N[Q++]|0,ee=ee+te|0;while(--Ae);te%=65521,ee%=65521}return te|ee<<16|0};const K=()=>{let l,N=[];for(var b=0;b<256;b++){l=b;for(var Q=0;Q<8;Q++)l=l&1?3988292384^l>>>1:l>>>1;N[b]=l}return N},Oe=new Uint32Array(K());var O=(l,N,b,Q)=>{const te=Oe,ee=Q+b;l^=-1;for(let Ae=Q;Ae<ee;Ae++)l=l>>>8^te[(l^N[Ae])&255];return l^-1},pe={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},ue={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Y,_tr_stored_block:re,_tr_flush_block:ye,_tr_tally:je,_tr_align:He}=Te,{Z_NO_FLUSH:Ve,Z_PARTIAL_FLUSH:qe,Z_FULL_FLUSH:Et,Z_FINISH:nt,Z_BLOCK:rt,Z_OK:tt,Z_STREAM_END:yt,Z_STREAM_ERROR:vt,Z_DATA_ERROR:Rt,Z_BUF_ERROR:St,Z_DEFAULT_COMPRESSION:_t,Z_FILTERED:mt,Z_HUFFMAN_ONLY:gt,Z_RLE:Ct,Z_FIXED:wt,Z_DEFAULT_STRATEGY:Wt,Z_UNKNOWN:di,Z_DEFLATED:Gt}=ue,ci=9,ui=15,vi=8,qt=29,Ci=256+1+qt,Qr=30,Jr=19,qr=2*Ci+1,en=15,at=3,Bt=258,Tt=Bt+at+1,tn=32,Zt=42,Li=57,Di=69,Oi=73,Si=91,Ti=103,Nt=113,ei=666,At=1,Yt=2,Vt=3,Xt=4,rn=3,kt=(l,N)=>(l.msg=pe[N],N),ji=l=>l*2-(l>4?9:0),Ut=l=>{let N=l.length;for(;--N>=0;)l[N]=0},nn=l=>{let N,b,Q,te=l.w_size;N=l.hash_size,Q=N;do b=l.head[--Q],l.head[Q]=b>=te?b-te:0;while(--N);N=te,Q=N;do b=l.prev[--Q],l.prev[Q]=b>=te?b-te:0;while(--N)};let Ft=(l,N,b)=>(N<<l.hash_shift^b)&l.hash_mask;const Lt=l=>{const N=l.state;let b=N.pending;b>l.avail_out&&(b=l.avail_out),b!==0&&(l.output.set(N.pending_buf.subarray(N.pending_out,N.pending_out+b),l.next_out),l.next_out+=b,N.pending_out+=b,l.total_out+=b,l.avail_out-=b,N.pending-=b,N.pending===0&&(N.pending_out=0))},Dt=(l,N)=>{ye(l,l.block_start>=0?l.block_start:-1,l.strstart-l.block_start,N),l.block_start=l.strstart,Lt(l.strm)},dt=(l,N)=>{l.pending_buf[l.pending++]=N},ti=(l,N)=>{l.pending_buf[l.pending++]=N>>>8&255,l.pending_buf[l.pending++]=N&255},Pi=(l,N,b,Q)=>{let te=l.avail_in;return te>Q&&(te=Q),te===0?0:(l.avail_in-=te,N.set(l.input.subarray(l.next_in,l.next_in+te),b),l.state.wrap===1?l.adler=Le(l.adler,N,te,b):l.state.wrap===2&&(l.adler=O(l.adler,N,te,b)),l.next_in+=te,l.total_in+=te,te)},Hi=(l,N)=>{let b=l.max_chain_length,Q=l.strstart,te,ee,Ae=l.prev_length,_e=l.nice_match;const Xe=l.strstart>l.w_size-Tt?l.strstart-(l.w_size-Tt):0,oe=l.window,Ce=l.w_mask,ft=l.prev,Ze=l.strstart+Bt;let Ue=oe[Q+Ae-1],Qe=oe[Q+Ae];l.prev_length>=l.good_match&&(b>>=2),_e>l.lookahead&&(_e=l.lookahead);do if(te=N,!(oe[te+Ae]!==Qe||oe[te+Ae-1]!==Ue||oe[te]!==oe[Q]||oe[++te]!==oe[Q+1])){Q+=2,te++;do;while(oe[++Q]===oe[++te]&&oe[++Q]===oe[++te]&&oe[++Q]===oe[++te]&&oe[++Q]===oe[++te]&&oe[++Q]===oe[++te]&&oe[++Q]===oe[++te]&&oe[++Q]===oe[++te]&&oe[++Q]===oe[++te]&&Q<Ze);if(ee=Bt-(Ze-Q),Q=Ze-Bt,ee>Ae){if(l.match_start=N,Ae=ee,ee>=_e)break;Ue=oe[Q+Ae-1],Qe=oe[Q+Ae]}}while((N=ft[N&Ce])>Xe&&--b!==0);return Ae<=l.lookahead?Ae:l.lookahead},$t=l=>{const N=l.w_size;let b,Q,te;do{if(Q=l.window_size-l.lookahead-l.strstart,l.strstart>=N+(N-Tt)&&(l.window.set(l.window.subarray(N,N+N-Q),0),l.match_start-=N,l.strstart-=N,l.block_start-=N,l.insert>l.strstart&&(l.insert=l.strstart),nn(l),Q+=N),l.strm.avail_in===0)break;if(b=Pi(l.strm,l.window,l.strstart+l.lookahead,Q),l.lookahead+=b,l.lookahead+l.insert>=at)for(te=l.strstart-l.insert,l.ins_h=l.window[te],l.ins_h=Ft(l,l.ins_h,l.window[te+1]);l.insert&&(l.ins_h=Ft(l,l.ins_h,l.window[te+at-1]),l.prev[te&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=te,te++,l.insert--,!(l.lookahead+l.insert<at)););}while(l.lookahead<Tt&&l.strm.avail_in!==0)},Ki=(l,N)=>{let b=l.pending_buf_size-5>l.w_size?l.w_size:l.pending_buf_size-5,Q,te,ee,Ae=0,_e=l.strm.avail_in;do{if(Q=65535,ee=l.bi_valid+42>>3,l.strm.avail_out<ee||(ee=l.strm.avail_out-ee,te=l.strstart-l.block_start,Q>te+l.strm.avail_in&&(Q=te+l.strm.avail_in),Q>ee&&(Q=ee),Q<b&&(Q===0&&N!==nt||N===Ve||Q!==te+l.strm.avail_in)))break;Ae=N===nt&&Q===te+l.strm.avail_in?1:0,re(l,0,0,Ae),l.pending_buf[l.pending-4]=Q,l.pending_buf[l.pending-3]=Q>>8,l.pending_buf[l.pending-2]=~Q,l.pending_buf[l.pending-1]=~Q>>8,Lt(l.strm),te&&(te>Q&&(te=Q),l.strm.output.set(l.window.subarray(l.block_start,l.block_start+te),l.strm.next_out),l.strm.next_out+=te,l.strm.avail_out-=te,l.strm.total_out+=te,l.block_start+=te,Q-=te),Q&&(Pi(l.strm,l.strm.output,l.strm.next_out,Q),l.strm.next_out+=Q,l.strm.avail_out-=Q,l.strm.total_out+=Q)}while(Ae===0);return _e-=l.strm.avail_in,_e&&(_e>=l.w_size?(l.matches=2,l.window.set(l.strm.input.subarray(l.strm.next_in-l.w_size,l.strm.next_in),0),l.strstart=l.w_size,l.insert=l.strstart):(l.window_size-l.strstart<=_e&&(l.strstart-=l.w_size,l.window.set(l.window.subarray(l.w_size,l.w_size+l.strstart),0),l.matches<2&&l.matches++,l.insert>l.strstart&&(l.insert=l.strstart)),l.window.set(l.strm.input.subarray(l.strm.next_in-_e,l.strm.next_in),l.strstart),l.strstart+=_e,l.insert+=_e>l.w_size-l.insert?l.w_size-l.insert:_e),l.block_start=l.strstart),l.high_water<l.strstart&&(l.high_water=l.strstart),Ae?Xt:N!==Ve&&N!==nt&&l.strm.avail_in===0&&l.strstart===l.block_start?Yt:(ee=l.window_size-l.strstart,l.strm.avail_in>ee&&l.block_start>=l.w_size&&(l.block_start-=l.w_size,l.strstart-=l.w_size,l.window.set(l.window.subarray(l.w_size,l.w_size+l.strstart),0),l.matches<2&&l.matches++,ee+=l.w_size,l.insert>l.strstart&&(l.insert=l.strstart)),ee>l.strm.avail_in&&(ee=l.strm.avail_in),ee&&(Pi(l.strm,l.window,l.strstart,ee),l.strstart+=ee,l.insert+=ee>l.w_size-l.insert?l.w_size-l.insert:ee),l.high_water<l.strstart&&(l.high_water=l.strstart),ee=l.bi_valid+42>>3,ee=l.pending_buf_size-ee>65535?65535:l.pending_buf_size-ee,b=ee>l.w_size?l.w_size:ee,te=l.strstart-l.block_start,(te>=b||(te||N===nt)&&N!==Ve&&l.strm.avail_in===0&&te<=ee)&&(Q=te>ee?ee:te,Ae=N===nt&&l.strm.avail_in===0&&Q===te?1:0,re(l,l.block_start,Q,Ae),l.block_start+=Q,Lt(l.strm)),Ae?Vt:At)},Ri=(l,N)=>{let b,Q;for(;;){if(l.lookahead<Tt){if($t(l),l.lookahead<Tt&&N===Ve)return At;if(l.lookahead===0)break}if(b=0,l.lookahead>=at&&(l.ins_h=Ft(l,l.ins_h,l.window[l.strstart+at-1]),b=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),b!==0&&l.strstart-b<=l.w_size-Tt&&(l.match_length=Hi(l,b)),l.match_length>=at)if(Q=je(l,l.strstart-l.match_start,l.match_length-at),l.lookahead-=l.match_length,l.match_length<=l.max_lazy_match&&l.lookahead>=at){l.match_length--;do l.strstart++,l.ins_h=Ft(l,l.ins_h,l.window[l.strstart+at-1]),b=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart;while(--l.match_length!==0);l.strstart++}else l.strstart+=l.match_length,l.match_length=0,l.ins_h=l.window[l.strstart],l.ins_h=Ft(l,l.ins_h,l.window[l.strstart+1]);else Q=je(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++;if(Q&&(Dt(l,!1),l.strm.avail_out===0))return At}return l.insert=l.strstart<at-1?l.strstart:at-1,N===nt?(Dt(l,!0),l.strm.avail_out===0?Vt:Xt):l.sym_next&&(Dt(l,!1),l.strm.avail_out===0)?At:Yt},Qt=(l,N)=>{let b,Q,te;for(;;){if(l.lookahead<Tt){if($t(l),l.lookahead<Tt&&N===Ve)return At;if(l.lookahead===0)break}if(b=0,l.lookahead>=at&&(l.ins_h=Ft(l,l.ins_h,l.window[l.strstart+at-1]),b=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),l.prev_length=l.match_length,l.prev_match=l.match_start,l.match_length=at-1,b!==0&&l.prev_length<l.max_lazy_match&&l.strstart-b<=l.w_size-Tt&&(l.match_length=Hi(l,b),l.match_length<=5&&(l.strategy===mt||l.match_length===at&&l.strstart-l.match_start>4096)&&(l.match_length=at-1)),l.prev_length>=at&&l.match_length<=l.prev_length){te=l.strstart+l.lookahead-at,Q=je(l,l.strstart-1-l.prev_match,l.prev_length-at),l.lookahead-=l.prev_length-1,l.prev_length-=2;do++l.strstart<=te&&(l.ins_h=Ft(l,l.ins_h,l.window[l.strstart+at-1]),b=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart);while(--l.prev_length!==0);if(l.match_available=0,l.match_length=at-1,l.strstart++,Q&&(Dt(l,!1),l.strm.avail_out===0))return At}else if(l.match_available){if(Q=je(l,0,l.window[l.strstart-1]),Q&&Dt(l,!1),l.strstart++,l.lookahead--,l.strm.avail_out===0)return At}else l.match_available=1,l.strstart++,l.lookahead--}return l.match_available&&(Q=je(l,0,l.window[l.strstart-1]),l.match_available=0),l.insert=l.strstart<at-1?l.strstart:at-1,N===nt?(Dt(l,!0),l.strm.avail_out===0?Vt:Xt):l.sym_next&&(Dt(l,!1),l.strm.avail_out===0)?At:Yt},sn=(l,N)=>{let b,Q,te,ee;const Ae=l.window;for(;;){if(l.lookahead<=Bt){if($t(l),l.lookahead<=Bt&&N===Ve)return At;if(l.lookahead===0)break}if(l.match_length=0,l.lookahead>=at&&l.strstart>0&&(te=l.strstart-1,Q=Ae[te],Q===Ae[++te]&&Q===Ae[++te]&&Q===Ae[++te])){ee=l.strstart+Bt;do;while(Q===Ae[++te]&&Q===Ae[++te]&&Q===Ae[++te]&&Q===Ae[++te]&&Q===Ae[++te]&&Q===Ae[++te]&&Q===Ae[++te]&&Q===Ae[++te]&&te<ee);l.match_length=Bt-(ee-te),l.match_length>l.lookahead&&(l.match_length=l.lookahead)}if(l.match_length>=at?(b=je(l,1,l.match_length-at),l.lookahead-=l.match_length,l.strstart+=l.match_length,l.match_length=0):(b=je(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++),b&&(Dt(l,!1),l.strm.avail_out===0))return At}return l.insert=0,N===nt?(Dt(l,!0),l.strm.avail_out===0?Vt:Xt):l.sym_next&&(Dt(l,!1),l.strm.avail_out===0)?At:Yt},an=(l,N)=>{let b;for(;;){if(l.lookahead===0&&($t(l),l.lookahead===0)){if(N===Ve)return At;break}if(l.match_length=0,b=je(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++,b&&(Dt(l,!1),l.strm.avail_out===0))return At}return l.insert=0,N===nt?(Dt(l,!0),l.strm.avail_out===0?Vt:Xt):l.sym_next&&(Dt(l,!1),l.strm.avail_out===0)?At:Yt};function Pt(l,N,b,Q,te){this.good_length=l,this.max_lazy=N,this.nice_length=b,this.max_chain=Q,this.func=te}const ii=[new Pt(0,0,0,0,Ki),new Pt(4,4,8,4,Ri),new Pt(4,5,16,8,Ri),new Pt(4,6,32,32,Ri),new Pt(4,4,16,16,Qt),new Pt(8,16,32,32,Qt),new Pt(8,16,128,128,Qt),new Pt(8,32,128,256,Qt),new Pt(32,128,258,1024,Qt),new Pt(32,258,258,4096,Qt)],on=l=>{l.window_size=2*l.w_size,Ut(l.head),l.max_lazy_match=ii[l.level].max_lazy,l.good_match=ii[l.level].good_length,l.nice_match=ii[l.level].nice_length,l.max_chain_length=ii[l.level].max_chain,l.strstart=0,l.block_start=0,l.lookahead=0,l.insert=0,l.match_length=l.prev_length=at-1,l.match_available=0,l.ins_h=0};function ln(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Gt,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(qr*2),this.dyn_dtree=new Uint16Array((2*Qr+1)*2),this.bl_tree=new Uint16Array((2*Jr+1)*2),Ut(this.dyn_ltree),Ut(this.dyn_dtree),Ut(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(en+1),this.heap=new Uint16Array(2*Ci+1),Ut(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Ci+1),Ut(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const ri=l=>{if(!l)return 1;const N=l.state;return!N||N.strm!==l||N.status!==Zt&&N.status!==Li&&N.status!==Di&&N.status!==Oi&&N.status!==Si&&N.status!==Ti&&N.status!==Nt&&N.status!==ei?1:0},Zi=l=>{if(ri(l))return kt(l,vt);l.total_in=l.total_out=0,l.data_type=di;const N=l.state;return N.pending=0,N.pending_out=0,N.wrap<0&&(N.wrap=-N.wrap),N.status=N.wrap===2?Li:N.wrap?Zt:Nt,l.adler=N.wrap===2?0:1,N.last_flush=-2,Y(N),tt},Yi=l=>{const N=Zi(l);return N===tt&&on(l.state),N},hn=(l,N)=>ri(l)||l.state.wrap!==2?vt:(l.state.gzhead=N,tt),Xi=(l,N,b,Q,te,ee)=>{if(!l)return vt;let Ae=1;if(N===_t&&(N=6),Q<0?(Ae=0,Q=-Q):Q>15&&(Ae=2,Q-=16),te<1||te>ci||b!==Gt||Q<8||Q>15||N<0||N>9||ee<0||ee>wt||Q===8&&Ae!==1)return kt(l,vt);Q===8&&(Q=9);const _e=new ln;return l.state=_e,_e.strm=l,_e.status=Zt,_e.wrap=Ae,_e.gzhead=null,_e.w_bits=Q,_e.w_size=1<<_e.w_bits,_e.w_mask=_e.w_size-1,_e.hash_bits=te+7,_e.hash_size=1<<_e.hash_bits,_e.hash_mask=_e.hash_size-1,_e.hash_shift=~~((_e.hash_bits+at-1)/at),_e.window=new Uint8Array(_e.w_size*2),_e.head=new Uint16Array(_e.hash_size),_e.prev=new Uint16Array(_e.w_size),_e.lit_bufsize=1<<te+6,_e.pending_buf_size=_e.lit_bufsize*4,_e.pending_buf=new Uint8Array(_e.pending_buf_size),_e.sym_buf=_e.lit_bufsize,_e.sym_end=(_e.lit_bufsize-1)*3,_e.level=N,_e.strategy=ee,_e.method=b,Yi(l)},fn=(l,N)=>Xi(l,N,Gt,ui,vi,Wt),dn=(l,N)=>{if(ri(l)||N>rt||N<0)return l?kt(l,vt):vt;const b=l.state;if(!l.output||l.avail_in!==0&&!l.input||b.status===ei&&N!==nt)return kt(l,l.avail_out===0?St:vt);const Q=b.last_flush;if(b.last_flush=N,b.pending!==0){if(Lt(l),l.avail_out===0)return b.last_flush=-1,tt}else if(l.avail_in===0&&ji(N)<=ji(Q)&&N!==nt)return kt(l,St);if(b.status===ei&&l.avail_in!==0)return kt(l,St);if(b.status===Zt&&b.wrap===0&&(b.status=Nt),b.status===Zt){let te=Gt+(b.w_bits-8<<4)<<8,ee=-1;if(b.strategy>=gt||b.level<2?ee=0:b.level<6?ee=1:b.level===6?ee=2:ee=3,te|=ee<<6,b.strstart!==0&&(te|=tn),te+=31-te%31,ti(b,te),b.strstart!==0&&(ti(b,l.adler>>>16),ti(b,l.adler&65535)),l.adler=1,b.status=Nt,Lt(l),b.pending!==0)return b.last_flush=-1,tt}if(b.status===Li){if(l.adler=0,dt(b,31),dt(b,139),dt(b,8),b.gzhead)dt(b,(b.gzhead.text?1:0)+(b.gzhead.hcrc?2:0)+(b.gzhead.extra?4:0)+(b.gzhead.name?8:0)+(b.gzhead.comment?16:0)),dt(b,b.gzhead.time&255),dt(b,b.gzhead.time>>8&255),dt(b,b.gzhead.time>>16&255),dt(b,b.gzhead.time>>24&255),dt(b,b.level===9?2:b.strategy>=gt||b.level<2?4:0),dt(b,b.gzhead.os&255),b.gzhead.extra&&b.gzhead.extra.length&&(dt(b,b.gzhead.extra.length&255),dt(b,b.gzhead.extra.length>>8&255)),b.gzhead.hcrc&&(l.adler=O(l.adler,b.pending_buf,b.pending,0)),b.gzindex=0,b.status=Di;else if(dt(b,0),dt(b,0),dt(b,0),dt(b,0),dt(b,0),dt(b,b.level===9?2:b.strategy>=gt||b.level<2?4:0),dt(b,rn),b.status=Nt,Lt(l),b.pending!==0)return b.last_flush=-1,tt}if(b.status===Di){if(b.gzhead.extra){let te=b.pending,ee=(b.gzhead.extra.length&65535)-b.gzindex;for(;b.pending+ee>b.pending_buf_size;){let _e=b.pending_buf_size-b.pending;if(b.pending_buf.set(b.gzhead.extra.subarray(b.gzindex,b.gzindex+_e),b.pending),b.pending=b.pending_buf_size,b.gzhead.hcrc&&b.pending>te&&(l.adler=O(l.adler,b.pending_buf,b.pending-te,te)),b.gzindex+=_e,Lt(l),b.pending!==0)return b.last_flush=-1,tt;te=0,ee-=_e}let Ae=new Uint8Array(b.gzhead.extra);b.pending_buf.set(Ae.subarray(b.gzindex,b.gzindex+ee),b.pending),b.pending+=ee,b.gzhead.hcrc&&b.pending>te&&(l.adler=O(l.adler,b.pending_buf,b.pending-te,te)),b.gzindex=0}b.status=Oi}if(b.status===Oi){if(b.gzhead.name){let te=b.pending,ee;do{if(b.pending===b.pending_buf_size){if(b.gzhead.hcrc&&b.pending>te&&(l.adler=O(l.adler,b.pending_buf,b.pending-te,te)),Lt(l),b.pending!==0)return b.last_flush=-1,tt;te=0}b.gzindex<b.gzhead.name.length?ee=b.gzhead.name.charCodeAt(b.gzindex++)&255:ee=0,dt(b,ee)}while(ee!==0);b.gzhead.hcrc&&b.pending>te&&(l.adler=O(l.adler,b.pending_buf,b.pending-te,te)),b.gzindex=0}b.status=Si}if(b.status===Si){if(b.gzhead.comment){let te=b.pending,ee;do{if(b.pending===b.pending_buf_size){if(b.gzhead.hcrc&&b.pending>te&&(l.adler=O(l.adler,b.pending_buf,b.pending-te,te)),Lt(l),b.pending!==0)return b.last_flush=-1,tt;te=0}b.gzindex<b.gzhead.comment.length?ee=b.gzhead.comment.charCodeAt(b.gzindex++)&255:ee=0,dt(b,ee)}while(ee!==0);b.gzhead.hcrc&&b.pending>te&&(l.adler=O(l.adler,b.pending_buf,b.pending-te,te))}b.status=Ti}if(b.status===Ti){if(b.gzhead.hcrc){if(b.pending+2>b.pending_buf_size&&(Lt(l),b.pending!==0))return b.last_flush=-1,tt;dt(b,l.adler&255),dt(b,l.adler>>8&255),l.adler=0}if(b.status=Nt,Lt(l),b.pending!==0)return b.last_flush=-1,tt}if(l.avail_in!==0||b.lookahead!==0||N!==Ve&&b.status!==ei){let te=b.level===0?Ki(b,N):b.strategy===gt?an(b,N):b.strategy===Ct?sn(b,N):ii[b.level].func(b,N);if((te===Vt||te===Xt)&&(b.status=ei),te===At||te===Vt)return l.avail_out===0&&(b.last_flush=-1),tt;if(te===Yt&&(N===qe?He(b):N!==rt&&(re(b,0,0,!1),N===Et&&(Ut(b.head),b.lookahead===0&&(b.strstart=0,b.block_start=0,b.insert=0))),Lt(l),l.avail_out===0))return b.last_flush=-1,tt}return N!==nt?tt:b.wrap<=0?yt:(b.wrap===2?(dt(b,l.adler&255),dt(b,l.adler>>8&255),dt(b,l.adler>>16&255),dt(b,l.adler>>24&255),dt(b,l.total_in&255),dt(b,l.total_in>>8&255),dt(b,l.total_in>>16&255),dt(b,l.total_in>>24&255)):(ti(b,l.adler>>>16),ti(b,l.adler&65535)),Lt(l),b.wrap>0&&(b.wrap=-b.wrap),b.pending!==0?tt:yt)},cn=l=>{if(ri(l))return vt;const N=l.state.status;return l.state=null,N===Nt?kt(l,Rt):tt},un=(l,N)=>{let b=N.length;if(ri(l))return vt;const Q=l.state,te=Q.wrap;if(te===2||te===1&&Q.status!==Zt||Q.lookahead)return vt;if(te===1&&(l.adler=Le(l.adler,N,b,0)),Q.wrap=0,b>=Q.w_size){te===0&&(Ut(Q.head),Q.strstart=0,Q.block_start=0,Q.insert=0);let Xe=new Uint8Array(Q.w_size);Xe.set(N.subarray(b-Q.w_size,b),0),N=Xe,b=Q.w_size}const ee=l.avail_in,Ae=l.next_in,_e=l.input;for(l.avail_in=b,l.next_in=0,l.input=N,$t(Q);Q.lookahead>=at;){let Xe=Q.strstart,oe=Q.lookahead-(at-1);do Q.ins_h=Ft(Q,Q.ins_h,Q.window[Xe+at-1]),Q.prev[Xe&Q.w_mask]=Q.head[Q.ins_h],Q.head[Q.ins_h]=Xe,Xe++;while(--oe);Q.strstart=Xe,Q.lookahead=at-1,$t(Q)}return Q.strstart+=Q.lookahead,Q.block_start=Q.strstart,Q.insert=Q.lookahead,Q.lookahead=0,Q.match_length=Q.prev_length=at-1,Q.match_available=0,l.next_in=Ae,l.input=_e,l.avail_in=ee,Q.wrap=te,tt};var vn=fn,gn=Xi,pn=Yi,_n=Zi,mn=hn,xn=dn,bn=cn,yn=un,En="pako deflate (from Nodeca project)",ni={deflateInit:vn,deflateInit2:gn,deflateReset:pn,deflateResetKeep:_n,deflateSetHeader:mn,deflate:xn,deflateEnd:bn,deflateSetDictionary:yn,deflateInfo:En};const Mn=(l,N)=>Object.prototype.hasOwnProperty.call(l,N);var wn=function(l){const N=Array.prototype.slice.call(arguments,1);for(;N.length;){const b=N.shift();if(b){if(typeof b!="object")throw new TypeError(b+"must be non-object");for(const Q in b)Mn(b,Q)&&(l[Q]=b[Q])}}return l},An=l=>{let N=0;for(let Q=0,te=l.length;Q<te;Q++)N+=l[Q].length;const b=new Uint8Array(N);for(let Q=0,te=0,ee=l.length;Q<ee;Q++){let Ae=l[Q];b.set(Ae,te),te+=Ae.length}return b},pi={assign:wn,flattenChunks:An};let $i=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{$i=!1}const si=new Uint8Array(256);for(let l=0;l<256;l++)si[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;si[254]=si[254]=1;var Cn=l=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(l);let N,b,Q,te,ee,Ae=l.length,_e=0;for(te=0;te<Ae;te++)b=l.charCodeAt(te),(b&64512)===55296&&te+1<Ae&&(Q=l.charCodeAt(te+1),(Q&64512)===56320&&(b=65536+(b-55296<<10)+(Q-56320),te++)),_e+=b<128?1:b<2048?2:b<65536?3:4;for(N=new Uint8Array(_e),ee=0,te=0;ee<_e;te++)b=l.charCodeAt(te),(b&64512)===55296&&te+1<Ae&&(Q=l.charCodeAt(te+1),(Q&64512)===56320&&(b=65536+(b-55296<<10)+(Q-56320),te++)),b<128?N[ee++]=b:b<2048?(N[ee++]=192|b>>>6,N[ee++]=128|b&63):b<65536?(N[ee++]=224|b>>>12,N[ee++]=128|b>>>6&63,N[ee++]=128|b&63):(N[ee++]=240|b>>>18,N[ee++]=128|b>>>12&63,N[ee++]=128|b>>>6&63,N[ee++]=128|b&63);return N};const Ln=(l,N)=>{if(N<65534&&l.subarray&&$i)return String.fromCharCode.apply(null,l.length===N?l:l.subarray(0,N));let b="";for(let Q=0;Q<N;Q++)b+=String.fromCharCode(l[Q]);return b};var Dn=(l,N)=>{const b=N||l.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(l.subarray(0,N));let Q,te;const ee=new Array(b*2);for(te=0,Q=0;Q<b;){let Ae=l[Q++];if(Ae<128){ee[te++]=Ae;continue}let _e=si[Ae];if(_e>4){ee[te++]=65533,Q+=_e-1;continue}for(Ae&=_e===2?31:_e===3?15:7;_e>1&&Q<b;)Ae=Ae<<6|l[Q++]&63,_e--;if(_e>1){ee[te++]=65533;continue}Ae<65536?ee[te++]=Ae:(Ae-=65536,ee[te++]=55296|Ae>>10&1023,ee[te++]=56320|Ae&1023)}return Ln(ee,te)},On=(l,N)=>{N=N||l.length,N>l.length&&(N=l.length);let b=N-1;for(;b>=0&&(l[b]&192)===128;)b--;return b<0||b===0?N:b+si[l[b]]>N?b:N},ai={string2buf:Cn,buf2string:Dn,utf8border:On};function Sn(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Qi=Sn;const Ji=Object.prototype.toString,{Z_NO_FLUSH:Tn,Z_SYNC_FLUSH:Pn,Z_FULL_FLUSH:Rn,Z_FINISH:In,Z_OK:_i,Z_STREAM_END:zn,Z_DEFAULT_COMPRESSION:Bn,Z_DEFAULT_STRATEGY:Un,Z_DEFLATED:Fn}=ue;function oi(l){this.options=pi.assign({level:Bn,method:Fn,chunkSize:16384,windowBits:15,memLevel:8,strategy:Un},l||{});let N=this.options;N.raw&&N.windowBits>0?N.windowBits=-N.windowBits:N.gzip&&N.windowBits>0&&N.windowBits<16&&(N.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Qi,this.strm.avail_out=0;let b=ni.deflateInit2(this.strm,N.level,N.method,N.windowBits,N.memLevel,N.strategy);if(b!==_i)throw new Error(pe[b]);if(N.header&&ni.deflateSetHeader(this.strm,N.header),N.dictionary){let Q;if(typeof N.dictionary=="string"?Q=ai.string2buf(N.dictionary):Ji.call(N.dictionary)==="[object ArrayBuffer]"?Q=new Uint8Array(N.dictionary):Q=N.dictionary,b=ni.deflateSetDictionary(this.strm,Q),b!==_i)throw new Error(pe[b]);this._dict_set=!0}}oi.prototype.push=function(l,N){const b=this.strm,Q=this.options.chunkSize;let te,ee;if(this.ended)return!1;for(N===~~N?ee=N:ee=N===!0?In:Tn,typeof l=="string"?b.input=ai.string2buf(l):Ji.call(l)==="[object ArrayBuffer]"?b.input=new Uint8Array(l):b.input=l,b.next_in=0,b.avail_in=b.input.length;;){if(b.avail_out===0&&(b.output=new Uint8Array(Q),b.next_out=0,b.avail_out=Q),(ee===Pn||ee===Rn)&&b.avail_out<=6){this.onData(b.output.subarray(0,b.next_out)),b.avail_out=0;continue}if(te=ni.deflate(b,ee),te===zn)return b.next_out>0&&this.onData(b.output.subarray(0,b.next_out)),te=ni.deflateEnd(this.strm),this.onEnd(te),this.ended=!0,te===_i;if(b.avail_out===0){this.onData(b.output);continue}if(ee>0&&b.next_out>0){this.onData(b.output.subarray(0,b.next_out)),b.avail_out=0;continue}if(b.avail_in===0)break}return!0},oi.prototype.onData=function(l){this.chunks.push(l)},oi.prototype.onEnd=function(l){l===_i&&(this.result=pi.flattenChunks(this.chunks)),this.chunks=[],this.err=l,this.msg=this.strm.msg};function Ii(l,N){const b=new oi(N);if(b.push(l,!0),b.err)throw b.msg||pe[b.err];return b.result}function Wn(l,N){return N=N||{},N.raw=!0,Ii(l,N)}function Gn(l,N){return N=N||{},N.gzip=!0,Ii(l,N)}var Nn=oi,Vn=Ii,kn=Wn,jn=Gn,Hn=ue,Kn={Deflate:Nn,deflate:Vn,deflateRaw:kn,gzip:jn,constants:Hn};const mi=16209,Zn=16191;var Yn=function(N,b){let Q,te,ee,Ae,_e,Xe,oe,Ce,ft,Ze,Ue,Qe,bt,lt,it,ut,st,Ke,ct,Mt,Je,pt,ht,et;const ot=N.state;Q=N.next_in,ht=N.input,te=Q+(N.avail_in-5),ee=N.next_out,et=N.output,Ae=ee-(b-N.avail_out),_e=ee+(N.avail_out-257),Xe=ot.dmax,oe=ot.wsize,Ce=ot.whave,ft=ot.wnext,Ze=ot.window,Ue=ot.hold,Qe=ot.bits,bt=ot.lencode,lt=ot.distcode,it=(1<<ot.lenbits)-1,ut=(1<<ot.distbits)-1;e:do{Qe<15&&(Ue+=ht[Q++]<<Qe,Qe+=8,Ue+=ht[Q++]<<Qe,Qe+=8),st=bt[Ue&it];t:for(;;){if(Ke=st>>>24,Ue>>>=Ke,Qe-=Ke,Ke=st>>>16&255,Ke===0)et[ee++]=st&65535;else if(Ke&16){ct=st&65535,Ke&=15,Ke&&(Qe<Ke&&(Ue+=ht[Q++]<<Qe,Qe+=8),ct+=Ue&(1<<Ke)-1,Ue>>>=Ke,Qe-=Ke),Qe<15&&(Ue+=ht[Q++]<<Qe,Qe+=8,Ue+=ht[Q++]<<Qe,Qe+=8),st=lt[Ue&ut];i:for(;;){if(Ke=st>>>24,Ue>>>=Ke,Qe-=Ke,Ke=st>>>16&255,Ke&16){if(Mt=st&65535,Ke&=15,Qe<Ke&&(Ue+=ht[Q++]<<Qe,Qe+=8,Qe<Ke&&(Ue+=ht[Q++]<<Qe,Qe+=8)),Mt+=Ue&(1<<Ke)-1,Mt>Xe){N.msg="invalid distance too far back",ot.mode=mi;break e}if(Ue>>>=Ke,Qe-=Ke,Ke=ee-Ae,Mt>Ke){if(Ke=Mt-Ke,Ke>Ce&&ot.sane){N.msg="invalid distance too far back",ot.mode=mi;break e}if(Je=0,pt=Ze,ft===0){if(Je+=oe-Ke,Ke<ct){ct-=Ke;do et[ee++]=Ze[Je++];while(--Ke);Je=ee-Mt,pt=et}}else if(ft<Ke){if(Je+=oe+ft-Ke,Ke-=ft,Ke<ct){ct-=Ke;do et[ee++]=Ze[Je++];while(--Ke);if(Je=0,ft<ct){Ke=ft,ct-=Ke;do et[ee++]=Ze[Je++];while(--Ke);Je=ee-Mt,pt=et}}}else if(Je+=ft-Ke,Ke<ct){ct-=Ke;do et[ee++]=Ze[Je++];while(--Ke);Je=ee-Mt,pt=et}for(;ct>2;)et[ee++]=pt[Je++],et[ee++]=pt[Je++],et[ee++]=pt[Je++],ct-=3;ct&&(et[ee++]=pt[Je++],ct>1&&(et[ee++]=pt[Je++]))}else{Je=ee-Mt;do et[ee++]=et[Je++],et[ee++]=et[Je++],et[ee++]=et[Je++],ct-=3;while(ct>2);ct&&(et[ee++]=et[Je++],ct>1&&(et[ee++]=et[Je++]))}}else if(Ke&64){N.msg="invalid distance code",ot.mode=mi;break e}else{st=lt[(st&65535)+(Ue&(1<<Ke)-1)];continue i}break}}else if(Ke&64)if(Ke&32){ot.mode=Zn;break e}else{N.msg="invalid literal/length code",ot.mode=mi;break e}else{st=bt[(st&65535)+(Ue&(1<<Ke)-1)];continue t}break}}while(Q<te&&ee<_e);ct=Qe>>3,Q-=ct,Qe-=ct<<3,Ue&=(1<<Qe)-1,N.next_in=Q,N.next_out=ee,N.avail_in=Q<te?5+(te-Q):5-(Q-te),N.avail_out=ee<_e?257+(_e-ee):257-(ee-_e),ot.hold=Ue,ot.bits=Qe};const Jt=15,qi=852,er=592,tr=0,zi=1,ir=2,Xn=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),$n=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Qn=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Jn=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var li=(l,N,b,Q,te,ee,Ae,_e)=>{const Xe=_e.bits;let oe=0,Ce=0,ft=0,Ze=0,Ue=0,Qe=0,bt=0,lt=0,it=0,ut=0,st,Ke,ct,Mt,Je,pt=null,ht;const et=new Uint16Array(Jt+1),ot=new Uint16Array(Jt+1);let Kt=null,$r,wi,Ai;for(oe=0;oe<=Jt;oe++)et[oe]=0;for(Ce=0;Ce<Q;Ce++)et[N[b+Ce]]++;for(Ue=Xe,Ze=Jt;Ze>=1&&et[Ze]===0;Ze--);if(Ue>Ze&&(Ue=Ze),Ze===0)return te[ee++]=1<<24|64<<16|0,te[ee++]=1<<24|64<<16|0,_e.bits=1,0;for(ft=1;ft<Ze&&et[ft]===0;ft++);for(Ue<ft&&(Ue=ft),lt=1,oe=1;oe<=Jt;oe++)if(lt<<=1,lt-=et[oe],lt<0)return-1;if(lt>0&&(l===tr||Ze!==1))return-1;for(ot[1]=0,oe=1;oe<Jt;oe++)ot[oe+1]=ot[oe]+et[oe];for(Ce=0;Ce<Q;Ce++)N[b+Ce]!==0&&(Ae[ot[N[b+Ce]]++]=Ce);if(l===tr?(pt=Kt=Ae,ht=20):l===zi?(pt=Xn,Kt=$n,ht=257):(pt=Qn,Kt=Jn,ht=0),ut=0,Ce=0,oe=ft,Je=ee,Qe=Ue,bt=0,ct=-1,it=1<<Ue,Mt=it-1,l===zi&&it>qi||l===ir&&it>er)return 1;for(;;){$r=oe-bt,Ae[Ce]+1<ht?(wi=0,Ai=Ae[Ce]):Ae[Ce]>=ht?(wi=Kt[Ae[Ce]-ht],Ai=pt[Ae[Ce]-ht]):(wi=96,Ai=0),st=1<<oe-bt,Ke=1<<Qe,ft=Ke;do Ke-=st,te[Je+(ut>>bt)+Ke]=$r<<24|wi<<16|Ai|0;while(Ke!==0);for(st=1<<oe-1;ut&st;)st>>=1;if(st!==0?(ut&=st-1,ut+=st):ut=0,Ce++,--et[oe]===0){if(oe===Ze)break;oe=N[b+Ae[Ce]]}if(oe>Ue&&(ut&Mt)!==ct){for(bt===0&&(bt=Ue),Je+=ft,Qe=oe-bt,lt=1<<Qe;Qe+bt<Ze&&(lt-=et[Qe+bt],!(lt<=0));)Qe++,lt<<=1;if(it+=1<<Qe,l===zi&&it>qi||l===ir&&it>er)return 1;ct=ut&Mt,te[ct]=Ue<<24|Qe<<16|Je-ee|0}}return ut!==0&&(te[Je+ut]=oe-bt<<24|64<<16|0),_e.bits=Ue,0};const qn=0,rr=1,nr=2,{Z_FINISH:sr,Z_BLOCK:es,Z_TREES:xi,Z_OK:jt,Z_STREAM_END:ts,Z_NEED_DICT:is,Z_STREAM_ERROR:Ot,Z_DATA_ERROR:ar,Z_MEM_ERROR:or,Z_BUF_ERROR:rs,Z_DEFLATED:lr}=ue,bi=16180,hr=16181,fr=16182,dr=16183,cr=16184,ur=16185,vr=16186,gr=16187,pr=16188,_r=16189,yi=16190,It=16191,Bi=16192,mr=16193,Ui=16194,xr=16195,br=16196,yr=16197,Er=16198,Ei=16199,Mi=16200,Mr=16201,wr=16202,Ar=16203,Cr=16204,Lr=16205,Fi=16206,Dr=16207,Or=16208,xt=16209,Sr=16210,Tr=16211,ns=852,ss=592,as=15,Pr=l=>(l>>>24&255)+(l>>>8&65280)+((l&65280)<<8)+((l&255)<<24);function os(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ht=l=>{if(!l)return 1;const N=l.state;return!N||N.strm!==l||N.mode<bi||N.mode>Tr?1:0},Rr=l=>{if(Ht(l))return Ot;const N=l.state;return l.total_in=l.total_out=N.total=0,l.msg="",N.wrap&&(l.adler=N.wrap&1),N.mode=bi,N.last=0,N.havedict=0,N.flags=-1,N.dmax=32768,N.head=null,N.hold=0,N.bits=0,N.lencode=N.lendyn=new Int32Array(ns),N.distcode=N.distdyn=new Int32Array(ss),N.sane=1,N.back=-1,jt},Ir=l=>{if(Ht(l))return Ot;const N=l.state;return N.wsize=0,N.whave=0,N.wnext=0,Rr(l)},zr=(l,N)=>{let b;if(Ht(l))return Ot;const Q=l.state;return N<0?(b=0,N=-N):(b=(N>>4)+5,N<48&&(N&=15)),N&&(N<8||N>15)?Ot:(Q.window!==null&&Q.wbits!==N&&(Q.window=null),Q.wrap=b,Q.wbits=N,Ir(l))},Br=(l,N)=>{if(!l)return Ot;const b=new os;l.state=b,b.strm=l,b.window=null,b.mode=bi;const Q=zr(l,N);return Q!==jt&&(l.state=null),Q},ls=l=>Br(l,as);let Ur=!0,Wi,Gi;const hs=l=>{if(Ur){Wi=new Int32Array(512),Gi=new Int32Array(32);let N=0;for(;N<144;)l.lens[N++]=8;for(;N<256;)l.lens[N++]=9;for(;N<280;)l.lens[N++]=7;for(;N<288;)l.lens[N++]=8;for(li(rr,l.lens,0,288,Wi,0,l.work,{bits:9}),N=0;N<32;)l.lens[N++]=5;li(nr,l.lens,0,32,Gi,0,l.work,{bits:5}),Ur=!1}l.lencode=Wi,l.lenbits=9,l.distcode=Gi,l.distbits=5},Fr=(l,N,b,Q)=>{let te;const ee=l.state;return ee.window===null&&(ee.wsize=1<<ee.wbits,ee.wnext=0,ee.whave=0,ee.window=new Uint8Array(ee.wsize)),Q>=ee.wsize?(ee.window.set(N.subarray(b-ee.wsize,b),0),ee.wnext=0,ee.whave=ee.wsize):(te=ee.wsize-ee.wnext,te>Q&&(te=Q),ee.window.set(N.subarray(b-Q,b-Q+te),ee.wnext),Q-=te,Q?(ee.window.set(N.subarray(b-Q,b),0),ee.wnext=Q,ee.whave=ee.wsize):(ee.wnext+=te,ee.wnext===ee.wsize&&(ee.wnext=0),ee.whave<ee.wsize&&(ee.whave+=te))),0},fs=(l,N)=>{let b,Q,te,ee,Ae,_e,Xe,oe,Ce,ft,Ze,Ue,Qe,bt,lt=0,it,ut,st,Ke,ct,Mt,Je,pt;const ht=new Uint8Array(4);let et,ot;const Kt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ht(l)||!l.output||!l.input&&l.avail_in!==0)return Ot;b=l.state,b.mode===It&&(b.mode=Bi),Ae=l.next_out,te=l.output,Xe=l.avail_out,ee=l.next_in,Q=l.input,_e=l.avail_in,oe=b.hold,Ce=b.bits,ft=_e,Ze=Xe,pt=jt;e:for(;;)switch(b.mode){case bi:if(b.wrap===0){b.mode=Bi;break}for(;Ce<16;){if(_e===0)break e;_e--,oe+=Q[ee++]<<Ce,Ce+=8}if(b.wrap&2&&oe===35615){b.wbits===0&&(b.wbits=15),b.check=0,ht[0]=oe&255,ht[1]=oe>>>8&255,b.check=O(b.check,ht,2,0),oe=0,Ce=0,b.mode=hr;break}if(b.head&&(b.head.done=!1),!(b.wrap&1)||(((oe&255)<<8)+(oe>>8))%31){l.msg="incorrect header check",b.mode=xt;break}if((oe&15)!==lr){l.msg="unknown compression method",b.mode=xt;break}if(oe>>>=4,Ce-=4,Je=(oe&15)+8,b.wbits===0&&(b.wbits=Je),Je>15||Je>b.wbits){l.msg="invalid window size",b.mode=xt;break}b.dmax=1<<b.wbits,b.flags=0,l.adler=b.check=1,b.mode=oe&512?_r:It,oe=0,Ce=0;break;case hr:for(;Ce<16;){if(_e===0)break e;_e--,oe+=Q[ee++]<<Ce,Ce+=8}if(b.flags=oe,(b.flags&255)!==lr){l.msg="unknown compression method",b.mode=xt;break}if(b.flags&57344){l.msg="unknown header flags set",b.mode=xt;break}b.head&&(b.head.text=oe>>8&1),b.flags&512&&b.wrap&4&&(ht[0]=oe&255,ht[1]=oe>>>8&255,b.check=O(b.check,ht,2,0)),oe=0,Ce=0,b.mode=fr;case fr:for(;Ce<32;){if(_e===0)break e;_e--,oe+=Q[ee++]<<Ce,Ce+=8}b.head&&(b.head.time=oe),b.flags&512&&b.wrap&4&&(ht[0]=oe&255,ht[1]=oe>>>8&255,ht[2]=oe>>>16&255,ht[3]=oe>>>24&255,b.check=O(b.check,ht,4,0)),oe=0,Ce=0,b.mode=dr;case dr:for(;Ce<16;){if(_e===0)break e;_e--,oe+=Q[ee++]<<Ce,Ce+=8}b.head&&(b.head.xflags=oe&255,b.head.os=oe>>8),b.flags&512&&b.wrap&4&&(ht[0]=oe&255,ht[1]=oe>>>8&255,b.check=O(b.check,ht,2,0)),oe=0,Ce=0,b.mode=cr;case cr:if(b.flags&1024){for(;Ce<16;){if(_e===0)break e;_e--,oe+=Q[ee++]<<Ce,Ce+=8}b.length=oe,b.head&&(b.head.extra_len=oe),b.flags&512&&b.wrap&4&&(ht[0]=oe&255,ht[1]=oe>>>8&255,b.check=O(b.check,ht,2,0)),oe=0,Ce=0}else b.head&&(b.head.extra=null);b.mode=ur;case ur:if(b.flags&1024&&(Ue=b.length,Ue>_e&&(Ue=_e),Ue&&(b.head&&(Je=b.head.extra_len-b.length,b.head.extra||(b.head.extra=new Uint8Array(b.head.extra_len)),b.head.extra.set(Q.subarray(ee,ee+Ue),Je)),b.flags&512&&b.wrap&4&&(b.check=O(b.check,Q,Ue,ee)),_e-=Ue,ee+=Ue,b.length-=Ue),b.length))break e;b.length=0,b.mode=vr;case vr:if(b.flags&2048){if(_e===0)break e;Ue=0;do Je=Q[ee+Ue++],b.head&&Je&&b.length<65536&&(b.head.name+=String.fromCharCode(Je));while(Je&&Ue<_e);if(b.flags&512&&b.wrap&4&&(b.check=O(b.check,Q,Ue,ee)),_e-=Ue,ee+=Ue,Je)break e}else b.head&&(b.head.name=null);b.length=0,b.mode=gr;case gr:if(b.flags&4096){if(_e===0)break e;Ue=0;do Je=Q[ee+Ue++],b.head&&Je&&b.length<65536&&(b.head.comment+=String.fromCharCode(Je));while(Je&&Ue<_e);if(b.flags&512&&b.wrap&4&&(b.check=O(b.check,Q,Ue,ee)),_e-=Ue,ee+=Ue,Je)break e}else b.head&&(b.head.comment=null);b.mode=pr;case pr:if(b.flags&512){for(;Ce<16;){if(_e===0)break e;_e--,oe+=Q[ee++]<<Ce,Ce+=8}if(b.wrap&4&&oe!==(b.check&65535)){l.msg="header crc mismatch",b.mode=xt;break}oe=0,Ce=0}b.head&&(b.head.hcrc=b.flags>>9&1,b.head.done=!0),l.adler=b.check=0,b.mode=It;break;case _r:for(;Ce<32;){if(_e===0)break e;_e--,oe+=Q[ee++]<<Ce,Ce+=8}l.adler=b.check=Pr(oe),oe=0,Ce=0,b.mode=yi;case yi:if(b.havedict===0)return l.next_out=Ae,l.avail_out=Xe,l.next_in=ee,l.avail_in=_e,b.hold=oe,b.bits=Ce,is;l.adler=b.check=1,b.mode=It;case It:if(N===es||N===xi)break e;case Bi:if(b.last){oe>>>=Ce&7,Ce-=Ce&7,b.mode=Fi;break}for(;Ce<3;){if(_e===0)break e;_e--,oe+=Q[ee++]<<Ce,Ce+=8}switch(b.last=oe&1,oe>>>=1,Ce-=1,oe&3){case 0:b.mode=mr;break;case 1:if(hs(b),b.mode=Ei,N===xi){oe>>>=2,Ce-=2;break e}break;case 2:b.mode=br;break;case 3:l.msg="invalid block type",b.mode=xt}oe>>>=2,Ce-=2;break;case mr:for(oe>>>=Ce&7,Ce-=Ce&7;Ce<32;){if(_e===0)break e;_e--,oe+=Q[ee++]<<Ce,Ce+=8}if((oe&65535)!==(oe>>>16^65535)){l.msg="invalid stored block lengths",b.mode=xt;break}if(b.length=oe&65535,oe=0,Ce=0,b.mode=Ui,N===xi)break e;case Ui:b.mode=xr;case xr:if(Ue=b.length,Ue){if(Ue>_e&&(Ue=_e),Ue>Xe&&(Ue=Xe),Ue===0)break e;te.set(Q.subarray(ee,ee+Ue),Ae),_e-=Ue,ee+=Ue,Xe-=Ue,Ae+=Ue,b.length-=Ue;break}b.mode=It;break;case br:for(;Ce<14;){if(_e===0)break e;_e--,oe+=Q[ee++]<<Ce,Ce+=8}if(b.nlen=(oe&31)+257,oe>>>=5,Ce-=5,b.ndist=(oe&31)+1,oe>>>=5,Ce-=5,b.ncode=(oe&15)+4,oe>>>=4,Ce-=4,b.nlen>286||b.ndist>30){l.msg="too many length or distance symbols",b.mode=xt;break}b.have=0,b.mode=yr;case yr:for(;b.have<b.ncode;){for(;Ce<3;){if(_e===0)break e;_e--,oe+=Q[ee++]<<Ce,Ce+=8}b.lens[Kt[b.have++]]=oe&7,oe>>>=3,Ce-=3}for(;b.have<19;)b.lens[Kt[b.have++]]=0;if(b.lencode=b.lendyn,b.lenbits=7,et={bits:b.lenbits},pt=li(qn,b.lens,0,19,b.lencode,0,b.work,et),b.lenbits=et.bits,pt){l.msg="invalid code lengths set",b.mode=xt;break}b.have=0,b.mode=Er;case Er:for(;b.have<b.nlen+b.ndist;){for(;lt=b.lencode[oe&(1<<b.lenbits)-1],it=lt>>>24,ut=lt>>>16&255,st=lt&65535,!(it<=Ce);){if(_e===0)break e;_e--,oe+=Q[ee++]<<Ce,Ce+=8}if(st<16)oe>>>=it,Ce-=it,b.lens[b.have++]=st;else{if(st===16){for(ot=it+2;Ce<ot;){if(_e===0)break e;_e--,oe+=Q[ee++]<<Ce,Ce+=8}if(oe>>>=it,Ce-=it,b.have===0){l.msg="invalid bit length repeat",b.mode=xt;break}Je=b.lens[b.have-1],Ue=3+(oe&3),oe>>>=2,Ce-=2}else if(st===17){for(ot=it+3;Ce<ot;){if(_e===0)break e;_e--,oe+=Q[ee++]<<Ce,Ce+=8}oe>>>=it,Ce-=it,Je=0,Ue=3+(oe&7),oe>>>=3,Ce-=3}else{for(ot=it+7;Ce<ot;){if(_e===0)break e;_e--,oe+=Q[ee++]<<Ce,Ce+=8}oe>>>=it,Ce-=it,Je=0,Ue=11+(oe&127),oe>>>=7,Ce-=7}if(b.have+Ue>b.nlen+b.ndist){l.msg="invalid bit length repeat",b.mode=xt;break}for(;Ue--;)b.lens[b.have++]=Je}}if(b.mode===xt)break;if(b.lens[256]===0){l.msg="invalid code -- missing end-of-block",b.mode=xt;break}if(b.lenbits=9,et={bits:b.lenbits},pt=li(rr,b.lens,0,b.nlen,b.lencode,0,b.work,et),b.lenbits=et.bits,pt){l.msg="invalid literal/lengths set",b.mode=xt;break}if(b.distbits=6,b.distcode=b.distdyn,et={bits:b.distbits},pt=li(nr,b.lens,b.nlen,b.ndist,b.distcode,0,b.work,et),b.distbits=et.bits,pt){l.msg="invalid distances set",b.mode=xt;break}if(b.mode=Ei,N===xi)break e;case Ei:b.mode=Mi;case Mi:if(_e>=6&&Xe>=258){l.next_out=Ae,l.avail_out=Xe,l.next_in=ee,l.avail_in=_e,b.hold=oe,b.bits=Ce,Yn(l,Ze),Ae=l.next_out,te=l.output,Xe=l.avail_out,ee=l.next_in,Q=l.input,_e=l.avail_in,oe=b.hold,Ce=b.bits,b.mode===It&&(b.back=-1);break}for(b.back=0;lt=b.lencode[oe&(1<<b.lenbits)-1],it=lt>>>24,ut=lt>>>16&255,st=lt&65535,!(it<=Ce);){if(_e===0)break e;_e--,oe+=Q[ee++]<<Ce,Ce+=8}if(ut&&!(ut&240)){for(Ke=it,ct=ut,Mt=st;lt=b.lencode[Mt+((oe&(1<<Ke+ct)-1)>>Ke)],it=lt>>>24,ut=lt>>>16&255,st=lt&65535,!(Ke+it<=Ce);){if(_e===0)break e;_e--,oe+=Q[ee++]<<Ce,Ce+=8}oe>>>=Ke,Ce-=Ke,b.back+=Ke}if(oe>>>=it,Ce-=it,b.back+=it,b.length=st,ut===0){b.mode=Lr;break}if(ut&32){b.back=-1,b.mode=It;break}if(ut&64){l.msg="invalid literal/length code",b.mode=xt;break}b.extra=ut&15,b.mode=Mr;case Mr:if(b.extra){for(ot=b.extra;Ce<ot;){if(_e===0)break e;_e--,oe+=Q[ee++]<<Ce,Ce+=8}b.length+=oe&(1<<b.extra)-1,oe>>>=b.extra,Ce-=b.extra,b.back+=b.extra}b.was=b.length,b.mode=wr;case wr:for(;lt=b.distcode[oe&(1<<b.distbits)-1],it=lt>>>24,ut=lt>>>16&255,st=lt&65535,!(it<=Ce);){if(_e===0)break e;_e--,oe+=Q[ee++]<<Ce,Ce+=8}if(!(ut&240)){for(Ke=it,ct=ut,Mt=st;lt=b.distcode[Mt+((oe&(1<<Ke+ct)-1)>>Ke)],it=lt>>>24,ut=lt>>>16&255,st=lt&65535,!(Ke+it<=Ce);){if(_e===0)break e;_e--,oe+=Q[ee++]<<Ce,Ce+=8}oe>>>=Ke,Ce-=Ke,b.back+=Ke}if(oe>>>=it,Ce-=it,b.back+=it,ut&64){l.msg="invalid distance code",b.mode=xt;break}b.offset=st,b.extra=ut&15,b.mode=Ar;case Ar:if(b.extra){for(ot=b.extra;Ce<ot;){if(_e===0)break e;_e--,oe+=Q[ee++]<<Ce,Ce+=8}b.offset+=oe&(1<<b.extra)-1,oe>>>=b.extra,Ce-=b.extra,b.back+=b.extra}if(b.offset>b.dmax){l.msg="invalid distance too far back",b.mode=xt;break}b.mode=Cr;case Cr:if(Xe===0)break e;if(Ue=Ze-Xe,b.offset>Ue){if(Ue=b.offset-Ue,Ue>b.whave&&b.sane){l.msg="invalid distance too far back",b.mode=xt;break}Ue>b.wnext?(Ue-=b.wnext,Qe=b.wsize-Ue):Qe=b.wnext-Ue,Ue>b.length&&(Ue=b.length),bt=b.window}else bt=te,Qe=Ae-b.offset,Ue=b.length;Ue>Xe&&(Ue=Xe),Xe-=Ue,b.length-=Ue;do te[Ae++]=bt[Qe++];while(--Ue);b.length===0&&(b.mode=Mi);break;case Lr:if(Xe===0)break e;te[Ae++]=b.length,Xe--,b.mode=Mi;break;case Fi:if(b.wrap){for(;Ce<32;){if(_e===0)break e;_e--,oe|=Q[ee++]<<Ce,Ce+=8}if(Ze-=Xe,l.total_out+=Ze,b.total+=Ze,b.wrap&4&&Ze&&(l.adler=b.check=b.flags?O(b.check,te,Ze,Ae-Ze):Le(b.check,te,Ze,Ae-Ze)),Ze=Xe,b.wrap&4&&(b.flags?oe:Pr(oe))!==b.check){l.msg="incorrect data check",b.mode=xt;break}oe=0,Ce=0}b.mode=Dr;case Dr:if(b.wrap&&b.flags){for(;Ce<32;){if(_e===0)break e;_e--,oe+=Q[ee++]<<Ce,Ce+=8}if(b.wrap&4&&oe!==(b.total&4294967295)){l.msg="incorrect length check",b.mode=xt;break}oe=0,Ce=0}b.mode=Or;case Or:pt=ts;break e;case xt:pt=ar;break e;case Sr:return or;case Tr:default:return Ot}return l.next_out=Ae,l.avail_out=Xe,l.next_in=ee,l.avail_in=_e,b.hold=oe,b.bits=Ce,(b.wsize||Ze!==l.avail_out&&b.mode<xt&&(b.mode<Fi||N!==sr))&&Fr(l,l.output,l.next_out,Ze-l.avail_out),ft-=l.avail_in,Ze-=l.avail_out,l.total_in+=ft,l.total_out+=Ze,b.total+=Ze,b.wrap&4&&Ze&&(l.adler=b.check=b.flags?O(b.check,te,Ze,l.next_out-Ze):Le(b.check,te,Ze,l.next_out-Ze)),l.data_type=b.bits+(b.last?64:0)+(b.mode===It?128:0)+(b.mode===Ei||b.mode===Ui?256:0),(ft===0&&Ze===0||N===sr)&&pt===jt&&(pt=rs),pt},ds=l=>{if(Ht(l))return Ot;let N=l.state;return N.window&&(N.window=null),l.state=null,jt},cs=(l,N)=>{if(Ht(l))return Ot;const b=l.state;return b.wrap&2?(b.head=N,N.done=!1,jt):Ot},us=(l,N)=>{const b=N.length;let Q,te,ee;return Ht(l)||(Q=l.state,Q.wrap!==0&&Q.mode!==yi)?Ot:Q.mode===yi&&(te=1,te=Le(te,N,b,0),te!==Q.check)?ar:(ee=Fr(l,N,b,b),ee?(Q.mode=Sr,or):(Q.havedict=1,jt))};var vs=Ir,gs=zr,ps=Rr,_s=ls,ms=Br,xs=fs,bs=ds,ys=cs,Es=us,Ms="pako inflate (from Nodeca project)",zt={inflateReset:vs,inflateReset2:gs,inflateResetKeep:ps,inflateInit:_s,inflateInit2:ms,inflate:xs,inflateEnd:bs,inflateGetHeader:ys,inflateSetDictionary:Es,inflateInfo:Ms};function ws(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var As=ws;const Wr=Object.prototype.toString,{Z_NO_FLUSH:Cs,Z_FINISH:Ls,Z_OK:hi,Z_STREAM_END:Ni,Z_NEED_DICT:Vi,Z_STREAM_ERROR:Ds,Z_DATA_ERROR:Gr,Z_MEM_ERROR:Os}=ue;function fi(l){this.options=pi.assign({chunkSize:65536,windowBits:15,to:""},l||{});const N=this.options;N.raw&&N.windowBits>=0&&N.windowBits<16&&(N.windowBits=-N.windowBits,N.windowBits===0&&(N.windowBits=-15)),N.windowBits>=0&&N.windowBits<16&&!(l&&l.windowBits)&&(N.windowBits+=32),N.windowBits>15&&N.windowBits<48&&(N.windowBits&15||(N.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Qi,this.strm.avail_out=0;let b=zt.inflateInit2(this.strm,N.windowBits);if(b!==hi)throw new Error(pe[b]);if(this.header=new As,zt.inflateGetHeader(this.strm,this.header),N.dictionary&&(typeof N.dictionary=="string"?N.dictionary=ai.string2buf(N.dictionary):Wr.call(N.dictionary)==="[object ArrayBuffer]"&&(N.dictionary=new Uint8Array(N.dictionary)),N.raw&&(b=zt.inflateSetDictionary(this.strm,N.dictionary),b!==hi)))throw new Error(pe[b])}fi.prototype.push=function(l,N){const b=this.strm,Q=this.options.chunkSize,te=this.options.dictionary;let ee,Ae,_e;if(this.ended)return!1;for(N===~~N?Ae=N:Ae=N===!0?Ls:Cs,Wr.call(l)==="[object ArrayBuffer]"?b.input=new Uint8Array(l):b.input=l,b.next_in=0,b.avail_in=b.input.length;;){for(b.avail_out===0&&(b.output=new Uint8Array(Q),b.next_out=0,b.avail_out=Q),ee=zt.inflate(b,Ae),ee===Vi&&te&&(ee=zt.inflateSetDictionary(b,te),ee===hi?ee=zt.inflate(b,Ae):ee===Gr&&(ee=Vi));b.avail_in>0&&ee===Ni&&b.state.wrap>0&&l[b.next_in]!==0;)zt.inflateReset(b),ee=zt.inflate(b,Ae);switch(ee){case Ds:case Gr:case Vi:case Os:return this.onEnd(ee),this.ended=!0,!1}if(_e=b.avail_out,b.next_out&&(b.avail_out===0||ee===Ni))if(this.options.to==="string"){let Xe=ai.utf8border(b.output,b.next_out),oe=b.next_out-Xe,Ce=ai.buf2string(b.output,Xe);b.next_out=oe,b.avail_out=Q-oe,oe&&b.output.set(b.output.subarray(Xe,Xe+oe),0),this.onData(Ce)}else this.onData(b.output.length===b.next_out?b.output:b.output.subarray(0,b.next_out));if(!(ee===hi&&_e===0)){if(ee===Ni)return ee=zt.inflateEnd(this.strm),this.onEnd(ee),this.ended=!0,!0;if(b.avail_in===0)break}}return!0},fi.prototype.onData=function(l){this.chunks.push(l)},fi.prototype.onEnd=function(l){l===hi&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=pi.flattenChunks(this.chunks)),this.chunks=[],this.err=l,this.msg=this.strm.msg};function ki(l,N){const b=new fi(N);if(b.push(l),b.err)throw b.msg||pe[b.err];return b.result}function Ss(l,N){return N=N||{},N.raw=!0,ki(l,N)}var Ts=fi,Ps=ki,Rs=Ss,Is=ki,zs=ue,Bs={Inflate:Ts,inflate:Ps,inflateRaw:Rs,ungzip:Is,constants:zs};const{Deflate:Us,deflate:Fs,deflateRaw:Ws,gzip:Gs}=Kn,{Inflate:Ns,inflate:Vs,inflateRaw:ks,ungzip:js}=Bs;var Nr=Us,Vr=Fs,kr=Ws,jr=Gs,Hr=Ns,Kr=Vs,Zr=ks,Yr=js,Xr=ue,Hs={Deflate:Nr,deflate:Vr,deflateRaw:kr,gzip:jr,Inflate:Hr,inflate:Kr,inflateRaw:Zr,ungzip:Yr,constants:Xr}}},__webpack_module_cache__={};function __webpack_require__(X){var L=__webpack_module_cache__[X];if(L!==void 0)return L.exports;var c=__webpack_module_cache__[X]={exports:{}};return __webpack_modules__[X].call(c.exports,c,c.exports,__webpack_require__),c.exports}__webpack_require__.n=X=>{var L=X&&X.__esModule?()=>X.default:()=>X;return __webpack_require__.d(L,{a:L}),L},__webpack_require__.d=(X,L)=>{for(var c in L)__webpack_require__.o(L,c)&&!__webpack_require__.o(X,c)&&Object.defineProperty(X,c,{enumerable:!0,get:L[c]})},__webpack_require__.o=(X,L)=>Object.prototype.hasOwnProperty.call(X,L),__webpack_require__.r=X=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(X,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(X,"__esModule",{value:!0})},__webpack_require__("./src/index.ts"),__webpack_require__("./src/SurfaceWorker.js");var __webpack_exports__=__webpack_require__("./src/exporter.js");return __webpack_exports__})())})(_3Dmol);var _3DmolExports=_3Dmol.exports;const _withScopeId=X=>(pushScopeId("data-v-ad35c618"),X=X(),popScopeId(),X),_hoisted_1$1={class:"w-full h-full flex-column"},_hoisted_2={class:"w-full h-2rem top-0 left-0 m-1 p-2 top-tools shadow-1 flex align-items-center"},_hoisted_3=_withScopeId(()=>createBaseVNode("i",{class:"w-1rem h-full ml-3 border-400 border-left-1"},null,-1)),_hoisted_4=_withScopeId(()=>createBaseVNode("path",{d:"M8.365 12.51c-.604 0-1.142-.104-1.614-.312-.469-.21-.84-.498-1.112-.865a2.176 2.176 0 01-.417-1.278h1.764a.92.92 0 00.198.534c.124.15.289.268.494.352.204.083.435.125.691.125.267 0 .503-.047.708-.142.205-.094.365-.225.481-.392a.99.99 0 00.174-.578.969.969 0 00-.186-.587 1.19 1.19 0 00-.526-.404 2.045 2.045 0 00-.809-.146H7.44V7.531h.772c.265 0 .498-.046.7-.138.205-.091.364-.218.477-.38a.988.988 0 00.17-.574.993.993 0 00-.562-.918 1.341 1.341 0 00-.615-.134c-.237 0-.454.043-.65.13a1.138 1.138 0 00-.474.36.947.947 0 00-.19.55H5.388c.008-.477.144-.898.409-1.262.264-.364.62-.649 1.068-.854A3.6 3.6 0 018.389 4c.572 0 1.072.104 1.501.311.429.208.762.488.999.842.24.35.359.744.356 1.18.003.465-.142.851-.433 1.162-.288.31-.664.507-1.128.59v.065c.61.078 1.073.29 1.391.635.32.342.48.771.477 1.286.003.472-.133.891-.408 1.258-.273.367-.649.655-1.129.865-.48.21-1.03.316-1.65.316zM15.34 12.397h-2.936V4.113h2.96c.834 0 1.551.166 2.153.498a3.356 3.356 0 011.387 1.42c.326.617.49 1.356.49 2.216 0 .863-.164 1.604-.49 2.225a3.363 3.363 0 01-1.395 1.427c-.605.332-1.327.498-2.168.498zm-1.184-1.5h1.112c.518 0 .953-.092 1.306-.276a1.77 1.77 0 00.801-.861c.18-.391.271-.896.271-1.513 0-.612-.09-1.112-.271-1.5a1.754 1.754 0 00-.797-.858c-.353-.184-.788-.275-1.306-.275h-1.117v5.282zM20.222 10v1.5c1.5 0 4 5.7-6 6.5v1.5c12.5-1 9-9.5 6-9.5zM8.107 16.33l-.385 1.391c-7.5-1.221-5.5-5.721-4-6.221V10c-2 0-6.5 7 3.755 8.951l-.199 1.207a.2.2 0 00.268.22l3.363-1.269a.2.2 0 00.071-.328l-2.538-2.538a.2.2 0 00-.335.088z",fill:"black"},null,-1)),_hoisted_5=[_hoisted_4],_hoisted_6={class:"flex-1 h-full"},_sfc_main$2=defineComponent({__name:"ViewContent",setup(X){let L=useMolStore();const c=ref();let A;function T(y){A&&axios.get(`http://127.0.0.1:8080/molecule?value=${y}`).then(function(C){A.removeAllModels(),A.addModel(C.data,"sdf"),A.setStyle({},{sphere:{scale:.25},stick:{radius:.1}}),A.zoomTo()}).finally(function(){A.render()})}onMounted(()=>{A=_3DmolExports.createViewer(c.value)});function D(y){y==="convert"?P():y==="picture"&&u()}function P(){L.config.convert=!L.config.convert}function u(){L.config.picture=!L.config.picture;let y=A.pngURI(),C=document.createElement("a");C.href=y,C.download="3d_image.png",C.click()}return watch(()=>L.config.smiles,()=>{T(L.config.smiles)}),(y,C)=>(openBlock(),createElementBlock("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2,[_hoisted_3,(openBlock(),createElementBlock("svg",{width:"25",height:"25",viewBox:"0 0 25 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",onClick:C[0]||(C[0]=v=>D("convert"))},_hoisted_5)),createBaseVNode("i",{class:"pi pi-images text-base ml-3",onClick:C[1]||(C[1]=v=>D("picture"))})]),createBaseVNode("div",_hoisted_6,[createBaseVNode("div",{class:"relative w-full h-full",ref_key:"container",ref:c},null,512)])]))}}),ViewContent=_export_sfc(_sfc_main$2,[["__scopeId","data-v-ad35c618"]]),_sfc_main$1=defineComponent({__name:"Content",setup(X){let L=ref(0),c=ref(0);function A(D){for(const P of D)c.value=P.contentRect.width,L.value=P.contentRect.height}const T=ref();return onMounted(()=>{new ResizeObserver(A).observe(T.value)}),(D,P)=>(openBlock(),createElementBlock("div",{ref_key:"contentContainer",ref:T,class:"h-full w-full flex"},[createVNode(Content,{width:unref(c)/2,height:unref(L)},null,8,["width","height"]),createVNode(ViewContent,{width:unref(c)/2,height:unref(L)},null,8,["width","height"])],512))}}),_hoisted_1={class:"h-full w-full"},_sfc_main=defineComponent({__name:"MaterialVisualization",setup(X){return(L,c)=>(openBlock(),createElementBlock("div",_hoisted_1,[createVNode(_sfc_main$1)]))}});export{_sfc_main as default};
